<!DOCTYPE html>
<html>
<head>
    

    

    
<!-- Baidu Tongji -->
<script>var _hmt = _hmt || []</script>
<script async src="//hm.baidu.com/hm.js?86125ece8b26a0a600d8b5b04d6e4695"></script>
<!-- End Baidu Tongji -->




    <meta charset="utf-8">
    
    
    <link rel="canonical" href="https://hubojing.github.io//2017/07/20/树状控件与列表控件交互以及XML的解析/">
    
    
    <title>树状控件与列表控件交互以及XML的解析 | 靖待的技术博客 | 小清新IT旅程 | 为中华之崛起而读书</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="CPP,MFC,XML">
    <meta name="description" content="自查笔记。">
<meta name="keywords" content="CPP,MFC,XML">
<meta property="og:type" content="article">
<meta property="og:title" content="树状控件与列表控件交互以及XML的解析">
<meta property="og:url" content="https://hubojing.github.io/2017/07/20/树状控件与列表控件交互以及XML的解析/index.html">
<meta property="og:site_name" content="靖待的技术博客">
<meta property="og:description" content="自查笔记。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://s8.51cto.com/wyfs02/M00/5B/67/wKioL1UI1-LRY-VkAADQ3snhmcU770.jpg">
<meta property="og:updated_time" content="2017-09-10T08:47:42.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="树状控件与列表控件交互以及XML的解析">
<meta name="twitter:description" content="自查笔记。">
<meta name="twitter:image" content="http://s8.51cto.com/wyfs02/M00/5B/67/wKioL1UI1-LRY-VkAADQ3snhmcU770.jpg">
    
        <link rel="alternate" type="application/atom+xml" title="靖待的技术博客" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<!--google adsense code-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-2097896583568287",
    enable_page_level_ads: true
  });
</script>
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu"  >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">靖待</h5>
          <a href="mailto:hubojing@outlook.com" title="hubojing@outlook.com" class="mail">hubojing@outlook.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archive"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/hubojing/"  >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://blog.csdn.net/hubojing/"  >
                <i class="icon icon-lg icon-pencil"></i>
                CSDN博客
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://music.163.com/#/user/home?id=92203594"  >
                <i class="icon icon-lg icon-music"></i>
                网易云音乐
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/friends"  >
                <i class="icon icon-lg icon-users"></i>
                友情链接
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about/Chinese"  >
                <i class="icon icon-lg icon-child"></i>
                关于
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/comment"  >
                <i class="icon icon-lg icon-book"></i>
                留言板
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/littletalk"  >
                <i class="icon icon-lg icon-edit"></i>
                自言自语
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/advertising"  >
                <i class="icon icon-lg icon-link"></i>
                推广
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://wpa.qq.com/msgrd?v=3&uin=417797456&site=qq&menu=yes"  >
                <i class="icon icon-lg icon-qq"></i>
                和我在线交流
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">树状控件与列表控件交互以及XML的解析</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">树状控件与列表控件交互以及XML的解析</h1>
        <h5 class="subtitle">
            
                <time datetime="2017-07-20T15:04:43.000Z" itemprop="datePublished" class="page-time">
  2017-07-20
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/编程语言/">编程语言</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#方法记录"><span class="post-toc-number">1.</span> <span class="post-toc-text">方法记录</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#MSXML相关"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">MSXML相关</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#创建对象"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">创建对象</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#获取根节点"><span class="post-toc-number">1.1.2.</span> <span class="post-toc-text">获取根节点</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#获取属性（法一）"><span class="post-toc-number">1.1.3.</span> <span class="post-toc-text">获取属性（法一）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#获取属性（法二）"><span class="post-toc-number">1.1.4.</span> <span class="post-toc-text">获取属性（法二）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#删除节点"><span class="post-toc-number">1.1.5.</span> <span class="post-toc-text">删除节点</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#树控件相关"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">树控件相关</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#插入"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">插入</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#存入数据"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">存入数据</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#获得根节点"><span class="post-toc-number">1.2.3.</span> <span class="post-toc-text">获得根节点</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#展开树"><span class="post-toc-number">1.2.4.</span> <span class="post-toc-text">展开树</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#获取选中树"><span class="post-toc-number">1.2.5.</span> <span class="post-toc-text">获取选中树</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#列表控件相关"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">列表控件相关</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#插入-1"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">插入</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#存入数据-1"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">存入数据</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#删除全部项"><span class="post-toc-number">1.3.3.</span> <span class="post-toc-text">删除全部项</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#在列表最后插入"><span class="post-toc-number">1.3.4.</span> <span class="post-toc-text">在列表最后插入</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#其它C-相关"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">其它C++相关</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#MessageBox"><span class="post-toc-number">1.4.1.</span> <span class="post-toc-text">MessageBox</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#父对话框给子对话框传值"><span class="post-toc-number">1.4.2.</span> <span class="post-toc-text">父对话框给子对话框传值</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#在子对话框显示图片"><span class="post-toc-number">1.4.3.</span> <span class="post-toc-text">在子对话框显示图片</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#vector"><span class="post-toc-number">1.4.4.</span> <span class="post-toc-text">vector</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#map"><span class="post-toc-number">1.4.5.</span> <span class="post-toc-text">map</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#父子循环"><span class="post-toc-number">1.4.6.</span> <span class="post-toc-text">父子循环</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#几个函数"><span class="post-toc-number">1.4.7.</span> <span class="post-toc-text">几个函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#创建临时文件夹"><span class="post-toc-number">1.4.8.</span> <span class="post-toc-text">创建临时文件夹</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#复制文件夹及子文件"><span class="post-toc-number">1.4.9.</span> <span class="post-toc-text">复制文件夹及子文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#删除文件目录及子文件夹"><span class="post-toc-number">1.4.10.</span> <span class="post-toc-text">删除文件目录及子文件夹</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#文件遍历"><span class="post-toc-number">1.4.11.</span> <span class="post-toc-text">文件遍历</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#截取字符串"><span class="post-toc-number">1.4.12.</span> <span class="post-toc-text">截取字符串</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#禁用"><span class="post-toc-number">1.4.13.</span> <span class="post-toc-text">禁用</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#调用exe"><span class="post-toc-number">1.4.14.</span> <span class="post-toc-text">调用exe</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#窗口缩放"><span class="post-toc-number">1.4.15.</span> <span class="post-toc-text">窗口缩放</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#更新数据"><span class="post-toc-number">1.4.16.</span> <span class="post-toc-text">更新数据</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#数据类型转换"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">数据类型转换</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#MSDN参考"><span class="post-toc-number">2.</span> <span class="post-toc-text">MSDN参考</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#MSXML"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">MSXML</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#TreeControl控件"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">TreeControl控件</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ListControl控件"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">ListControl控件</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#思维碰撞"><span class="post-toc-number">3.</span> <span class="post-toc-text">思维碰撞</span></a></li></ol>
        </nav>
    </aside>


<article id="post-树状控件与列表控件交互以及XML的解析"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">树状控件与列表控件交互以及XML的解析</h1>
        <div class="post-meta">
            <time class="post-time" title="2017-07-20 23:04:43" datetime="2017-07-20T15:04:43.000Z"  itemprop="datePublished">2017-07-20</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/编程语言/">编程语言</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <div align="left"><br><img src="http://s8.51cto.com/wyfs02/M00/5B/67/wKioL1UI1-LRY-VkAADQ3snhmcU770.jpg" width="300" height="180" style="float:right;"><br><br><br>　　<strong>自查笔记。</strong><br>　　<br>　　　<br><br> </div>

<a id="more"></a>
<h1 id="方法记录"><a href="#方法记录" class="headerlink" title="方法记录"></a>方法记录</h1><h2 id="MSXML相关"><a href="#MSXML相关" class="headerlink" title="MSXML相关"></a>MSXML相关</h2><h3 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MSXML2::IXMLDOMDocumentPtr pDoc;</span><br><span class="line"></span><br><span class="line">HRESULT hr = pDoc.CreateInstance(_uuidof(MSXML2::DOMDocument60));</span><br><span class="line"><span class="keyword">if</span>(!pDoc)</span><br><span class="line">&#123;</span><br><span class="line">	ASSERT(FALSE);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">_variant_t</span> varOut((<span class="keyword">bool</span>)TRUE);</span><br><span class="line">varOut = pDoc-&gt;load(xmlPath);</span><br><span class="line"><span class="keyword">if</span> ((<span class="keyword">bool</span>)varOut == FALSE)</span><br><span class="line">&#123;</span><br><span class="line">	::MessageBox(<span class="literal">NULL</span>, <span class="string">"Wrong!"</span>, <span class="string">"提示"</span>, MB_ICONERROR);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="获取根节点"><a href="#获取根节点" class="headerlink" title="获取根节点"></a>获取根节点</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MSXML2::IXMLDOMElementPtr pNode;</span><br><span class="line">pNode = pDoc-&gt;GetdocumentElement();</span><br></pre></td></tr></table></figure>
<h3 id="获取属性（法一）"><a href="#获取属性（法一）" class="headerlink" title="获取属性（法一）"></a>获取属性（法一）</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">MSXML2::IXMLDOMNamedNodeMapPtr pAttrMap;</span><br><span class="line">MSXML2::IXMLDOMNodePtr pAttrItem;</span><br><span class="line">MSXML2::IXMLDOMNodeListPtr pNodeList = pNode-&gt;GetchildNodes();</span><br><span class="line"><span class="keyword">long</span> Len = pNodeList-&gt;Getlength();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Len; ++i)</span><br><span class="line">&#123;</span><br><span class="line">	MSXML2::IXMLDOMElementPtr pChildNode = (MSXML2::IXMLDOMElementPtr)pNodeList-&gt;Getitem(i);</span><br><span class="line">	pChildNode-&gt;get_attributes(&amp;pAttrMap);</span><br><span class="line">	<span class="keyword">long</span> count;</span><br><span class="line">	pAttrMap-&gt;get_length(&amp;count);</span><br><span class="line">	<span class="keyword">if</span> (count)</span><br><span class="line">	&#123;</span><br><span class="line">		pAttrMap-&gt;get_item(<span class="number">0</span>, &amp;pAttrItem);</span><br><span class="line">		<span class="keyword">_variant_t</span> variantItemName;</span><br><span class="line">		pAttrItem-&gt;get_nodeTypedValue(&amp;variantItemName);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="获取属性（法二）"><a href="#获取属性（法二）" class="headerlink" title="获取属性（法二）"></a>获取属性（法二）</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">MSXML2::IXMLDOMNodeListPtr pList = pRoot-&gt;GetchildNodes();</span><br><span class="line"><span class="keyword">int</span> iCount = pList-&gt;Getlength();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; iCount; ++i)</span><br><span class="line">&#123;</span><br><span class="line">	MSXML2::IXMLDOMElementPtr pItem = (MSXML2::IXMLDOMElementPtr)pList-&gt;item[i];</span><br><span class="line">	MSXML2::IXMLDOMNamedNodeMapPtr pAttrMap = pItem-&gt;Getattributes();</span><br><span class="line">	MSXML2::IXMLDOMNodePtr pAttrItem;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> att = <span class="number">0</span>; att &lt; pAttrMap-&gt;length; ++att)</span><br><span class="line">	&#123;</span><br><span class="line">		pAttrItem = pAttrMap-&gt;Getitem(att);</span><br><span class="line">		strTemp = (LPCTSTR)pAttrItem-&gt;GetnodeName();</span><br><span class="line">		<span class="keyword">_variant_t</span> value;</span><br><span class="line">		value = pAttrItem-&gt;GetnodeValue();</span><br><span class="line">		<span class="keyword">if</span> (strTemp == <span class="string">"某属性名1"</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//需要进行的操作</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (strTemp == <span class="string">"某属性名2"</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//需要进行的操作</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="删除节点"><a href="#删除节点" class="headerlink" title="删除节点"></a>删除节点</h3><p>连同子节点一起删 pChildNode-&gt;GetParentNode()-&gt;removeChild(pChildNode);</p>
<h2 id="树控件相关"><a href="#树控件相关" class="headerlink" title="树控件相关"></a>树控件相关</h2><h3 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h3><p>HTREEITEM ht = m_tree.InsertItem((_bstr_t)variantValue, 1, 1, ht, TVI_LAST);<br>依次是：插入的数据，树前图标点击前，树前图标点击后，父节点，插在最后。</p>
<h3 id="存入数据"><a href="#存入数据" class="headerlink" title="存入数据"></a>存入数据</h3><p>m_tree.SetItemData(ht,(DWORD_PTR)数据);</p>
<h3 id="获得根节点"><a href="#获得根节点" class="headerlink" title="获得根节点"></a>获得根节点</h3><p>HTREEITEM hRoot=m_tree.GetRootItem();</p>
<h3 id="展开树"><a href="#展开树" class="headerlink" title="展开树"></a>展开树</h3><p>m_tree.Expand(ht,TVE_EXPAND);</p>
<h3 id="获取选中树"><a href="#获取选中树" class="headerlink" title="获取选中树"></a>获取选中树</h3><p>HTREEITEM ChooseItem = m_tree.GetSelectedItem();<br>获取数据<br>数据类型animal <em>pStructure = (数据类型animal</em>)m_tree.GetitemData(ChooseItem);</p>
<h2 id="列表控件相关"><a href="#列表控件相关" class="headerlink" title="列表控件相关"></a>列表控件相关</h2><h3 id="插入-1"><a href="#插入-1" class="headerlink" title="插入"></a>插入</h3><p>m_list.InsertItem(i,(LPCTSTR)数据,i);</p>
<h3 id="存入数据-1"><a href="#存入数据-1" class="headerlink" title="存入数据"></a>存入数据</h3><p>m_list.SetItemData(i,(DWORD_PTR)数据);</p>
<h3 id="删除全部项"><a href="#删除全部项" class="headerlink" title="删除全部项"></a>删除全部项</h3><p>m_list.DeleteAllItems();</p>
<h3 id="在列表最后插入"><a href="#在列表最后插入" class="headerlink" title="在列表最后插入"></a>在列表最后插入</h3><p>int iRow = m_list.GetItemCount();<br>m_list.InsertItem(iRow, text, 0);<br>text 插入的文本 0表示imagelist中的第一个图片<br>imagelist是由一幅幅image拼起来的长图列表</p>
<h2 id="其它C-相关"><a href="#其它C-相关" class="headerlink" title="其它C++相关"></a>其它C++相关</h2><h3 id="MessageBox"><a href="#MessageBox" class="headerlink" title="MessageBox"></a>MessageBox</h3><p>MessageBox分为win API 和 MFC封装两种。<br>win API:<br>::MessageBox(1, 2, 3, 4);<br>1为父窗口句柄，常用NULL<br>2为显示的字符串<br>3为标题栏显示的字符串<br>4为图标icon  有四种：MB_ICONERROR,MB_ICONINFORMATION,MB_ICONWARNING,MB_ICONQUESTION</p>
<h3 id="父对话框给子对话框传值"><a href="#父对话框给子对话框传值" class="headerlink" title="父对话框给子对话框传值"></a>父对话框给子对话框传值</h3><p>如果子对话框是模态对话框，那么子对话框是无法在弹出后调用父对话框的控件变量的。只能在DoModal之前，通过一个子对话框的自定义成员变量传递过去。<br>eg.<br>CxxDlg dlg;<br>UpdateData(TRUE);<br>dlg.m_str=m_edit;<br>dlg.DoModal();</p>
<p>一种不良的方式：<br>父对话框 BookDlg  子对话框TitleDlg<br>在父对话框中 TitleDlg dlg(this);<br>在子对话框中 CBookDlg <em>parent = (CBookDlg</em>)GetParent();<br>然后就可以使用了：<br>CString text=pParent-&gt;m_sentence;<br>m_sentence是父对话框类的成员变量</p>
<p>父窗口引用子窗口变量<br>在父窗口中 xxxDlg dlg;<br>if(dlg.DoModal() == IDOK)<br>{<br>//操作<br>}</p>
<h3 id="在子对话框显示图片"><a href="#在子对话框显示图片" class="headerlink" title="在子对话框显示图片"></a>在子对话框显示图片</h3><p>给自对话框添加OnInitDlg()<br>添加OnPaint()<br>(记得加WM_ONPAINT消息)<br>在OnInitDlg中加载图片，在OnPanint()中重绘图片。（在初始化里重绘是不行的）</p>
<h3 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h3><p>添加头文件#include <vector><br>vector容器，std::vector&lt;类型*&gt; name;  push_back添加元素。<br>遍历元素使用迭代器iterator，for循环<br>vector&lt;数据类型&gt;::iterator it;<br>for(it=数据.begin();it!=数据.end();it++)<br>{<br>    //操作<br>    Break;<br>}</vector></p>
<h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p>添加头文件#include <map><br>std::map&lt;CString, std::vector&lt;信息&gt;&gt;<br>一个CString对应一个vector。查询时也是先遍历（迭代器）再比较，it-&gt;first指代返回关键字，it-&gt;second指代数据。</map></p>
<h3 id="父子循环"><a href="#父子循环" class="headerlink" title="父子循环"></a>父子循环</h3><p>父子循环遍历时避免使用相同的变量名。</p>
<h3 id="几个函数"><a href="#几个函数" class="headerlink" title="几个函数"></a>几个函数</h3><p>检查路径合法性 PathFileExists(path)，使用它需要加上头文件#include “shlwapi.h”<br>字符连接 CString str;<br>str.Format((“%s%s\%s\“),path,”第三层”,”第四层”));<br>复制文件CopyFile(原完整带后缀路径，复制后的带后缀完整目的路径,TRUE);  该函数有返回值<br>比较<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(strTemp.Compare(<span class="string">"相比较的字符串"</span>)==<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//操作</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="创建临时文件夹"><a href="#创建临时文件夹" class="headerlink" title="创建临时文件夹"></a>创建临时文件夹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">TCHAR Temp[<span class="number">512</span>];</span><br><span class="line">GetTempPath(<span class="number">512</span>, Temp);</span><br><span class="line">CString strTempPath;</span><br><span class="line">strTempPath.Format(<span class="string">"%s\\Mydata"</span>, Temp);</span><br><span class="line"><span class="keyword">if</span> (!PathFileExists(strTempPath))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (!CreateDirectory(strTempPath, <span class="literal">NULL</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		ASSERT(FALSE);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="复制文件夹及子文件"><a href="#复制文件夹及子文件" class="headerlink" title="复制文件夹及子文件"></a>复制文件夹及子文件</h3><p>写一个函数CopyDiretory(CString source, CString target)<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	CFileFind finder;</span><br><span class="line"><span class="keyword">bool</span> bWorking = finder.FindFile(source);</span><br><span class="line"><span class="keyword">while</span> (bWorking)</span><br><span class="line">&#123;</span><br><span class="line">	bWorking = finder.FindNextFile();</span><br><span class="line">	<span class="keyword">if</span> (finder.IsDirectory() &amp;&amp; !finder.IsDots())</span><br><span class="line">	&#123;</span><br><span class="line">		copyDiretory(finder.GetFilePath(), target + <span class="string">"\\"</span> + finder.GetFileName();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		Bool temp = CopyFile(finder.GetFilePath(), target + <span class="string">"\\"</span> + finder.GetFileName(), FALSE);</span><br><span class="line">		<span class="keyword">if</span> (temp == <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			MessageBox(<span class="string">"复制失败！"</span>);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="删除文件目录及子文件夹"><a href="#删除文件目录及子文件夹" class="headerlink" title="删除文件目录及子文件夹"></a>删除文件目录及子文件夹</h3><p>写一个DeleteDirectory函数<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">CFileFind finder;</span><br><span class="line">CString path;</span><br><span class="line">path.Format(<span class="string">"%s\\*.*"</span>, directorypath);</span><br><span class="line">BOOL bWorking = finder.FindFile(path);</span><br><span class="line"><span class="keyword">while</span> (bWorking)</span><br><span class="line">&#123;</span><br><span class="line">	bWorking = finder.FindNextFile();</span><br><span class="line">	<span class="keyword">if</span> (finder.IsDirectory() &amp;&amp; !finder.IsDots())</span><br><span class="line">	&#123;</span><br><span class="line">		DeleteDirectory(finder.GetFilePath());</span><br><span class="line">		RemoveDirectory(finder.GetFilePath();)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		DeleteFile(finder.GetFilePath());</span><br><span class="line">	&#125;</span><br><span class="line">	finder.Close();</span><br><span class="line">	RemoveDirectory(directoryPath);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="文件遍历"><a href="#文件遍历" class="headerlink" title="文件遍历"></a>文件遍历</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">CFileFind finder;</span><br><span class="line">CString strName;</span><br><span class="line">BOOL bWorking = finder.FindFile(path);</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;CString&gt;a;</span><br><span class="line"><span class="keyword">while</span> (bWorking)</span><br><span class="line">&#123;</span><br><span class="line">	bWorking = finder.FindNextFile();</span><br><span class="line">	strName = finder.GetFileName();</span><br><span class="line">	a.push_back(strName);<span class="comment">//获取全部文件名</span></span><br><span class="line">	<span class="built_in">vector</span>&lt;CString&gt;::iterator it;</span><br><span class="line">	<span class="keyword">for</span> (it = a.begin(); it != a.end(); it++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> ((*it) == strFileName)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//需要的处理代码</span></span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="截取字符串"><a href="#截取字符串" class="headerlink" title="截取字符串"></a>截取字符串</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span>* temp = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">260</span>];</span><br><span class="line">::GetCurrentDirectory(<span class="number">260</span>, temp);<span class="comment">//得到的是DWord型</span></span><br><span class="line">CString strTempDir = temp;</span><br><span class="line"><span class="keyword">char</span>* str = strTempDir.GetBuffer(strTempDir.GetLength() + <span class="number">1</span>);</span><br><span class="line"><span class="keyword">char</span>* delim = <span class="string">"\\"</span>;</span><br><span class="line"><span class="keyword">char</span>* buf;</span><br><span class="line"><span class="keyword">char</span>* p1 = strtok_s(str, delim, &amp;buf);</span><br><span class="line"><span class="keyword">char</span>*p2 = strtok_s(<span class="literal">NULL</span>, delim, &amp;buf);</span><br><span class="line">CString strp1 = (<span class="keyword">_bstr_t</span>)p1;</span><br><span class="line">CString strp2 = (<span class="keyword">_bstr_t</span>)p2;</span><br></pre></td></tr></table></figure>
<p>循环截取<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span>* str = strName.GetBuffer(strName.GetLength() + <span class="number">1</span>);</span><br><span class="line"><span class="keyword">char</span>* delim = <span class="string">"\\"</span>;</span><br><span class="line"><span class="keyword">char</span>* buf;</span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; str[i]; i++)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (str[i] == *delim)</span><br><span class="line">	&#123;</span><br><span class="line">		count++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">char</span>* p = strtok_s(str, delim, *buf);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; count; j++)</span><br><span class="line">	&#123;</span><br><span class="line">		p = strtok_s(<span class="literal">NULL</span>, delim, &amp;buf);</span><br><span class="line">	&#125;</span><br><span class="line">	CString strp = (<span class="keyword">_bstr_t</span>)p;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="禁用"><a href="#禁用" class="headerlink" title="禁用"></a>禁用</h3><p>GetDlgItem(IDC_Text)-&gt;EnableWindow(FALSE);</p>
<h3 id="调用exe"><a href="#调用exe" class="headerlink" title="调用exe"></a>调用exe</h3><p>法一：<br>UINT temp=WinExec(strPath,SW_SHOWNORMAL);<br>法二：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">STARTUPINFO si;</span><br><span class="line"><span class="built_in">memset</span>(&amp;si, <span class="number">0</span>, <span class="keyword">sizeof</span>(STARTUPINFO));</span><br><span class="line">si.cb = <span class="keyword">sizeof</span>(STARTUPINFO);</span><br><span class="line">si.dwFlags = STARTF_USESHOWWINDOW;</span><br><span class="line">si.wShowWindow = SW_SHOW;</span><br><span class="line">PROCESS_INFORMATION pi;</span><br><span class="line">BOOL bDemoPro = CreateProcess(path, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, FALSE, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, &amp;si, &amp;pi);</span><br><span class="line"><span class="keyword">if</span> (!bDemoPro)</span><br><span class="line">&#123;</span><br><span class="line">	ASSERT(FALSE);</span><br><span class="line">&#125;</span><br><span class="line">WaitForSingleObject(pi.hProcess, INFINITE);</span><br><span class="line">CloseHandle(pi.hThread);</span><br><span class="line">CloseHandle(pi.hProcess);</span><br></pre></td></tr></table></figure></p>
<h3 id="窗口缩放"><a href="#窗口缩放" class="headerlink" title="窗口缩放"></a>窗口缩放</h3><p>.h文件中：<br>protected:<br>afx_msg void OnSize(UINT nType,int cx, int cy);<br>POINT old;<br>CRect m_rect;</p>
<p>.cpp文件中：<br>ON_WM_SIZE()</p>
<p>在OnInitDialog()中：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GetClientRect(&amp;m_rect);<span class="comment">//初始大小</span></span><br><span class="line">old.x = m_rect.right - m_rect.left;</span><br><span class="line">old.y = m_rect.bottom - m_rect.top;</span><br></pre></td></tr></table></figure></p>
<p>在OnSize函数中：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	CDialog::OnSize(nTpye, cx, cy);</span><br><span class="line">	<span class="comment">//TODO</span></span><br><span class="line">	<span class="keyword">float</span> fsp[<span class="number">2</span>];</span><br><span class="line">	POINT Newp;</span><br><span class="line">	CRect rectNow;</span><br><span class="line">	GetClientRect(&amp;rectNow);</span><br><span class="line">	Newp.x = rectNow.right - rectNow.left;</span><br><span class="line">	Newp.y = rectNow.bottom - rectNow.top;</span><br><span class="line">	fsp[<span class="number">0</span>] = (<span class="keyword">float</span>)Newp.x / old.x;</span><br><span class="line">	fsp[<span class="number">1</span>] = (<span class="keyword">float</span>)Newp.y / old.y;</span><br><span class="line">	CRect Rect;</span><br><span class="line">	<span class="keyword">int</span> woc;</span><br><span class="line">	CPoint OldTLPoint, TLPoint;<span class="comment">//左上</span></span><br><span class="line">	CPoint OldBRPoint, BRPoint;<span class="comment">//右下</span></span><br><span class="line">	HWND hwndChild = ::GetWindow(m_hWnd, GW_CHILD);<span class="comment">//列出所有控件</span></span><br><span class="line">	<span class="keyword">while</span> (hwndChild)</span><br><span class="line">	&#123;</span><br><span class="line">		woc = ::GetDlgCtrlID(hwndChild);</span><br><span class="line">		GetDlgItem(woc)-&gt;GetWindowRect(Rect);</span><br><span class="line">		ScreenToClient(Rect);</span><br><span class="line">		OldTLPoint = Rect.TopLeft();</span><br><span class="line">		TLPoint.x = <span class="keyword">long</span>(OldTLPoint.x*fsp[<span class="number">0</span>]);</span><br><span class="line">		TLPoint.y = <span class="keyword">long</span>(OldTLPoint.y*fsp[<span class="number">1</span>]);</span><br><span class="line">		OldBRPoint = Rect.BottomRight();</span><br><span class="line">		BRPoint.x = <span class="keyword">long</span>(OldBRPoint.x*fsp[<span class="number">0</span>]);</span><br><span class="line">		BRPoint.y = <span class="keyword">long</span>(OldBRPoint.y*fsp[<span class="number">1</span>]);</span><br><span class="line">		Rect.SetRect(TLPoint, BRPoint);</span><br><span class="line">		GetDlgItem(woc)-&gt;MoveWindow(Rect, TRUE);</span><br><span class="line">		hwndChild = ::GetWindow(hwndChild, GW_HWNDNEXT);</span><br><span class="line">	&#125;</span><br><span class="line">	old = Newp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h3><p>UpdateData(TRUE);//更新值到界面<br>UpdateData(FALSE);//更新界面到值</p>
<h2 id="数据类型转换"><a href="#数据类型转换" class="headerlink" title="数据类型转换"></a>数据类型转换</h2><ol>
<li>int转CString<br>iRow是int型，number是CString型。<br>CString number;<br>number.Format(“%d”, iRow);</li>
</ol>
<p>2._variant_t转int<br>_variant_t a;<br>int b;<br>b=_ttoi((LPCTSTR)(_bstr_t)a);</p>
<hr>
<h1 id="MSDN参考"><a href="#MSDN参考" class="headerlink" title="MSDN参考"></a>MSDN参考</h1><h2 id="MSXML"><a href="#MSXML" class="headerlink" title="MSXML"></a>MSXML</h2><p>MSXML API 历史记录 <a href="https://msdn.microsoft.com/zh-cn/library/ms762314(v=vs.85).aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/zh-cn/library/ms762314(v=vs.85).aspx</a> </p>
<p>MSXML SDK 概述 <a href="https://msdn.microsoft.com/zh-cn/library/ms760399(v=vs.85).aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/zh-cn/library/ms760399(v=vs.85).aspx</a> </p>
<h2 id="TreeControl控件"><a href="#TreeControl控件" class="headerlink" title="TreeControl控件"></a>TreeControl控件</h2><p>使用 CTreeCtrl <a href="https://msdn.microsoft.com/zh-cn/library/8ws6dh1y(v=vs.120).aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/zh-cn/library/8ws6dh1y(v=vs.120).aspx</a> </p>
<h2 id="ListControl控件"><a href="#ListControl控件" class="headerlink" title="ListControl控件"></a>ListControl控件</h2><p>使用 CListCtrl <a href="https://msdn.microsoft.com/zh-cn/library/cc468276(v=vs.71).aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/zh-cn/library/cc468276(v=vs.71).aspx</a><br>创建列表控件 (List Control) <a href="https://msdn.microsoft.com/zh-cn/library/cc451545(v=vs.71).aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/zh-cn/library/cc451545(v=vs.71).aspx</a> </p>
<hr>
<p>现有一个XML文档如下：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;root&gt;</span><br><span class="line">	&lt;Node world = <span class="string">"生命"</span>&gt;</span><br><span class="line">		&lt;Node animal = “动物<span class="string">"&gt;</span></span><br><span class="line"><span class="string">			&lt;Node aniname = "</span>熊猫<span class="string">"&gt;</span></span><br><span class="line"><span class="string">			&lt;/Node&gt;</span></span><br><span class="line"><span class="string">			&lt;Node aniname = "</span>兔子<span class="string">"&gt;</span></span><br><span class="line"><span class="string">			&lt;/Node&gt;</span></span><br><span class="line"><span class="string">		&lt;/Node&gt;</span></span><br><span class="line"><span class="string">		&lt;Node plant = "</span>植物<span class="string">"&gt;</span></span><br><span class="line"><span class="string">			&lt;Node planame = "</span>仙人掌<span class="string">"&gt;</span></span><br><span class="line"><span class="string">			&lt;/Node&gt;</span></span><br><span class="line"><span class="string">			&lt;Node planame = "</span>玫瑰<span class="string">"&gt;</span></span><br><span class="line"><span class="string">			&lt;/Node&gt;</span></span><br><span class="line"><span class="string">		&lt;/Node&gt;</span></span><br><span class="line"><span class="string">	&lt;/Node&gt;</span></span><br><span class="line"><span class="string">&lt;/root&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>要求在树状控件上显示如下：<br>–root<br>—-动物<br>—-植物</p>
<p>在树状控件上点击“动物”，在列表控件上出现<br>1 熊猫<br>2 兔子</p>
<p>同理，点击“植物”，在列表控件上出现<br>1 仙人掌<br>2 玫瑰</p>
<h1 id="思维碰撞"><a href="#思维碰撞" class="headerlink" title="思维碰撞"></a>思维碰撞</h1><p><del>之前的思路：先SelectedSingleNode(“/Node/Node”)，定位到动物这一层。然后获得该结点的属性即aniname，插入树状控件。接着指向其兄弟结点，将兄弟结点（植物）的属性同样插入树状控件。如果新插入结点，可能需递归（但都是在动物同层面）。</del><br><del>因为并没有将“熊猫”“兔子”插入树状控件，因此无法使用m_tree.GetChildItem(ht)获取。所以我想通过“动物”植物“的aniname和planame来反过来查找对应xml里的结点pNode（这里存在问题how to find it?遍历xml找同样的名字？Item能和node存在对应关系么）。找到后，只需GetChildNode之类获取孩子结点，再插入到列表控件中（也就是和列表控件交互实际是列表控件在和xml直接交互，树控件只起到选择某个item，对应到xml中）。</del><br><del>简单说来：选择树结点-&gt;获得该xml对应结点-&gt;获得每一个孩子结点-&gt;获得孩子结点的文本和其他路径属性-&gt;通过列表插入</del></p>
<p><del>就算是为树状控件和列表控件设置一个类或者一个结构，先要把xml所需的信息全部放入。毕竟投射到树状控件的结点并非全部结点，最重要的是<strong>列表控件所需结点不在树状控件中</strong>。那么添加删除时，对应的类或结构也应相应操作，是否繁琐。但感觉之前用树控件用错了，只是获取了文本，数据并没传入。</del></p>
<p>又过了一天。思路变为：为不直接操作XML，应创建一个结构体，利用MSXML解析XML将信息放入结构体中，在后续树状控件和列表控件操作时都调用该结构体而非XML。</p>
<p>前面那么多废话，其实说白了就是要<strong>自己生成一棵树</strong>，数据来源是xml，通过MSXML获得每个结点信息，自己生成的树中只包含所需要的xml片段信息，之后树控件根据指针来获得选择结点的孩子结点。<br>xml解析的最关键之处，就是如何将xml文件内容解析成内存中的可用、易用的程序数据—DOM(Document Object Model)树。DOM其实就是多叉树，每个节点只需知道自己的第一个子节点（first child）和下一个兄弟节点（next sibling），即可实现元素数据的解析。</p>
<p>理一理六层结构：<br>map-&gt;分类节点-&gt;vector-&gt;n个小节点-&gt;结构体-&gt;xml</p>
<p>如果要求分类节点就一层，是完全OK的。但如果要求分类下面还需要小分类，这就很不ok了。换为<br>两个结构体：1）小节点结构体-&gt;xml<br>2)分类节点结构体-&gt;vector-&gt;1)</p>
<p>发现六层结构办不到时，仿佛多米诺骨牌立到最后几块，突然看到最开始的一段里有一块距离放远了……<br>但换成双结构体其实改动也没太多，又好像把那块出差错的给换了块适合长度的，整个链条还是能补完整的。<br>思维过山车  跌宕起伏</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2017-09-10T08:47:42.000Z" itemprop="dateUpdated">2017-09-10 16:47:42</time>
</span><br>


        
        原始链接：<a href="/2017/07/20/树状控件与列表控件交互以及XML的解析/" target="_blank" rel="external">https://hubojing.github.io/2017/07/20/树状控件与列表控件交互以及XML的解析/</a>
        
    </div>
    
    <footer>
        <a href="https://hubojing.github.io">
            <img src="/img/avatar.jpg" alt="靖待">
            靖待
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CPP/">CPP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MFC/">MFC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/XML/">XML</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://hubojing.github.io/2017/07/20/树状控件与列表控件交互以及XML的解析/&title=《树状控件与列表控件交互以及XML的解析》 — 靖待的技术博客&pic=https://hubojing.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://hubojing.github.io/2017/07/20/树状控件与列表控件交互以及XML的解析/&title=《树状控件与列表控件交互以及XML的解析》 — 靖待的技术博客&source=　　自查笔记。　　　　　 " data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://hubojing.github.io/2017/07/20/树状控件与列表控件交互以及XML的解析/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《树状控件与列表控件交互以及XML的解析》 — 靖待的技术博客&url=https://hubojing.github.io/2017/07/20/树状控件与列表控件交互以及XML的解析/&via=https://hubojing.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://hubojing.github.io/2017/07/20/树状控件与列表控件交互以及XML的解析/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2017/07/23/树/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">树</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2017/07/18/求购/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">求购</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'false' == 'true',
            verify: 'false' == 'true',
            appId: "JmIOWxzPr7srCSPni2dKJvlk-gzGzoHsz",
            appKey: "RNTLoM5BDEURrDBqJGq68wqK",
            avatar: "identicon",
            placeholder: "据说留言的人都变漂亮了...",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        码代码和码字，都是人生乐趣
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>靖待 &copy; 2015 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://hubojing.github.io/2017/07/20/树状控件与列表控件交互以及XML的解析/&title=《树状控件与列表控件交互以及XML的解析》 — 靖待的技术博客&pic=https://hubojing.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://hubojing.github.io/2017/07/20/树状控件与列表控件交互以及XML的解析/&title=《树状控件与列表控件交互以及XML的解析》 — 靖待的技术博客&source=　　自查笔记。　　　　　 " data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://hubojing.github.io/2017/07/20/树状控件与列表控件交互以及XML的解析/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《树状控件与列表控件交互以及XML的解析》 — 靖待的技术博客&url=https://hubojing.github.io/2017/07/20/树状控件与列表控件交互以及XML的解析/&via=https://hubojing.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://hubojing.github.io/2017/07/20/树状控件与列表控件交互以及XML的解析/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAADLklEQVR42u3aQU7EQAwEQP7/abhwQFrt0m0HicxWTigKydRwaGzPx0d8ff64nt35ef/xmcfr8flnd14/+ez5Cy5sbGzsm7Dzxb1e7uYryRqSbcrfg42NjX0e+3Vg5AH2+g3JF2cb2oYfNjY29juz83Li9Ruu2mhsbGxs7Bk7X0r7hrYgwcbGxsaeNfHz5lHbEkrW1m4ZNjY29tnsTePmv/38J/NtbGxs7H/M/ouxa7JxSfspf0+9fmxsbOyD2PmHZ4veFzn5saG6IMHGxsY+iD0bDMy2YzMqngVncRgIGxsb+4bsNh7yMNg8P8MXBQw2Njb2Qez24M4mYNrjPrNWUV3wYGNjY9+cPWvZbOLtqiHBqmmFjY2N/WbsGThZRBJdbRwmjTBsbGzsk9htG2hWSFxV3rR/qmS12NjY2GewN22jdpTbBljbMMp/CxsbG/skdh4Vs1FuEopRxl4UY9jY2Nhns5Pyo4W1g+RZY6t9AzY2NvYZ7NnYdR8ebUTtR8XY2NjY78lO4qEd/ebhl1dOeQPr+w42Njb2Qey2PTRr5efbtwcncYuNjY19EnvfskmCbXMYqB0nRxc2Njb2QezZAKCYFQek2WGgWUw+bS1hY2Nj35zdLi65nx+aaY/mtAd9isk2NjY29g3Zm0ZS0bUqo3F/P5qKYGNjYx/Hbv+Vz0uC9oBOHoF5EfXLeAAbGxv7tuwkGDZjhnyEcO0Ao2iEYWNjYx/Bviow8iZ+G42zQQU2Njb2+7DzpSeBtA+tfWTWB3qwsbGxb8tO2kCbRvwsZurGUFsUYWNjYx/Ebj+cx1jS7p9t66zx9EsFho2NjX1bdj7obRl5kTD8W5WjYmxsbOxT2Qksj4pNiZKsIS9IovYWNjY29hHsz/Jq20+rgBkdzYkOfWJjY2MfxJ4NVttCYr+U2da0zSlsbGzs+7I3oTXb49lXkrZXEa7Y2NjYx7Hz4mE23G2P++zDLxoPYGNjY78ZOzmskxcPmyFBvp4LAgwbGxv7IHZ7cCdfejJayAfMUeBhY2NjH8feLz1fUNISagOpbkhhY2NjH8RuR61XjWDzb7WFTVtQYWNjY9+W/QXkrgdKPvpcfwAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>




<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '快回来嘛！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)抱抱~你回来了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
