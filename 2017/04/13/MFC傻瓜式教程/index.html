<!DOCTYPE html>
<html>
<head>
    

    

    
<!-- Baidu Tongji -->
<script>var _hmt = _hmt || []</script>
<script async src="//hm.baidu.com/hm.js?86125ece8b26a0a600d8b5b04d6e4695"></script>
<!-- End Baidu Tongji -->




    <meta charset="utf-8">
    
    
    <link rel="canonical" href="https://hubojing.github.io//2017/04/13/MFC傻瓜式教程/">
    
    
    <title>MFC傻瓜式教程 | 靖待的技术博客 | 小清新IT旅程 | 为中华之崛起而读书</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="CPP,MFC">
    <meta name="description" content="本教程重操作，轻理论，为操作减负。需了解详细原理的朋友可以自行看各种书籍。　　直接上菜。">
<meta name="keywords" content="CPP,MFC">
<meta property="og:type" content="article">
<meta property="og:title" content="MFC傻瓜式教程">
<meta property="og:url" content="https://hubojing.github.io/2017/04/13/MFC傻瓜式教程/index.html">
<meta property="og:site_name" content="靖待的技术博客">
<meta property="og:description" content="本教程重操作，轻理论，为操作减负。需了解详细原理的朋友可以自行看各种书籍。　　直接上菜。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://img.blog.csdn.net/20170413231922633?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170413231922633?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170413231954758?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170413232035196?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170413232222055?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170413232907845?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170413233804513?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170413233914861?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170413234011986?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170414000004060?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170414000303079?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170414000500779?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170414000612202?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170414000901869?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170414001008658?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170414001252061?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170414001335972?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170414001137294?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170415152155489?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170415152224880?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170415152247131?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170415152324147?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170415152341882?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170415152354773?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170415152409742?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170415152431039?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170415152451118?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170415152505259?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170415152522025?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170415152547447?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170415152614010?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170415152648992?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170415152705855?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170415152725793?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420224900928?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420224921428?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420224951225?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420225018961?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420225058617?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420225116851?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420225150945?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420225218087?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420225352728?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230125731?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230209594?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230235013?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230302938?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230346873?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230404138?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230440190?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230503092?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230521295?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230550253?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230616957?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230636254?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230656311?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230721832?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230741630?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230758895?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230814077?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230830380?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230849318?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230906115?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230925890?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420230949366?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420231009906?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420231023694?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170420231045554?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170424215210507?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170424215239306?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170424215308947?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170424215335853?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170424215356165?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170424215530885?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170424215545651?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170424215606416?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170424215622479?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170428102011032?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170428102101643?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170428102150065?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170428102229597?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170424215653701?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170424215712448?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170424215734652?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170428102440017?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170428102449366?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170428102525898?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170709130424898?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170709130702138?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170709132044018?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170709132630578?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170813113649482?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:updated_time" content="2017-08-13T11:45:34.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MFC傻瓜式教程">
<meta name="twitter:description" content="本教程重操作，轻理论，为操作减负。需了解详细原理的朋友可以自行看各种书籍。　　直接上菜。">
<meta name="twitter:image" content="http://img.blog.csdn.net/20170413231922633?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
    
        <link rel="alternate" type="application/atom+xml" title="靖待的技术博客" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<!--google adsense code-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-2097896583568287",
    enable_page_level_ads: true
  });
</script>
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu"  >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">靖待</h5>
          <a href="mailto:hubojing@outlook.com" title="hubojing@outlook.com" class="mail">hubojing@outlook.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archive"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/hubojing/"  >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://blog.csdn.net/hubojing/"  >
                <i class="icon icon-lg icon-pencil"></i>
                CSDN博客
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://music.163.com/#/user/home?id=92203594"  >
                <i class="icon icon-lg icon-music"></i>
                网易云音乐
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/friends"  >
                <i class="icon icon-lg icon-users"></i>
                友情链接
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about/Chinese"  >
                <i class="icon icon-lg icon-child"></i>
                关于
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/comment"  >
                <i class="icon icon-lg icon-book"></i>
                留言板
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/littletalk"  >
                <i class="icon icon-lg icon-edit"></i>
                自言自语
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/advertising"  >
                <i class="icon icon-lg icon-link"></i>
                推广
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://wpa.qq.com/msgrd?v=3&uin=417797456&site=qq&menu=yes"  >
                <i class="icon icon-lg icon-qq"></i>
                和我在线交流
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">MFC傻瓜式教程</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">MFC傻瓜式教程</h1>
        <h5 class="subtitle">
            
                <time datetime="2017-04-13T14:26:01.000Z" itemprop="datePublished" class="page-time">
  2017-04-13
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/编程语言/">编程语言</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#对话框"><span class="post-toc-number">1.</span> <span class="post-toc-text">对话框</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#对话框的创建和显示"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">对话框的创建和显示</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#模态对话框的创建"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">模态对话框的创建</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#非模态对话框的创建"><span class="post-toc-number">1.1.2.</span> <span class="post-toc-text">非模态对话框的创建</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#动态创建按钮"><span class="post-toc-number">2.</span> <span class="post-toc-text">动态创建按钮</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#控件的访问"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">控件的访问</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#控件的调整"><span class="post-toc-number">2.1.1.</span> <span class="post-toc-text">控件的调整</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#静态文本控件"><span class="post-toc-number">2.1.2.</span> <span class="post-toc-text">静态文本控件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#编辑框控件"><span class="post-toc-number">2.1.3.</span> <span class="post-toc-text">编辑框控件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#第一种方式"><span class="post-toc-number">2.1.3.1.</span> <span class="post-toc-text">第一种方式</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#第二种方式"><span class="post-toc-number">2.1.3.2.</span> <span class="post-toc-text">第二种方式</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#第三种方式"><span class="post-toc-number">2.1.3.3.</span> <span class="post-toc-text">第三种方式</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#第四种方式"><span class="post-toc-number">2.1.3.4.</span> <span class="post-toc-text">第四种方式</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#第五种方式"><span class="post-toc-number">2.1.3.5.</span> <span class="post-toc-text">第五种方式</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#第六种方式"><span class="post-toc-number">2.1.3.6.</span> <span class="post-toc-text">第六种方式</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#第七种方式"><span class="post-toc-number">2.1.3.7.</span> <span class="post-toc-text">第七种方式</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#总结"><span class="post-toc-number">2.1.3.8.</span> <span class="post-toc-text">总结</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#对话框伸缩功能的实现"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">对话框伸缩功能的实现</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#输入焦点的传递"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">输入焦点的传递</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#法一"><span class="post-toc-number">2.3.1.</span> <span class="post-toc-text">法一</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#法二"><span class="post-toc-number">2.3.2.</span> <span class="post-toc-text">法二</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#法三"><span class="post-toc-number">2.3.3.</span> <span class="post-toc-text">法三</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#法四"><span class="post-toc-number">2.3.4.</span> <span class="post-toc-text">法四</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#文件和注册表操作"><span class="post-toc-number">3.</span> <span class="post-toc-text">文件和注册表操作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#C语言对文件操作的支持"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">C语言对文件操作的支持</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#文件的打开和写入"><span class="post-toc-number">3.1.1.</span> <span class="post-toc-text">文件的打开和写入</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#文件的关闭"><span class="post-toc-number">3.1.2.</span> <span class="post-toc-text">文件的关闭</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#文件指针定位"><span class="post-toc-number">3.1.3.</span> <span class="post-toc-text">文件指针定位</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#文件的读取"><span class="post-toc-number">3.1.4.</span> <span class="post-toc-text">文件的读取</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#二进制文件和文本文件"><span class="post-toc-number">3.1.5.</span> <span class="post-toc-text">二进制文件和文本文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#文本方式和二进制方式"><span class="post-toc-number">3.1.6.</span> <span class="post-toc-text">文本方式和二进制方式</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#C-对文件操作的支持"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">C++对文件操作的支持</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Win32-API-对文件操作的支持"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">Win32 API 对文件操作的支持</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#文件的创建、打开和写入"><span class="post-toc-number">3.3.1.</span> <span class="post-toc-text">文件的创建、打开和写入</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#文件的读取-1"><span class="post-toc-number">3.3.2.</span> <span class="post-toc-text">文件的读取</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#菜单"><span class="post-toc-number">4.</span> <span class="post-toc-text">菜单</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#菜单命令响应函数"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">菜单命令响应函数</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#菜单命令的路由"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">菜单命令的路由</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#程序类对菜单命令的响应顺序"><span class="post-toc-number">4.2.1.</span> <span class="post-toc-text">程序类对菜单命令的响应顺序</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Windows消息的分类"><span class="post-toc-number">4.2.2.</span> <span class="post-toc-text">Windows消息的分类</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#菜单命令的路由-1"><span class="post-toc-number">4.2.3.</span> <span class="post-toc-text">菜单命令的路由</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#基本菜单操作"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">基本菜单操作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#标记菜单"><span class="post-toc-number">4.3.1.</span> <span class="post-toc-text">标记菜单</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#默认菜单项"><span class="post-toc-number">4.3.2.</span> <span class="post-toc-text">默认菜单项</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#图形标记菜单"><span class="post-toc-number">4.3.3.</span> <span class="post-toc-text">图形标记菜单</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#禁用菜单项"><span class="post-toc-number">4.3.4.</span> <span class="post-toc-text">禁用菜单项</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#移除和装载菜单"><span class="post-toc-number">4.3.5.</span> <span class="post-toc-text">移除和装载菜单</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#MFC菜单命令更新机制"><span class="post-toc-number">4.3.6.</span> <span class="post-toc-text">MFC菜单命令更新机制</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#快捷菜单"><span class="post-toc-number">4.3.7.</span> <span class="post-toc-text">快捷菜单</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#动态菜单操作"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">动态菜单操作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#添加菜单项目"><span class="post-toc-number">4.4.1.</span> <span class="post-toc-text">添加菜单项目</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#插入菜单项目"><span class="post-toc-number">4.4.2.</span> <span class="post-toc-text">插入菜单项目</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#删除菜单"><span class="post-toc-number">4.4.3.</span> <span class="post-toc-text">删除菜单</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#动态添加的菜单项的命令响应"><span class="post-toc-number">4.4.4.</span> <span class="post-toc-text">动态添加的菜单项的命令响应</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#电话本示例程序"><span class="post-toc-number">4.5.</span> <span class="post-toc-text">电话本示例程序</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#动态添加子菜单的实现"><span class="post-toc-number">4.5.1.</span> <span class="post-toc-text">动态添加子菜单的实现</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#显示输入的字符"><span class="post-toc-number">4.5.2.</span> <span class="post-toc-text">显示输入的字符</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#添加菜单项及其命令响应函数"><span class="post-toc-number">4.5.3.</span> <span class="post-toc-text">添加菜单项及其命令响应函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#框架类窗口截获菜单命令消息"><span class="post-toc-number">4.5.4.</span> <span class="post-toc-text">框架类窗口截获菜单命令消息</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#简单绘图"><span class="post-toc-number">5.</span> <span class="post-toc-text">简单绘图</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#MFC消息映射机制"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">MFC消息映射机制</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#绘制线条"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">绘制线条</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#利用MFC的CDC类实现画线功能"><span class="post-toc-number">5.2.1.</span> <span class="post-toc-text">利用MFC的CDC类实现画线功能</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#利用MFC的CWindowDC类实现画线功能"><span class="post-toc-number">5.2.2.</span> <span class="post-toc-text">利用MFC的CWindowDC类实现画线功能</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#在桌面窗口中画线"><span class="post-toc-number">5.2.3.</span> <span class="post-toc-text">在桌面窗口中画线</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#绘制彩色线条"><span class="post-toc-number">5.2.4.</span> <span class="post-toc-text">绘制彩色线条</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#使用画刷绘图"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">使用画刷绘图</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#简单画刷"><span class="post-toc-number">5.3.1.</span> <span class="post-toc-text">简单画刷</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#位图画刷"><span class="post-toc-number">5.3.2.</span> <span class="post-toc-text">位图画刷</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#透明画刷"><span class="post-toc-number">5.3.3.</span> <span class="post-toc-text">透明画刷</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#绘制连续线条"><span class="post-toc-number">5.4.</span> <span class="post-toc-text">绘制连续线条</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#绘制扇形效果的线条"><span class="post-toc-number">5.5.</span> <span class="post-toc-text">绘制扇形效果的线条</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#文本编程"><span class="post-toc-number">6.</span> <span class="post-toc-text">文本编程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#插入符"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">插入符</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#创建文本插入符"><span class="post-toc-number">6.1.1.</span> <span class="post-toc-text">创建文本插入符</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#创建图形插入符"><span class="post-toc-number">6.1.2.</span> <span class="post-toc-text">创建图形插入符</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#窗口重绘"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">窗口重绘</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#OnDraw函数"><span class="post-toc-number">6.2.1.</span> <span class="post-toc-text">OnDraw函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#添加字符串资源"><span class="post-toc-number">6.2.2.</span> <span class="post-toc-text">添加字符串资源</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#路径"><span class="post-toc-number">6.2.3.</span> <span class="post-toc-text">路径</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#字符输入"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">字符输入</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#设置字体"><span class="post-toc-number">6.3.1.</span> <span class="post-toc-text">设置字体</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#字幕变色功能的实现"><span class="post-toc-number">6.3.2.</span> <span class="post-toc-text">字幕变色功能的实现</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#绘图控制"><span class="post-toc-number">7.</span> <span class="post-toc-text">绘图控制</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#简单绘图-1"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">简单绘图</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#设置对话框"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">设置对话框</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#设置线宽"><span class="post-toc-number">7.2.1.</span> <span class="post-toc-text">设置线宽</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#设置线型"><span class="post-toc-number">7.2.2.</span> <span class="post-toc-text">设置线型</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#颜色对话框"><span class="post-toc-number">7.3.</span> <span class="post-toc-text">颜色对话框</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#字体对话框"><span class="post-toc-number">7.4.</span> <span class="post-toc-text">字体对话框</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#示例对话框"><span class="post-toc-number">7.5.</span> <span class="post-toc-text">示例对话框</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#10-6-改变对话框和控件的背景及文本颜色"><span class="post-toc-number">7.6.</span> <span class="post-toc-text">10.6 改变对话框和控件的背景及文本颜色</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#改变整个对话框及其子控件的背景色"><span class="post-toc-number">7.6.1.</span> <span class="post-toc-text">改变整个对话框及其子控件的背景色</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#仅改变某个子控件的背景及文本颜色"><span class="post-toc-number">7.6.2.</span> <span class="post-toc-text">仅改变某个子控件的背景及文本颜色</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#图形的保存和重绘"><span class="post-toc-number">8.</span> <span class="post-toc-text">图形的保存和重绘</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#坐标空间和转换"><span class="post-toc-number">8.1.</span> <span class="post-toc-text">坐标空间和转换</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#坐标空间"><span class="post-toc-number">8.1.1.</span> <span class="post-toc-text">坐标空间</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#转换"><span class="post-toc-number">8.1.2.</span> <span class="post-toc-text">转换</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#图形的保存和重绘-1"><span class="post-toc-number">8.2.</span> <span class="post-toc-text">图形的保存和重绘</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#改变控件上的文本字体"><span class="post-toc-number">8.2.1.</span> <span class="post-toc-text">改变控件上的文本字体</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#改变按钮控件的背景色及文本颜色"><span class="post-toc-number">8.2.2.</span> <span class="post-toc-text">改变按钮控件的背景色及文本颜色</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#位图的显示"><span class="post-toc-number">8.3.</span> <span class="post-toc-text">位图的显示</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#定制应用程序外观"><span class="post-toc-number">9.</span> <span class="post-toc-text">定制应用程序外观</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#修改应用程序窗口的外观"><span class="post-toc-number">9.1.</span> <span class="post-toc-text">修改应用程序窗口的外观</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#在窗口创建之前修改"><span class="post-toc-number">9.1.1.</span> <span class="post-toc-text">在窗口创建之前修改</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#在窗口创建之后修改"><span class="post-toc-number">9.2.</span> <span class="post-toc-text">在窗口创建之后修改</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#修改窗口的光标、图标和背景"><span class="post-toc-number">9.3.</span> <span class="post-toc-text">修改窗口的光标、图标和背景</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#在窗口创建之前修改-1"><span class="post-toc-number">9.3.1.</span> <span class="post-toc-text">在窗口创建之前修改</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#网络编程"><span class="post-toc-number">10.</span> <span class="post-toc-text">网络编程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#计算机网络基本知识"><span class="post-toc-number">10.1.</span> <span class="post-toc-text">计算机网络基本知识</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#基于TCP的网络应用程序的编写"><span class="post-toc-number">10.2.</span> <span class="post-toc-text">基于TCP的网络应用程序的编写</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#服务器端程序"><span class="post-toc-number">10.2.1.</span> <span class="post-toc-text">服务器端程序</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#客户端程序"><span class="post-toc-number">10.2.2.</span> <span class="post-toc-text">客户端程序</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#基于UDP的网络应用程序的编写"><span class="post-toc-number">10.3.</span> <span class="post-toc-text">基于UDP的网络应用程序的编写</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#服务器端程序-1"><span class="post-toc-number">10.3.1.</span> <span class="post-toc-text">服务器端程序</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#客户端程序-1"><span class="post-toc-number">10.3.2.</span> <span class="post-toc-text">客户端程序</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#基于UDP的简单聊天程序"><span class="post-toc-number">10.4.</span> <span class="post-toc-text">基于UDP的简单聊天程序</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#客户端程序-2"><span class="post-toc-number">10.4.1.</span> <span class="post-toc-text">客户端程序</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#多线程"><span class="post-toc-number">11.</span> <span class="post-toc-text">多线程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#进程"><span class="post-toc-number">11.1.</span> <span class="post-toc-text">进程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#程序和进程"><span class="post-toc-number">11.1.1.</span> <span class="post-toc-text">程序和进程</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#简单多线程示例"><span class="post-toc-number">11.2.</span> <span class="post-toc-text">简单多线程示例</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#线程同步"><span class="post-toc-number">11.3.</span> <span class="post-toc-text">线程同步</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#火车站售票系统模拟程序"><span class="post-toc-number">11.3.1.</span> <span class="post-toc-text">火车站售票系统模拟程序</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#保证应用程序只有一个实例运行"><span class="post-toc-number">11.4.</span> <span class="post-toc-text">保证应用程序只有一个实例运行</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#网络聊天室程序的实现"><span class="post-toc-number">11.5.</span> <span class="post-toc-text">网络聊天室程序的实现</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#加载套接字库"><span class="post-toc-number">11.5.1.</span> <span class="post-toc-text">加载套接字库</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#创建并初始化套接字"><span class="post-toc-number">11.5.2.</span> <span class="post-toc-text">创建并初始化套接字</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#实现接收端功能"><span class="post-toc-number">11.5.3.</span> <span class="post-toc-text">实现接收端功能</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#实现发送端功能"><span class="post-toc-number">11.5.4.</span> <span class="post-toc-text">实现发送端功能</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#ActiveX控件"><span class="post-toc-number">12.</span> <span class="post-toc-text">ActiveX控件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ActiveX控件-1"><span class="post-toc-number">12.1.</span> <span class="post-toc-text">ActiveX控件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#MFC-ActiveX-ControlWizard"><span class="post-toc-number">12.1.1.</span> <span class="post-toc-text">MFC ActiveX ControlWizard</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#动态链接库"><span class="post-toc-number">13.</span> <span class="post-toc-text">动态链接库</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Win32-DLL的创建和使用"><span class="post-toc-number">13.1.</span> <span class="post-toc-text">Win32 DLL的创建和使用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Dumpbin命令"><span class="post-toc-number">13.1.1.</span> <span class="post-toc-text">Dumpbin命令</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#从DLL中导出函数"><span class="post-toc-number">13.1.2.</span> <span class="post-toc-text">从DLL中导出函数</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#隐式链接方式加载DLL"><span class="post-toc-number">13.2.</span> <span class="post-toc-text">隐式链接方式加载DLL</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#利用extern声明外部函数"><span class="post-toc-number">13.2.1.</span> <span class="post-toc-text">利用extern声明外部函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Depends工具"><span class="post-toc-number">13.2.2.</span> <span class="post-toc-text">Depends工具</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#利用-declspec-dllimport-声明外部函数"><span class="post-toc-number">13.2.3.</span> <span class="post-toc-text">利用_declspec(dllimport)声明外部函数</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#完善Win32-DLL例子"><span class="post-toc-number">13.3.</span> <span class="post-toc-text">完善Win32 DLL例子</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#从DLL中导出C-类"><span class="post-toc-number">13.4.</span> <span class="post-toc-text">从DLL中导出C++类</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#解决名字改编问题"><span class="post-toc-number">13.5.</span> <span class="post-toc-text">解决名字改编问题</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#显示加载方式加载DLL"><span class="post-toc-number">13.6.</span> <span class="post-toc-text">显示加载方式加载DLL</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-MFC傻瓜式教程"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">MFC傻瓜式教程</h1>
        <div class="post-meta">
            <time class="post-time" title="2017-04-13 22:26:01" datetime="2017-04-13T14:26:01.000Z"  itemprop="datePublished">2017-04-13</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/编程语言/">编程语言</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <div align="left"><br><img src="http://img.blog.csdn.net/20170413231922633?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" width="300" height="180" style="float:right;"><br><br> </div>



<p>　　<br>　　<strong>本教程重操作，轻理论，为操作减负。需了解详细原理的朋友可以自行看各种书籍。</strong><br>　　<strong>直接上菜。</strong></p>
<a id="more"></a>
<p>MFC：Microsoft Foundation Class ，微软基础类库。</p>
<h1 id="对话框"><a href="#对话框" class="headerlink" title="对话框"></a>对话框</h1><h2 id="对话框的创建和显示"><a href="#对话框的创建和显示" class="headerlink" title="对话框的创建和显示"></a>对话框的创建和显示</h2><ol>
<li>新建MFC AppWizard(exe)工程，单文档类型。工程名：Mybole。编译运行。<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170413231922633?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="新建" title="">
                </div>
                <div class="image-caption">新建</div>
            </figure></li>
<li><p>点击帮助-关于Mybole。这是MFC自动创建的。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170413231954758?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="关于" title="">
                </div>
                <div class="image-caption">关于</div>
            </figure>
</li>
<li><p>创建自己的对话框。点击Insert-Resource。选择Dialog，点击New。VC++自动将其标识设置为IDD_DIALOG1，并自动添加到ResourceView-Dialog项中。Dialog项下还有一个对话框资源标识：IDD_ABOUTBOX，即上一步中的“关于”对话框。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170413232035196?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="Insert Resource对话框" title="">
                </div>
                <div class="image-caption">Insert Resource对话框</div>
            </figure>
</li>
</ol>
<p> <img src="http://img.blog.csdn.net/20170413232222055?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="新建的对话框资源"></p>
<ol start="4">
<li>选中对话框本身，右键点击属性。将Caption设置为“测试”。</li>
<li>选择View-ClassWizard，点击create a new class，OK。出现下图，并输入下图选项。<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170413232907845?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="New Class" title="">
                </div>
                <div class="image-caption">New Class</div>
            </figure></li>
<li>在随后出现的MFC ClassWizard对话框上点击OK。<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170413233804513?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="列表" title="">
                </div>
                <div class="image-caption">列表</div>
            </figure>
<strong>注意</strong>：看看左侧类列表中是否添加好了CTestDlg，否则会影响后续操作。</li>
</ol>
<p>接下来，我们希望在程序中显示这个对话窗口。</p>
<ol start="7">
<li><p>点击右侧菜单Menu，选中IDR_MAINFRAME。点击帮助旁边的虚线框。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170413233914861?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="Menu" title="">
                </div>
                <div class="image-caption">Menu</div>
            </figure>
</li>
<li><p>对虚线框右键属性，修改为下图。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170413234011986?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="属性" title="">
                </div>
                <div class="image-caption">属性</div>
            </figure>
</li>
<li><p>关闭属性。点击View-ClassWizard（中文是建立类向导），选择CMyboleView，用COMMAND命令消息响应函数。如图。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170414000004060?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="COMMAND" title="">
                </div>
                <div class="image-caption">COMMAND</div>
            </figure>
</li>
</ol>
<h3 id="模态对话框的创建"><a href="#模态对话框的创建" class="headerlink" title="模态对话框的创建"></a>模态对话框的创建</h3><p>　　需要调用CDialog类的成员函数：DoModal，它能创建并显示一个模态对话框，其返回值将作为CDialog类的另一个成员函数：EndDialog的参数，后者功能是关闭模态对话框。</p>
<p>　　在FileView中选择MyboleView.cpp，编写程序。<br>　　记得在开头添加头文件 #include “testdlg.h” （头文件大小写问题，linux区分，windows不区分）<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170414000303079?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="编程" title="">
                </div>
                <div class="image-caption">编程</div>
            </figure><br>　　显示模态对话框的具体实现代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CMyboleView::OnDialog() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your command handler code here</span></span><br><span class="line">	CTestDlg dlg;</span><br><span class="line">	dlg.DoModal();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>编译运行，点击对话框。会发现若不确认该窗口，将无法点击其他窗口。<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170414000500779?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="模态对话框1" title="">
                </div>
                <div class="image-caption">模态对话框1</div>
            </figure></p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170414000612202?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="模态对话框2" title="">
                </div>
                <div class="image-caption">模态对话框2</div>
            </figure>
<h3 id="非模态对话框的创建"><a href="#非模态对话框的创建" class="headerlink" title="非模态对话框的创建"></a>非模态对话框的创建</h3><p>将上面的模态对话框代码注释掉。</p>
<p>改为：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CMyboleView::OnDialog() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your command handler code here</span></span><br><span class="line">	<span class="comment">//CTestDlg dlg;</span></span><br><span class="line">	<span class="comment">//dlg.DoModal();</span></span><br><span class="line"></span><br><span class="line">	CTestDlg *pDlg = <span class="keyword">new</span> CTestDlg;</span><br><span class="line">	pDlg-&gt;Create(IDD_DIALOG1,<span class="keyword">this</span>);</span><br><span class="line">	pDlg-&gt;ShowWindow(SW_SHOW);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>注意</strong>：需要把之前运行的对话框关掉才能编译成功。</p>
<p>然而，当它生命周期结束时，所保存的内存地址就丢失了，那么程序中也就无法再引用到它所指向的那块内存。于是，我们这样解决该问题。<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170414000901869?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="MFC ClassWizard" title="">
                </div>
                <div class="image-caption">MFC ClassWizard</div>
            </figure></p>
<p><strong>注意</strong>：Message里双击添加函数或者点击add Class…</p>
<p>void CTestDlg::PostNcDestroy()<br>{<br>    // TODO: Add your specialized code here and/or call the base class<br>    delete this;<br>    CDialog::PostNcDestroy();<br>}</p>
<p><strong>区别</strong>：点击确定，对话框都会消失。但是，模态对话框窗口对象被销毁了。对非模态对话框来说，只是隐藏起来了，并未被销毁。<br>因此，若要销毁对话框，若有一个ID为IDOK的按钮，就必须重写基类的OnOK这个虚函数，并在重写的函数中调用DestroyWindow函数，完成销毁。并不要再调用基类的OnOK函数。<br>同样地，若有一个ID为IDCANCEL的按钮，也必须重写基类的OnCancel虚函数，并在重写的函数中调用DestroyWindow函数，完成销毁。并不要再调用基类的OnCancel函数。</p>
<h1 id="动态创建按钮"><a href="#动态创建按钮" class="headerlink" title="动态创建按钮"></a>动态创建按钮</h1><p>注释掉非模态对话框代码，还原模态对话框代码。</p>
<p>点击ResourceView-IDD_DIALOG1，打开资源，用鼠标拖出控件面板上的Button按钮控件，对按钮右键，选择属性，设置如下。<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170414001008658?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="按钮" title="">
                </div>
                <div class="image-caption">按钮</div>
            </figure></p>
<p>接下来，我们实现当单击Add按钮时，在对话框中动态创建一个按钮这一功能。</p>
<ol>
<li>为CTestDlg类添加一个私有的CButton成员变量。<br>　　点击ClassView标签页右键，如图点击。<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170414001252061?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="ClassView" title="">
                </div>
                <div class="image-caption">ClassView</div>
            </figure>
</li>
</ol>
<p>　　填入信息。<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170414001335972?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="添加成员变量" title="">
                </div>
                <div class="image-caption">添加成员变量</div>
            </figure></p>
<ol start="2">
<li>添加Add按钮单击消息的响应函数。<br>　　按钮点右键，选ClassWizard（建立类向导），如图。<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170414001137294?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="建立类向导" title="">
                </div>
                <div class="image-caption">建立类向导</div>
            </figure>
</li>
</ol>
<p>　　单击Edit Code，即可定位到该函数定义处。<br>　　添加一下代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></span><br><span class="line">	m_btn.Create(<span class="string">"New"</span>,BS_DEFPUSHBUTTON | WS_VISIBLE | WS_CHILD,</span><br><span class="line">				 CRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>,<span class="number">100</span>),<span class="keyword">this</span>,<span class="number">123</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　为避免多次点击Add出现非法操作，我们需要进行如下步骤。</p>
<ol start="3">
<li><p>为CTestDlg类增加一个私有的BOOL类型成员变量。<br>变量类型：BOOL<br>变量名称：m_bIsCreated<br>Access: private</p>
</li>
<li><p>在TestDlg.cpp中找到构造函数，将m_bIsCreated初始为FALSE。如图所示。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170415152155489?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure>
</li>
</ol>
<p>　　或者改为如下亦可。<br>Static BOOL bIsCreated = FALSE;</p>
<ol start="5">
<li>回到Add，双击它，进入代码部分，改之。<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></span><br><span class="line">	<span class="keyword">if</span>(m_bIsCreated==FALSE)</span><br><span class="line">	&#123;</span><br><span class="line">	m_btn.Create(<span class="string">"New"</span>,BS_DEFPUSHBUTTON | WS_VISIBLE | WS_CHILD,</span><br><span class="line">				CRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>,<span class="number">100</span>),<span class="keyword">this</span>,<span class="number">123</span>);</span><br><span class="line">	m_bIsCreated = TRUE;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		m_btn.DestroyWindow();</span><br><span class="line">		m_bIsCreated = FALSE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>　　或者以下亦能实现。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></span><br><span class="line">	<span class="keyword">if</span>(!m_btn.m_hWnd)</span><br><span class="line">	&#123;</span><br><span class="line">	m_btn.Create(<span class="string">"New"</span>,BS_DEFPUSHBUTTON | WS_VISIBLE | WS_CHILD,</span><br><span class="line">				CRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>,<span class="number">100</span>),<span class="keyword">this</span>,<span class="number">123</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		m_btn.DestroyWindow();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　效果：<br>　　<img src="http://img.blog.csdn.net/20170415152224880?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　点击Add出现New窗口，再点击就销毁。</p>
<h2 id="控件的访问"><a href="#控件的访问" class="headerlink" title="控件的访问"></a>控件的访问</h2><h3 id="控件的调整"><a href="#控件的调整" class="headerlink" title="控件的调整"></a>控件的调整</h3><p>用Layout-Align，Layout-Make Same Size，Layout-Space Evenly里的选项进行调整。<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170415152247131?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<h3 id="静态文本控件"><a href="#静态文本控件" class="headerlink" title="静态文本控件"></a>静态文本控件</h3><p>　　查看三个静态文本框，它们ID相同。我们可以更改第一个静态文本框ID为IDC_NUMBER1，再打开ClassWizard，可以在ObjectIDs看到新ID。<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170415152324147?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure><br>　　对BN_CLICKED进行Add Function，并Edit Code:</p>
<p>　　此时运行程序点击第一个静态文本框并没有反应。这是因为：<strong>静态文本控件在默认状态下是不发送通告消息的</strong>。</p>
<p>　　为了该控件能向父窗口发送鼠标事件，我们对该文本框右键-属性，切换到styles选项卡，勾上Notify。<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170415152341882?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<p>　　现在可以显示了：<br>　　点击就改变。<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170415152354773?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<p>　　<strong>总结：为了使一个静态文本控件能够响应鼠标单击消息，那么需要进行两个特殊的步骤：第一步，改变它的ID；第二步，在它的属性对话框中选中Notify选项。</strong></p>
<h3 id="编辑框控件"><a href="#编辑框控件" class="headerlink" title="编辑框控件"></a>编辑框控件</h3><p>利用上面的对话框实现这样的功能：在前两个编辑框中分别输入一个数字，然后单击Add按钮，对前两个编辑框中的数字求和，并将结果显示在第三个编辑框中。</p>
<h4 id="第一种方式"><a href="#第一种方式" class="headerlink" title="第一种方式"></a>第一种方式</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> num1, num2, num3; </span><br><span class="line">	<span class="keyword">char</span> ch1[<span class="number">10</span>], ch2[<span class="number">10</span>], ch3[<span class="number">10</span>]; </span><br><span class="line">	GetDlgItem(IDC_EDIT1)-&gt;GetWindowText(ch1,<span class="number">10</span>); </span><br><span class="line">	GetDlgItem(IDC_EDIT2)-&gt;GetWindowText(ch2,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">	num1 = atoi(ch1); </span><br><span class="line">	num2 = atoi(ch2); </span><br><span class="line">	num3 = num1 + num2; </span><br><span class="line"></span><br><span class="line">	itoa(num3,ch3,<span class="number">10</span>);</span><br><span class="line">	GetDlgItem(IDC_EDIT3)-&gt;SetWindowText(ch3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>C语言转换函数：atoi 将一个由数字组成的字符串转换为相应的数值<br>itoa 数值转换为文本<br>itoa函数的第三个参数表示转换的进制，数字10表示十进制。</p>
<p>效果：<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170415152409742?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<h4 id="第二种方式"><a href="#第二种方式" class="headerlink" title="第二种方式"></a>第二种方式</h4><p>　　代码如下：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> num1, num2, num3; </span><br><span class="line">	<span class="keyword">char</span> ch1[<span class="number">10</span>], ch2[<span class="number">10</span>], ch3[<span class="number">10</span>]; </span><br><span class="line">	<span class="comment">//GetDlgItem(IDC_EDIT1)-&gt;GetWindowText(ch1,10); </span></span><br><span class="line">	<span class="comment">//GetDlgItem(IDC_EDIT2)-&gt;GetWindowText(ch2,10);</span></span><br><span class="line">	</span><br><span class="line">	GetDlgItemText(IDC_EDIT1,ch1,<span class="number">10</span>);</span><br><span class="line">	GetDlgItemText(IDC_EDIT2,ch2,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">	num1 = atoi(ch1); </span><br><span class="line">	num2 = atoi(ch2); </span><br><span class="line">	num3 = num1 + num2; </span><br><span class="line"></span><br><span class="line">	itoa(num3,ch3,<span class="number">10</span>);</span><br><span class="line">	<span class="comment">//GetDlgItem(IDC_EDIT3)-&gt;SetWindowText(ch3);</span></span><br><span class="line">	SetDlgItemText(IDC_EDIT3,ch3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　GetDlgItemText 将返回对话框中指定ID的控件上的文本，相当于将上面的GetDlgItem和GetWindowText这两个函数功能组合起来了。<br>与之对应的是SetDlgItemText，用来设置对话框中指定ID的控件上的文本。</p>
<h4 id="第三种方式"><a href="#第三种方式" class="headerlink" title="第三种方式"></a>第三种方式</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> num1, num2, num3; </span><br><span class="line">	<span class="comment">//char ch1[10], ch2[10], ch3[10]; </span></span><br><span class="line">	<span class="comment">//GetDlgItem(IDC_EDIT1)-&gt;GetWindowText(ch1,10); </span></span><br><span class="line">	<span class="comment">//GetDlgItem(IDC_EDIT2)-&gt;GetWindowText(ch2,10);</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//GetDlgItemText(IDC_EDIT1,ch1,10);</span></span><br><span class="line">	<span class="comment">//GetDlgItemText(IDC_EDIT2,ch2,10);</span></span><br><span class="line"></span><br><span class="line">	num1 = GetDlgItemInt(IDC_EDIT1);</span><br><span class="line">	num2 = GetDlgItemInt(IDC_EDIT2);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//num1 = atoi(ch1); </span></span><br><span class="line">	<span class="comment">//num2 = atoi(ch2); </span></span><br><span class="line">	num3 = num1 + num2; </span><br><span class="line"></span><br><span class="line">	<span class="comment">//itoa(num3,ch3,10);</span></span><br><span class="line">	<span class="comment">//GetDlgItem(IDC_EDIT3)-&gt;SetWindowText(ch3);</span></span><br><span class="line">	<span class="comment">//SetDlgItemText(IDC_EDIT3,ch3);</span></span><br><span class="line">	SetDlgItemInt(IDC_EDIT3,num3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="第四种方式"><a href="#第四种方式" class="headerlink" title="第四种方式"></a>第四种方式</h4><p>　　将这三个编辑框分别与对话框类的三个成员变量相关联，然后通过这些成员变量来检索和设置编辑框的文本，这是最简单的访问控件的方式。<br>打开ClassWizard对话框，切换到Member Variables选项卡，如图。<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170415152431039?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure><br>　　首先为IDC_EDIT1编辑框添加一个关联的成员变量，方法是在Control IDs列表中选中IDC_EDIT1，再单击Add Variable按钮，如图。<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170415152451118?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure><br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170415152505259?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<p>　　同样地，为IDC_EDIT2和IDC_EDIT3分别添加好成员变量。<br>　　接着修改代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </span><br><span class="line">&#123;</span><br><span class="line">	UpdateData();</span><br><span class="line">	m_num3 = m_num1 + m_num2;</span><br><span class="line">	UpdateData(FALSE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>　　对编辑框控件中输入的数值设定一个范围：<br>　　打开ClassWizard-Member Variable，选中IDC_EDIT1，下方输入0和100。同样为IDC_EDIT2也设置好。<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170415152522025?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<h4 id="第五种方式"><a href="#第五种方式" class="headerlink" title="第五种方式"></a>第五种方式</h4><p>　　将编辑框控件再与一个变量相关联，代表控件本身。为IDC_EDIT1增加一个控件类型的变量：m_edit1，类别为Control。同样地，也为IDC_EDIT2和IDC_EDIT3添加。<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170415152547447?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<p>　　修改代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> num1, num2, num3; </span><br><span class="line">	<span class="keyword">char</span> ch1[<span class="number">10</span>], ch2[<span class="number">10</span>], ch3[<span class="number">10</span>]; </span><br><span class="line">	</span><br><span class="line">	m_edit1.GetWindowText(ch1,<span class="number">10</span>);</span><br><span class="line">	m_edit2.GetWindowText(ch2,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//num1 = GetDlgItemInt(IDC_EDIT1);</span></span><br><span class="line">	<span class="comment">//num2 = GetDlgItemInt(IDC_EDIT2);</span></span><br><span class="line"></span><br><span class="line">	num1 = atoi(ch1); </span><br><span class="line">	num2 = atoi(ch2); </span><br><span class="line">	num3 = num1 + num2; </span><br><span class="line"></span><br><span class="line">	itoa(num3,ch3,<span class="number">10</span>);</span><br><span class="line">	m_edit3.SetWindowText(ch3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="第六种方式"><a href="#第六种方式" class="headerlink" title="第六种方式"></a>第六种方式</h4><p>　　修改代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> num1, num2, num3; </span><br><span class="line">	<span class="keyword">char</span> ch1[<span class="number">10</span>], ch2[<span class="number">10</span>], ch3[<span class="number">10</span>]; </span><br><span class="line"></span><br><span class="line">	::SendMessage(GetDlgItem(IDC_EDIT1)-&gt;m_hWnd, WM_GETTEXT, <span class="number">10</span>, (LPARAM)ch1);</span><br><span class="line">	::SendMessage(m_edit2.m_hWnd, WM_GETTEXT, <span class="number">10</span>, (LPARAM)ch2);</span><br><span class="line"></span><br><span class="line">	num1 = atoi(ch1); </span><br><span class="line">	num2 = atoi(ch2); </span><br><span class="line">	num3 = num1 + num2; </span><br><span class="line"></span><br><span class="line">	itoa(num3,ch3,<span class="number">10</span>);</span><br><span class="line">	m_edit3.SendMessage(WM_SETTEXT, <span class="number">0</span>, (LPARAM)ch3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="第七种方式"><a href="#第七种方式" class="headerlink" title="第七种方式"></a>第七种方式</h4><p>　　修改代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> num1, num2, num3; </span><br><span class="line">	<span class="keyword">char</span> ch1[<span class="number">10</span>], ch2[<span class="number">10</span>], ch3[<span class="number">10</span>]; </span><br><span class="line">	</span><br><span class="line">	SendDlgItemMessage(IDC_EDIT1, WM_GETTEXT, <span class="number">10</span>, (LPARAM)ch1);</span><br><span class="line">	SendDlgItemMessage(IDC_EDIT2, WM_GETTEXT, <span class="number">10</span>, (LPARAM)ch2);</span><br><span class="line">	</span><br><span class="line">num1 = atoi(ch1); </span><br><span class="line">	num2 = atoi(ch2); </span><br><span class="line">	num3 = num1 + num2; </span><br><span class="line"></span><br><span class="line">	itoa(num3,ch3,<span class="number">10</span>);</span><br><span class="line">	SendDlgItemMessage(IDC_EDIT3, WM_SETTEXT, <span class="number">0</span>, (LPARAM)ch3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　获得编辑框复选的内容：<br>　　在上述代码最后添加：<br>    SendDlgItemMessage(IDC_EDIT3, EM_SETSEL, 0, -1); //0,-1表示全选若1,3表示选中1-3位复选<br>    m_edit3.SetFocus();</p>
<p>　　效果：<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170415152614010?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>1    GetDlgItem()-&gt;Get(Set)WindowTest()<br>2    GetDlgItemText()/SetDlgItemText()<br>3    GetDlgItemInt()/SetDlgItemInt()<br>4    将控件和整型变量相关联<br>5    将控件和控件变量相关联<br>6    SendMessage()<br>7    SendDlgItemMessage()<br>　　最常用是1、4、5。在利用MFC编程时，6、7用得少。</p>
<h2 id="对话框伸缩功能的实现"><a href="#对话框伸缩功能的实现" class="headerlink" title="对话框伸缩功能的实现"></a>对话框伸缩功能的实现</h2><p>　　对话框上再添加一个按钮，Caption设置为“收缩&lt;&lt;”点击ClassWizard，添加一个命令相应函数（BN_CLICKED）。具体实现代码为：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTestDlg::OnButton1() </span><br><span class="line">&#123;</span><br><span class="line">	CString str; </span><br><span class="line">	<span class="keyword">if</span>(GetDlgItemText(IDC_BUTTON1,str), str == <span class="string">"收缩&lt;&lt;"</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		SetDlgItemText(IDC_BUTTON1, <span class="string">"拓展&gt;&gt;"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		SetDlgItemText(IDC_BUTTON1, <span class="string">"收缩&lt;&lt;"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　拖动一个图像控件来划分对话框中要动态切除的部分。<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170415152648992?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<p>　　修改该控件ID为IDC_SEPATATOR，styles选项卡勾上Sunken选项。<br>　　修改代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTestDlg::OnButton1() </span><br><span class="line">&#123;</span><br><span class="line">	CString str; </span><br><span class="line">	<span class="keyword">if</span>(GetDlgItemText(IDC_BUTTON1,str), str == <span class="string">"收缩&lt;&lt;"</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		SetDlgItemText(IDC_BUTTON1, <span class="string">"拓展&gt;&gt;"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		SetDlgItemText(IDC_BUTTON1, <span class="string">"收缩&lt;&lt;"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">static</span> CRect rectLarge;</span><br><span class="line">	<span class="keyword">static</span> CRect rectSmall;</span><br><span class="line"></span><br><span class="line">	<span class="function">CRect <span class="title">rect1</span><span class="params">(<span class="number">10</span>,<span class="number">10</span>,<span class="number">10</span>,<span class="number">10</span>)</span></span>;</span><br><span class="line">	<span class="function">CRect <span class="title">rect2</span><span class="params">(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(rectLarge.IsRectNull())</span><br><span class="line">	&#123;</span><br><span class="line">		CRect rectSeparator;</span><br><span class="line">		GetWindowRect(&amp;rectLarge);</span><br><span class="line">		GetDlgItem(IDC_SEPARATOR)-&gt;GetWindowRect(&amp;rectSeparator);</span><br><span class="line"></span><br><span class="line">		rectSmall.left=rectLarge.left;</span><br><span class="line">		rectSmall.top=rectLarge.top;</span><br><span class="line">		rectSmall.right=rectLarge.right;</span><br><span class="line">		rectSmall.bottom=rectSeparator.bottom;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(str == <span class="string">"收缩&lt;&lt;"</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		SetWindowPos(<span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>, rectSmall.Width(), rectSmall.Height(), SWP_NOMOVE | SWP_NOZORDER);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		SetWindowPos(<span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>, rectLarge.Width(), rectLarge.Height(), SWP_NOMOVE | SWP_NOZORDER);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　效果：<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170415152705855?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<p>　　点击“收缩&lt;&lt;”：<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170415152725793?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<p>　　若希望隐藏分隔条，则设置属性去掉“Visible”前的勾。</p>
<h2 id="输入焦点的传递"><a href="#输入焦点的传递" class="headerlink" title="输入焦点的传递"></a>输入焦点的传递</h2><p>　　为了屏蔽掉默认的回车键关闭对话框这一功能，应该在对话框子类（此处是CTestDlg类）中重写OK按钮的消息响应函数。<br>　　首先点击OK按钮，添加鼠标单击消息响应函数。注释掉原有函数。</p>
<h3 id="法一"><a href="#法一" class="headerlink" title="法一"></a>法一</h3><p>　　在ClassView选项卡的CTestDlg类添加WM_INITDIALOG消息的响应函数。对类右键，选择Add Windows Message Handler，在弹出的框左侧选择WM_INITDIALOG，直接单击Add and Edit，跳转。<br>　　修改代码为：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTestDlg::OnOK() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add extra validation here</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//CDialog::OnOK();</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">WNDPROC prevProc;</span><br><span class="line">	<span class="function">LRESULT CALLBACK <span class="title">NewEditProc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">		HWND hwnd,</span></span></span><br><span class="line"><span class="function"><span class="params">		UINT uMsg,</span></span></span><br><span class="line"><span class="function"><span class="params">		WPARAM wParam,</span></span></span><br><span class="line"><span class="function"><span class="params">		LPARAM lParam</span></span></span><br><span class="line"><span class="function"><span class="params">		)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(uMsg == WM_CHAR &amp;&amp; wParam == <span class="number">0x0d</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			::SetFocus(GetNextWindow(hwnd,GW_HWNDNEXT));</span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> prevProc(hwnd,uMsg,wParam,lParam);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">BOOL CTestDlg::OnInitDialog() </span><br><span class="line">&#123;</span><br><span class="line">	CDialog::OnInitDialog();</span><br><span class="line">	prevProc=(WNDPROC)SetWindowLong(GetDlgItem(IDC_EDIT1)-&gt;m_hWnd,</span><br><span class="line">		GWL_WNDPROC, (LONG)NewEditProc);</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　查看第一个编辑框的属性，打开styles选项卡，勾上MultiLine（多行）。即可实现焦点的传递。</p>
<h3 id="法二"><a href="#法二" class="headerlink" title="法二"></a>法二</h3><p>　　只需要改变一行代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">WNDPROC prevProc;</span><br><span class="line">	<span class="function">LRESULT CALLBACK <span class="title">NewEditProc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">		HWND hwnd,</span></span></span><br><span class="line"><span class="function"><span class="params">		UINT uMsg,</span></span></span><br><span class="line"><span class="function"><span class="params">		WPARAM wParam,</span></span></span><br><span class="line"><span class="function"><span class="params">		LPARAM lParam</span></span></span><br><span class="line"><span class="function"><span class="params">		)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(uMsg == WM_CHAR &amp;&amp; wParam == <span class="number">0x0d</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//::SetFocus(GetNextWindow(hwnd,GW_HWNDNEXT));</span></span><br><span class="line">			SetFocus(::GetWindow(hwnd,GW_HWNDNEXT));</span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> prevProc(hwnd,uMsg,wParam,lParam);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="法三"><a href="#法三" class="headerlink" title="法三"></a>法三</h3><p>　　编辑框属性有一个WS_TABSTOP，如果勾选了，则在对话框中按下Tab键后，输入焦点可以转移到此控件上。</p>
<p>　　修改一行代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">WNDPROC prevProc;</span><br><span class="line">	<span class="function">LRESULT CALLBACK <span class="title">NewEditProc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">		HWND hwnd,</span></span></span><br><span class="line"><span class="function"><span class="params">		UINT uMsg,</span></span></span><br><span class="line"><span class="function"><span class="params">		WPARAM wParam,</span></span></span><br><span class="line"><span class="function"><span class="params">		LPARAM lParam</span></span></span><br><span class="line"><span class="function"><span class="params">		)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(uMsg == WM_CHAR &amp;&amp; wParam == <span class="number">0x0d</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			SetFocus(::GetNextDlgTabItem(::GetParent(hwnd),hwnd,FALSE));</span><br><span class="line">			<span class="comment">//::SetFocus(GetNextWindow(hwnd,GW_HWNDNEXT));</span></span><br><span class="line">			<span class="comment">//SetFocus(::GetWindow(hwnd,GW_HWNDNEXT));</span></span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> prevProc(hwnd,uMsg,wParam,lParam);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　三种方法的缺点：只修改了第一个编辑框的窗口过程，因此从第二到第三个编辑框的焦点转移无法实现，除非继续修改第二个编辑窗口。</p>
<p>　　再介绍一种方法解决这个问题。</p>
<h3 id="法四"><a href="#法四" class="headerlink" title="法四"></a>法四</h3><p>　　在MFC中，默认情况下，当在对话框窗口中按下回车键时，会调用对话框的默认按钮的响应函数，我们可以在此默认按钮的响应函数中把焦点依次向下传递。</p>
<p>　　首先取消第一个编辑框的MultiLine。<br>　　接着修改OnOK函数为：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTestDlg::OnOK() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add extra validation here</span></span><br><span class="line">	<span class="comment">//GetDlgItem(IDC_EDIT1)-&gt;GetNextWindow()-&gt;SetFocus();</span></span><br><span class="line">	<span class="comment">//GetFocus()-&gt;GetNextWindow()-&gt;SetFocus();</span></span><br><span class="line">	<span class="comment">//GetFocus()-&gt;GetWindow(GW_HWNDNEXT)-&gt;SetFocus();</span></span><br><span class="line">	GetNextDlgTabItem(GetFocus())-&gt;SetFocus();</span><br><span class="line">	<span class="comment">//CDialog::OnOK();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　注释掉的部分是各种失败的尝试，各有各的bug。现在程序是正常的。</p>
<pre><code>**注意：然而该屏蔽回车键的方法并非是常规做法，应该在PreTranslateMessage中进行拦截。（return TRUE即拦截）**
</code></pre><p>　　具体做法：<br>　　现在Testdlg.h中添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CTestDlg</span> :</span> <span class="keyword">public</span> CDialog</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> BOOL <span class="title">PreTranslateMessage</span><span class="params">(MSG* pMsg)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnOK</span><span class="params">()</span></span>;</span><br><span class="line">……</span><br></pre></td></tr></table></figure></p>
<p>　　接着：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">CTestDlg::PreTranslateMessage(MSG* pMsg)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//屏蔽ESC关闭窗体</span></span><br><span class="line">	<span class="keyword">if</span> (pMsg-&gt;message == WM_KEYDOWN &amp;&amp; pMsg-&gt;wParam == VK_ESCAPE)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> TRUE;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//屏蔽回车关闭窗体，但会导致回车在窗体上失效.</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	if (pMsg-&gt;message == WM_KEYDOWN &amp;&amp; pMsg-&gt;wParam == VK_RETURN &amp;&amp; pMsg-&gt;wParam)</span></span><br><span class="line"><span class="comment">	&#123;</span></span><br><span class="line"><span class="comment">		return TRUE;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> CDialog::PreTranslateMessage(pMsg);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CTestDlg::OnOK() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add extra validation here</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//CDialog::OnOK();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　点击Layout-Tab order，这些序号就是各控件的Tab顺序。顺序可改变，依次点击希望的顺序控件即可。</p>
<p>　　调用顺序：当用户按下回车键时，Windows将查看对话框中是否存在指定的默认按钮，如果有，就调用该默认按钮单击消息的响应函数。如果没有，就会调用虚拟的OnOK函数，即使对话框没有包含默认的OK按钮（这个默认OK按钮的ID是IDOK）。</p>
<h1 id="文件和注册表操作"><a href="#文件和注册表操作" class="headerlink" title="文件和注册表操作"></a>文件和注册表操作</h1><h2 id="C语言对文件操作的支持"><a href="#C语言对文件操作的支持" class="headerlink" title="C语言对文件操作的支持"></a>C语言对文件操作的支持</h2><p>　　新建单文档类型的MFC应用程序，工程名为File，并为主菜单添加一个子菜单，名称为“文件操作”，然后为其添加两个菜单项，并分别为它们添加相应的命令响应函数（通过COMMAND），让CFileView类接收这些菜单项的命令响应。<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170420224900928?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure><br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170420224921428?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<h3 id="文件的打开和写入"><a href="#文件的打开和写入" class="headerlink" title="文件的打开和写入"></a>文件的打开和写入</h3><p>　　代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </span><br><span class="line">&#123;</span><br><span class="line">	FILE *pFile = fopen(<span class="string">"1.txt"</span>,<span class="string">"w"</span>);</span><br><span class="line">	fwrite(<span class="string">"http://www.sunxin.org"</span>, <span class="number">1</span>, <span class="built_in">strlen</span>(<span class="string">"http://www.sunxin.org"</span>), pFile); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　编译后可看到文件夹中生成了1.txt，打开有一行网址。</p>
<h3 id="文件的关闭"><a href="#文件的关闭" class="headerlink" title="文件的关闭"></a>文件的关闭</h3><p>　　增加一行代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </span><br><span class="line">&#123;</span><br><span class="line">	FILE *pFile = fopen(<span class="string">"1.txt"</span>,<span class="string">"w"</span>);</span><br><span class="line">	fwrite(<span class="string">"http://www.sunxin.org"</span>, <span class="number">1</span>, <span class="built_in">strlen</span>(<span class="string">"http://www.sunxin.org"</span>), pFile); </span><br><span class="line">	fclose(pFile);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="文件指针定位"><a href="#文件指针定位" class="headerlink" title="文件指针定位"></a>文件指针定位</h3><p>　　代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </span><br><span class="line">&#123;</span><br><span class="line">	FILE *pFile = fopen(<span class="string">"1.txt"</span>,<span class="string">"w"</span>);</span><br><span class="line">	fwrite(<span class="string">"http://www.sunxin.org"</span>, <span class="number">1</span>, <span class="built_in">strlen</span>(<span class="string">"http://www.sunxin.org"</span>), pFile); </span><br><span class="line">	fwrite(<span class="string">"欢迎访问"</span>, <span class="number">1</span>, <span class="built_in">strlen</span>(<span class="string">"欢迎访问"</span>), pFile);</span><br><span class="line">	fclose(pFile);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　显示：<a href="http://www.sunxin.org欢迎访问" target="_blank" rel="noopener">http://www.sunxin.org欢迎访问</a></p>
<p>　　将文件指针移动到文件的开始位置处：<br>　　代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </span><br><span class="line">&#123;</span><br><span class="line">	FILE *pFile = fopen(<span class="string">"1.txt"</span>,<span class="string">"w"</span>);</span><br><span class="line">	fwrite(<span class="string">"http://www.sunxin.org"</span>, <span class="number">1</span>, <span class="built_in">strlen</span>(<span class="string">"http://www.sunxin.org"</span>), pFile); </span><br><span class="line">	fseek(pFile, <span class="number">0</span>, SEEK_SET);</span><br><span class="line">	fwrite(<span class="string">"ftp:"</span>, <span class="number">1</span>, <span class="built_in">strlen</span>(<span class="string">"ftp:"</span>),pFile);</span><br><span class="line">	<span class="comment">//fwrite("欢迎访问", 1, strlen("欢迎访问"), pFile);</span></span><br><span class="line">	fclose(pFile);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　显示：ftp:://<a href="http://www.sunxin.org" target="_blank" rel="noopener">www.sunxin.org</a></p>
<h3 id="文件的读取"><a href="#文件的读取" class="headerlink" title="文件的读取"></a>文件的读取</h3><p>　　在OnFileRead函数中写入代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CFileView::OnFileRead() </span><br><span class="line">&#123;</span><br><span class="line">	FILE *pFile = fopen(<span class="string">"1.txt"</span>,<span class="string">"r"</span>);</span><br><span class="line">	<span class="keyword">char</span> ch[<span class="number">100</span>];</span><br><span class="line">	fread(ch, <span class="number">1</span>, <span class="number">100</span>, pFile);</span><br><span class="line">	fclose(pFile);</span><br><span class="line">	MessageBox(ch);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　编译运行：<br>　　<br> <img src="http://img.blog.csdn.net/20170420224951225?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　原因：C语言以“\0”结束。</p>
<p>　　解决方法：<br>　　法一：<br>　　修改代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </span><br><span class="line">&#123;</span><br><span class="line">	FILE *pFile = fopen(<span class="string">"1.txt"</span>,<span class="string">"w"</span>);</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">22</span>] = <span class="string">"http://www.sunxin.org"</span>;</span><br><span class="line">	buf[<span class="number">21</span>] = <span class="string">'\0'</span>;</span><br><span class="line">	fwrite(buf, <span class="number">1</span>, <span class="number">22</span>, pFile);</span><br><span class="line">	fclose(pFile);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　先点击写入文件，再点击读取文件，就可以看到正确的内容。<br>　　缺点：增加了文件大小。</p>
<p>法二：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CFileView::OnFileRead() </span><br><span class="line">&#123;</span><br><span class="line">	FILE *pFile = fopen(<span class="string">"1.txt"</span>,<span class="string">"r"</span>);</span><br><span class="line">	<span class="keyword">char</span> ch[<span class="number">100</span>];</span><br><span class="line">	<span class="built_in">memset</span>(ch, <span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">	fread(ch, <span class="number">1</span>, <span class="number">100</span>, pFile);</span><br><span class="line">	fclose(pFile);</span><br><span class="line">	MessageBox(ch);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>法三：<br>　　读取文件时，不知道文件大小时的做法。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CFileView::OnFileRead() </span><br><span class="line">&#123;</span><br><span class="line">	FILE *pFile = fopen(<span class="string">"1.txt"</span>,<span class="string">"r"</span>);</span><br><span class="line">	<span class="keyword">char</span> *pBuf;</span><br><span class="line">	fseek(pFile, <span class="number">0</span>, SEEK_END);</span><br><span class="line">	<span class="keyword">int</span> len=ftell(pFile);</span><br><span class="line">	pBuf = <span class="keyword">new</span> <span class="keyword">char</span>[len+<span class="number">1</span>];</span><br><span class="line">	rewind(pFile);</span><br><span class="line">	fread(pBuf, <span class="number">1</span>, len, pFile);</span><br><span class="line">	pBuf[len] = <span class="number">0</span>;</span><br><span class="line">	fclose(pFile);</span><br><span class="line">	MessageBox(pBuf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="二进制文件和文本文件"><a href="#二进制文件和文本文件" class="headerlink" title="二进制文件和文本文件"></a>二进制文件和文本文件</h3><p>　　代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </span><br><span class="line">&#123;</span><br><span class="line">	FILE *pFile = fopen(<span class="string">"2.txt"</span>, <span class="string">"w"</span>);</span><br><span class="line">	<span class="keyword">char</span> ch[<span class="number">3</span>];</span><br><span class="line">	ch[<span class="number">0</span>] = <span class="string">'a'</span>;</span><br><span class="line">	ch[<span class="number">1</span>] = <span class="number">10</span>;</span><br><span class="line">	ch[<span class="number">2</span>] = <span class="string">'b'</span>;</span><br><span class="line">	fwrite(ch, <span class="number">1</span>, <span class="number">3</span>, pFile);</span><br><span class="line">	fclose(pFile);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CFileView::OnFileRead() </span><br><span class="line">&#123;</span><br><span class="line">	FILE *pFile = fopen(<span class="string">"2.txt"</span>,<span class="string">"r"</span>);</span><br><span class="line">	<span class="keyword">char</span> ch[<span class="number">100</span>];</span><br><span class="line">	fread(ch, <span class="number">1</span>, <span class="number">3</span>, pFile);</span><br><span class="line">	ch[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">	fclose(pFile);</span><br><span class="line">	MessageBox(ch);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　效果：<br>　　<br> <img src="http://img.blog.csdn.net/20170420225018961?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　文本方式：10实际上是换行符的ASCII码。</p>
<p>　　以文本方式和二进制方式读取文件是有明显的区别的。</p>
<h3 id="文本方式和二进制方式"><a href="#文本方式和二进制方式" class="headerlink" title="文本方式和二进制方式"></a>文本方式和二进制方式</h3><p>　　二进制方式：换行是由两个字符组成的，即ASCII码10（回车符）和13（换行符）。<br>　　写入和读取文件时要保持一致。如果采用文本方式写入，应采用文本方式读取；如果采用二进制方式写入数据，在读取时也应采用二进制方式。</p>
<p>　　面试题：给你一个整数，如：98341，将这个整数保存到文件中，要求在以记事本程序打开该文件时，显示的是：98341。<br>　　法一：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </span><br><span class="line">&#123;</span><br><span class="line">	FILE *pFile = fopen(<span class="string">"3.txt"</span>, <span class="string">"w"</span>);</span><br><span class="line">	<span class="keyword">char</span> ch[<span class="number">5</span>];</span><br><span class="line">	ch[<span class="number">0</span>] = <span class="number">9</span> + <span class="number">48</span>;</span><br><span class="line">	ch[<span class="number">1</span>] = <span class="number">8</span> + <span class="number">48</span>;</span><br><span class="line">	ch[<span class="number">2</span>] = <span class="number">3</span> + <span class="number">48</span>;</span><br><span class="line">	ch[<span class="number">3</span>] = <span class="number">4</span> + <span class="number">48</span>;</span><br><span class="line">	ch[<span class="number">4</span>] = <span class="number">1</span> + <span class="number">48</span>;</span><br><span class="line"></span><br><span class="line">	fwrite(ch, <span class="number">1</span>, <span class="number">5</span>, pFile);</span><br><span class="line">	fclose(pFile);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　或</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </span><br><span class="line">&#123;</span><br><span class="line">	FILE *pFile = fopen(<span class="string">"3.txt"</span>, <span class="string">"w"</span>);</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">98341</span>;</span><br><span class="line">	<span class="keyword">char</span> ch[<span class="number">5</span>];</span><br><span class="line">	itoa(i, ch, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">	fwrite(ch, <span class="number">1</span>, <span class="number">5</span>, pFile);</span><br><span class="line">	fclose(pFile);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>　　面试题：给定一个字符串，其中既有数字字符，又有26个英文字母中的几个字符，让你判断一下哪些是数字字符。</p>
<p>　　对这种问题，实际上就是判断各字符的ASCII码，对于数字字符来说，它们的ASCII码大于等于48，小于等于57。</p>
<h2 id="C-对文件操作的支持"><a href="#C-对文件操作的支持" class="headerlink" title="C++对文件操作的支持"></a>C++对文件操作的支持</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="function">ofstream <span class="title">ofs</span><span class="params">(<span class="string">"4.txt"</span>)</span></span>;</span><br><span class="line">	ofs.write(<span class="string">"http://www.sunxin.org"</span>,<span class="built_in">strlen</span>(<span class="string">"http://www.sunxin.org"</span>));</span><br><span class="line">	ofs.close;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CFileView::OnFileRead() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="function">ifstream <span class="title">ifs</span><span class="params">(<span class="string">"4.txt"</span>)</span></span>;</span><br><span class="line">	<span class="keyword">char</span> ch[<span class="number">100</span>];</span><br><span class="line">	<span class="built_in">memset</span>(ch, <span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">	ifs.read(ch,<span class="number">100</span>);</span><br><span class="line">	ifs.close();</span><br><span class="line">	MessageBox(ch);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Win32-API-对文件操作的支持"><a href="#Win32-API-对文件操作的支持" class="headerlink" title="Win32 API 对文件操作的支持"></a>Win32 API 对文件操作的支持</h2><h3 id="文件的创建、打开和写入"><a href="#文件的创建、打开和写入" class="headerlink" title="文件的创建、打开和写入"></a>文件的创建、打开和写入</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//定义一个句柄变量</span></span><br><span class="line">	HANDLE hFile;</span><br><span class="line">	<span class="comment">//创建文件</span></span><br><span class="line">	hFile = CreateFile(<span class="string">"5.txt"</span>, GENERIC_WRITE, <span class="number">0</span>, <span class="literal">NULL</span>, CREATE_NEW, </span><br><span class="line">		FILE_ATTRIBUTE_NORMAL, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="comment">//接收实际写入的字节数</span></span><br><span class="line">	DWORD dwWrites;</span><br><span class="line">	<span class="comment">//写入数据</span></span><br><span class="line">	WriteFile(hFile,<span class="string">"http://www.sunxin.org"</span>,<span class="built_in">strlen</span>(<span class="string">"http://www.sunxin.org"</span>),</span><br><span class="line">		&amp;dwWrites, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="comment">//关闭文件句柄</span></span><br><span class="line">	CloseHandle(hFile);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="文件的读取-1"><a href="#文件的读取-1" class="headerlink" title="文件的读取"></a>文件的读取</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CFileView::OnFileRead() </span><br><span class="line">&#123;</span><br><span class="line">	HANDLE hFile;</span><br><span class="line">	<span class="comment">//打开文件</span></span><br><span class="line">	hFile = CreateFile(<span class="string">"5.txt"</span>, GENERIC_READ, <span class="number">0</span>, <span class="literal">NULL</span>, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="comment">//接收实际收到的数据</span></span><br><span class="line">	<span class="keyword">char</span> ch[<span class="number">100</span>];</span><br><span class="line">	<span class="comment">//接收实际读取到的字节数</span></span><br><span class="line">	DWORD dwReads;</span><br><span class="line">	<span class="comment">//读取数据</span></span><br><span class="line">	ReadFile(hFile, ch, <span class="number">100</span>, &amp;dwReads, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="comment">//设置字符串结束字符</span></span><br><span class="line">	ch[dwReads] = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//关闭打开的文件对象的句柄</span></span><br><span class="line">	CloseHandle(hFile);</span><br><span class="line">	<span class="comment">//显示读取到的数据</span></span><br><span class="line">	MessageBox(ch);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="菜单"><a href="#菜单" class="headerlink" title="菜单"></a>菜单</h1><h2 id="菜单命令响应函数"><a href="#菜单命令响应函数" class="headerlink" title="菜单命令响应函数"></a>菜单命令响应函数</h2><p>　　新建一个单文档的MFC AppWizard(exe)工程，工程名为Menu。Build运行。</p>
<p> <img src="http://img.blog.csdn.net/20170420225058617?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>　　左上角点击按钮，可以让属性框始终显示，不会因为点击对话框以外的地方就消失。<br>　　去掉Pop-up弹出前的勾，将ID改为ID_TEST。给Test添加响应函数在CMainFrame中，在函数中加入    MessageBox(“MainFrame Clicked”);<br>　　效果：<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170420225116851?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<h2 id="菜单命令的路由"><a href="#菜单命令的路由" class="headerlink" title="菜单命令的路由"></a>菜单命令的路由</h2><h3 id="程序类对菜单命令的响应顺序"><a href="#程序类对菜单命令的响应顺序" class="headerlink" title="程序类对菜单命令的响应顺序"></a>程序类对菜单命令的响应顺序</h3><p>　　响应Test<br>　　菜单项命令的顺序依次是：视类、文档类、框架类，最后才是应用程序类。</p>
<h3 id="Windows消息的分类"><a href="#Windows消息的分类" class="headerlink" title="Windows消息的分类"></a>Windows消息的分类</h3><p>　　凡是从CWnd派生的类，它们既可以接收标准消息，也可以接收命令消息和通告消息。而对于那些从CCmdTarget派生的类，则只能接收命令消息和通告消息，不能接收标准消息。<br>本例中的文档类（CMenuDoc）和应用程序类（CWinApp），因为它们都派生于CCmdTarget类，所以它们可以接收菜单命令消息。但它们不是从CWnd类派生的，所以不能接收标准消息。</p>
<h3 id="菜单命令的路由-1"><a href="#菜单命令的路由-1" class="headerlink" title="菜单命令的路由"></a>菜单命令的路由</h3><p>　　菜单命令消息路由的具体过程：当点击某个菜单项时，最先接收到这个菜单命令消息的是框架类。框架类将把接收到的这个消息交给它的子窗口，即视类，由视类首先进行处理。视类首先根据命令消息映射机制查找自身是否对此消息进行了响应，如果响应了，就调用相应响应函数对这个消息进行处理，消息路由过程结束；如果视类没有对此命令消息做出响应，就交由文档类，文档类同样查找自身是否对这个菜单命令进行了响应，如果响应了，就由文档类的命令消息响应函数进行处理，路由过程结束。如果文档类也未做出响应，就把这个命令消息交还给视类，后者又把该消息交还给框架类。框架类查看自己是否对这个命令消息进行了响应，如果它也没有做出响应，就把这个菜单命令消息交给应用程序类，由后者来进行处理。</p>
<h2 id="基本菜单操作"><a href="#基本菜单操作" class="headerlink" title="基本菜单操作"></a>基本菜单操作</h2><h3 id="标记菜单"><a href="#标记菜单" class="headerlink" title="标记菜单"></a>标记菜单</h3><p>　　运行刚才创建的Menu程序，点击查看，前面都有一个对号，这种类型就是标记菜单。<br>在CMainFrame类的OnCreate的return语句之前添加这句代码    GetMenu()-&gt;GetSubMenu(0)-&gt;CheckMenuItem(0, MF_BYPOSITION | MF_CHECKED);  或者GetMenu()-&gt;GetSubMenu(0)-&gt;CheckMenuItem(ID_FILE_NEW, MF_BYCOMMAND | MF_CHECKED);<br>　　Build并运行，可发现新建左边已添加一个复选标记。</p>
<h3 id="默认菜单项"><a href="#默认菜单项" class="headerlink" title="默认菜单项"></a>默认菜单项</h3><p>　　在刚才的代码下，添加    GetMenu()-&gt;GetSubMenu(0)-&gt;SetDefaultItem(1, TRUE); 或者GetMenu()-&gt;GetSubMenu(0)-&gt;SetDefaultItem(ID_FILE_OPEN,  FALSE);  编译运行，会发现“打开”变成了粗体。</p>
<p>　　<strong>注意：“打印”的索引是5，不是4。计算菜单项索引时，一定要把分割栏菜单项计算在内。并且，一个子菜单只能有一个默认菜单项。</strong></p>
<h3 id="图形标记菜单"><a href="#图形标记菜单" class="headerlink" title="图形标记菜单"></a>图形标记菜单</h3><p>　　Insert-Resource-Bitmap，创建一个位图资源。如图。<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170420225150945?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure><br>　　为CMainFrame类添加一个CBitmap类型的成员变量：m_bitmap。</p>
<p>　　接着添加代码：<br>    CString str;<br>    str.Format(“x=%d”,y=%d”, GetSystemMetrics(SM_CXMENUCHECK),GetSystemMetrics(SM_CYMENUCHECK));<br>    MessageBox(str);<br>    m_bitmap.LoadBitmap(IDB_BITMAP1);<br>    GetMenu()-&gt;GetSubMenu(0)-&gt;SetMenuItemBitmaps(0, MF_BYPOSITION, &amp;m_bitmap, &amp;m_bitmap);</p>
<h3 id="禁用菜单项"><a href="#禁用菜单项" class="headerlink" title="禁用菜单项"></a>禁用菜单项</h3><p>　　通常把MF_GRAYED和MF_DISABLED这两个标志放在一起使用。不过这么做并不是必需的。<br>　　删除之前的代码，写入    GetMenu()-&gt;GetSubMenu(0)-&gt;EnableMenuItem(1, MF_BYPOSITION | MF_DISABLED | MF_GRAYED);<br>　　打开“文件”子菜单，发现“打开”菜单栏变灰，点击不起作用。</p>
<h3 id="移除和装载菜单"><a href="#移除和装载菜单" class="headerlink" title="移除和装载菜单"></a>移除和装载菜单</h3><p>　　再添加一行代码：    SetMenu(NULL);  此时菜单栏被移除了。<br>　　再添加几行代码：<br>CMenu menu;<br>    menu.LoadMenu(IDR_MAINFRAME);<br>    SetMenu(&amp;menu);<br>    menu.Detach();<br>　　此时菜单栏又装载了。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">CMenu menu;</span><br><span class="line">menu.CreateMenu();</span><br><span class="line">GetMenu()-&gt;AppendMenu(MF_POPUP, (UINT)menu.m_hMenu, <span class="string">"Test1"</span>);</span><br><span class="line">menu.AppendMenu(MF_STRING, <span class="number">111</span>, <span class="string">"Hello"</span>);</span><br><span class="line">menu.AppendMenu(MF_STRING, <span class="number">112</span>, <span class="string">"Bye"</span>);</span><br><span class="line">menu.AppendMenu(MF_STRING, <span class="number">113</span>, <span class="string">"Mybole"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">menu.Detach();</span><br><span class="line"></span><br><span class="line">CMenu menu1;</span><br><span class="line">menu1.CreateMenu();</span><br><span class="line">GetMenu()-&gt;InsertMenu(<span class="number">2</span>, MF_POPUP | MF_BYPOSITION, (UINT)menu1. m_hMenu,<span class="string">"Test"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">menu1.Detach();</span><br><span class="line"></span><br><span class="line">GetMenu()-&gt;GetSubMenu(<span class="number">2</span>)-&gt;AppendMenu(MF_STRING, <span class="number">118</span>, <span class="string">"Welcome"</span>);</span><br><span class="line">GetMenu()-&gt;GetSubMenu(<span class="number">0</span>)-&gt;AppendMenu(MF_STRING, <span class="number">114</span>, <span class="string">"Welcome"</span>);</span><br><span class="line">GetMenu()-&gt;GetSubMenu(<span class="number">0</span>)-&gt;InsertMenu(ID_FILE_OPEN, MF_BYCOMMAND | MF_STRING, <span class="number">115</span>, <span class="string">"VC编程"</span>);</span><br></pre></td></tr></table></figure></p>
<h3 id="MFC菜单命令更新机制"><a href="#MFC菜单命令更新机制" class="headerlink" title="MFC菜单命令更新机制"></a>MFC菜单命令更新机制</h3><p> <img src="http://img.blog.csdn.net/20170420225218087?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　MFC命令更新机制：当要显示菜单时，操作系统发出WM_INITMENUPOPOP消息，然后由程序窗口的基类如CFrameWnd接管，它会创建一个CCmdUI对象，并与程序的第一个菜单项相关联，调用该对象的一个成员函数DoUpdate()。这个函数发出CN_UPDATE_COMMAND_UI消息，这条消息带有一个指向CCmdUI对象的指针。这时，系统会判断是否存在一个ON_UPDATE_COMMAND_UI宏去捕获这个菜单项消息。如果找到这样一个宏，就调用相应的消息响应函数进行处理，在这个函数中，可以利用传递过来的CCmdUI对象去调用相应的函数，使该菜单项可以使用，或禁用该菜单项。当更新完第一个菜单项后，同一个CCmdUI对象就设置为与第二个菜单项相关联，依此顺序进行，直到完成所有菜单项的处理。</p>
<p>　　添加代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CMainFrame::OnUpdateEditCut(CCmdUI* pCmdUI) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your command update UI handler code here</span></span><br><span class="line">	pCmdUI-&gt;Enable();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　编辑-剪切 可用了。<br>　　如果要把工具栏上的一个工具按钮与菜单栏中的某个菜单项相关联，只要将它们的ID设置为同一个标识就可以了。</p>
<p>　　如果希望禁用文件-新建，为ID_FILE_NEW添加UPDATE_COMMAND_UI消息响应函数。<br>　　代码如下：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">void</span> CMainFrame::OnUpdateFileNew(CCmdUI* pCmdUI) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your command update UI handler code here</span></span><br><span class="line">	pCmdUI-&gt;Enable(FALSE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　或者<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CMainFrame::OnUpdateFileNew(CCmdUI* pCmdUI) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="number">2</span> == pCmdUI-&gt;m_nIndex)</span><br><span class="line">	pCmdUI-&gt;Enable();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="快捷菜单"><a href="#快捷菜单" class="headerlink" title="快捷菜单"></a>快捷菜单</h3><p>　　1. 新增一个新的菜单资源。点开，顶级菜单设置任意的文本，如abc。添加两个菜单项：<br>　　显示 IDM_SHOW<br>　　退出 IDM_EXIT<br>　　2. 给CMenuView类添加WM_RBUTTONDOWN消息响应函数。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CMenu2View::OnRButtonDown(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	CMenu menu;</span><br><span class="line">	menu.LoadMenu(IDR_MENU1);</span><br><span class="line">	CMenu* pPopup = menu.GetSubMenu(<span class="number">0</span>);</span><br><span class="line">	ClientToScreen(&amp;point);</span><br><span class="line">	pPopup-&gt;TrackPopupMenu(TPM_LEFTALIGN | TPM_RIGHTBUTTON, point.x, point.y, <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">	CView::OnRButtonDown(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　效果：<br>　　<br> <img src="http://img.blog.csdn.net/20170420225352728?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>　　3.对“显示”右键ClassWizard，可以取消创建新类的询问。分别为CMainFrame类和CMenuView类添加一个响应。<br>　　代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CMenu2View::OnShow() </span><br><span class="line">&#123;</span><br><span class="line">	MessageBox(<span class="string">"View show"</span>);	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CMainFrame::OnShow() </span><br><span class="line">&#123;</span><br><span class="line">	MessageBox(<span class="string">"Main show"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>　　结果是显示“View show”。说明只有视类才能对快捷菜单项命令做出响应。若想让CMainView类对此快捷菜单项进行响应的话，修改代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CMenu2View::OnRButtonDown(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	CMenu menu;</span><br><span class="line">	menu.LoadMenu(IDR_MENU1);</span><br><span class="line">	CMenu* pPopup = menu.GetSubMenu(<span class="number">0</span>);</span><br><span class="line">	ClientToScreen(&amp;point);</span><br><span class="line">	<span class="comment">//pPopup-&gt;TrackPopupMenu(TPM_LEFTALIGN | TPM_RIGHTBUTTON, point.x, point.y, this);</span></span><br><span class="line">	pPopup-&gt;TrackPopupMenu(TPM_LEFTALIGN | TPM_RIGHTBUTTON, point.x, point.y, GetParent());</span><br><span class="line"></span><br><span class="line">	CView::OnRButtonDown(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　同时删去视类的显示。</p>
<h2 id="动态菜单操作"><a href="#动态菜单操作" class="headerlink" title="动态菜单操作"></a>动态菜单操作</h2><h3 id="添加菜单项目"><a href="#添加菜单项目" class="headerlink" title="添加菜单项目"></a>添加菜单项目</h3><p>　　在CMainFrame类的OnCreate函数中添加代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CMenu menu;</span><br><span class="line">menu.CreateMenu();</span><br><span class="line">GetMenu()-&gt;AppendMenu(MF_POPUP, (UINT)menu.m_hMenu, <span class="string">"Test"</span>);</span><br><span class="line">menu.Detach();</span><br></pre></td></tr></table></figure></p>
<h3 id="插入菜单项目"><a href="#插入菜单项目" class="headerlink" title="插入菜单项目"></a>插入菜单项目</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CMenu menu;</span><br><span class="line">menu.CreateMenu();</span><br><span class="line"><span class="comment">/*GetMenu()-&gt;AppendMenu(MF_POPUP, (UINT)menu.m_hMenu, "Test");</span></span><br><span class="line"><span class="comment">menu.Detach();*/</span></span><br><span class="line">GetMenu()-&gt;InsertMenu(<span class="number">2</span>, MF_POPUP | MF_BYPOSITION, (UINT)menu. m_hMenu,<span class="string">"Test"</span>);</span><br><span class="line">menu.Detach();</span><br></pre></td></tr></table></figure>
<p>　　如果要在新插入的子菜单中添加菜单项的话，同样可以使用AppendMenu函数来实现。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CMenu menu;</span><br><span class="line">	menu.CreateMenu();</span><br><span class="line">	<span class="comment">/*GetMenu()-&gt;AppendMenu(MF_POPUP, (UINT)menu.m_hMenu, "Test");</span></span><br><span class="line"><span class="comment">	menu.Detach();*/</span></span><br><span class="line">	GetMenu()-&gt;InsertMenu(<span class="number">2</span>, MF_POPUP | MF_BYPOSITION, (UINT)menu. m_hMenu,<span class="string">"Test"</span>);</span><br><span class="line"></span><br><span class="line">	menu.AppendMenu(MF_STRING, <span class="number">111</span>, <span class="string">"Hello"</span>);</span><br><span class="line">	menu.AppendMenu(MF_STRING, <span class="number">112</span>, <span class="string">"Bye"</span>);</span><br><span class="line">	menu.AppendMenu(MF_STRING, <span class="number">113</span>, <span class="string">"Mybole"</span>);</span><br><span class="line">	menu.Detach();</span><br></pre></td></tr></table></figure></p>
<p>　　111、112、113是随便赋予的ID号。<br>　　<br> <img src="http://img.blog.csdn.net/20170420230125731?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　若要在“文件”子菜单下添加一个菜单项Welcome，再添加一行代码：    GetMenu()-&gt;GetSubMenu(0)-&gt;AppendMenu(MF_STRING, 114, “Welcome”);<br>　　若要在“文件”中的“新建”和“打开”插入一个菜单项VC编程，再添加一行代码：<br>    GetMenu()-&gt;GetSubMenu(0)-&gt;InsertMenu(ID_FILE_OPEN, MF_BYCOMMAND | MF_STRING, 115， “VC编程”);</p>
<h3 id="删除菜单"><a href="#删除菜单" class="headerlink" title="删除菜单"></a>删除菜单</h3><p>　　删除“编辑”：在CMainFrame类的OnCreate函数最后（return之前）添加：<br>　　GetMenu()-&gt;DeleteMenu(1, MF_BYPOSITION);<br>　　删除“文件”下的“打开”：<br>　　GetMenu()-&gt;GetSubMenu(0)-&gt;DeleteMenu(2, MF_BYPOSITION);</p>
<h3 id="动态添加的菜单项的命令响应"><a href="#动态添加的菜单项的命令响应" class="headerlink" title="动态添加的菜单项的命令响应"></a>动态添加的菜单项的命令响应</h3><p>　　Resource.h中添加新ID<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IDM_HELLO	111</span></span><br></pre></td></tr></table></figure></p>
<p>将menu.AppendMenu(MF_STRING, 111, “Hello”); 改为 menu.AppendMenu(MF_STRING, IDM_HELLO, “Hello”);</p>
<p>　　三部曲：<br>　　1.    点开MainFrm.h，增加为<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#123;&#123;AFX_MSG(CMainFrame)</span></span><br><span class="line">	<span class="function">afx_msg <span class="keyword">int</span> <span class="title">OnCreate</span><span class="params">(LPCREATESTRUCT lpCreateStruct)</span></span>;</span><br><span class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnShow</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">//&#125;&#125;AFX_MSG</span></span><br><span class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnHello</span><span class="params">()</span></span>;</span><br><span class="line">	DECLARE_MESSAGE_MAP()</span><br></pre></td></tr></table></figure></p>
<p>　　2. 点开MainFrm.cpp，增加为<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">BEGIN_MESSAGE_MAP(CMainFrame, CFrameWnd)</span><br><span class="line">	<span class="comment">//&#123;&#123;AFX_MSG_MAP(CMainFrame)</span></span><br><span class="line">	ON_WM_CREATE()</span><br><span class="line">	ON_COMMAND(IDM_SHOW, OnShow)</span><br><span class="line">	ON_COMMAND(IDM_HELLO, OnHello)</span><br><span class="line">	<span class="comment">//&#125;&#125;AFX_MSG_MAP</span></span><br><span class="line">END_MESSAGE_MAP()</span><br></pre></td></tr></table></figure></p>
<p>　　3. CMainFrame类中添加<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CMainFrame::OnHello()</span><br><span class="line">&#123;</span><br><span class="line">	MessageBox(<span class="string">"Hello"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="电话本示例程序"><a href="#电话本示例程序" class="headerlink" title="电话本示例程序"></a>电话本示例程序</h2><p>　　删除之前写入CMainFrame类的OnCreate函数，留下原始函数。</p>
<h3 id="动态添加子菜单的实现"><a href="#动态添加子菜单的实现" class="headerlink" title="动态添加子菜单的实现"></a>动态添加子菜单的实现</h3><p>　　利用ClassWizard添加WM_CHAR消息。在Menu2View.h中添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="keyword">int</span> m_nIndex;</span><br><span class="line">	CMenu m_menu;</span><br></pre></td></tr></table></figure></p>
<p>在Menu2View.cpp里，添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CMenu2View::CMenu2View()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> add construction code here</span></span><br><span class="line">	m_nIndex = <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="显示输入的字符"><a href="#显示输入的字符" class="headerlink" title="显示输入的字符"></a>显示输入的字符</h3><h3 id="添加菜单项及其命令响应函数"><a href="#添加菜单项及其命令响应函数" class="headerlink" title="添加菜单项及其命令响应函数"></a>添加菜单项及其命令响应函数</h3><p>　　在资源编辑器中打开程序的菜单，在“帮助”后添加一个新菜单abc，添加4个菜单项。名称为1，ID为IDM_PHONE1，以此类推。用ClassWizard为CMenu2View类分别加上这四个菜单项的命令响应函数。<br>　　修改CMenu2View类的头文件，如下：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="comment">//&#123;&#123;AFX_MSG(CMenu2View)</span></span><br><span class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnRButtonDown</span><span class="params">(UINT nFlags, CPoint point)</span></span>;</span><br><span class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnChar</span><span class="params">(UINT nChar, UINT nRepCnt, UINT nFlags)</span></span>;</span><br><span class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnPhone1</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnPhone2</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnPhone3</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnPhone4</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">//&#125;&#125;AFX_MSG</span></span><br><span class="line">	DECLARE_MESSAGE_MAP()</span><br></pre></td></tr></table></figure></p>
<p>CMenu2View.cpp中，<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">//&#123;&#123;AFX_MSG_MAP(CMenu2View)</span></span><br><span class="line">	ON_WM_CHAR()</span><br><span class="line">	<span class="comment">//&#125;&#125;AFX_MSG_MAP</span></span><br><span class="line">	ON_COMMAND(IDM_PHONE1, OnPhone1)</span><br><span class="line">	ON_COMMAND(IDM_PHONE2, OnPhone2)</span><br><span class="line">	ON_COMMAND(IDM_PHONE3, OnPhone3)</span><br><span class="line">	ON_COMMAND(IDM_PHONE4, OnPhone4)</span><br><span class="line">	<span class="comment">// Standard printing commands</span></span><br><span class="line">	ON_COMMAND(ID_FILE_PRINT, CView::OnFilePrint)</span><br><span class="line">	ON_COMMAND(ID_FILE_PRINT_DIRECT, CView::OnFilePrint)</span><br><span class="line">	ON_COMMAND(ID_FILE_PRINT_PREVIEW, CView::OnFilePrintPreview)</span><br><span class="line">END_MESSAGE_MAP()</span><br></pre></td></tr></table></figure></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CMenu2View::OnPhone1() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	dc.TextOut(<span class="number">0</span>, <span class="number">0</span>, m_strArray.GetAt(<span class="number">0</span>));</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CMenu2View::OnPhone2() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	dc.TextOut(<span class="number">0</span>, <span class="number">0</span>, m_strArray.GetAt(<span class="number">1</span>));</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CMenu2View::OnPhone3() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	dc.TextOut(<span class="number">0</span>, <span class="number">0</span>, m_strArray.GetAt(<span class="number">2</span>));</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CMenu2View::OnPhone4() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	dc.TextOut(<span class="number">0</span>, <span class="number">0</span>, m_strArray.GetAt(<span class="number">3</span>));</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="框架类窗口截获菜单命令消息"><a href="#框架类窗口截获菜单命令消息" class="headerlink" title="框架类窗口截获菜单命令消息"></a>框架类窗口截获菜单命令消息</h3><p>　　右键单击CMainFrame，选择Add Virtual Functions-OnCommand，单击Add Handler，再点击Edit Existing。<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170420230209594?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure><br>　　代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">BOOL CMainFrame::OnCommand(WPARAM wParam, LPARAM lParam) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> MenuCmdID = LOWORD(wParam);</span><br><span class="line">	CMenu2View *pView = (CMenu2View *)GetActiveView();</span><br><span class="line">	<span class="keyword">if</span> (MenuCmdID &gt;= IDM_PHONE1 &amp;&amp; MenuCmdID &lt; IDM_PHONE1 + pView-&gt;m_strArray.GetSize())</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="comment">//MessageBox("Test");</span></span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(pView)</span></span>;</span><br><span class="line">	dc.TextOut(<span class="number">0</span>, <span class="number">0</span>, pView-&gt;m_strArray.GetAt(MenuCmdID - IDM_PHONE1));</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> CFrameWnd::OnCommand(wParam, lParam);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　将MainFrm.cpp里添加#include “Menu2View.h” 。<br>　　将Menu2View.cpp中的#include “Menu2Doc.h”剪切到Menu2View.h文件的前部（#endif // _MSC_VER &gt; 1000下面）。</p>
<p>　　最终代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">void</span> CMenu2View::OnChar(UINT nChar, UINT nRepCnt, UINT nFlags) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	<span class="keyword">if</span> (<span class="number">0x0d</span> == nChar)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="number">0</span> == ++m_nIndex)</span><br><span class="line">		&#123;</span><br><span class="line">			m_menu.CreatePopupMenu();</span><br><span class="line">			GetParent()-&gt;GetMenu()-&gt;AppendMenu(MF_POPUP, (UINT)m_menu.m_hMenu, <span class="string">"PhoneBook"</span>);</span><br><span class="line">			GetParent()-&gt;DrawMenuBar();</span><br><span class="line">		&#125;</span><br><span class="line">		m_menu.AppendMenu(MF_STRING, IDM_PHONE1 + m_nIndex, m_strLine.Left(m_strLine.Find(<span class="string">' '</span>)));</span><br><span class="line">		m_strArray.Add(m_strLine);</span><br><span class="line">		m_strLine.Empty();</span><br><span class="line">		Invalidate();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		m_strLine += nChar;</span><br><span class="line">		dc.TextOut(<span class="number">0</span>, <span class="number">0</span>, m_strLine);</span><br><span class="line">	&#125;</span><br><span class="line">	CView::OnChar(nChar, nRepCnt, nFlags);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　效果：<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170420230235013?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<h1 id="简单绘图"><a href="#简单绘图" class="headerlink" title="简单绘图"></a>简单绘图</h1><h2 id="MFC消息映射机制"><a href="#MFC消息映射机制" class="headerlink" title="MFC消息映射机制"></a>MFC消息映射机制</h2><p>　　与消息有关的三处信息：1.头文件XXXX.h中 2.源文件XXXX.cpp中 3.源文件XXXX.cpp的响应函数中</p>
<h2 id="绘制线条"><a href="#绘制线条" class="headerlink" title="绘制线条"></a>绘制线条</h2><p>　　对CDrawView右键点击Add Member Variable，变量名称：m_ptOrigin，类型：CPoint，访问权限设置：Private。<br>　　代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CDrawView::OnLButtonDown(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	m_ptOrigin = point;</span><br><span class="line">	CView::OnLButtonDown(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CDrawView::OnLButtonUp(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//首先获得窗口的设备描述表</span></span><br><span class="line">	HDC hdc;</span><br><span class="line">	hdc = ::GetDC(m_hWnd);</span><br><span class="line">	<span class="comment">//移动到线条的起点</span></span><br><span class="line">	MoveToEx(hdc, m_ptOrigin.x, m_ptOrigin.y, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="comment">//画线</span></span><br><span class="line">	LineTo(hdc, point.x, point.y);</span><br><span class="line">	<span class="comment">//释放设备描述表</span></span><br><span class="line">	::ReleaseDC(m_hWnd, hdc);</span><br><span class="line"></span><br><span class="line">	CView::OnLButtonUp(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170420230302938?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure>
<h3 id="利用MFC的CDC类实现画线功能"><a href="#利用MFC的CDC类实现画线功能" class="headerlink" title="利用MFC的CDC类实现画线功能"></a>利用MFC的CDC类实现画线功能</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CDrawView::OnLButtonUp(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/*//首先获得窗口的设备描述表</span></span><br><span class="line"><span class="comment">	HDC hdc;</span></span><br><span class="line"><span class="comment">	hdc = ::GetDC(m_hWnd);</span></span><br><span class="line"><span class="comment">	//移动到线条的起点</span></span><br><span class="line"><span class="comment">	MoveToEx(hdc, m_ptOrigin.x, m_ptOrigin.y, NULL);</span></span><br><span class="line"><span class="comment">	//画线</span></span><br><span class="line"><span class="comment">	LineTo(hdc, point.x, point.y);</span></span><br><span class="line"><span class="comment">	//释放设备描述表</span></span><br><span class="line"><span class="comment">	::ReleaseDC(m_hWnd, hdc);*/</span></span><br><span class="line"></span><br><span class="line">	CDC* pDC = GetDC();</span><br><span class="line">	pDC-&gt;MoveTo(m_ptOrigin);</span><br><span class="line">	pDC-&gt;LineTo(point);</span><br><span class="line">	ReleaseDC(pDC);</span><br><span class="line"></span><br><span class="line">	CView::OnLButtonUp(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="利用MFC的CWindowDC类实现画线功能"><a href="#利用MFC的CWindowDC类实现画线功能" class="headerlink" title="利用MFC的CWindowDC类实现画线功能"></a>利用MFC的CWindowDC类实现画线功能</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CDrawView::OnLButtonUp(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	CWindowDC dc(GetParent());</span><br><span class="line">	dc.MoveTo(m_ptOrigin);</span><br><span class="line">	dc.LineTo(point);</span><br><span class="line"></span><br><span class="line">	CView::OnLButtonUp(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> <img src="http://img.blog.csdn.net/20170420230346873?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="在桌面窗口中画线"><a href="#在桌面窗口中画线" class="headerlink" title="在桌面窗口中画线"></a>在桌面窗口中画线</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CDrawView::OnLButtonUp(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	CWindowDC dc(GetDesktopWindow());</span><br><span class="line">	dc.MoveTo(m_ptOrigin);</span><br><span class="line">	dc.LineTo(point);</span><br><span class="line"></span><br><span class="line">	CView::OnLButtonUp(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> <img src="http://img.blog.csdn.net/20170420230404138?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　<strong>注意</strong>：在桌面上画图需要权限（一般写代码时需要避免软件以外的操作）。</p>
<h3 id="绘制彩色线条"><a href="#绘制彩色线条" class="headerlink" title="绘制彩色线条"></a>绘制彩色线条</h3><p>　　在程序中，当构造一个GDI对象后，该对象并不会立即生效，必须选入设备描述表，它才会在以后的绘制操作中生效。<br>一般情况下，在完成绘图操作之后，都要利用SelectObject函数把之前的GDI对象选入设备描述表，以便使其恢复到先前的状态。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CDrawView::OnLButtonUp(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	CPen pen(PS_SOLID, 1, RGB(255, 0, 0));</span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	CPen* pOldPen = dc.SelectObject(&amp;pen);</span><br><span class="line">	dc.MoveTo(m_ptOrigin);</span><br><span class="line">	dc.LineTo(point);</span><br><span class="line">	dc.SelectObject(pOldPen);</span><br><span class="line"></span><br><span class="line">	CView::OnLButtonUp(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　运行的效果是红色线条。</p>
<p>　　改为    CPen pen(PS_DASH, 1, RGB(255, 0, 0));  是虚线。（其中第二个参数需小于等于10）<br>    CPen pen(PS_DOT, 1, RGB(255, 0, 0)); 是点线。</p>
<h2 id="使用画刷绘图"><a href="#使用画刷绘图" class="headerlink" title="使用画刷绘图"></a>使用画刷绘图</h2><h3 id="简单画刷"><a href="#简单画刷" class="headerlink" title="简单画刷"></a>简单画刷</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CDrawView::OnLButtonUp(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//创建一个红色画刷</span></span><br><span class="line">	CBrush brush(RGB(255, 0, 0));</span><br><span class="line">	<span class="comment">//创建并获得设备描述表</span></span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	<span class="comment">//利用红色画刷填充鼠标拖拽过程中形成的矩形区域</span></span><br><span class="line">	dc.FillRect(CRect(m_ptOrigin, point),&amp;brush);</span><br><span class="line"></span><br><span class="line">	CView::OnLButtonUp(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> <img src="http://img.blog.csdn.net/20170420230440190?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="位图画刷"><a href="#位图画刷" class="headerlink" title="位图画刷"></a>位图画刷</h3><p>　　Insert-Resource-Bitmap-New，在这里发挥灵魂画手的天赋吧！<br>　　代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CDrawView::OnLButtonUp(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//创建位图对象</span></span><br><span class="line">	CBitmap bitmap;</span><br><span class="line">	<span class="comment">//加载位图资源</span></span><br><span class="line">	bitmap.LoadBitmap(IDB_BITMAP1);</span><br><span class="line">	<span class="comment">//创建位图画刷</span></span><br><span class="line">	<span class="function">CBrush <span class="title">brush</span><span class="params">(&amp;bitmap)</span></span>;</span><br><span class="line">	<span class="comment">//创建并获得设备描述表</span></span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	<span class="comment">//利用位图画刷填充鼠标拖拽过程中形成的矩形区域</span></span><br><span class="line">	dc.FillRect(CRect(m_ptOrigin, point),&amp;brush);</span><br><span class="line"></span><br><span class="line">	CView::OnLButtonUp(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p> <img src="http://img.blog.csdn.net/20170420230503092?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>　　我画的是不是很滑稽（手动滑稽）</p>
<h3 id="透明画刷"><a href="#透明画刷" class="headerlink" title="透明画刷"></a>透明画刷</h3><p>　　先进行一种尝试：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CDrawView::OnLButtonUp(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//创建并获得设备描述表</span></span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	<span class="comment">//绘制一个矩形</span></span><br><span class="line">	dc.Rectangle(CRect(m_ptOrigin,point));</span><br><span class="line"></span><br><span class="line">	CView::OnLButtonUp(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p> <img src="http://img.blog.csdn.net/20170420230521295?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>　　如果希望矩形内部是透明的，能够看到被遮挡的图形，就要创建一个透明画刷。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CDrawView::OnLButtonUp(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//创建并获得设备描述表</span></span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	<span class="comment">//创建一个空画刷</span></span><br><span class="line">	CBrush *pBrush = CBrush::FromHandle((HBRUSH)GetStockObject(NULL_BRUSH));</span><br><span class="line">	<span class="comment">//将空画刷选入设备描述表</span></span><br><span class="line">	CBrush *pOldBrush = dc.SelectObject(pBrush);</span><br><span class="line">	<span class="comment">//绘制一个矩形</span></span><br><span class="line">	dc.Rectangle(CRect(m_ptOrigin, point));</span><br><span class="line">	<span class="comment">//恢复先前的画刷</span></span><br><span class="line">	dc.SelectObject(pOldBrush);</span><br><span class="line"></span><br><span class="line">	CView::OnLButtonUp(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170420230550253?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure>
<h2 id="绘制连续线条"><a href="#绘制连续线条" class="headerlink" title="绘制连续线条"></a>绘制连续线条</h2><p>　　首先为视类增加鼠标移动消息（WM_MOUSEMOVE）的响应函数（默认OnMouseMove），并为视类添加一个BOOL型的私有成员变量m_bDraw。<br>在视类头文件定义：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">　Private:</span><br><span class="line">　BOOL m_bDraw;</span><br></pre></td></tr></table></figure></p>
<p>在视类的构造函数中：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m_bDraw = FALSE;</span><br></pre></td></tr></table></figure></p>
<p>在OnLButtonDown中：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m_bDraw = TRUE;</span><br></pre></td></tr></table></figure></p>
<p>在OnLButtonUp中：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m_bDraw = FALSE;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CDrawView::OnMouseMove(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	<span class="keyword">if</span>(m_bDraw == TRUE)</span><br><span class="line">	&#123;</span><br><span class="line">		dc.MoveTo(m_ptOrigin);</span><br><span class="line">		dc.LineTo(point);</span><br><span class="line">		<span class="comment">//修改线段的起点</span></span><br><span class="line">		m_ptOrigin = point;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	CView::OnMouseMove(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170420230616957?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure>
<p>给线条换色：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CDrawView::OnMouseMove(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">		<span class="comment">//创建一个红色的、宽度为1的实线画笔</span></span><br><span class="line">		CPen pen(PS_SOLID, 1, RGB(255, 0, 0));</span><br><span class="line">		<span class="comment">//把创建的画笔选入设备描述表</span></span><br><span class="line">		CPen *pOldPen = dc.SelectObject(&amp;pen);</span><br><span class="line">		<span class="keyword">if</span> (m_bDraw == TRUE)</span><br><span class="line">		&#123;</span><br><span class="line">		dc.MoveTo(m_ptOrigin);</span><br><span class="line">		dc.LineTo(point);</span><br><span class="line">		<span class="comment">//修改线段的起点</span></span><br><span class="line">		m_ptOrigin = point;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//恢复设备描述表</span></span><br><span class="line">		dc.SelectObject(pOldPen);</span><br><span class="line"></span><br><span class="line">	CView::OnMouseMove(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="绘制扇形效果的线条"><a href="#绘制扇形效果的线条" class="headerlink" title="绘制扇形效果的线条"></a>绘制扇形效果的线条</h2><p>　　去掉上述代码中的     m_ptOrigin = point;</p>
<p>　　效果：<br>　　<img src="http://img.blog.csdn.net/20170420230636254?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　绘制一个带边线的扇形：<br>　　为CDrawView类增加一个CPoint类型的私有成员变量m_ptOld，用来保存鼠标上一个移动点。</p>
<p>　　在OnLButton中：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m_ptOld = point;</span><br></pre></td></tr></table></figure></p>
<p>　　在OnMouseMove中：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CDrawView::OnMouseMove(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">		<span class="comment">//创建一个红色的、宽度为1的实线画笔</span></span><br><span class="line">		CPen pen(PS_SOLID, 1, RGB(255, 0, 0));</span><br><span class="line">		<span class="comment">//把创建的画笔选入设备描述表</span></span><br><span class="line">		CPen *pOldPen = dc.SelectObject(&amp;pen);</span><br><span class="line">		<span class="keyword">if</span> (m_bDraw == TRUE)</span><br><span class="line">		&#123;</span><br><span class="line">		dc.MoveTo(m_ptOrigin);</span><br><span class="line">		dc.LineTo(point);</span><br><span class="line">		dc.LineTo(m_ptOld);</span><br><span class="line">		<span class="comment">//修改线段的起点</span></span><br><span class="line">		<span class="comment">//m_ptOrigin = point;</span></span><br><span class="line">		m_ptOld = point;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//恢复设备描述表</span></span><br><span class="line">		dc.SelectObject(pOldPen);</span><br><span class="line"></span><br><span class="line">	CView::OnMouseMove(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　最好将OnLButtonUp里原来写的代码删除或注释之。<br>　　效果：<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170420230656311?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<p>　　MFC提供一个设置绘图模式的函数SetROP2，带有一个参数R2_BLACK、R2_WHITE、R2_MERGENOTPEN等。<br>　　例如，在CClientDC dc(this); 下方添加代码：     dc.SetROP2(R2_MERGENOTPEN);  编译运行后看不到绘制的线条，这就是设置了R2_MERGENOTPEN这种绘图模式。<br>使用R2_BLACK，将会发现绘制的线条颜色始终都是黑色的。</p>
<h1 id="文本编程"><a href="#文本编程" class="headerlink" title="文本编程"></a>文本编程</h1><h2 id="插入符"><a href="#插入符" class="headerlink" title="插入符"></a>插入符</h2><h3 id="创建文本插入符"><a href="#创建文本插入符" class="headerlink" title="创建文本插入符"></a>创建文本插入符</h3><p>　　创建一个单文档类型的MFC AppWizard(exe)工程，取名为Text。<br>为CTextView类添加WM_CREATE消息的响应函数OnCreate，在此函数中创建一个宽度为20、高度为100的插入符。代码如下。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> CTextView::OnCreate(LPCREATESTRUCT lpCreateStruct) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (CView::OnCreate(lpCreateStruct) == <span class="number">-1</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	</span><br><span class="line">	CreateSolidCaret(<span class="number">20</span>,<span class="number">100</span>);</span><br><span class="line">	ShowCaret();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170420230721832?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure>
<p>　　让插入符适应于当前字体的大小：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> CTextView::OnCreate(LPCREATESTRUCT lpCreateStruct) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (CView::OnCreate(lpCreateStruct) == <span class="number">-1</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//创建设备描述表</span></span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	<span class="comment">//定义文本信息结构体变量</span></span><br><span class="line">	TEXTMETRIC tm;</span><br><span class="line">	<span class="comment">//获得设备描述表中的文本信息</span></span><br><span class="line">	dc.GetTextMetrics(&amp;tm);</span><br><span class="line">	<span class="comment">//根据字体大小，创建何时的插入符（除以8是经验值）</span></span><br><span class="line">	CreateSolidCaret(tm.tmAveCharWidth/<span class="number">8</span>, tm.tmHeight);</span><br><span class="line">	<span class="comment">//显示插入符</span></span><br><span class="line">	ShowCaret();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　运行结果就比较符合常规了。</p>
<h3 id="创建图形插入符"><a href="#创建图形插入符" class="headerlink" title="创建图形插入符"></a>创建图形插入符</h3><p>　　新建一个位图资源，画一个图形。<br>在TextView.h中添加<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span>:</span><br><span class="line">		CBitmap bitmap;</span><br></pre></td></tr></table></figure></p>
<p>代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> CTextView::OnCreate(LPCREATESTRUCT lpCreateStruct) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (CView::OnCreate(lpCreateStruct) == <span class="number">-1</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	bitmap.LoadBitmap(IDB_BITMAP1);</span><br><span class="line">	CreateCaret(&amp;bitmap);</span><br><span class="line">	ShowCaret();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170420230741630?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure>
<h2 id="窗口重绘"><a href="#窗口重绘" class="headerlink" title="窗口重绘"></a>窗口重绘</h2><h3 id="OnDraw函数"><a href="#OnDraw函数" class="headerlink" title="OnDraw函数"></a>OnDraw函数</h3><p>　　实现在程序窗口中输出一串文字的功能。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTextView::OnDraw(CDC* pDC)</span><br><span class="line">&#123;</span><br><span class="line">	CTextDoc* pDoc = GetDocument();</span><br><span class="line">	ASSERT_VALID(pDoc);</span><br><span class="line"></span><br><span class="line">	<span class="function">CString <span class="title">str</span><span class="params">(<span class="string">"VC++ 深入编程"</span>)</span></span>;</span><br><span class="line">	pDC-&gt;TextOut(<span class="number">50</span>, <span class="number">50</span>, str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p> <img src="http://img.blog.csdn.net/20170420230758895?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="添加字符串资源"><a href="#添加字符串资源" class="headerlink" title="添加字符串资源"></a>添加字符串资源</h3><p>　　点击Resource View-String Table选项，在此字符串表最底部的空行上双击，即可弹出添加新字符串资源的对话框。ID：IDS_STRINGVC，Caption：“VC++编程 文本编程”。代码如下。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTextView::OnDraw(CDC* pDC)</span><br><span class="line">&#123;</span><br><span class="line">	CTextDoc* pDoc = GetDocument();</span><br><span class="line">	ASSERT_VALID(pDoc);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//CString str("VC++ 深入编程");</span></span><br><span class="line">	CString str;</span><br><span class="line">	str = <span class="string">"VC++ 深入编程"</span>;</span><br><span class="line">	pDC-&gt;TextOut(<span class="number">50</span>, <span class="number">50</span>, str);</span><br><span class="line"></span><br><span class="line">	str.LoadString(IDS_STRINGVC);</span><br><span class="line">	pDC-&gt;TextOut(<span class="number">0</span>, <span class="number">200</span>, str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170420230814077?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure>
<h3 id="路径"><a href="#路径" class="headerlink" title="路径"></a>路径</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">void</span> CTextView::OnDraw(CDC* pDC)</span><br><span class="line">&#123;</span><br><span class="line">	CTextDoc* pDoc = GetDocument();</span><br><span class="line">	ASSERT_VALID(pDoc);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//CString str("VC++ 深入编程");</span></span><br><span class="line">	CString str;</span><br><span class="line">	str = <span class="string">"VC++ 深入编程"</span>;</span><br><span class="line">	pDC-&gt;TextOut(<span class="number">50</span>, <span class="number">50</span>, str);</span><br><span class="line"></span><br><span class="line">	CSize sz = pDC-&gt;GetTextExtent(str);</span><br><span class="line"></span><br><span class="line">	str.LoadString(IDS_STRINGVC);</span><br><span class="line">	pDC-&gt;TextOut(<span class="number">0</span>, <span class="number">200</span>, str);</span><br><span class="line"></span><br><span class="line">	pDC-&gt;BeginPath();</span><br><span class="line">	pDC-&gt;Rectangle(<span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>+sz.cx, <span class="number">50</span>+sz.cy);</span><br><span class="line">	pDC-&gt;EndPath();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">300</span>; i+=<span class="number">10</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		pDC-&gt;MoveTo(<span class="number">0</span>, i);</span><br><span class="line">		pDC-&gt;LineTo(<span class="number">300</span>, i);</span><br><span class="line">		pDC-&gt;MoveTo(i,<span class="number">0</span>);</span><br><span class="line">		pDC-&gt;LineTo(i,<span class="number">300</span>);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p> <img src="http://img.blog.csdn.net/20170420230830380?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTextView::OnDraw(CDC* pDC)</span><br><span class="line">&#123;</span><br><span class="line">	CTextDoc* pDoc = GetDocument();</span><br><span class="line">	ASSERT_VALID(pDoc);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//CString str("VC++ 深入编程");</span></span><br><span class="line">	CString str;</span><br><span class="line">	str = <span class="string">"VC++ 深入编程"</span>;</span><br><span class="line">	pDC-&gt;TextOut(<span class="number">50</span>, <span class="number">50</span>, str);</span><br><span class="line"></span><br><span class="line">	CSize sz = pDC-&gt;GetTextExtent(str);</span><br><span class="line"></span><br><span class="line">	str.LoadString(IDS_STRINGVC);</span><br><span class="line">	pDC-&gt;TextOut(<span class="number">0</span>, <span class="number">200</span>, str);</span><br><span class="line"></span><br><span class="line">	pDC-&gt;BeginPath();</span><br><span class="line">	pDC-&gt;Rectangle(<span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>+sz.cx, <span class="number">50</span>+sz.cy);</span><br><span class="line">	pDC-&gt;EndPath();</span><br><span class="line">	pDC-&gt;SelectClipPath(RGN_DIFF);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">300</span>; i+=<span class="number">10</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		pDC-&gt;MoveTo(<span class="number">0</span>, i);</span><br><span class="line">		pDC-&gt;LineTo(<span class="number">300</span>, i);</span><br><span class="line">		pDC-&gt;MoveTo(i,<span class="number">0</span>);</span><br><span class="line">		pDC-&gt;LineTo(i,<span class="number">300</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> <img src="http://img.blog.csdn.net/20170420230849318?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>　　这正是RGN_DIFF模式的效果。<br>　　如果是RGN_AND，效果是新的裁剪区域是当前裁剪区域和当前路径层的交集。</p>
<p>　　路径层的作用：实现特殊效果。如，希望整幅图形中某一部分与其他部分有所区别，就可以把这部分的图形设置到一个路径层中，然后利用SelectClipPath函数设置一种模式，让路径层和裁剪区域进行互操作以达到一种特殊效果。</p>
<h2 id="字符输入"><a href="#字符输入" class="headerlink" title="字符输入"></a>字符输入</h2><p>　　当用户在键盘上按下某个字符按键后，要把该字符输出到程序窗口上。<br>首先让CTextView捕获WM_CHAR消息，接着为该类定义一个CString类型的成员变量：m_strLine，并在CTextView类的构造函数中将这个变量初始化：m_strLine = “”;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTextView::OnLButtonDown(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	SetCaretPos(point);</span><br><span class="line"></span><br><span class="line">	CView::OnLButtonDown(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="http://img.blog.csdn.net/20170420230906115?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>　　为CTextView类再增加一个CPoint类型的成员变量，取名m_ptOrigin，权限为私有。在CTextView类的构造函数中设置其初值为0。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTextView::OnLButtonDown(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	SetCaretPos(point);</span><br><span class="line">	m_strLine.Empty();</span><br><span class="line">	m_ptOrigin = point;</span><br><span class="line"></span><br><span class="line">	CView::OnLButtonDown(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　<strong>注意：回车字符的ASCII码十六进制是0x0d，退格键的ASCII码十六进制值是0x08。</strong></p>
<p>　　最终代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTextView::OnChar(UINT nChar, UINT nRepCnt, UINT nFlags) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	TEXTMETRIC tm;</span><br><span class="line">	dc.GetTextMetrics(&amp;tm);</span><br><span class="line">	<span class="keyword">if</span> (<span class="number">0x0d</span> == nChar)</span><br><span class="line">	&#123;</span><br><span class="line">	m_strLine.Empty();</span><br><span class="line">	m_ptOrigin.y += tm.tmHeight;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0x08</span> == nChar)</span><br><span class="line">	&#123;</span><br><span class="line">		COLORREF clr = dc.SetTextColor(dc.GetBkColor());</span><br><span class="line">		dc.TextOut(m_ptOrigin.x, m_ptOrigin.y, m_strLine);</span><br><span class="line">		m_strLine = m_strLine.Left(m_strLine.GetLength() - <span class="number">1</span>);</span><br><span class="line">		dc.SetTextColor(clr);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		m_strLine += nChar; </span><br><span class="line">	&#125;</span><br><span class="line">	CSize sz = dc.GetTextExtent(m_strLine);</span><br><span class="line">	CPoint pt;</span><br><span class="line">	pt.x = m_ptOrigin.x + sz.cx;</span><br><span class="line">	pt.y = m_ptOrigin.y;</span><br><span class="line">	SetCaretPos(pt);</span><br><span class="line"></span><br><span class="line">	dc.TextOut(m_ptOrigin.x, m_ptOrigin.y, m_strLine);</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	CView::OnChar(nChar, nRepCnt, nFlags);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="http://img.blog.csdn.net/20170420230925890?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="设置字体"><a href="#设置字体" class="headerlink" title="设置字体"></a>设置字体</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTextView::OnChar(UINT nChar, UINT nRepCnt, UINT nFlags) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	CFont font;</span><br><span class="line">	font.CreatePointFont(<span class="number">300</span>, <span class="string">"华文行楷"</span>, <span class="literal">NULL</span>);</span><br><span class="line">	CFont *pOldFont = dc.SelectObject(&amp;font);</span><br><span class="line">……</span><br><span class="line">	dc.SelectObject(pOldFont);</span><br><span class="line">	</span><br><span class="line">	CView::OnChar(nChar, nRepCnt, nFlags);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> <img src="http://img.blog.csdn.net/20170420230949366?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="字幕变色功能的实现"><a href="#字幕变色功能的实现" class="headerlink" title="字幕变色功能的实现"></a>字幕变色功能的实现</h3><p>　　在这个Text例子中，我们在视类的OnCreate 函数中设置定时器，设置一个时间间隔为100ms，标识为1的定时器。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> CTextView::OnCreate(LPCREATESTRUCT lpCreateStruct) </span><br><span class="line">&#123;</span><br><span class="line">	……</span><br><span class="line"></span><br><span class="line">	SetTimer(<span class="number">1</span>, <span class="number">100</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　给CTextView类添加WM_TIMER消息的响应函数。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTextView::OnTimer(UINT nIDEvent) </span><br><span class="line">&#123;</span><br><span class="line">	m_nWidth += <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	TEXTMETRIC tm;</span><br><span class="line">	dc.GetTextMetrics(&amp;tm);</span><br><span class="line">	CRect rect;</span><br><span class="line">	rect.left =<span class="number">0</span>;</span><br><span class="line">	rect.top = <span class="number">200</span>;</span><br><span class="line">	rect.right = m_nWidth;</span><br><span class="line">	rect.bottom = rect.top + tm.tmHeight;</span><br><span class="line"></span><br><span class="line">	dc.SetTextColor(RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">	CString str;</span><br><span class="line">	str.LoadString(IDS_STRINGVC);</span><br><span class="line">	dc.DrawText(str, rect, DT_LEFT);</span><br><span class="line">	</span><br><span class="line">	rect.top = <span class="number">150</span>;</span><br><span class="line">	rect.bottom = rect.top + tm.tmHeight;</span><br><span class="line">	dc.DrawText(str, rect, DT_RIGHT);</span><br><span class="line">	</span><br><span class="line">	CSize sz = dc.GetTextExtent(str);</span><br><span class="line">	<span class="keyword">if</span> (m_nWidth &gt; sz.cx)</span><br><span class="line">	&#123;</span><br><span class="line">		m_nWidth = <span class="number">0</span>;</span><br><span class="line">		dc.SetTextColor(RGB(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>));</span><br><span class="line">		dc.TextOut(<span class="number">0</span>, <span class="number">200</span>, str);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	CView::OnTimer(nIDEvent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　红色渐变效果可看到。<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170420231009906?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<h1 id="绘图控制"><a href="#绘图控制" class="headerlink" title="绘图控制"></a>绘图控制</h1><h2 id="简单绘图-1"><a href="#简单绘图-1" class="headerlink" title="简单绘图"></a>简单绘图</h2><p>　　新建一个单文档类型的MFC AppWizard(exe)工程，取名：Graphic。<br>　　添加的菜单项：<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170420231023694?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure><br>　　给CGraphicView类中添加一个私有变量：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UINT m_nDrawType;</span><br></pre></td></tr></table></figure></p>
<p>　　在视类构造函数中将此变量初始化为0。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CGraphicView::OnDot() </span><br><span class="line">&#123;</span><br><span class="line">	m_nDrawType = <span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CGraphicView::OnLine() </span><br><span class="line">&#123;</span><br><span class="line">	m_nDrawType = <span class="number">2</span>;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CGraphicView::OnRectangle() </span><br><span class="line">&#123;</span><br><span class="line">	m_nDrawType = <span class="number">3</span>;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CGraphicView::OnEllipse() </span><br><span class="line">&#123;</span><br><span class="line">	m_nDrawType = <span class="number">4</span>;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>　　CGraphicView类再增加一个CPoint类型的私有成员变量：m_ptOrigin。在CGraphicView类构造函数中，将该变量的值设置为0。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CGraphicView::OnLButtonDown(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	m_ptOrigin = point;</span><br><span class="line">	</span><br><span class="line">	CView::OnLButtonDown(nFlags, point);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CGraphicView::OnLButtonUp(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	<span class="comment">//为边框设定颜色</span></span><br><span class="line">	CPen pen(PS_SOLID, 1, RGB(255, 0, 0));</span><br><span class="line">	dc.SelectObject(&amp;pen);</span><br><span class="line">	<span class="comment">//能看到图形内部内容(透明)</span></span><br><span class="line">	CBrush *pBrush = CBrush::FromHandle((HBRUSH)GetStockObject(NULL_BRUSH));</span><br><span class="line">	dc.SelectObject(pBrush);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span>(m_nDrawType)</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">		dc.SetPixel(point,RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">		dc.MoveTo(m_ptOrigin);</span><br><span class="line">		dc.LineTo(point);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">		dc.Rectangle(CRect(m_ptOrigin,point));</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">		dc.Ellipse(CRect(m_ptOrigin, point));</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	CView::OnLButtonUp(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p> <img src="http://img.blog.csdn.net/20170420231045554?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="设置对话框"><a href="#设置对话框" class="headerlink" title="设置对话框"></a>设置对话框</h2><p>　　再增加一个对话框资源，ID为IDD_DLG_SETTING，Caption为Setting，Font为宋体。</p>
<h3 id="设置线宽"><a href="#设置线宽" class="headerlink" title="设置线宽"></a>设置线宽</h3><p>　　添加一个静态文本框，并将Caption设为“线宽”。再添加一个编辑框，ID：IDC_LINE_WIDTH。为此对话框资源创建一个响应的对话框类，类名为CSettingDlg。对编辑框右键，ClassWizard，为它添加一个成员变量：m_nLineWidth，类型为UINT。为绘图菜单下再增加一个菜单项为“设置”，ID为IDM_SETTING。为此菜单项添加一个命令响应，选择视类做出响应。为CGraphicView类添加一个私有成员变量：m_nLineWidth，类型：UINT，并在CGraphicView类的构造函数初始化为0。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CGraphicView::OnSetting() </span><br><span class="line">&#123;</span><br><span class="line">	CSettingDlg dlg;</span><br><span class="line">	dlg.m_nLineWidth = m_nLineWidth; <span class="comment">//将保存的用户先前设置的线宽再传回给该设置对话框</span></span><br><span class="line">	<span class="keyword">if</span>(IDOK == dlg.DoModal())<span class="comment">//点击OK才保持线宽值</span></span><br><span class="line">	&#123;</span><br><span class="line">		m_nLineWidth = dlg.m_nLineWidth;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　在源文件前部添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Include “SettingDlg.h”</span><br></pre></td></tr></table></figure></p>
<p>　　修改OnLButtonUp函数：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CGraphicView::OnLButtonUp(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	<span class="comment">//为边框设定颜色(m_nLineWidth定义线宽)</span></span><br><span class="line">	CPen pen(PS_SOLID, m_nLineWidth, RGB(255, 0, 0));</span><br><span class="line">……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="设置线型"><a href="#设置线型" class="headerlink" title="设置线型"></a>设置线型</h3><p>　　为对话框资源添加一个组框，Caption设为线型。ID为IDC_LINE_STYLE。在组框内放三个单选按钮，ID不变，名称分别为：实线、虚线、点线（不要改变顺序）。在第一个单选按钮上右键，属性勾上Group，使三个按钮成为一组。再为CGraphicView类添加一个Int类型的私有成员变量m_nLineStyle，在构造函数中初始化为0。<br>　　由于WINGDI.h定义了一些符号常量，（可以在PS_SOLID右键，Go To Definition Of PS_SOLID），刚好PS_SOLID（实线）值本身就是0；PS_DASH（虚线）是1；PS_DOT（点线）是2。所以此处的排列是故意为之。<br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170424215210507?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure><br> <figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170424215239306?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<p>　　<strong>注意：若要画出虚线和点线，线宽只能为0或1。</strong></p>
<h2 id="颜色对话框"><a href="#颜色对话框" class="headerlink" title="颜色对话框"></a>颜色对话框</h2><p>　　在绘图下增加一个子菜单，ID为IDM_COLOR，Caption为颜色。为其在视类增加一个命令响应，代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CGraphicView::OnColor() </span><br><span class="line">&#123;</span><br><span class="line">	CColorDialog dlg;</span><br><span class="line">	dlg.m_cc.Flags |= CC_RGBINIT;</span><br><span class="line">	dlg.m_cc.rgbResult = m_clr;</span><br><span class="line">	<span class="keyword">if</span> (IDOK == dlg.DoModal())</span><br><span class="line">	&#123;</span><br><span class="line">		m_clr = dlg.m_cc.rgbResult;</span><br><span class="line">		<span class="comment">//dlg.m_cc.Flags |= CC_RGBINIT | CC_FULLOPEN;//让颜色对话框完全展开</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　为CGraphicView类再增加一个COLORREF类型的私有成员变量：m_clr，并在构造函数中初始化为红色：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m_clr = RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure></p>
<p>　　修改该函数两处位置：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CGraphicView::OnLButtonUp(UINT nFlags, CPoint point) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">	<span class="comment">//为边框设定颜色(m_nLineStyle定义线型，m_nLineWidth定义线宽，m_clr定义颜色)</span></span><br><span class="line">	<span class="function">CPen <span class="title">pen</span><span class="params">(m_nLineStyle, m_nLineWidth, m_clr)</span></span>;</span><br><span class="line">	dc.SelectObject(&amp;pen);</span><br><span class="line">	<span class="comment">//能看到图形内部内容(透明)</span></span><br><span class="line">	CBrush *pBrush = CBrush::FromHandle((HBRUSH)GetStockObject(NULL_BRUSH));</span><br><span class="line">	dc.SelectObject(pBrush);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span>(m_nDrawType)</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">		dc.SetPixel(point,m_clr);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">		dc.MoveTo(m_ptOrigin);</span><br><span class="line">		dc.LineTo(point);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">		dc.Rectangle(CRect(m_ptOrigin,point));</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">		dc.Ellipse(CRect(m_ptOrigin, point));</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	CView::OnLButtonUp(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p> <img src="http://img.blog.csdn.net/20170424215308947?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　注意：//dlg.m_cc.Flags |= CC_RGBINIT | CC_FULLOPEN;//让颜色对话框完全展开<br>这句我没能实现展开效果。</p>
<h2 id="字体对话框"><a href="#字体对话框" class="headerlink" title="字体对话框"></a>字体对话框</h2><p>　　增加一个菜单，ID为IDM_FONT，Caption为字体。在视类增加命令响应，代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CGraphicView::OnFont() </span><br><span class="line">&#123;</span><br><span class="line">	CFontDialog dlg;</span><br><span class="line">	<span class="keyword">if</span> (IDOK == dlg.DoModal())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (m_font.m_hObject) <span class="comment">//m_font对象是否已经与某字体资源相关联</span></span><br><span class="line">			m_font.DeleteObject();</span><br><span class="line">		m_font.CreateFontIndirect(dlg.m_cf.lpLogFont);</span><br><span class="line">		m_strFontName = dlg.m_cf.lpLogFont-&gt;lfFaceName;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">void</span> CGraphicView::OnDraw(CDC* pDC)</span><br><span class="line">&#123;</span><br><span class="line">	CGraphicDoc* pDoc = GetDocument();</span><br><span class="line">	ASSERT_VALID(pDoc);</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> add draw code for native data here</span></span><br><span class="line">	CFont *pOldFont = pDC-&gt;SelectObject(&amp;m_font);</span><br><span class="line">	pDC-&gt;TextOut(<span class="number">0</span>, <span class="number">0</span>, m_strFontName);</span><br><span class="line">	pDC-&gt;SelectObject(pOldFont);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="示例对话框"><a href="#示例对话框" class="headerlink" title="示例对话框"></a>示例对话框</h2><p>　　在对话框中增加一个组框，Caption:示例，ID：IDC_SAMPLE。为CSettingDlg类添加编辑框控件的EN_CHANCE响应函数，对三个单选按钮都选择BN_CLICKED消息。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CSettingDlg::OnRadio1() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></span><br><span class="line">	Invalidate();	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CSettingDlg::OnRadio2() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></span><br><span class="line">	Invalidate();	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CSettingDlg::OnRadio3() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></span><br><span class="line">	Invalidate();	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CSettingDlg::OnPaint() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="function">CPaintDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>; <span class="comment">// device context for painting</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your message handler code here</span></span><br><span class="line">	UpdateData();</span><br><span class="line">	<span class="function">CPen <span class="title">pen</span><span class="params">(m_nLineStyle, m_nLineWidth, m_clr)</span></span>;</span><br><span class="line">	dc.SelectObject(&amp;pen);</span><br><span class="line"></span><br><span class="line">	CRect rect;</span><br><span class="line">	GetDlgItem(IDC_SAMPLE)-&gt;GetWindowRect(&amp;rect);</span><br><span class="line">	ScreenToClient(&amp;rect);</span><br><span class="line"></span><br><span class="line">	dc.MoveTo(rect.left+<span class="number">20</span>, rect.top+rect.Height()/<span class="number">2</span>);</span><br><span class="line">	dc.LineTo(rect.right<span class="number">-20</span>, rect.top+rect.Height()/<span class="number">2</span>);</span><br><span class="line">	<span class="comment">// Do not call CDialog::OnPaint() for painting messages</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170424215335853?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure>
<p>　　现在可以实时修改了。</p>
<h2 id="10-6-改变对话框和控件的背景及文本颜色"><a href="#10-6-改变对话框和控件的背景及文本颜色" class="headerlink" title="10.6 改变对话框和控件的背景及文本颜色"></a>10.6 改变对话框和控件的背景及文本颜色</h2><h3 id="改变整个对话框及其子控件的背景色"><a href="#改变整个对话框及其子控件的背景色" class="headerlink" title="改变整个对话框及其子控件的背景色"></a>改变整个对话框及其子控件的背景色</h3><p>　　为CSettingDlg类添加WM_CTLCOLOR消息，并定义一个CBrush类型的私有成员变量：m_brush，并在构造函数中初始化一个蓝色画刷：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m_brush.CreateSolidBrush (RGB(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>));</span><br></pre></td></tr></table></figure></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HBRUSH CSettingDlg::OnCtlColor(CDC* pDC, CWnd* pWnd, UINT nCtlColor) </span><br><span class="line">&#123;</span><br><span class="line">	HBRUSH hbr = CDialog::OnCtlColor(pDC, pWnd, nCtlColor);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Change any attributes of the DC here</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Return a different brush if the default is not desired</span></span><br><span class="line">	<span class="comment">//return hbr;</span></span><br><span class="line">	<span class="keyword">return</span> m_brush;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> <img src="http://img.blog.csdn.net/20170424215356165?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="仅改变某个子控件的背景及文本颜色"><a href="#仅改变某个子控件的背景及文本颜色" class="headerlink" title="仅改变某个子控件的背景及文本颜色"></a>仅改变某个子控件的背景及文本颜色</h3><h1 id="图形的保存和重绘"><a href="#图形的保存和重绘" class="headerlink" title="图形的保存和重绘"></a>图形的保存和重绘</h1><h2 id="坐标空间和转换"><a href="#坐标空间和转换" class="headerlink" title="坐标空间和转换"></a>坐标空间和转换</h2><h3 id="坐标空间"><a href="#坐标空间" class="headerlink" title="坐标空间"></a>坐标空间</h3><p>　　Win32应用程序编程接口（API）使用四种坐标空间：世界坐标系空间、页面空间、设备空间和物理设备空间。Win32 API把世界坐标系空间和页面空间称为逻辑空间。</p>
<h3 id="转换"><a href="#转换" class="headerlink" title="转换"></a>转换</h3><p>　　转换是把对象从一个坐标空间复制到另一个坐标空间时改变（或转变）这一对象的大小、方位和形态。</p>
<h2 id="图形的保存和重绘-1"><a href="#图形的保存和重绘-1" class="headerlink" title="图形的保存和重绘"></a>图形的保存和重绘</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">HBRUSH CSettingDlg::OnCtlColor(CDC* pDC, CWnd* pWnd, UINT nCtlColor) </span><br><span class="line">&#123;</span><br><span class="line">	HBRUSH hbr = CDialog::OnCtlColor(pDC, pWnd, nCtlColor);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Change any attributes of the DC here</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Return a different brush if the default is not desired</span></span><br><span class="line">	<span class="comment">//return hbr;</span></span><br><span class="line">	<span class="keyword">if</span> (pWnd -&gt; GetDlgCtrlID() == IDC_LINE_STYLE)</span><br><span class="line">	&#123;</span><br><span class="line">		pDC-&gt;SetTextColor(RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">		<span class="keyword">return</span> m_brush;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> hbr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> <img src="http://img.blog.csdn.net/20170424215530885?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　上述程序再加一行：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pDC-&gt;SetBkMode(TRANSPARENT);</span><br></pre></td></tr></table></figure></p>
<p> <img src="http://img.blog.csdn.net/20170424215545651?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">HBRUSH CSettingDlg::OnCtlColor(CDC* pDC, CWnd* pWnd, UINT nCtlColor) </span><br><span class="line">&#123;</span><br><span class="line">	HBRUSH hbr = CDialog::OnCtlColor(pDC, pWnd, nCtlColor);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Change any attributes of the DC here</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Return a different brush if the default is not desired</span></span><br><span class="line">	<span class="comment">//return hbr;</span></span><br><span class="line">	<span class="keyword">if</span> (pWnd -&gt; GetDlgCtrlID() == IDC_LINE_STYLE)</span><br><span class="line">	&#123;</span><br><span class="line">		pDC-&gt;SetTextColor(RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">		pDC-&gt;SetBkMode(TRANSPARENT);</span><br><span class="line">		<span class="keyword">return</span> m_brush;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (pWnd-&gt;GetDlgCtrlID() == IDC_LINE_WIDTH)</span><br><span class="line">	&#123;</span><br><span class="line">		pDC-&gt;SetTextColor(RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">		<span class="comment">//pDC-&gt;SetBkMode(TRANSPARENT);</span></span><br><span class="line">		pDC-&gt;SetBkColor(RGB(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>));</span><br><span class="line">		<span class="keyword">return</span> m_brush;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> hbr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> <img src="http://img.blog.csdn.net/20170424215606416?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="改变控件上的文本字体"><a href="#改变控件上的文本字体" class="headerlink" title="改变控件上的文本字体"></a>改变控件上的文本字体</h3><p>　　为对话框增加一个静态文本控件，ID:IDC_TEXT，Caption:程序员，为CSettingDlg类增加一个CFont类型的私有成员变量：m_font，在构造函数中添加<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m_font.CreatePointFont(<span class="number">200</span>, <span class="string">"华文行楷"</span>);</span><br></pre></td></tr></table></figure></p>
<p>　　在OnCtlColor函数中添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (pWnd-&gt;GetDlgCtrlID() == IDC_TEXT)</span><br><span class="line">&#123;</span><br><span class="line">	pDC-&gt;SelectObject(&amp;m_font);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p> <img src="http://img.blog.csdn.net/20170424215622479?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="改变按钮控件的背景色及文本颜色"><a href="#改变按钮控件的背景色及文本颜色" class="headerlink" title="改变按钮控件的背景色及文本颜色"></a>改变按钮控件的背景色及文本颜色</h3><p>　　在CSettingDlg类OnCtlColor函数中添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">if</span> (pWnd-&gt;GetDlgCtrlID() == IDOK)</span><br><span class="line">	&#123;</span><br><span class="line">		pDC-&gt;SetTextColor(RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">		<span class="keyword">return</span> m_brush;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> hbr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　点Insert-New Class，选择MFC Class，新增类名：CTestBtn，基类CButton。<br>　　为此类添加DrawItem虚函数重写。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CTestBtn::DrawItem(LPDRAWITEMSTRUCT lpDrawItemStruct) </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your code to draw the specified item</span></span><br><span class="line">	UINT uStyle = DFCS_BUTTONPUSH;</span><br><span class="line"></span><br><span class="line">	ASSERT(lpDrawItemStruct-&gt;CtlType == ODT_BUTTON);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (lpDrawItemStruct-&gt;itemState &amp; ODS_SELECTED)</span><br><span class="line">		uStyle |= DFCS_PUSHED;</span><br><span class="line"></span><br><span class="line">	::DrawFrameControl(lpDrawItemStruct-&gt;hDC, &amp;lpDrawItemStruct-&gt;rcItem, DFC_BUTTON, uStyle);</span><br><span class="line"></span><br><span class="line">	CString strText;</span><br><span class="line">	GetWindowText(strText);</span><br><span class="line"></span><br><span class="line">	COLORREF crOldColor = ::SetTextColor(lpDrawItemStruct-&gt;hDC, RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">	::DrawText(lpDrawItemStruct-&gt;hDC, strText, strText.GetLength(),</span><br><span class="line">		&amp;lpDrawItemStruct-&gt;rcItem, DT_SINGLELINE | DT_VCENTER | DT_CENTER);</span><br><span class="line">	::SetTextColor(lpDrawItemStruct-&gt;hDC, crOldColor);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　然而，此时我返回双击OK键显示“Cannot add new member”……</p>
<p>　　按理，接下来应该是：<br>　　利用ClassWizard打开Add Member Variable对话框，为OK按钮关联一个成员变量，名称为m_btnTest，类型CTestBtn。在SettingDlg.h文件前部添加<code>#include “TestBtn.h”</code>。对OK右键属性，打开Styles，选中Owner draw选项。此时OK文字变红色。</p>
<h2 id="位图的显示"><a href="#位图的显示" class="headerlink" title="位图的显示"></a>位图的显示</h2><h1 id="定制应用程序外观"><a href="#定制应用程序外观" class="headerlink" title="定制应用程序外观"></a>定制应用程序外观</h1><h2 id="修改应用程序窗口的外观"><a href="#修改应用程序窗口的外观" class="headerlink" title="修改应用程序窗口的外观"></a>修改应用程序窗口的外观</h2><h3 id="在窗口创建之前修改"><a href="#在窗口创建之前修改" class="headerlink" title="在窗口创建之前修改"></a>在窗口创建之前修改</h3><p>　　创建前，打开CMainFrame类的PreCreateWindow成员函数，修改CREATETRUCT结构体中的cx和cy成员。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">BOOL CMainFrame::PreCreateWindow(CREATESTRUCT&amp; cs)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>( !CFrameWnd::PreCreateWindow(cs) )</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Modify the Window class or styles here by modifying</span></span><br><span class="line">	<span class="comment">//  the CREATESTRUCT cs</span></span><br><span class="line">	cs.cx = <span class="number">300</span>;</span><br><span class="line">	cs.cy = <span class="number">200</span>;</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　创建运行，可看到初始大小为300x200的应用程序窗口。</p>
<p>　　修改窗口标题：在上述 return TRUE; 前添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cs.style &amp;= ~FWS_ADDTOTITLE;</span><br><span class="line">cs.lpszName = <span class="string">"http://www.sunxin.org"</span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="在窗口创建之后修改"><a href="#在窗口创建之后修改" class="headerlink" title="在窗口创建之后修改"></a>在窗口创建之后修改</h2><p>　　注释掉之前添加的代码。在OnCreate函数中添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> CMainFrame::OnCreate(LPCREATESTRUCT lpCreateStruct)</span><br><span class="line">&#123;</span><br><span class="line">	…</span><br><span class="line"></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Delete these three lines if you don't want the toolbar to</span></span><br><span class="line">	<span class="comment">//  be dockable</span></span><br><span class="line">	m_wndToolBar.EnableDocking(CBRS_ALIGN_ANY);</span><br><span class="line">	EnableDocking(CBRS_ALIGN_ANY);</span><br><span class="line">	DockControlBar(&amp;m_wndToolBar);</span><br><span class="line"></span><br><span class="line">	SetWindowLong(m_hWnd, GWL_STYLE, WS_OVERLAPPEDWINDOW);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　创建运行后可看到文档标题去掉了。</p>
<p>　　去掉窗口最大化框类型：<br>　　将上述SetWindowLong函数替换为<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SetWindowLong(m_hWnd, GWL_STYLE, GetWindowLong(m_hWnd, GWL_STYLE) &amp; ~WS_MAXIMIZEBOX);</span><br></pre></td></tr></table></figure></p>
<p>　　创建运行发现最大化框变灰，不能放大窗口了。</p>
<h2 id="修改窗口的光标、图标和背景"><a href="#修改窗口的光标、图标和背景" class="headerlink" title="修改窗口的光标、图标和背景"></a>修改窗口的光标、图标和背景</h2><h3 id="在窗口创建之前修改-1"><a href="#在窗口创建之前修改-1" class="headerlink" title="在窗口创建之前修改"></a>在窗口创建之前修改</h3><h1 id="网络编程"><a href="#网络编程" class="headerlink" title="网络编程"></a>网络编程</h1><h2 id="计算机网络基本知识"><a href="#计算机网络基本知识" class="headerlink" title="计算机网络基本知识"></a>计算机网络基本知识</h2><p>ISO/OSI七层参考模型<br>应用层——处理网络应用<br>Telnet、FTP、HTTP、DNS、SMTP、POP3</p>
<p>表示层——数据表示<br>TCP、UDP</p>
<p>会话层——主机间通信<br>传输层——端到端的连接<br>网络层——寻址和最短路径<br>IP、ICMP、IGMP</p>
<p>数据链路层——介质访问（接入）<br>物理层——二进制传输</p>
<h2 id="基于TCP的网络应用程序的编写"><a href="#基于TCP的网络应用程序的编写" class="headerlink" title="基于TCP的网络应用程序的编写"></a>基于TCP的网络应用程序的编写</h2><h3 id="服务器端程序"><a href="#服务器端程序" class="headerlink" title="服务器端程序"></a>服务器端程序</h3><p>　　关闭先前的工作区，新建一个工程，选择Win32 Console Application类型，名为TCPSrv。选择An empty project选项，创建一个空工程。再新建一个C++源文件：TcpSrv.cpp。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Winsock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//加载套接字库</span></span><br><span class="line">	WORD wVersionRequested;</span><br><span class="line">	WSADATA wsaData;</span><br><span class="line">	<span class="keyword">int</span> err;</span><br><span class="line"></span><br><span class="line">	wVersionRequested = MAKEWORD(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	err = WSAStartup(wVersionRequested, &amp;wsaData);</span><br><span class="line">	<span class="keyword">if</span> (err != <span class="number">0</span>)&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (LOBYTE(wsaData.wVersion) != <span class="number">1</span> ||</span><br><span class="line">		HIBYTE(wsaData.wVersion) != <span class="number">1</span>)&#123;</span><br><span class="line">		WSACleanup();</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//创建用于监听的套接字</span></span><br><span class="line">	SOCKET sockSrv = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	SOCKADDR_IN addrSrv;</span><br><span class="line">	addrSrv.sin_addr.S_un.S_addr = htonl(INADDR_ANY);</span><br><span class="line">	addrSrv.sin_family = AF_INET;</span><br><span class="line">	addrSrv.sin_port = htons(<span class="number">7000</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//绑定套接字</span></span><br><span class="line">	bind(sockSrv, (SOCKADDR*)&amp;addrSrv, <span class="keyword">sizeof</span>(SOCKADDR));</span><br><span class="line">	<span class="comment">//将套接字设为监听模式，准备接收客户请求</span></span><br><span class="line">	listen(sockSrv, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">	SOCKADDR_IN addrClient;</span><br><span class="line">	<span class="keyword">int</span> len = <span class="keyword">sizeof</span>(SOCKADDR);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//等待客户请求到来</span></span><br><span class="line">		SOCKET sockConn = accept(sockSrv, (SOCKADDR*)&amp;addrClient, &amp;len);</span><br><span class="line">		<span class="keyword">char</span> sendBuf[<span class="number">100</span>];</span><br><span class="line">		<span class="built_in">sprintf</span>(sendBuf, <span class="string">"Welcome %s to http://www.sunxin.org"</span>, inet_ntoa(addrClient.sin_addr));</span><br><span class="line">		<span class="comment">//发送数据</span></span><br><span class="line">		send(sockConn, sendBuf, <span class="built_in">strlen</span>(sendBuf)+<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">		<span class="keyword">char</span> recvBuf[<span class="number">100</span>];</span><br><span class="line">		<span class="comment">//接收数据</span></span><br><span class="line">		recv(sockConn, recvBuf, <span class="number">100</span>, <span class="number">0</span>);</span><br><span class="line">		<span class="comment">//打印接收的数据</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%s\n"</span>, recvBuf);</span><br><span class="line">		<span class="comment">//关闭套接字</span></span><br><span class="line">		closesocket(sockConn);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　Project-Setting-Link，在Object/library modules编辑框中添加ws2_32.lib文件，注意输入的库文件与前面的库文件之间一定 要有一个空格。<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170428102011032?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<h3 id="客户端程序"><a href="#客户端程序" class="headerlink" title="客户端程序"></a>客户端程序</h3><p>　　在工作区名称上单击鼠标右键，选择Add New Project to Workspace，再创建一个Win32 Console Application类型的应用程序，创建一个空工程。为此增加一个C++源文件：TcpClient.cpp。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Winsock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//加载套接字库</span></span><br><span class="line">	WORD wVersionRequested;</span><br><span class="line">	WSADATA wsaData;</span><br><span class="line">	<span class="keyword">int</span> err;</span><br><span class="line"></span><br><span class="line">	wVersionRequested = MAKEWORD(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	err = WSAStartup(wVersionRequested, &amp;wsaData);</span><br><span class="line">	<span class="keyword">if</span> (err != <span class="number">0</span>)&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (LOBYTE(wsaData.wVersion) != <span class="number">1</span> || </span><br><span class="line">		HIBYTE(wsaData.wVersion) != <span class="number">1</span>)&#123;</span><br><span class="line">		WSACleanup();</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//创建套接字</span></span><br><span class="line">	SOCKET sockClient = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	SOCKADDR_IN addrSrv;</span><br><span class="line">	addrSrv.sin_addr.S_un.S_addr = inet_addr(<span class="string">"127.0.0.1"</span>);</span><br><span class="line">	addrSrv.sin_family = AF_INET;</span><br><span class="line">	addrSrv.sin_port = htons(<span class="number">7000</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//向服务器发出连接请求</span></span><br><span class="line">	connect(sockClient, (SOCKADDR*)&amp;addrSrv, <span class="keyword">sizeof</span>(SOCKADDR));</span><br><span class="line"></span><br><span class="line">	<span class="comment">//接收数据</span></span><br><span class="line">	<span class="keyword">char</span> recvBuf[<span class="number">100</span>];</span><br><span class="line">	recv(sockClient, recvBuf, <span class="number">100</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s\n"</span>,recvBuf);</span><br><span class="line">	<span class="comment">//发送数据</span></span><br><span class="line">	send(sockClient, <span class="string">"This is lisi"</span>, <span class="built_in">strlen</span>(<span class="string">"This is lisi"</span>)+<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="comment">//关闭套接字</span></span><br><span class="line">	closesocket(sockClient);</span><br><span class="line">	WSACleanup();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　链接库文件：ws2_32.lib。<br>　　创建运行，首先运行服务器程序，然后再运行客户端程序。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170428102101643?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure>
<p>　　<strong>注意</strong>：当没有报错，服务器端运行结果为“烫烫……烫”（N个烫）时，尝试换一个端口号，有可能你设置的端口号被其它的应用程序占用了。</p>
<h2 id="基于UDP的网络应用程序的编写"><a href="#基于UDP的网络应用程序的编写" class="headerlink" title="基于UDP的网络应用程序的编写"></a>基于UDP的网络应用程序的编写</h2><h3 id="服务器端程序-1"><a href="#服务器端程序-1" class="headerlink" title="服务器端程序"></a>服务器端程序</h3><p>　　关闭先前的工作区，新建一个工程，选择Win32 Console Application类型，名为UdpSrv。选择An empty project选项，创建一个空工程。再新建一个C++源文件：UdpSrv.cpp。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Winsock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//加载套接字库</span></span><br><span class="line">	WORD wVersionRequired;</span><br><span class="line">	WSADATA wsaData;</span><br><span class="line">	<span class="keyword">int</span> err;</span><br><span class="line"></span><br><span class="line">	wVersionRequired = MAKEWORD(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	err = WSAStartup(wVersionRequired, &amp;wsaData);</span><br><span class="line">	<span class="keyword">if</span> (err != <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (LOBYTE(wsaData.wVersion) != <span class="number">1</span> ||</span><br><span class="line">		HIBYTE(wsaData.wVersion) !=<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		WSACleanup();</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//创建套接字</span></span><br><span class="line">	SOCKET sockSrv = socket(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line">	SOCKADDR_IN addrSrv;</span><br><span class="line">	addrSrv.sin_addr.S_un.S_addr = htonl(INADDR_ANY);</span><br><span class="line">	addrSrv.sin_family = AF_INET;</span><br><span class="line">	addrSrv.sin_port = htons(<span class="number">7000</span>);</span><br><span class="line">	<span class="comment">//绑定套接字</span></span><br><span class="line">	bind(sockSrv, (SOCKADDR*)&amp;addrSrv, <span class="keyword">sizeof</span>(SOCKADDR));</span><br><span class="line"></span><br><span class="line">	<span class="comment">//等待并接收数据</span></span><br><span class="line">	SOCKADDR_IN addrClient;</span><br><span class="line">	<span class="keyword">int</span> len = <span class="keyword">sizeof</span>(SOCKADDR);</span><br><span class="line">	<span class="keyword">char</span> recvBuf[<span class="number">100</span>];</span><br><span class="line">	recvfrom(sockSrv, recvBuf, <span class="number">100</span>, <span class="number">0</span>, (SOCKADDR*)&amp;addrClient, &amp;len);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s\n"</span>,recvBuf);</span><br><span class="line">	<span class="comment">//关闭套接字</span></span><br><span class="line">	closesocket(sockSrv);</span><br><span class="line">	WSACleanup();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　在工程设置对话框的链接选项卡下添加库文件：Ws2_32.lib的链接。</p>
<h3 id="客户端程序-1"><a href="#客户端程序-1" class="headerlink" title="客户端程序"></a>客户端程序</h3><p>　　在同一个UdpSrv工作区中创建客户端应用程序。创建一个空的Win32 Console Application类型的工程，名为：UdpClient。为该工程添加一个C++源文件：UdpClient.cpp。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Winsock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//加载套接字库</span></span><br><span class="line">	WORD wVersionRequired;</span><br><span class="line">	WSADATA wsaData;</span><br><span class="line">	<span class="keyword">int</span> err;</span><br><span class="line"></span><br><span class="line">	wVersionRequired = MAKEWORD(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	err = WSAStartup(wVersionRequired, &amp;wsaData);</span><br><span class="line">	<span class="keyword">if</span> (err != <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (LOBYTE(wsaData.wVersion) != <span class="number">1</span> ||</span><br><span class="line">		HIBYTE(wsaData.wVersion) !=<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		WSACleanup();</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建套接字</span></span><br><span class="line">	SOCKET sockClient = socket(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line">	SOCKADDR_IN addrSrv;</span><br><span class="line">	addrSrv.sin_addr.S_un.S_addr = inet_addr(<span class="string">"127.0.0.1"</span>);</span><br><span class="line">	addrSrv.sin_family = AF_INET;</span><br><span class="line">	addrSrv.sin_port = htons(<span class="number">7000</span>);</span><br><span class="line">	<span class="comment">//发送数据</span></span><br><span class="line">	sendto(sockClient, <span class="string">"Hello"</span>, <span class="built_in">strlen</span>(<span class="string">"Hello"</span>)+<span class="number">1</span>, <span class="number">0</span>, </span><br><span class="line">		(SOCKADDR*)&amp;addrSrv, <span class="keyword">sizeof</span>(SOCKADDR));</span><br><span class="line">	<span class="comment">//关闭套接字</span></span><br><span class="line">	closesocket(sockClient);</span><br><span class="line">	WSACleanup();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　链接库文件：ws2_32.lib。</p>
<p>　　创建运行。服务器端程序应先启动，然后启动客户端程序。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170428102150065?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure>
<p>　　<strong>基于TCP和基于UDP的网络应用程序在发送和接收数据时使用的函数是不一样的：前者使用send和recv，后者使用sendto和recvfrom。</strong></p>
<h2 id="基于UDP的简单聊天程序"><a href="#基于UDP的简单聊天程序" class="headerlink" title="基于UDP的简单聊天程序"></a>基于UDP的简单聊天程序</h2><p>　　在新工作区新建一个空的Win32 Console Application类型的应用程序，名为NetSrv。为该工程添加一个C++源文件：NetSrv.cpp。接着为该工程添加对WinSock库的链接，即在工程设置对话框的Link选项卡上添加ws2_32.lib文件的链接。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Winsock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">	 <span class="comment">//加载套接字库</span></span><br><span class="line">	 WORD wVersionRequested;</span><br><span class="line">	 WSADATA wsaData;</span><br><span class="line">	 <span class="keyword">int</span> err;</span><br><span class="line"></span><br><span class="line">	 wVersionRequested = MAKEWORD(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	 err = WSAStartup(wVersionRequested, &amp;wsaData);</span><br><span class="line">	 <span class="keyword">if</span> (err != <span class="number">0</span>)</span><br><span class="line">	 &#123;</span><br><span class="line">		 <span class="keyword">return</span>;</span><br><span class="line">	 &#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (LOBYTE(wsaData.wVersion) != <span class="number">1</span> ||</span><br><span class="line">		HIBYTE(wsaData.wVersion) !=<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		WSACleanup();</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	 <span class="comment">//创建套接字</span></span><br><span class="line">	 SOCKET sockSrv = socket(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	 SOCKADDR_IN addrSrv;</span><br><span class="line">	 addrSrv.sin_addr.S_un.S_addr = htonl(INADDR_ANY);</span><br><span class="line">	 addrSrv.sin_family = AF_INET;</span><br><span class="line">	 addrSrv.sin_port = htons(<span class="number">7000</span>);</span><br><span class="line"></span><br><span class="line">	 <span class="comment">//绑定套接字</span></span><br><span class="line">	 bind(sockSrv, (SOCKADDR*)&amp;addrSrv, <span class="keyword">sizeof</span>(SOCKADDR));</span><br><span class="line"></span><br><span class="line">	 <span class="keyword">char</span> recvBuf[<span class="number">100</span>];</span><br><span class="line">	 <span class="keyword">char</span> sendBuf[<span class="number">100</span>];</span><br><span class="line">	 <span class="keyword">char</span> tempBuf[<span class="number">200</span>];</span><br><span class="line"></span><br><span class="line">	 SOCKADDR_IN addrClient;</span><br><span class="line">	 <span class="keyword">int</span> len = <span class="keyword">sizeof</span>(SOCKADDR);</span><br><span class="line">	 <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	 &#123;</span><br><span class="line">		 <span class="comment">//等待并接收数据</span></span><br><span class="line">		 recvfrom(sockSrv, recvBuf, <span class="number">100</span>, <span class="number">0</span>, (SOCKADDR*)&amp;addrClient, &amp;len);</span><br><span class="line">		 <span class="keyword">if</span> (<span class="string">'q'</span> == recvBuf[<span class="number">0</span>])</span><br><span class="line">		 &#123;</span><br><span class="line">			 sendto(sockSrv, <span class="string">"q"</span>, <span class="built_in">strlen</span>(<span class="string">"q"</span>)+<span class="number">1</span>, <span class="number">0</span>, (SOCKADDR*)&amp;addrClient, len);</span><br><span class="line">			 <span class="built_in">printf</span>(<span class="string">"Chat end!\n"</span>);</span><br><span class="line">			 <span class="keyword">break</span>;</span><br><span class="line">		 &#125;</span><br><span class="line">		 <span class="built_in">sprintf</span>(tempBuf, <span class="string">"%s say : %s"</span>, inet_ntoa(addrClient.sin_addr), recvBuf);</span><br><span class="line">		 <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, tempBuf);</span><br><span class="line">		 <span class="comment">//发送数据</span></span><br><span class="line">		 <span class="built_in">printf</span>(<span class="string">"Please input data:\n"</span>);</span><br><span class="line">		 gets(sendBuf);</span><br><span class="line">		 sendto(sockSrv, sendBuf, <span class="built_in">strlen</span>(sendBuf)+<span class="number">1</span>, <span class="number">0</span>, (SOCKADDR*)&amp;addrClient, len);</span><br><span class="line">	&#125;</span><br><span class="line">	 <span class="comment">//关闭套接字</span></span><br><span class="line">	 closesocket(sockSrv);</span><br><span class="line">	 WSACleanup();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="客户端程序-2"><a href="#客户端程序-2" class="headerlink" title="客户端程序"></a>客户端程序</h3><p>　　向已有工作区增加一个空的Win32 Console Application类型的工程：NetClient。为此添加一个C++源文件：NetClient.cpp。为该工程添加ws2_32.lib文件的链接。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Winsock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">	 <span class="comment">//加载套接字库</span></span><br><span class="line">	 WORD wVersionRequested;</span><br><span class="line">	 WSADATA wsaData;</span><br><span class="line">	 <span class="keyword">int</span> err;</span><br><span class="line"></span><br><span class="line">	 wVersionRequested = MAKEWORD(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	 err = WSAStartup(wVersionRequested, &amp;wsaData);</span><br><span class="line">	 <span class="keyword">if</span> (err != <span class="number">0</span>)</span><br><span class="line">	 &#123;</span><br><span class="line">		 <span class="keyword">return</span>;</span><br><span class="line">	 &#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (LOBYTE(wsaData.wVersion) != <span class="number">1</span> ||</span><br><span class="line">		HIBYTE(wsaData.wVersion) !=<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		WSACleanup();</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	 <span class="comment">//创建套接字</span></span><br><span class="line">	 SOCKET sockClient = socket(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	 SOCKADDR_IN addrSrv;</span><br><span class="line">	 addrSrv.sin_addr.S_un.S_addr = inet_addr(<span class="string">"127.0.0.1"</span>);</span><br><span class="line">	 addrSrv.sin_family = AF_INET;</span><br><span class="line">	 addrSrv.sin_port = htons(<span class="number">7000</span>);</span><br><span class="line"></span><br><span class="line">	 <span class="keyword">char</span> recvBuf[<span class="number">100</span>];</span><br><span class="line">	 <span class="keyword">char</span> sendBuf[<span class="number">100</span>];</span><br><span class="line">	 <span class="keyword">char</span> tempBuf[<span class="number">200</span>];</span><br><span class="line"></span><br><span class="line">	 <span class="keyword">int</span> len = <span class="keyword">sizeof</span>(SOCKADDR);</span><br><span class="line"></span><br><span class="line">	 <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	 &#123;</span><br><span class="line">		 <span class="comment">//发送数据</span></span><br><span class="line">		 <span class="built_in">printf</span>(<span class="string">"Please input data:\n"</span>);</span><br><span class="line">		 gets(sendBuf);</span><br><span class="line">		 sendto(sockClient, sendBuf, <span class="built_in">strlen</span>(sendBuf)+<span class="number">1</span>, <span class="number">0</span>, (SOCKADDR*)&amp;addrSrv, len);</span><br><span class="line">		 <span class="comment">//等待并接收数据</span></span><br><span class="line"></span><br><span class="line">		 recvfrom(sockClient, recvBuf, <span class="number">100</span>, <span class="number">0</span>, (SOCKADDR*)&amp;addrSrv, &amp;len);</span><br><span class="line">		 <span class="keyword">if</span>(<span class="string">'q'</span> == recvBuf[<span class="number">0</span>])</span><br><span class="line">		 &#123;</span><br><span class="line">			 sendto(sockClient, <span class="string">"q"</span>, <span class="built_in">strlen</span>(<span class="string">"q"</span>)+<span class="number">1</span>, <span class="number">0</span>, (SOCKADDR*)&amp;addrSrv, len);</span><br><span class="line">			 <span class="built_in">printf</span>(<span class="string">"Chat end!\n"</span>);</span><br><span class="line">			 <span class="keyword">break</span>;</span><br><span class="line">		 &#125;</span><br><span class="line">		 <span class="built_in">sprintf</span>(tempBuf, <span class="string">"%s say : %s"</span>, inet_ntoa(addrSrv.sin_addr), recvBuf);</span><br><span class="line">		 <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, tempBuf);</span><br><span class="line">	 &#125;</span><br><span class="line">	 <span class="comment">//关闭套接字</span></span><br><span class="line">	 closesocket(sockClient);</span><br><span class="line">	 WSACleanup();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170428102229597?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure>
<h1 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h1><h2 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h2><h3 id="程序和进程"><a href="#程序和进程" class="headerlink" title="程序和进程"></a>程序和进程</h3><h2 id="简单多线程示例"><a href="#简单多线程示例" class="headerlink" title="简单多线程示例"></a>简单多线程示例</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function">DWORD WINAPI <span class="title">Fun1Proc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	LPVOID lpParameter  <span class="comment">//thread data					 </span></span></span></span><br><span class="line"><span class="function"><span class="params">	)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		HANDLE hThread1;</span><br><span class="line">		hThread1 = CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, Fun1Proc, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">		CloseHandle(hThread1);</span><br><span class="line">		<span class="built_in">cout</span>&lt;&lt;<span class="string">"main thread is running"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">		Sleep(<span class="number">10</span>);<span class="comment">//让主线程暂停运行，进入分线程</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//线程1的入口函数</span></span><br><span class="line">	<span class="function">DWORD WINAPI <span class="title">Fun1Proc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">		LPVOID lpParameter  <span class="comment">//thread data</span></span></span></span><br><span class="line"><span class="function"><span class="params">		)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">cout</span>&lt;&lt;<span class="string">"thread1 is running"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p> <img src="http://img.blog.csdn.net/20170424215653701?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　交替运行：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function">DWORD WINAPI <span class="title">Fun1Proc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	LPVOID lpParameter  <span class="comment">//thread data					 </span></span></span></span><br><span class="line"><span class="function"><span class="params">	)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		HANDLE hThread1;</span><br><span class="line">		hThread1 = CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, Fun1Proc, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">		CloseHandle(hThread1);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">while</span> (index ++&lt; <span class="number">100</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">cout</span>&lt;&lt;<span class="string">"main thread is running"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">		&#125;</span><br><span class="line">			<span class="comment">//Sleep(10);//让主线程暂停运行，进入分线程</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//线程1的入口函数</span></span><br><span class="line"></span><br><span class="line">	<span class="function">DWORD WINAPI <span class="title">Fun1Proc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			</span></span></span><br><span class="line"><span class="function"><span class="params">		LPVOID lpParameter  <span class="comment">//thread data</span></span></span></span><br><span class="line"><span class="function"><span class="params">		)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">while</span> (index++&lt; <span class="number">100</span>)</span><br><span class="line">		<span class="built_in">cout</span>&lt;&lt;<span class="string">"thread1 is running"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p> <img src="http://img.blog.csdn.net/20170424215712448?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="线程同步"><a href="#线程同步" class="headerlink" title="线程同步"></a>线程同步</h2><h3 id="火车站售票系统模拟程序"><a href="#火车站售票系统模拟程序" class="headerlink" title="火车站售票系统模拟程序"></a>火车站售票系统模拟程序</h3><p>　　由主线程创建的两个线程（1和2）负责销售火车票。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function">DWORD WINAPI <span class="title">Fun1Proc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	LPVOID lpParameter  <span class="comment">//thread data					 </span></span></span></span><br><span class="line"><span class="function"><span class="params">	)</span></span>;</span><br><span class="line">	</span><br><span class="line">	 <span class="function">DWORD WINAPI <span class="title">Fun2Proc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	LPVOID lpParameter  <span class="comment">//thread data					 </span></span></span></span><br><span class="line"><span class="function"><span class="params">	)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> tickets = <span class="number">100</span>;</span><br><span class="line">	HANDLE hMutex;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		HANDLE hThread1;</span><br><span class="line">		HANDLE hThread2;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//创建互斥对象</span></span><br><span class="line">		hMutex = CreateMutex(<span class="literal">NULL</span>, FALSE, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//创建线程</span></span><br><span class="line">		hThread1 = CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, Fun1Proc, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">		hThread2 = CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, Fun2Proc, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">		CloseHandle(hThread1);</span><br><span class="line">		CloseHandle(hThread2);</span><br><span class="line">		Sleep(<span class="number">4000</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="comment">//线程1的入口函数</span></span><br><span class="line">	<span class="function">DWORD WINAPI <span class="title">Fun1Proc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			</span></span></span><br><span class="line"><span class="function"><span class="params">		LPVOID lpParameter  <span class="comment">//thread data</span></span></span></span><br><span class="line"><span class="function"><span class="params">		)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">	<span class="keyword">while</span> (TRUE)</span><br><span class="line">		&#123;</span><br><span class="line">			WaitForSingleObject(hMutex, INFINITE);<span class="comment">//实现线程同步</span></span><br><span class="line">			<span class="keyword">if</span> (tickets &gt; <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				Sleep(<span class="number">1</span>);</span><br><span class="line">				<span class="built_in">cout</span>&lt;&lt;<span class="string">"thread1 sell ticket:"</span>&lt;&lt;tickets--&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> </span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			ReleaseMutex(hMutex);<span class="comment">//释放当前线程对互斥对象的所有权</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">		<span class="comment">//线程2的入口函数</span></span><br><span class="line">	<span class="function">DWORD WINAPI <span class="title">Fun2Proc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			</span></span></span><br><span class="line"><span class="function"><span class="params">		LPVOID lpParameter  <span class="comment">//thread data</span></span></span></span><br><span class="line"><span class="function"><span class="params">		)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">while</span> (TRUE)</span><br><span class="line">		&#123;</span><br><span class="line">			WaitForSingleObject(hMutex,INFINITE);</span><br><span class="line">			<span class="keyword">if</span> (tickets &gt; <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				Sleep(<span class="number">1</span>);</span><br><span class="line">				<span class="built_in">cout</span>&lt;&lt;<span class="string">"thread2 sell ticket:"</span>&lt;&lt;tickets--&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> </span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			ReleaseMutex(hMutex);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p> <img src="http://img.blog.csdn.net/20170424215734652?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>　　这时所销售的票号正常，没有看到销售了号码为0的票。</p>
<p>　　对互斥对象来说，谁拥有谁释放。</p>
<h2 id="保证应用程序只有一个实例运行"><a href="#保证应用程序只有一个实例运行" class="headerlink" title="保证应用程序只有一个实例运行"></a>保证应用程序只有一个实例运行</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function">DWORD WINAPI <span class="title">Fun1Proc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	LPVOID lpParameter  <span class="comment">//thread data					 </span></span></span></span><br><span class="line"><span class="function"><span class="params">	)</span></span>;</span><br><span class="line">	</span><br><span class="line">	 <span class="function">DWORD WINAPI <span class="title">Fun2Proc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	LPVOID lpParameter  <span class="comment">//thread data					 </span></span></span></span><br><span class="line"><span class="function"><span class="params">	)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> tickets = <span class="number">100</span>;</span><br><span class="line">	HANDLE hMutex;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		HANDLE hThread1;</span><br><span class="line">		HANDLE hThread2;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//创建互斥对象(注意命名)</span></span><br><span class="line">		hMutex = CreateMutex(<span class="literal">NULL</span>, FALSE, <span class="string">"1"</span>);</span><br><span class="line">		<span class="keyword">if</span> (hMutex)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (ERROR_ALREADY_EXISTS == GetLastError())</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">cout</span>&lt;&lt;<span class="string">"only one instance can run!"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//创建线程</span></span><br><span class="line">		hThread1 = CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, Fun1Proc, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">		hThread2 = CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, Fun2Proc, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">		CloseHandle(hThread1);</span><br><span class="line">		CloseHandle(hThread2);</span><br><span class="line">		WaitForSingleObject(hMutex, INFINITE);</span><br><span class="line">		ReleaseMutex(hMutex);</span><br><span class="line">		ReleaseMutex(hMutex);</span><br><span class="line">		Sleep(<span class="number">4000</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//线程1的入口函数</span></span><br><span class="line">	<span class="function">DWORD WINAPI <span class="title">Fun1Proc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			</span></span></span><br><span class="line"><span class="function"><span class="params">		LPVOID lpParameter  <span class="comment">//thread data</span></span></span></span><br><span class="line"><span class="function"><span class="params">		)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">	<span class="keyword">while</span> (TRUE)</span><br><span class="line">		&#123;</span><br><span class="line">			WaitForSingleObject(hMutex, INFINITE);<span class="comment">//实现线程同步</span></span><br><span class="line">			<span class="keyword">if</span> (tickets &gt; <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				Sleep(<span class="number">1</span>);</span><br><span class="line">				<span class="built_in">cout</span>&lt;&lt;<span class="string">"thread1 sell ticket:"</span>&lt;&lt;tickets--&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> </span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			ReleaseMutex(hMutex);<span class="comment">//释放当前线程对互斥对象的所有权</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">		<span class="comment">//线程2的入口函数</span></span><br><span class="line">	<span class="function">DWORD WINAPI <span class="title">Fun2Proc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			</span></span></span><br><span class="line"><span class="function"><span class="params">		LPVOID lpParameter  <span class="comment">//thread data</span></span></span></span><br><span class="line"><span class="function"><span class="params">		)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">while</span> (TRUE)</span><br><span class="line">		&#123;</span><br><span class="line">			WaitForSingleObject(hMutex,INFINITE);</span><br><span class="line">			<span class="keyword">if</span> (tickets &gt; <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				Sleep(<span class="number">1</span>);</span><br><span class="line">				<span class="built_in">cout</span>&lt;&lt;<span class="string">"thread2 sell ticket:"</span>&lt;&lt;tickets--&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> </span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			ReleaseMutex(hMutex);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="网络聊天室程序的实现"><a href="#网络聊天室程序的实现" class="headerlink" title="网络聊天室程序的实现"></a>网络聊天室程序的实现</h2><p>　　新建一个基于对话框的工程，名为：Chat。<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170428102440017?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure><br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170428102449366?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<h3 id="加载套接字库"><a href="#加载套接字库" class="headerlink" title="加载套接字库"></a>加载套接字库</h3><p>　　在CChatApp类的InitInstance函数开始位置<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">BOOL CChatApp::InitInstance()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (!AfxSocketInit())</span><br><span class="line">	&#123;</span><br><span class="line">		AfxMessageBox(<span class="string">"加载套接字库失败！"</span>);</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line">……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　在stdafx.h中，添加头文件<code>#include &lt;Afxsock.h&gt;</code>。</p>
<h3 id="创建并初始化套接字"><a href="#创建并初始化套接字" class="headerlink" title="创建并初始化套接字"></a>创建并初始化套接字</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">BOOL CChatDlg::InitSocket()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//创建套接字</span></span><br><span class="line">	m_socket = socket(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (INVALID_SOCKET == m_socket)</span><br><span class="line">	&#123;</span><br><span class="line">		MessageBox(<span class="string">"套接字创建失败！"</span>);</span><br><span class="line">		<span class="keyword">return</span> FALSE;</span><br><span class="line">	&#125;</span><br><span class="line">	SOCKADDR_IN addrSock;</span><br><span class="line">	addrSock.sin_family = AF_INET;</span><br><span class="line">	addrSock.sin_port = htons(<span class="number">7000</span>);</span><br><span class="line">	addrSock.sin_addr.S_un.S_addr = htonl(INADDR_ANY);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> retval;</span><br><span class="line">	<span class="comment">//绑定套接字</span></span><br><span class="line">	retval = bind(m_socket, (SOCKADDR*)&amp;addrSock, <span class="keyword">sizeof</span>(SOCKADDR));</span><br><span class="line">	<span class="keyword">if</span> (SOCKET_ERROR == retval)</span><br><span class="line">	&#123;</span><br><span class="line">		closesocket(m_socket);</span><br><span class="line">		MessageBox(<span class="string">"绑定失败！"</span>);</span><br><span class="line">		<span class="keyword">return</span> TRUE;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">BOOL CChatDlg::OnInitDialog()</span><br><span class="line">&#123;</span><br><span class="line">……</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add extra initialization here</span></span><br><span class="line">	InitSocket();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> TRUE;  <span class="comment">// return TRUE  unless you set the focus to a control</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="实现接收端功能"><a href="#实现接收端功能" class="headerlink" title="实现接收端功能"></a>实现接收端功能</h3><p>　　在CChatDlg类中定义：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">// CChatDlg dialog</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RECVPARAM</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	SOCKET sock; <span class="comment">//已创建的套接字</span></span><br><span class="line">	HWND hwnd; <span class="comment">//对话框句柄</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>　　在Chatdlg.h中添加：<code>static DWORD WINAPI RecvProc(LPVOID lpParameter);</code><br>在OnInitDialog()中添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">BOOL CChatDlg::OnInitDialog()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">……</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Add extra initialization here</span></span><br><span class="line">	InitSocket();</span><br><span class="line">	RECVPARAM *pRecvParam = <span class="keyword">new</span> RECVPARAM;</span><br><span class="line">	pRecvParam-&gt;sock = m_socket;</span><br><span class="line">	pRecvParam-&gt;hwnd = m_hWnd;</span><br><span class="line">	<span class="comment">//创建接收线程</span></span><br><span class="line">	HANDLE hThread = CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, RecvProc, (LPVOID)pRecvParam, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="comment">//关闭该接收程句柄，释放其引用计数</span></span><br><span class="line">	CloseHandle(hThread);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> TRUE;  <span class="comment">// return TRUE  unless you set the focus to a control</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　在CChatDlg类中添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DWORD WINAPI CChatDlg::RecvProc(LPVOID lpParameter)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　若要求采用完全面向对象的思想来编程，不能使用全局函数和全局变量了，可以采用静态成员函数和静态成员变量的方法来解决。<br>　　<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">DWORD WINAPI CChatDlg::RecvProc(LPVOID lpParameter)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//获取主线程传递的套接字和窗口句柄</span></span><br><span class="line">	SOCKET sock = ((RECVPARAM*)lpParameter)-&gt;sock;</span><br><span class="line">	HWND hwnd = ((RECVPARAM*)lpParameter)-&gt;hwnd;</span><br><span class="line">	<span class="keyword">delete</span> lpParameter;</span><br><span class="line"></span><br><span class="line">	SOCKADDR_IN addrFrom;</span><br><span class="line">	<span class="keyword">int</span> len = <span class="keyword">sizeof</span>(SOCKADDR);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">char</span> recvBuf[<span class="number">200</span>];</span><br><span class="line">	<span class="keyword">char</span> tempBuf[<span class="number">300</span>];</span><br><span class="line">	<span class="keyword">int</span> retval;</span><br><span class="line">	<span class="keyword">while</span>(TRUE)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//接收数据</span></span><br><span class="line">		retval = recvfrom(sock, recvBuf, <span class="number">200</span>, <span class="number">0</span>, (SOCKADDR*)&amp;addrFrom, &amp;len);</span><br><span class="line">		<span class="keyword">if</span> (SOCKET_ERROR == retval)</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="built_in">sprintf</span>(tempBuf, <span class="string">"%s 说： %s"</span>, inet_ntoa(addrFrom.sin_addr), recvBuf);</span><br><span class="line">		::PostMessage(hwnd, WM_RECVDATA, <span class="number">0</span>, (LPARAM)tempBuf);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　在该类添加头文件 <code>#define WM_RECVDATA    WM_USER+1</code></p>
<p>在CChatDlg类头文件中编写该消息响应函数原型的声明：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Generated message map functions</span></span><br><span class="line"><span class="comment">//&#123;&#123;AFX_MSG(CChatDlg)</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> BOOL <span class="title">OnInitDialog</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnSysCommand</span><span class="params">(UINT nID, LPARAM lParam)</span></span>;</span><br><span class="line"><span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnPaint</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">afx_msg HCURSOR <span class="title">OnQueryDragIcon</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//&#125;&#125;AFX_MSG</span></span><br><span class="line"><span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnRecvData</span><span class="params">(WPARAM wParam, LPARAM lParam)</span></span>;</span><br><span class="line">DECLARE_MESSAGE_MAP()</span><br></pre></td></tr></table></figure></p>
<p>在CChatDlg类的源文件中添加WM_RECVDATA消息映射。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">BEGIN_MESSAGE_MAP(CChatDlg, CDialog)</span><br><span class="line">	<span class="comment">//&#123;&#123;AFX_MSG_MAP(CChatDlg)</span></span><br><span class="line">	ON_WM_SYSCOMMAND()</span><br><span class="line">	ON_WM_PAINT()</span><br><span class="line">	ON_WM_QUERYDRAGICON()</span><br><span class="line">	<span class="comment">//&#125;&#125;AFX_MSG_MAP</span></span><br><span class="line">	ON_MESSAGE(WM_RECVDATA, OnRecvData)</span><br><span class="line">END_MESSAGE_MAP()</span><br></pre></td></tr></table></figure></p>
<p>在构造函数中<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CChatDlg::OnRecvData(WPARAM wParam, LPARAM lParam)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//取出接收到的数据</span></span><br><span class="line">	CString str = (<span class="keyword">char</span>*)lParam;</span><br><span class="line">	CString strTemp;</span><br><span class="line">	<span class="comment">//获得已有数据</span></span><br><span class="line">	GetDlgItemText(IDC_EDIT_RECV, strTemp);</span><br><span class="line">	str += <span class="string">"\r\n"</span>;</span><br><span class="line">	str += strTemp;</span><br><span class="line">	<span class="comment">//显示所有接收到的数据</span></span><br><span class="line">	SetDlgItemText(IDC_EDIT_RECV, str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="实现发送端功能"><a href="#实现发送端功能" class="headerlink" title="实现发送端功能"></a>实现发送端功能</h3><p>双击发送，添加响应函数。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CChatDlg::OnBtnSend() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//获取对方IP</span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></span><br><span class="line">	DWORD dwIP;</span><br><span class="line">	((CIPAddressCtrl*)GetDlgItem(IDC_IPADDRESS1))-&gt;GetAddress(dwIP);</span><br><span class="line"></span><br><span class="line">	SOCKADDR_IN addrTo;</span><br><span class="line">	addrTo.sin_family = AF_INET;</span><br><span class="line">	addrTo.sin_port = htons(<span class="number">7000</span>);</span><br><span class="line">	addrTo.sin_addr.S_un.S_addr = htonl(dwIP);</span><br><span class="line"></span><br><span class="line">	CString strSend;</span><br><span class="line">	<span class="comment">//获得待发送数据</span></span><br><span class="line">	GetDlgItemText(IDC_EDIT_SEND, strSend);</span><br><span class="line">	<span class="comment">//发送数据</span></span><br><span class="line">	sendto(m_socket, strSend, strSend.GetLength()+<span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">		(SOCKADDR*)&amp;addrTo, <span class="keyword">sizeof</span>(SOCKADDR));</span><br><span class="line">	<span class="comment">//清空发送编辑框中的内容</span></span><br><span class="line">	SetDlgItemText(IDC_EDIT_SEND, <span class="string">""</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　为了让编辑框控件接受换行符，必须设置该控件支持多行数据这一属性。<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170428102525898?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="">
                </div>
                <div class="image-caption">这里写图片描述</div>
            </figure></p>
<p>　　将“发送”设置为Default button，还可以选择取消Visible选项。<br>　　本例在一个程序中同时实现了接收端和发送端的功能，所以只需在聊天双方各自的机器上安装本程序，在聊天时，通过输入对方主机的IP地址，就可以与对方进行通信了。</p>
<h1 id="ActiveX控件"><a href="#ActiveX控件" class="headerlink" title="ActiveX控件"></a>ActiveX控件</h1><h2 id="ActiveX控件-1"><a href="#ActiveX控件-1" class="headerlink" title="ActiveX控件"></a>ActiveX控件</h2><p>OCX是ActiveX控件的一种后缀名。但ActiveX控件对应的文件也可以是其他后缀名，例如DLL。作为一个典型的ActiveX控件，它具有方法、属性、事件这三种特性。在一个文件中可以包含多个ActiveX控件。</p>
<h3 id="MFC-ActiveX-ControlWizard"><a href="#MFC-ActiveX-ControlWizard" class="headerlink" title="MFC ActiveX ControlWizard"></a>MFC ActiveX ControlWizard</h3><h1 id="动态链接库"><a href="#动态链接库" class="headerlink" title="动态链接库"></a>动态链接库</h1><p>　　动态链接库有两种加载方式：隐式链接和显式加载</p>
<h2 id="Win32-DLL的创建和使用"><a href="#Win32-DLL的创建和使用" class="headerlink" title="Win32 DLL的创建和使用"></a>Win32 DLL的创建和使用</h2><p>　　新建一个Win32 Dynamic-Link Library类型的工程，取名为Dll1。并在AppWizard的第一步选择“An empty Dll project”，即创建一个空的动态链接库工程。然后添加一个C++源文件：Dll1.cpp。添加代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">subtract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　Build生成Dll1程序。在该工程的Debug目录下，可看到一个Dll1.dll文件，这就是生成的动态链接库文件。</p>
<h3 id="Dumpbin命令"><a href="#Dumpbin命令" class="headerlink" title="Dumpbin命令"></a>Dumpbin命令</h3><p>　　应用程序如果想要访问某个DLL中的函数，那么该函数必须是已经被导出的函数。为了查看有哪些导出函数，可以用VS提供的命令行工具：Dumpbin实现。    </p>
<h3 id="从DLL中导出函数"><a href="#从DLL中导出函数" class="headerlink" title="从DLL中导出函数"></a>从DLL中导出函数</h3><p>　　为导出函数，需在每一个将被导出的函数前添加标识符：_declspec(dllexport)。修改上述代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">_declspec(dllexport) <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_declspec(dllexport) <span class="function"><span class="keyword">int</span> <span class="title">subtract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　编译后可看到又生成了两个新文件，Dll1.lib，它保存Dll1.dll中导出的函数和变量的符号名。以及DALL1.EXP文件。</p>
<h2 id="隐式链接方式加载DLL"><a href="#隐式链接方式加载DLL" class="headerlink" title="隐式链接方式加载DLL"></a>隐式链接方式加载DLL</h2><p>　　编写一个测试程序测试这个动态链接库。新建一个基于对话框的MFC应用程序，取名DllTest，放置两个按钮，ID和Caption分别为：IDC_BTN_ADD，Add，IDC_BTN_SUBTRACT，Subtract。</p>
<h3 id="利用extern声明外部函数"><a href="#利用extern声明外部函数" class="headerlink" title="利用extern声明外部函数"></a>利用extern声明外部函数</h3><p>　　为让编译器知道这两个函数，需作出声明，注意放在OnBtnAdd函数和OnBtnSubtract函数前面。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">subtract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CDllTestDlg::OnBtnAdd() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></span><br><span class="line">	CString str;</span><br><span class="line">	str.Format(<span class="string">"5 + 3 = %d"</span>, add(<span class="number">5</span>, <span class="number">3</span>));</span><br><span class="line">	MessageBox(str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CDllTestDlg::OnBtnSubtract() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></span><br><span class="line">	CString str;</span><br><span class="line">	str.Format(<span class="string">"5 - 3 = %d"</span>, subtract(<span class="number">5</span>, <span class="number">3</span>));</span><br><span class="line">	MessageBox(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　Build后报错：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">--------------------Configuration: DllTest - Win32 Debug--------------------</span><br><span class="line">Compiling resources...</span><br><span class="line">Compiling...</span><br><span class="line">StdAfx.cpp</span><br><span class="line">Compiling...</span><br><span class="line">DllTest.cpp</span><br><span class="line">DllTestDlg.cpp</span><br><span class="line">Generating Code...</span><br><span class="line">Linking...</span><br><span class="line">DllTestDlg.obj : error LNK2001: unresolved external symbol <span class="string">"int __cdecl add(int,int)"</span> (?add@@YAHHH@Z)</span><br><span class="line">DllTestDlg.obj : error LNK2001: unresolved external symbol <span class="string">"int __cdecl subtract(int,int)"</span> (?subtract@@YAHHH@Z)</span><br><span class="line">Debug/DllTest.exe : fatal error LNK1120: <span class="number">2</span> unresolved externals</span><br><span class="line">执行 link.exe 时出错.</span><br><span class="line"></span><br><span class="line">DllTest.exe - <span class="number">1</span> error(s), <span class="number">0</span> warning(s)</span><br></pre></td></tr></table></figure></p>
<p>　　可看到编译成功，错误发生在链接时。为解决该问题，需利用动态链接库的引入库文件。<br>　　在Dll1.dll文件所在目录下，复制Dll1.lib文件，并将其复制到DllTest程序所在目录下，这个文件中就包含了Dll1.dll中导出函数的符号名。<br>　　然后在DllTest中，选择Porject\Settings\link，在Object/library modules中输入dll1.lib。<br>　　再次编译，成功生成DllTest.exe文件。<br>　　（可利用dumpbin -imports dlltest.exe查看输入信息）</p>
<p>　　运行程序，弹出报错对话框：<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170709130424898?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="报错" title="">
                </div>
                <div class="image-caption">报错</div>
            </figure></p>
<p>　　将Dll1.dll放置在DllTest工程所在目录下，就好了。</p>
<p>　　效果如图。<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170709130702138?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="效果" title="">
                </div>
                <div class="image-caption">效果</div>
            </figure></p>
<h3 id="Depends工具"><a href="#Depends工具" class="headerlink" title="Depends工具"></a>Depends工具</h3><p>　　在Microsoft Visual Studio\Common\Tools中有一个DEPENDS.EXE，该工具可以查看可执行程序，还可以查看动态链接库，主要是看它们依赖于哪些动态链接库。<br>　　打开该工具，单击File\Open，选择DllText.exe，将会看到：<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170709132044018?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="DEPENDS" title="">
                </div>
                <div class="image-caption">DEPENDS</div>
            </figure></p>
<p>　　DllTest程序需访问Dll1.dll这一动态链接库，但该文件名前有一个问号，说明没有找到Dll1.dll这个动态链接库。这是因为前面将动态链接库文件放在了\DllTest\Debug目录的上一级目录下了。这里，可将Dll1.dll文件再复制到\DllTest\Debug目录下，然后重启Depends工具。这时问号就没有了。（因为Dll1.dll与DllTest.exe位于同一目录，在打开DllTest.exe时，就可找到该动态链接库。）</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170709132630578?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="成功" title="">
                </div>
                <div class="image-caption">成功</div>
            </figure>
<h3 id="利用-declspec-dllimport-声明外部函数"><a href="#利用-declspec-dllimport-声明外部函数" class="headerlink" title="利用_declspec(dllimport)声明外部函数"></a>利用_declspec(dllimport)声明外部函数</h3><p>　　除了使用extern关键字表明函数是外部定义的之外，还可以使用标识符：_declspec(dllimport)来表明函数是从动态链接库中引入的。将之前的extern声明注释起来。添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_declspec(dllimport) <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line">_declspec(dllimport) <span class="function"><span class="keyword">int</span> <span class="title">subtract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>　　若调用的函数来自于动态链接库，应采用这种方式声明外部函数，编译器可以生成运行效率更高的代码。</p>
<h2 id="完善Win32-DLL例子"><a href="#完善Win32-DLL例子" class="headerlink" title="完善Win32 DLL例子"></a>完善Win32 DLL例子</h2><p>　　为知道DLL有哪些导出函数，通常在编写动态链接库时，会提供一个头文件，在此提供DLL导出函数原型的声明，以及函数有关注释文档。</p>
<p>　　为DLL1工程添加一个头文件：Dll1.h，并添加代码<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_declspec(dllimport) <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line">_declspec(dllimport) <span class="function"><span class="keyword">int</span> <span class="title">subtract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>　　然后将DllTestDlg.cpp先前添加的声明语句注释起来，并在前部添加下面的语句：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"dll1.h"</span></span></span><br></pre></td></tr></table></figure></p>
<p>　　Build并运行，结果和之前一样。</p>
<p>　　所以在发布Dll1.dll动态链接库时，可将Dll1.h头文件一起提供给使用者。</p>
<p>　　下面对Dll.h进行改造，使其不仅能为调用动态链接库的客户端程序服务，也能由动态链接库程序自身来使用。修改头文件：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> DLL1_API</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DLL1_API _declspec(dllimport)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">_declspec(dllimport) <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line">_declspec(dllimport) <span class="function"><span class="keyword">int</span> <span class="title">subtract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>　　修改Dll1.cpp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DLL1_API _declspec(dllexport)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Dll1.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">subtract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　将重新生成的文件复制，运行，结果也是正确的。</p>
<h2 id="从DLL中导出C-类"><a href="#从DLL中导出C-类" class="headerlink" title="从DLL中导出C++类"></a>从DLL中导出C++类</h2><p>　　在一个动态链接库中还可以导出一个C++类。<br>　　在Dll1.h中添加如下代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DLL1_API</span> <span class="title">Point</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>　　在Dll1.cpp中改为：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DLL1_API _declspec(dllexport)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Dll1.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">subtract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Point::output(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//返回调用者进程当前正在使用的那个窗口的句柄</span></span><br><span class="line">	HWND hwnd = GetForegroundWindow();</span><br><span class="line">	<span class="comment">//获取DC</span></span><br><span class="line">	HDC hdc = GetDC(hwnd);</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">20</span>];</span><br><span class="line">	<span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="number">20</span>);</span><br><span class="line">	<span class="built_in">sprintf</span>(buf, <span class="string">"x = %d, y = %d"</span>, x, y);</span><br><span class="line">	<span class="comment">//输出坐标</span></span><br><span class="line">	TextOut(hdc, <span class="number">0</span>, <span class="number">0</span>, buf, <span class="built_in">strlen</span>(buf));</span><br><span class="line">	<span class="comment">//释放DC</span></span><br><span class="line">	ReleaseDC(hwnd, hdc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　将Dll1.dll和Dll1.lib复制到测试工程DllTest所在目录下（本例将对应Dll1.h也放在了DllTest项目工程下，所以Dll1.h也应相应复制过来）。为避免麻烦，也可以把动态链接库文件所在目录添加到系统的环境变量Path中。这样就无需复制。<br>　　为测试这个新生成的DLL，打开DllTest工程，在对话框中增加一个按钮，属性为IDC_BTN_OUTPUT，Capition为Output。双击按钮添加响应函数OnBtnOutput。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CDllTestDlg::OnBtnOutput() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></span><br><span class="line">	Point pt;</span><br><span class="line">	pt.output(<span class="number">5</span>, <span class="number">3</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>　　记得删除Debug下的旧Dll1.dll，放入新的，否则会报错。<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://img.blog.csdn.net/20170813113649482?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="Output" title="">
                </div>
                <div class="image-caption">Output</div>
            </figure><br>　　可利用Dumpbin命令的exports选项查看Dll1.dll这一动态链接库的导出情况，利用imports选项查看测试程序的导入情况。</p>
<p>另外，在实现动态链接库时，可以不导出整个类，而只导出该类中的某些函数。<br>打开Dll1工程，在Dll1.h中将声明Point类时使用的DLL1_API宏注释起来，然后在output函数的声明前放置DLL1_API宏。这样就表示只导出Point类中的成员函数output。为证实这一点，为Point类再添加一个成员函数test，<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> /*<span class="title">DLL1_API</span>*/ <span class="title">Point</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> DLL1_API <span class="title">output</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>接着在Dll1.cpp中添加test函数的实现：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> Point::test()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Build后，利用dumpbin命令的exports可查看Dll1.dll的导出信息。<br>可将所需文件再次复制到DllTest工程中，运行结果和之前相同。<br>在导出类的成员函数时，该函数必须具有public类型的访问权限，否则即使能被导出也不能被其他程序访问。</p>
<h2 id="解决名字改编问题"><a href="#解决名字改编问题" class="headerlink" title="解决名字改编问题"></a>解决名字改编问题</h2><p>C++编译器在生产厂DLL时，会对导出的函数进行名字改编，由于不同编译器改编规则不同，所以改编后名字不同。若利用不同编译器分别生成DLL和访问该DLL的客户端程序时，后者在访问该DLL的导出函数时就会出现问题。因此希望动态链接库在编译时，导出函数的名称不要发生改变。为此，在定义导出函数时，需加上限定符：extern “C”。C一定要大写。<br>打开Dll1工程，找到Dll1.cpp和Dll1.h中定义DLL1_API宏的代码，添加限定符。<br>此时，Dll1.h为<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> DLL1_API</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DLL1_API extern <span class="meta-string">"C"</span> _declspec(dllimport)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">DLL1_API <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line"><span class="function">DLL1_API <span class="keyword">int</span> <span class="title">subtract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*class  Point</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">public:</span></span><br><span class="line"><span class="comment">	void DLL1_API output(int x, int y);</span></span><br><span class="line"><span class="comment">	void test();</span></span><br><span class="line"><span class="comment">&#125;;*/</span></span><br></pre></td></tr></table></figure></p>
<p>Dll1.cpp为<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DLL1_API extern <span class="meta-string">"C"</span> _declspec(dllexport)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Dll1.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">subtract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">void Point::output(int x, int y)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">	//返回调用者进程当前正在使用的那个窗口的句柄</span></span><br><span class="line"><span class="comment">	HWND hwnd = GetForegroundWindow();</span></span><br><span class="line"><span class="comment">	//获取DC</span></span><br><span class="line"><span class="comment">	HDC hdc = GetDC(hwnd);</span></span><br><span class="line"><span class="comment">	char buf[20];</span></span><br><span class="line"><span class="comment">	memset(buf, 0, 20);</span></span><br><span class="line"><span class="comment">	sprintf(buf, "x = %d, y = %d", x, y);</span></span><br><span class="line"><span class="comment">	//输出坐标</span></span><br><span class="line"><span class="comment">	TextOut(hdc, 0, 0, buf, strlen(buf));</span></span><br><span class="line"><span class="comment">	//释放DC</span></span><br><span class="line"><span class="comment">	ReleaseDC(hwnd, hdc);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">void Point::test()</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p>Build后生成Dll1.dll，用dumpbin命令的exports选项查看该动态链接库的导出信息，发现add和subtract函数名没有被改编。然后利用DllTest工程测试，将Point类的代码注释起来，将发现客户端可访问Dll1中的导出函数。</p>
<p>缺陷：extern “C”只能导出全局函数，不能导出一个类的成员函数。另外，如果导出函数的调用约定发生了改变，即使使用了extern “C”，函数名仍会发生改编。<br>例如，在Dll1.h中add和subtract函数添加_stdcall关键字标准调用约定。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> DLL1_API</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DLL1_API extern <span class="meta-string">"C"</span> _declspec(dllimport)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">DLL1_API _<span class="function">stdcall <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line">DLL1_API _<span class="function">stdcall <span class="keyword">int</span> <span class="title">subtract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>在Dll1.cpp中<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DLL1_API extern <span class="meta-string">"C"</span> _declspec(dllexport)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Dll1.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> _<span class="function">stdcall <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> _<span class="function">stdcall <span class="title">subtract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>没有_stdcall关键字，函数的调用约定就是C调用约定，标准调用约定是WINAPI调用约定，与C调用约定不同。<br>Build后生成最新Dll1.dll，利用Dumpbin的exports选项查看该动态链接库的导出情况，可看到名字变为_add@8。</p>
<p>这种情况下，可通过模型定义文件（DEF）的方式来解决名字改编问题。<br>新建一个Win32 Dynamic-Link Library类型的工程，取名为Dll2，在AppWizard第一步选择“An empty Dll project”选项。添加Dll2.cpp，<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">subtract</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在Dll2工程目录下新建一个空文本文件，改后缀为.def，添加到工程Source文件并打开：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LIBRARY Dll2</span><br><span class="line"></span><br><span class="line">EXPORTS</span><br><span class="line">add</span><br><span class="line">subtract</span><br></pre></td></tr></table></figure></p>
<p>Bulid后利用Dumpbin的exports查看证明没有发生名字改编。</p>
<h2 id="显示加载方式加载DLL"><a href="#显示加载方式加载DLL" class="headerlink" title="显示加载方式加载DLL"></a>显示加载方式加载DLL</h2><p>将最新的Dll2.dll复制到DllTest工程目录下。将DllTestDlg.cpp包含Dll1.h的那行代码注释起来，在link选项卡上删除对Dll1.lib的链接。<br>需用到LoadLibrary函数。</p>
<p>　　To be continued…<br>　　听听那冷雨</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2017-08-13T11:45:34.000Z" itemprop="dateUpdated">2017-08-13 19:45:34</time>
</span><br>


        
        原始链接：<a href="/2017/04/13/MFC傻瓜式教程/" target="_blank" rel="external">https://hubojing.github.io/2017/04/13/MFC傻瓜式教程/</a>
        
    </div>
    
    <footer>
        <a href="https://hubojing.github.io">
            <img src="/img/avatar.jpg" alt="靖待">
            靖待
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CPP/">CPP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MFC/">MFC</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://hubojing.github.io/2017/04/13/MFC傻瓜式教程/&title=《MFC傻瓜式教程》 — 靖待的技术博客&pic=https://hubojing.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://hubojing.github.io/2017/04/13/MFC傻瓜式教程/&title=《MFC傻瓜式教程》 — 靖待的技术博客&source= 



　　　　本教程重操作，轻理论，为操作减负。需了解详细原理的朋友可以自行看各种书籍。　　直接上菜。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://hubojing.github.io/2017/04/13/MFC傻瓜式教程/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《MFC傻瓜式教程》 — 靖待的技术博客&url=https://hubojing.github.io/2017/04/13/MFC傻瓜式教程/&via=https://hubojing.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://hubojing.github.io/2017/04/13/MFC傻瓜式教程/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2017/04/21/折腾才是人生/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">折腾才是人生</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2017/04/05/多说关闭引发的麻烦/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">多说关闭引发的麻烦</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'true' == 'true',
            verify: 'false' == 'true',
            appId: "2H9yj8iEb2hu9aasGn4nMwsc-MdYXbMMI",
            appKey: "sM0wCJDvqhJACy3RaqtxvJ7u",
            avatar: "identicon",
            placeholder: "据说留言的人都变漂亮了...",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        码代码和码字，都是人生乐趣
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>靖待 &copy; 2015 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://hubojing.github.io/2017/04/13/MFC傻瓜式教程/&title=《MFC傻瓜式教程》 — 靖待的技术博客&pic=https://hubojing.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://hubojing.github.io/2017/04/13/MFC傻瓜式教程/&title=《MFC傻瓜式教程》 — 靖待的技术博客&source= 



　　　　本教程重操作，轻理论，为操作减负。需了解详细原理的朋友可以自行看各种书籍。　　直接上菜。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://hubojing.github.io/2017/04/13/MFC傻瓜式教程/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《MFC傻瓜式教程》 — 靖待的技术博客&url=https://hubojing.github.io/2017/04/13/MFC傻瓜式教程/&via=https://hubojing.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://hubojing.github.io/2017/04/13/MFC傻瓜式教程/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACK0lEQVR42u3aS27DMAwFwN7/0ukBCjuPpBLU0mhVpLGj0YIQPz8/8Xr9WVf/vf/k6s1XTy1eGBgYj2W8blfyA/lT99+8h90fJQYGxgmMJBQmES8Jpsmh5HvDwMDAqDKSMFrFY2BgYFQZk432kmEMDAyMPIlNXl1IO4Ny20dycQwMjAcy8qr79//+SH8DAwPjUYxXca0q7i/eFQYGxtaMXiktb2dO3lAt7WFgYOzKKAe1oJRfDbLJSMcbGAYGxjGMSUG/usXekV2CMTAwjmEkDcV8VOI+9c3HLKILKAYGxgGMfAwiuVzmIXjSNsDAwDiHMWlYli9w8Sa+OlqBgYHx7xkLEsj4Elm9dCaHWLjhYmBgPJzRSyOrbcv8stgst2FgYGzNWLX1XsNyQVsUAwPjAMakQJa0J+cHUSirYWBgbM3IW4y9QJkX7MoNTgwMjK0Z1SZBXsSfFP2b3QwMDIxNGfcjXPk3k0HVeeC+/BwDA2Nrxry4P5/sqI66vvktDAyMTRnVYYsEMEl386fedDkwMDC2Y/SCXW8r1eQ2SncxMDCOYfSucZPjWDb8ioGBsSnjVVzJhqotxqRgV7jbYmBgbMdYVRSrjoLlTdNm7RADA2M7RjXIztucSZOyOfiFgYGxNWNt/E4+nySxhXIbBgbGkYw8paw2PkcNBgwMDIzBgGl11Kx6HBgYGOcw8nGH6hhZPkDWa0hgYGCcwOiljtVi2bwAt6CRiYGB8TzGL/5JnTsFfWsCAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>




<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '快回来嘛！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)抱抱~你回来了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
