<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>胡博靖的技术博客</title>
  <subtitle>小清新IT旅程|为中华崛起读书</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://hubojing.github.io/"/>
  <updated>2017-07-05T15:11:34.228Z</updated>
  <id>http://hubojing.github.io/</id>
  
  <author>
    <name>胡博靖</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>新闻杂谈</title>
    <link href="http://hubojing.github.io/2017/06/29/%E5%8B%92%E7%B4%A2%E7%97%85%E6%AF%92/"/>
    <id>http://hubojing.github.io/2017/06/29/勒索病毒/</id>
    <published>2017-06-29T15:26:53.000Z</published>
    <updated>2017-07-05T15:11:34.228Z</updated>
    
    <content type="html"><![CDATA[<div align="left"><br><img src="http://n.sinaimg.cn/translate/20170628/njjU-fyhneam5185815.jpg" width="300" height="180" style="float:right;"><br><br><br><br><br>给Petya病毒差评，比永恒之蓝的用户体验差太多了，竟然没有简体中文版！！！<br>　　<br><br><br> </div>

<a id="more"></a>
<p>QQ身份证显示，2006年加入QQ，竟然是全球第7.96亿个用户？？？？然而腾讯2008年用户数也才4.3亿吧，前不久统计全国网民也还不到十亿。<br>。。。。。。<br>好吧，我看2014年注册的号已经是第41.2亿个用户了，很强势。。。看来很多人都有多个QQ号→_→</p>
<hr>
<p><strong>三条新闻</strong></p>
<p>巴铁狗带<br>今天看新闻巴铁终于被拆了……<br>还记得当初第一回看到这个新概念视频时还觉得超酷的，然而仔细一想就漏洞百出。黑科技常有，但在众人提出质疑后却给不出解决方案的情况下一意孤行就很不地道。只能说是打着科研旗号骗国家钱的玩意儿……</p>
<hr>
<p>之前报道：<br>【微软惊呆：Win 10源代码泄漏！】外媒Theregister获得消息称，Win10源代码目前在网上被大量泄漏，这些源代码大小超过32TB。据悉，这些代码在今年三月左右在微软内部系统当中流出，包含Win10硬件驱动程序源码及USB和Wi-Fi协议栈等，获得源代码的黑客将可以查找系统中的漏洞用来破坏全球Windows系统.. ​</p>
<p>标题我都想好了：<br>震惊！！Windows系统将走向开源 国产自主研发加速</p>
<p>最新消息：微软承认遭泄露，不过只有1.2G。（这就很不新闻了）</p>
<hr>
<p>最近勒索病毒又升级了……吓得我又去看看自己win10升级没……</p>
<p>Petya病毒对勒索对象的加密，分为以下7个步骤：<br>遍历所有驱动器，对每个驱动器创建一个线程并行加密 -&gt; 生成AES-128密钥key -&gt; 遍历磁盘文件，用key对其进行AES加密 -&gt; 从程序中获取一个公钥pubkey（内置固定） -&gt; 用pubkey加密key，得到ekey -&gt; 将ekey写入README.TXT -&gt; 释放key</p>
<p><a href="https://yq.aliyun.com/articles/85783?spm=5176.100239.blogcont111587.33.CQn23O&amp;utm_content=m_24432" target="_blank" rel="external">WanaCrypt0r勒索蠕虫完全分析报告</a></p>
<p>—————————————————————–闲话分割线———————————————————————<br>插播一段闲话（写于2017年6月14日）：</p>
<pre><code>毕设告一段落，真的要毕业啦。
毕设期间，感觉自己学到了不少Android开发的基本东西，但我都不敢写文章发上来。因为在paperfree查重时显示和一篇文章重复率有5%：
来源：互联网资源    标题：**************（具体文章名就匿了） - 胡博靖的技术博客

还有比这更惨的事情吗？说我抄袭了自己的文章[哭泣]

最终知网查重率1.3%，毕设顺利完成，挺开心的，虽然编程过程遇到了很多的难题，好在大都解决了。导师人也很好，给人感觉是才华横溢的学者型，交材料时我们聊了聊各自毕业的场景，他祝贺我们毕业时，感觉真的就到了离开学校的时候，时光飞逝啊。
</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://n.sinaimg.cn/translate/20170628/njjU-fyhneam5185815.jpg&quot; width=&quot;300&quot; height=&quot;180&quot; style=&quot;float:right;&quot;/&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;给Petya病毒差评，比永恒之蓝的用户体验差太多了，竟然没有简体中文版！！！&lt;br&gt;　　&lt;br&gt;&lt;br&gt;&lt;br&gt; &lt;/div&gt;
    
    </summary>
    
      <category term="杂谈" scheme="http://hubojing.github.io/categories/%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="病毒" scheme="http://hubojing.github.io/tags/%E7%97%85%E6%AF%92/"/>
    
  </entry>
  
  <entry>
    <title>HOOPS记录</title>
    <link href="http://hubojing.github.io/2017/06/25/HOOPS%E8%AE%B0%E5%BD%95/"/>
    <id>http://hubojing.github.io/2017/06/25/HOOPS记录/</id>
    <published>2017-06-25T14:54:44.000Z</published>
    <updated>2017-06-29T16:30:58.238Z</updated>
    
    <content type="html"><![CDATA[<div align="left"><br><img src="https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=2467623496,1926622754&fm=15&gp=0.jpg" width="300" height="180" style="float:right;"><br><br> HOOPS初学概念小记（自用笔记）。<br>　　<br><br><br> </div>

<a id="more"></a>
<h1 id="hoops-3d-application-framework-hoops3daf"><a href="#HOOPS-3D-Application-Framework-HOOPS-3dAF" class="headerlink" title="HOOPS 3D Application Framework (HOOPS/3dAF)"></a>HOOPS 3D Application Framework (HOOPS/3dAF)</h1><p>官网描述<br>With HOOPS Visualize, you can rapidly produce eye-popping graphics across both mobile and desktop platforms. </p>
<p>At its core, HOOPS Visualize provides a flexible, hierarchical scene management engine capable of handling a range of graphics entities, together with a sophisticated graphics pipeline and high-performance graphics and interaction handling algorithms. It also delivers advanced capabilities to accelerate your application development, including an animation engine, clash detection, multi-plane sectioning, and large model visualization. </p>
<h1 id="hoops-基本图元和属性支持"><a href="#HOOPS-基本图元和属性支持" class="headerlink" title="HOOPS 基本图元和属性支持"></a>HOOPS 基本图元和属性支持</h1><blockquote>
<p>几 何</p>
<ul>
<li>Images, Unicode Text, Points, Lines, Polygons, Polylines, Polycylinders, NURBS curves, NURBS surfaces, Arcs, Ellipses, Circles, Tristrips, Trifans, Indexed Facesets, Cutting Planes, Capping Geometry<br>几何属性<br>Color, Transparency, Textures, Visibility, Patterns (Facet,edge 和 Line), Color Ramps, Lighting Interpolation, Selectability<br>渲染属性<br>Shaded, Analytic Hidden Line, Wireframe,Color Maps, Various Color Ramping Algorithms, Window Background Coloring</li>
</ul>
</blockquote>
<p>edges包含polygons,shells,meshes.<br>faces包含shells和meshes.<br>markers 单独的点.</p>
<p>标记marker</p>
<blockquote>
<p>可作为注释来使用</p>
<ul>
<li>当放大和缩小时标记的大小是不变的</li>
<li>标记的大小是朝向相机的，它并不旋转</li>
</ul>
</blockquote>
<h1 id="hoops-mvo-mvo分别是model-view-operator的缩写"><a href="#HOOPS-MVO-（MVO分别是Model、View、Operator的缩写）" class="headerlink" title="HOOPS MVO  （MVO分别是Model、View、Operator的缩写）"></a>HOOPS MVO  （MVO分别是Model、View、Operator的缩写）</h1><blockquote>
<p>段结构</p>
<ul>
<li>HDB</li>
<li>HBaseModel：处理在包含库下的段</li>
<li>HBaseView：处理在驱动段下的段和实例</li>
<li>HbaseOperator：处理图形用户界面/事件循环<br>· 相机操作<br>· 几何对象操作<br>· 选择</li>
</ul>
</blockquote>
<h1 id="3d应用程序中经常用到的函数"><a href="#3D应用程序中经常用到的函数" class="headerlink" title="3D应用程序中经常用到的函数"></a>3D应用程序中经常用到的函数</h1><ul>
<li>保存应用程序数据</li>
<li>绘制应用程序数据</li>
<li>管理应用程序数据</li>
<li>相机</li>
<li>选择</li>
<li>坐标</li>
<li>查询</li>
<li>驱动器设置</li>
</ul>
<h1 id="shell官网描述"><a href="#shell官网描述" class="headerlink" title="shell官网描述"></a>shell官网描述</h1><p>3D applications typically represent 3D objects with an “indexed face set” or “polygon-point mesh”. In Visualize, such primitives are called ‘shells’. A shell defines the boundary surface of an object in 3D using a set of planar polygons. Polygons can be multi-sided and can include holes. A shell is defined as an array of vertices (3D points) and an array of indices into the vertex array that define each polygonal face.</p>
<p>HOOPS Visualize supports a wide range of advanced functionality relating to shells, including the ability to select, highlight, and modify individual sub-entities (faces, edges, and vertices). Attributes such as normals, colors, and texture coordinates can also be set at the sub-entity level to enable a variety of complex shading and display.</p>
<p>Shell   一系列连通的Face / Wire的集合。线、面的集合，能位于实体外，也能在内部形成空洞。一个体含一个悬挂面，一个体内嵌许多和外表面相连的面都称为shell。</p>
<h2 id="shell-attributes属性"><a href="#shell-attributes属性" class="headerlink" title="shell attributes属性"></a>shell attributes属性</h2><p>1.Vertex markers<br>2.Silhouette（外表面）/perimeter/hard/adjacent edges<br>3.Cut edges/faces<br>4.Attributes on subparts<br>5.Smooth shading<br>6.Advanced rendering</p>
<h1 id="selection官网描述"><a href="#selection官网描述" class="headerlink" title="selection官网描述"></a>selection官网描述</h1><p>The Visualize libraries provide multiple operations for selection and several advanced highlighting techniques.</p>
<p>Selection</p>
<p>Control over what is targeted for selection is configurable:</p>
<p>Segments in the scene graph can be marked as available for selection<br>The selection level can be specified – entity, geometry, segment, or segment tree. Selection of individual vertices, edges and faces can be configured<br>The number of selected items to search for is configurable<br>The selection proximity can be used to select the nearest item on screen within a screen-based tolerance<br>Selections can be made of all items inside and outside a drag box, inside arbitrary screen regions defined by polylines or polygons, by a volume of 3D space, and by an arbitrary triangle mesh in 3D for clash/collision detection.</p>
<h1 id="坐标系coordinate-systems"><a href="#坐标系（Coordinate-Systems）" class="headerlink" title="坐标系（Coordinate Systems）"></a>坐标系（Coordinate Systems）</h1><p>对象（Object）-&gt;世界（World）-&gt;(-&gt;视点ViewPoint)-&gt;外窗口（Outer Window）-&gt;像素（Pixel）</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="http://blog.csdn.net/myan/article/details/647511" target="_blank" rel="external">理解矩阵（一）</a><br><a href="http://blog.csdn.net/myan/article/details/649018" target="_blank" rel="external">理解矩阵（二）</a><br><a href="http://blog.csdn.net/myan/article/details/1865397" target="_blank" rel="external">理解矩阵（三）</a><br><a href="https://wenku.baidu.com/view/a19bf8ec4afe04a1b071ded2.html?re=view" target="_blank" rel="external">HOOPS基础培训课程1</a><br><a href="https://wenku.baidu.com/view/a0154f28915f804d2b16c1d2.html?re=view" target="_blank" rel="external">HOOPS基础培训课程2</a><br><a href="https://wenku.baidu.com/view/84fdc0c789eb172ded63b7d2.html?re=view" target="_blank" rel="external">HOOPS基础培训课程3</a><br><a href="https://wenku.baidu.com/view/796caa5377232f60ddcca102.html?re=view" target="_blank" rel="external">HOOPS_MFC应用程序向导</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=2467623496,1926622754&amp;fm=15&amp;gp=0.jpg&quot; width=&quot;300&quot; height=&quot;180&quot; style=&quot;float:right;&quot;/&gt;&lt;br&gt;&lt;br&gt; HOOPS初学概念小记（自用笔记）。&lt;br&gt;　　&lt;br&gt;&lt;br&gt;&lt;br&gt; &lt;/div&gt;
    
    </summary>
    
      <category term="互联网" scheme="http://hubojing.github.io/categories/%E4%BA%92%E8%81%94%E7%BD%91/"/>
    
    
      <category term="HOOPS 3D" scheme="http://hubojing.github.io/tags/HOOPS-3D/"/>
    
  </entry>
  
  <entry>
    <title>MFC+多线程+进度条+复制文件（夹）</title>
    <link href="http://hubojing.github.io/2017/06/15/MFC-%E5%A4%9A%E7%BA%BF%E7%A8%8B-%E8%BF%9B%E5%BA%A6%E6%9D%A1-%E5%A4%8D%E5%88%B6%E6%96%87%E4%BB%B6%EF%BC%88%E5%A4%B9%EF%BC%89/"/>
    <id>http://hubojing.github.io/2017/06/15/MFC-多线程-进度条-复制文件（夹）/</id>
    <published>2017-06-15T10:00:17.000Z</published>
    <updated>2017-06-15T10:25:01.714Z</updated>
    
    <content type="html"><![CDATA[<div align="left"><br><img src="https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=1049830277,1612840852&fm=26&gp=0.jpg" width="300" height="180" style="float:right;"><br><br><br>MFC，多线程+进度条+复制文件（夹）小程序。<br><br><br> </div>

<a id="more"></a>
<p>　　多线程：</p>
<ol>
<li>做一个MFC对话框程序。</li>
<li>点击开始按钮，程序启动一个工作线程，复制指定的文件夹到目标位置。</li>
<li>同时在更新进度条，反映当前的复制进度（按文件数量计算进度）。</li>
<li>点击停止按钮时终止，但需要保证当前正在复制的文件得以复制完成。</li>
<li>工作线程访问主线程需要使用消息机制，不能直接访问。</li>
<li>主界面不能锁死，停止按钮需要随时可以响应点击。</li>
</ol>
<p>整体思路：<br>在开始按钮里的响应函数中创建一个线程，在线程里复制，通过消息机制更新进度条，在消息机制的函数中和复制过程关联显示进度。</p>
<p>需要解决的问题：<br>1.怎么创建线程<br>2.怎么更新进度条<br>3.怎么将编辑框中输入的路径被copyfile函数读取到<br>4.怎么获取文件个数（遍历）<br>5.怎么把进度条和复制文件进度关联<br>（通过文件个数 进度条范围设置为0-文件数量长度    步长为1 完成一次复制加一次）<br>6.点击取消怎么保证当前正在复制的文件得以复制完成</p>
<p>获取个数：<br>递归遍历整个文件夹，然后递归复制文件到目的文件夹。<br>在递归遍历整个文件夹的时候，就可以拿到整个文件夹的大小以及文件数量。</p>
<p>传递进度数据，用postmessage到该进度条的窗口，在进度条窗口获取该消息 设置SetPos，updatedata该控件。<br>一个对话框里有个进度条控件，当线程接收到数据（文件的总大小和收到的大小）postmessage给对话框，对话框的PreTranslateMessage(MSG* pMsg)截取该消息设置进度条控件（范围和增量，setpos）。</p>
<p>关键代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//复制函数</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">CopyDirectory</span><span class="params">(CString source, CString target, CCopyFoldersDlg * pDlg)</span>    </span></div><div class="line">&#123;</div><div class="line"> 	 </div><div class="line">	CreateDirectory(target,<span class="literal">NULL</span>);   </div><div class="line">  </div><div class="line">    CFileFind finder;    </div><div class="line">    CString path;    </div><div class="line">    path.Format(<span class="number">_</span>T(<span class="string">"%s\\*.*"</span>),source);    </div><div class="line">  </div><div class="line">    BOOL bWorking = finder.FindFile(path);    </div><div class="line">    <span class="keyword">while</span> (bWorking)  </div><div class="line">    &#123;   </div><div class="line">        bWorking = finder.FindNextFile();   </div><div class="line">           </div><div class="line">        <span class="keyword">if</span> (finder.IsDirectory() &amp;&amp; !finder.IsDots())  </div><div class="line">        &#123;   </div><div class="line">            CopyDirectory(finder.GetFilePath(), target+<span class="number">_</span>T(<span class="string">"\\"</span>)+finder.GetFileName(), pDlg);  <span class="comment">//递归 </span></div><div class="line">        &#125;    </div><div class="line">        <span class="keyword">else</span>  </div><div class="line">        &#123;      </div><div class="line"></div><div class="line">			WaitForSingleObject(pDlg-&gt;hEvent,INFINITE);</div><div class="line"></div><div class="line">            CopyFile(finder.GetFilePath(), target+<span class="number">_</span>T(<span class="string">"\\"</span>)+finder.GetFileName(), FALSE);   </div><div class="line">            count++;  </div><div class="line">            pDlg-&gt;PostMessage(WM_USER_PROCESS, count);  </div><div class="line">          </div><div class="line">  </div><div class="line">             Sleep(<span class="number">50</span>);   </div><div class="line">        &#125;   </div><div class="line">    &#125;    </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">VOID <span class="title">GetInfo</span><span class="params">(CString csPath, <span class="keyword">long</span>&amp; FoldersNum, <span class="keyword">long</span>&amp; FilesNum)</span>  </span></div><div class="line">&#123;     </div><div class="line">    SetCurrentDirectory(csPath);  </div><div class="line">    CFileFind finder;  </div><div class="line">    BOOL bWorking = finder.FindFile(<span class="number">_</span>T(<span class="string">"*.*"</span>));  </div><div class="line">    <span class="keyword">while</span>(bWorking)  </div><div class="line">    &#123;  </div><div class="line">        bWorking = finder.FindNextFile();  </div><div class="line">  </div><div class="line">        <span class="keyword">if</span>(finder.IsDots())   </div><div class="line">        &#123;  </div><div class="line">            <span class="keyword">continue</span>;  </div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(finder.IsDirectory())  </div><div class="line">        &#123;  </div><div class="line">            ++FoldersNum;  </div><div class="line">            GetInfo(finder.GetFilePath(), FoldersNum, FilesNum);  </div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">else</span>  </div><div class="line">        &#123;  </div><div class="line">            ++FilesNum;  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">&#125;  </div><div class="line"></div><div class="line"><span class="comment">//复制线程</span></div><div class="line">DWORD WINAPI CCopyFoldersDlg::CopyFolders(LPVOID pParam)</div><div class="line">&#123;  </div><div class="line">	CCopyFoldersDlg* pDlg = (CCopyFoldersDlg*)pParam;  </div><div class="line"></div><div class="line">	 <span class="keyword">if</span> (!pDlg) </div><div class="line">	 &#123;</div><div class="line">		 <span class="keyword">return</span> <span class="number">0</span>;  </div><div class="line">	 &#125;</div><div class="line">	 ResetEvent(pDlg-&gt;hExit);  </div><div class="line"></div><div class="line">	<span class="keyword">long</span> FoldersNum  = <span class="number">0</span>;                 </div><div class="line">    <span class="keyword">long</span> FilesNum = <span class="number">0</span>;                  </div><div class="line">    GetInfo(pDlg-&gt;m_SrcPath,FoldersNum, FilesNum);  </div><div class="line">	pDlg-&gt;m_Progress.SetRange(<span class="number">0</span>, FilesNum);  </div><div class="line">    pDlg-&gt;m_Progress.SetStep(<span class="number">1</span>); </div><div class="line">	CopyDirectory(pDlg-&gt;m_SrcPath, pDlg-&gt;m_DesPath, pDlg);   </div><div class="line"></div><div class="line">	SetEvent(pDlg-&gt;hExit);  </div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">LRESULT CCopyFoldersDlg::Do_process(WPARAM wParam, LPARAM lParam)   </div><div class="line">&#123;   </div><div class="line">   wParam += <span class="number">1</span>;  </div><div class="line">   m_Progress.SetPos(wParam);    </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;  </div><div class="line">&#125;         </div><div class="line">  </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">void</span> CCopyFoldersDlg::OnStart() </div><div class="line">&#123;</div><div class="line">	UpdateData(<span class="literal">true</span>);</div><div class="line"></div><div class="line">	<span class="keyword">if</span> ((m_SrcPath.IsEmpty() &amp;&amp; m_DesPath.IsEmpty()))</div><div class="line">	&#123;</div><div class="line">		MessageBox(<span class="string">"路径不能为空！"</span>);</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		<span class="comment">//创建线程</span></div><div class="line">		hThread = CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, CopyFolders, <span class="keyword">this</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</div><div class="line">		hEvent = CreateEvent(<span class="literal">NULL</span>, TRUE, TRUE, <span class="literal">NULL</span>);</div><div class="line">		CloseHandle(hThread);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">void</span> CCopyFoldersDlg::OnStop() </div><div class="line">&#123;</div><div class="line">	m_iStatus++;  </div><div class="line">         </div><div class="line">    <span class="keyword">if</span> (m_iStatus % <span class="number">2</span> == <span class="number">0</span>)  </div><div class="line">    &#123;    </div><div class="line">         SetEvent(hEvent);</div><div class="line">    &#125;   </div><div class="line">    <span class="keyword">else</span>  </div><div class="line">    &#123;  </div><div class="line">        ResetEvent(hEvent);</div><div class="line">    &#125;  </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CCopyFoldersDlg::OnTimer(UINT_PTR nIDEvent)  </div><div class="line">&#123;  </div><div class="line">    CDialog::OnTimer(nIDEvent);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>界面：<br><img src="http://img.blog.csdn.net/20170615182222589?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="界面"></p>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=1049830277,1612840852&amp;fm=26&amp;gp=0.jpg&quot; width=&quot;300&quot; height=&quot;180&quot; style=&quot;float:right;&quot;/&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;MFC，多线程+进度条+复制文件（夹）小程序。&lt;br&gt;&lt;br&gt;&lt;br&gt; &lt;/div&gt;
    
    </summary>
    
      <category term="互联网" scheme="http://hubojing.github.io/categories/%E4%BA%92%E8%81%94%E7%BD%91/"/>
    
    
      <category term="MFC 多线程" scheme="http://hubojing.github.io/tags/MFC-%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>MFC网页分析程序</title>
    <link href="http://hubojing.github.io/2017/06/14/MFC%E7%BD%91%E9%A1%B5%E5%88%86%E6%9E%90%E7%A8%8B%E5%BA%8F/"/>
    <id>http://hubojing.github.io/2017/06/14/MFC网页分析程序/</id>
    <published>2017-06-14T14:45:38.000Z</published>
    <updated>2017-07-05T15:43:15.322Z</updated>
    
    <content type="html"><![CDATA[<div align="left"><br><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1497464380109&di=1e9f39d0b13b850e8ec21fd0e1f0f262&imgtype=0&src=http%3A%2F%2Fimg.weixinyidu.com%2F151130%2F39b5d6c2.jpg" width="300" height="180" style="float:right;"><br><br><br> 开发一个网页分析程序，可以抓取特定网页的内容，加以分析之后将结果保存之数据库。<br><br><br> </div>

<a id="more"></a>
<p>网页分析程序具体要求描述如下：<br>1.使用http技术获取一个博客的首页<a href="http://blog.csdn.net/jiangsheng" target="_blank" rel="external">http://blog.csdn.net/jiangsheng</a><br>2.分析这个网页的内容，从中找到博客中每一篇文章的链接。<br>3.通过这些链接，获取文章的正文网页，从内容中提取文章的标题和文章的内容。<br>4.将文章的标题与内容分别保存至数据库。<br>5.布局要求：提供一个列表框和一个多行文本框。列表框中显示从数据库中获取的文章标题列表；当点击列表框中的某一篇文章时，在文本框中显示该文章的内容。</p>
<p>首先实现获取网页源码的功能：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CGetWebDlg::OnGetweb() </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></div><div class="line">	CInternetSession session;</div><div class="line">	CHttpFile *file = <span class="literal">NULL</span>; </div><div class="line">	CString strURL = <span class="string">"http://blog.csdn.net/jiangsheng"</span>;</div><div class="line">    CString strHtml = <span class="number">_</span>T(<span class="string">""</span>); <span class="comment">//存放网页数据</span></div><div class="line"> <span class="keyword">try</span></div><div class="line"> &#123; </div><div class="line">  </div><div class="line">	file =(CHttpFile*)session.OpenURL(strURL);</div><div class="line"> &#125; </div><div class="line"><span class="keyword">catch</span>(CInternetException *m_pException)</div><div class="line"> &#123; </div><div class="line">	file = <span class="literal">NULL</span>;</div><div class="line">	m_pException-&gt;m_dwError;</div><div class="line">	m_pException-&gt;Delete();</div><div class="line">	session.Close();</div><div class="line">	MessageBox(<span class="string">"网络连接错误"</span>,<span class="string">"提示"</span>);</div><div class="line">	<span class="keyword">return</span>;</div><div class="line"> &#125;</div><div class="line">	CString strLine;</div><div class="line">	<span class="keyword">char</span> sRecived[<span class="number">1024</span>];</div><div class="line">	<span class="keyword">if</span> (file != <span class="literal">NULL</span>) </div><div class="line">	&#123;</div><div class="line">		<span class="keyword">while</span>(file-&gt;ReadString((LPTSTR)sRecived,<span class="number">1024</span>)!=<span class="literal">NULL</span>) </div><div class="line">		&#123;</div><div class="line">			strHtml += sRecived; </div><div class="line">		&#125;</div><div class="line"> &#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123; </div><div class="line">		AfxMessageBox(<span class="number">_</span>T(<span class="string">"失败！"</span>));</div><div class="line">	&#125;</div><div class="line">        session.Close();</div><div class="line">		file-&gt;Close();</div><div class="line">		<span class="keyword">delete</span> file; </div><div class="line">		file = <span class="literal">NULL</span>;</div><div class="line"></div><div class="line">		ConvertUtf8ToGBK(strHtml);<span class="comment">//源码转换</span></div><div class="line">		(<span class="keyword">this</span>-&gt;GetDlgItem(IDC_EDITCONTENT))-&gt;SetWindowText(strHtml);</div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注意网页编码问题，因此需要格式转换，编写一个函数：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span>  <span class="title">ConvertUtf8ToGBK</span><span class="params">(CString &amp;strUtf8)</span></span></div><div class="line">&#123;</div><div class="line">          </div><div class="line">    <span class="keyword">int</span> len=MultiByteToWideChar(CP_UTF8, <span class="number">0</span>, (LPCTSTR)strUtf8, <span class="number">-1</span>, <span class="literal">NULL</span>,<span class="number">0</span>);</div><div class="line">	<span class="keyword">unsigned</span> <span class="keyword">short</span> * wszGBK = <span class="keyword">new</span> <span class="keyword">unsigned</span> <span class="keyword">short</span>[len+<span class="number">1</span>];</div><div class="line">	<span class="built_in">memset</span>(wszGBK, <span class="number">0</span>, len * <span class="number">2</span> + <span class="number">2</span>);</div><div class="line">	MultiByteToWideChar(CP_UTF8, <span class="number">0</span>, (LPCTSTR)strUtf8, <span class="number">-1</span>, (LPWSTR)wszGBK, len);</div><div class="line"> </div><div class="line">	len = WideCharToMultiByte(CP_ACP, <span class="number">0</span>, (LPCWSTR)wszGBK, <span class="number">-1</span>, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>); </div><div class="line">	<span class="keyword">char</span> *szGBK=<span class="keyword">new</span> <span class="keyword">char</span>[len + <span class="number">1</span>];</div><div class="line">	<span class="built_in">memset</span>(szGBK, <span class="number">0</span>, len + <span class="number">1</span>);</div><div class="line">	WideCharToMultiByte (CP_ACP, <span class="number">0</span>, (LPCWSTR)wszGBK, <span class="number">-1</span>, szGBK, len, <span class="literal">NULL</span>,<span class="literal">NULL</span>);</div><div class="line"> </div><div class="line">	strUtf8 = szGBK;</div><div class="line">	 <span class="keyword">delete</span>[] szGBK;</div><div class="line">	 <span class="keyword">delete</span>[] wszGBK;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="http://img.blog.csdn.net/20170614232311302?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="显示源码"></p>
<p>有些类似网页爬虫的感觉。<br><del>为了接下来的操作，我去学正则表达式了……</del></p>
<p>还是学习html解析库 htmlcxx<br><a href="http://blog.csdn.net/youfangyuan/article/details/7816518" target="_blank" rel="external">HtmlCxx用户手册</a><br>编译成功就好，把htmlcxx.lib和html文件夹拷贝到所需的工程中。</p>
<p>由于我刚开始是用VC6.0创建项目，现在用VS2013打开，因此，提示报错：<br>error MSB8031: Building an MFC project for a non-Unicode character set is deprecated. You must change the project property to Unicode or download an additional library. See <a href="http://go.microsoft.com/fwlink/p/?LinkId=286820" target="_blank" rel="external">http://go.microsoft.com/fwlink/p/?LinkId=286820</a> for more information.</p>
<p>解决：用于多字节字符编码 (MBCS) 的 MFC 库 (DLL) 不再包含于 Visual Studio 中，但是可用作插件，您可以在任何装有 Visual Studio Professional、Visual Studio Premium 或 Visual Studio Ultimate 的计算机上下载和安装。下载地址：<a href="https://www.microsoft.com/zh-cn/download/details.aspx?id=40770" target="_blank" rel="external">https://www.microsoft.com/zh-cn/download/details.aspx?id=40770</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1497464380109&amp;di=1e9f39d0b13b850e8ec21fd0e1f0f262&amp;imgtype=0&amp;src=http%3A%2F%2Fimg.weixinyidu.com%2F151130%2F39b5d6c2.jpg&quot; width=&quot;300&quot; height=&quot;180&quot; style=&quot;float:right;&quot;/&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt; 开发一个网页分析程序，可以抓取特定网页的内容，加以分析之后将结果保存之数据库。&lt;br&gt;&lt;br&gt;&lt;br&gt; &lt;/div&gt;
    
    </summary>
    
      <category term="互联网" scheme="http://hubojing.github.io/categories/%E4%BA%92%E8%81%94%E7%BD%91/"/>
    
    
      <category term="MFC 爬虫" scheme="http://hubojing.github.io/tags/MFC-%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>Socket点对点聊天+文件传输</title>
    <link href="http://hubojing.github.io/2017/05/07/Socket%E7%82%B9%E5%AF%B9%E7%82%B9%E8%81%8A%E5%A4%A9-%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93/"/>
    <id>http://hubojing.github.io/2017/05/07/Socket点对点聊天-文件传输/</id>
    <published>2017-05-07T14:58:30.000Z</published>
    <updated>2017-05-28T14:29:34.000Z</updated>
    
    <content type="html"><![CDATA[<div align="left"><br><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1494249495796&di=6e913a58ff8ec3713e96983683e150b8&imgtype=0&src=http%3A%2F%2Fimg.my.csdn.net%2Fuploads%2F201304%2F08%2F1365431054_1015.png" width="300" height="180" style="float:right;"><br><br><br>　Socket编程。　<br><br><br> </div>

<a id="more"></a>
<p>socket:<br>设计一个点对点聊天小程序。</p>
<ol>
<li>使用原生socket api实现，<strong>即不使用MFC中的socket类</strong>，也不使用其他高级socket框架</li>
<li>需要先设计一套协议</li>
<li>有GUI界面</li>
<li>可互相传递文字和文件</li>
<li>即时反应对方的在线还是离线</li>
</ol>
<h1 id="初级版"><a href="#初级版" class="headerlink" title="初级版"></a>初级版</h1><p>1.在应用程序类重载的InitInstance函数中调用AfxSocketInit()函数，加载套接字。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(!AfxSocketInit())</div><div class="line">&#123;</div><div class="line">    AfxMessageBox(<span class="string">"加载套接字库失败！"</span>);</div><div class="line">    <span class="keyword">return</span> FALSE;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.在你的对话框类中添加如下函数InitSocket()，初始化套接字</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">BOOL CChatDlg::InitSocket()</div><div class="line">&#123;</div><div class="line">    m_socket=socket(AF_INET,SOCK_DGRAM,<span class="number">0</span>);</div><div class="line">    <span class="keyword">if</span>(INVALID_SOCKET==m_socket)</div><div class="line">    &#123;</div><div class="line">        MessageBox(<span class="string">"套接字创建失败！"</span>);</div><div class="line">        <span class="keyword">return</span> FALSE;</div><div class="line">    &#125;</div><div class="line">    SOCKADDR_IN addrSock;</div><div class="line">    addrSock.sin_family=AF_INET;</div><div class="line">    addrSock.sin_port=htons(<span class="number">5000</span>);</div><div class="line">    addrSock.sin_addr.S_un.S_addr=htonl(INADDR_ANY);</div><div class="line"> </div><div class="line">    <span class="keyword">int</span> retval;</div><div class="line">    retval=bind(m_socket,(SOCKADDR*)&amp;addrSock,<span class="keyword">sizeof</span>(SOCKADDR));</div><div class="line">    <span class="keyword">if</span>(SOCKET_ERROR==retval)</div><div class="line">    &#123;</div><div class="line">        closesocket(m_socket);</div><div class="line">        MessageBox(<span class="string">"绑定失败!"</span>);</div><div class="line">        <span class="keyword">return</span> FALSE;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> TRUE;</div><div class="line"> </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>3.在对话框类的OnInitDialog()函数中调用上述InitSocket()函数，初始化套接字，同时创建一个线程接收数据：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">RECVPARAM *pRecvParam=<span class="keyword">new</span> RECVPARAM;</div><div class="line">pRecvParam-&gt;sock=m_socket;</div><div class="line">pRecvParam-&gt;hwnd=m_hWnd;</div><div class="line">HANDLE hThread=CreateThread(<span class="literal">NULL</span>,<span class="number">0</span>,RecvProc,(LPVOID)pRecvParam,<span class="number">0</span>,<span class="literal">NULL</span>);</div><div class="line">CloseHandle(hThread);</div></pre></td></tr></table></figure>
<p>其中</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> RECVPARAM</div><div class="line">&#123;</div><div class="line">    SOCKET sock;</div><div class="line">    HWND hwnd;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>是自定义结构体</p>
<p>4.接收线程函数RecvProc:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">DWORD WINAPI CChatDlg::RecvProc(LPVOID lpParameter)</div><div class="line">&#123;</div><div class="line">    SOCKET sock=((RECVPARAM*)lpParameter)-&gt;sock;</div><div class="line">    HWND hwnd=((RECVPARAM*)lpParameter)-&gt;hwnd;</div><div class="line">    <span class="keyword">delete</span> lpParameter;   </div><div class="line">    SOCKADDR_IN addrFrom;</div><div class="line">    <span class="keyword">int</span> len=<span class="keyword">sizeof</span>(SOCKADDR); </div><div class="line">    <span class="keyword">char</span> recvBuf[<span class="number">200</span>];</div><div class="line">    <span class="keyword">int</span> retval;</div><div class="line">    <span class="keyword">while</span>(TRUE)</div><div class="line">    &#123;</div><div class="line">        retval=recvfrom(sock,recvBuf,<span class="number">200</span>,<span class="number">0</span>,(SOCKADDR*)&amp;addrFrom,&amp;len);</div><div class="line">        <span class="keyword">if</span>(SOCKET_ERROR==retval)</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>recvBuf中就保存了你要的数据。<br><img src="http://img.blog.csdn.net/20170508183259821?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="初级版"></p>
<h1 id="中级版"><a href="#中级版" class="headerlink" title="中级版"></a>中级版</h1><h2 id="界面"><a href="#界面" class="headerlink" title="界面"></a>界面</h2><p><img src="http://img.blog.csdn.net/20170508181716901?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="原始界面"></p>
<p>聊天：<br><img src="http://img.blog.csdn.net/20170508181451922?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="TCP"></p>
<p>传文件：<br>服务器<br><img src="http://img.blog.csdn.net/20170508181526914?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="传文件"></p>
<p>客户端<br><img src="http://img.blog.csdn.net/20170508181625735?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="传文件2"></p>
<p>显示文件传输进度：<br><img src="http://img.blog.csdn.net/20170508181907845?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="传输过程"></p>
<p>传输成功，可以正常打开文件。<br><img src="http://img.blog.csdn.net/20170508181937814?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="传输成功"></p>
<p>下线：<br><img src="http://img.blog.csdn.net/20170508182031143?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="下线"></p>
<p>关于：<br><img src="http://img.blog.csdn.net/20170508182628147?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="关于"></p>
<p>源程序：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div><div class="line">620</div><div class="line">621</div><div class="line">622</div><div class="line">623</div><div class="line">624</div><div class="line">625</div><div class="line">626</div><div class="line">627</div><div class="line">628</div><div class="line">629</div><div class="line">630</div><div class="line">631</div><div class="line">632</div><div class="line">633</div><div class="line">634</div><div class="line">635</div><div class="line">636</div><div class="line">637</div><div class="line">638</div><div class="line">639</div><div class="line">640</div><div class="line">641</div><div class="line">642</div><div class="line">643</div><div class="line">644</div><div class="line">645</div><div class="line">646</div><div class="line">647</div><div class="line">648</div><div class="line">649</div><div class="line">650</div><div class="line">651</div><div class="line">652</div><div class="line">653</div><div class="line">654</div><div class="line">655</div><div class="line">656</div><div class="line">657</div><div class="line">658</div><div class="line">659</div><div class="line">660</div><div class="line">661</div><div class="line">662</div><div class="line">663</div><div class="line">664</div><div class="line">665</div><div class="line">666</div><div class="line">667</div><div class="line">668</div><div class="line">669</div><div class="line">670</div><div class="line">671</div><div class="line">672</div><div class="line">673</div><div class="line">674</div><div class="line">675</div><div class="line">676</div><div class="line">677</div><div class="line">678</div><div class="line">679</div><div class="line">680</div><div class="line">681</div><div class="line">682</div><div class="line">683</div><div class="line">684</div><div class="line">685</div><div class="line">686</div><div class="line">687</div><div class="line">688</div><div class="line">689</div><div class="line">690</div><div class="line">691</div><div class="line">692</div><div class="line">693</div><div class="line">694</div><div class="line">695</div><div class="line">696</div><div class="line">697</div><div class="line">698</div><div class="line">699</div><div class="line">700</div><div class="line">701</div><div class="line">702</div><div class="line">703</div><div class="line">704</div><div class="line">705</div><div class="line">706</div><div class="line">707</div><div class="line">708</div><div class="line">709</div><div class="line">710</div><div class="line">711</div><div class="line">712</div><div class="line">713</div><div class="line">714</div><div class="line">715</div><div class="line">716</div><div class="line">717</div><div class="line">718</div><div class="line">719</div><div class="line">720</div><div class="line">721</div><div class="line">722</div><div class="line">723</div><div class="line">724</div><div class="line">725</div><div class="line">726</div><div class="line">727</div><div class="line">728</div><div class="line">729</div><div class="line">730</div><div class="line">731</div><div class="line">732</div><div class="line">733</div><div class="line">734</div><div class="line">735</div><div class="line">736</div><div class="line">737</div><div class="line">738</div><div class="line">739</div><div class="line">740</div><div class="line">741</div><div class="line">742</div><div class="line">743</div><div class="line">744</div><div class="line">745</div><div class="line">746</div><div class="line">747</div><div class="line">748</div><div class="line">749</div><div class="line">750</div><div class="line">751</div><div class="line">752</div><div class="line">753</div><div class="line">754</div><div class="line">755</div><div class="line">756</div><div class="line">757</div><div class="line">758</div><div class="line">759</div><div class="line">760</div><div class="line">761</div><div class="line">762</div><div class="line">763</div><div class="line">764</div><div class="line">765</div><div class="line">766</div><div class="line">767</div><div class="line">768</div><div class="line">769</div><div class="line">770</div><div class="line">771</div><div class="line">772</div><div class="line">773</div><div class="line">774</div><div class="line">775</div><div class="line">776</div><div class="line">777</div><div class="line">778</div><div class="line">779</div><div class="line">780</div><div class="line">781</div><div class="line">782</div><div class="line">783</div><div class="line">784</div><div class="line">785</div><div class="line">786</div><div class="line">787</div><div class="line">788</div><div class="line">789</div><div class="line">790</div><div class="line">791</div><div class="line">792</div><div class="line">793</div><div class="line">794</div><div class="line">795</div><div class="line">796</div><div class="line">797</div><div class="line">798</div><div class="line">799</div><div class="line">800</div><div class="line">801</div><div class="line">802</div><div class="line">803</div><div class="line">804</div><div class="line">805</div><div class="line">806</div><div class="line">807</div><div class="line">808</div><div class="line">809</div><div class="line">810</div><div class="line">811</div><div class="line">812</div><div class="line">813</div><div class="line">814</div><div class="line">815</div><div class="line">816</div><div class="line">817</div><div class="line">818</div><div class="line">819</div><div class="line">820</div><div class="line">821</div><div class="line">822</div><div class="line">823</div><div class="line">824</div><div class="line">825</div><div class="line">826</div><div class="line">827</div><div class="line">828</div><div class="line">829</div><div class="line">830</div><div class="line">831</div><div class="line">832</div><div class="line">833</div><div class="line">834</div><div class="line">835</div><div class="line">836</div><div class="line">837</div><div class="line">838</div><div class="line">839</div><div class="line">840</div><div class="line">841</div><div class="line">842</div><div class="line">843</div><div class="line">844</div><div class="line">845</div><div class="line">846</div><div class="line">847</div><div class="line">848</div><div class="line">849</div><div class="line">850</div><div class="line">851</div><div class="line">852</div><div class="line">853</div><div class="line">854</div><div class="line">855</div><div class="line">856</div><div class="line">857</div><div class="line">858</div><div class="line">859</div><div class="line">860</div><div class="line">861</div><div class="line">862</div><div class="line">863</div><div class="line">864</div><div class="line">865</div><div class="line">866</div><div class="line">867</div><div class="line">868</div><div class="line">869</div><div class="line">870</div><div class="line">871</div><div class="line">872</div><div class="line">873</div><div class="line">874</div><div class="line">875</div><div class="line">876</div><div class="line">877</div><div class="line">878</div><div class="line">879</div><div class="line">880</div><div class="line">881</div><div class="line">882</div><div class="line">883</div><div class="line">884</div><div class="line">885</div><div class="line">886</div><div class="line">887</div><div class="line">888</div><div class="line">889</div><div class="line">890</div><div class="line">891</div><div class="line">892</div><div class="line">893</div><div class="line">894</div><div class="line">895</div><div class="line">896</div><div class="line">897</div><div class="line">898</div><div class="line">899</div><div class="line">900</div><div class="line">901</div><div class="line">902</div><div class="line">903</div><div class="line">904</div><div class="line">905</div><div class="line">906</div><div class="line">907</div><div class="line">908</div><div class="line">909</div><div class="line">910</div><div class="line">911</div><div class="line">912</div><div class="line">913</div><div class="line">914</div><div class="line">915</div><div class="line">916</div><div class="line">917</div><div class="line">918</div><div class="line">919</div><div class="line">920</div><div class="line">921</div><div class="line">922</div><div class="line">923</div><div class="line">924</div><div class="line">925</div><div class="line">926</div><div class="line">927</div><div class="line">928</div><div class="line">929</div><div class="line">930</div><div class="line">931</div><div class="line">932</div><div class="line">933</div><div class="line">934</div><div class="line">935</div><div class="line">936</div><div class="line">937</div><div class="line">938</div><div class="line">939</div><div class="line">940</div><div class="line">941</div><div class="line">942</div><div class="line">943</div><div class="line">944</div><div class="line">945</div><div class="line">946</div><div class="line">947</div><div class="line">948</div><div class="line">949</div><div class="line">950</div><div class="line">951</div><div class="line">952</div><div class="line">953</div><div class="line">954</div><div class="line">955</div><div class="line">956</div><div class="line">957</div><div class="line">958</div><div class="line">959</div><div class="line">960</div><div class="line">961</div><div class="line">962</div><div class="line">963</div><div class="line">964</div><div class="line">965</div><div class="line">966</div><div class="line">967</div><div class="line">968</div><div class="line">969</div><div class="line">970</div><div class="line">971</div><div class="line">972</div><div class="line">973</div><div class="line">974</div><div class="line">975</div><div class="line">976</div><div class="line">977</div><div class="line">978</div><div class="line">979</div><div class="line">980</div><div class="line">981</div><div class="line">982</div><div class="line">983</div><div class="line">984</div><div class="line">985</div><div class="line">986</div><div class="line">987</div><div class="line">988</div><div class="line">989</div><div class="line">990</div><div class="line">991</div><div class="line">992</div><div class="line">993</div><div class="line">994</div><div class="line">995</div><div class="line">996</div><div class="line">997</div><div class="line">998</div><div class="line">999</div><div class="line">1000</div><div class="line">1001</div><div class="line">1002</div><div class="line">1003</div><div class="line">1004</div><div class="line">1005</div><div class="line">1006</div><div class="line">1007</div><div class="line">1008</div><div class="line">1009</div><div class="line">1010</div><div class="line">1011</div><div class="line">1012</div><div class="line">1013</div><div class="line">1014</div><div class="line">1015</div><div class="line">1016</div><div class="line">1017</div><div class="line">1018</div><div class="line">1019</div><div class="line">1020</div><div class="line">1021</div><div class="line">1022</div><div class="line">1023</div><div class="line">1024</div><div class="line">1025</div><div class="line">1026</div><div class="line">1027</div><div class="line">1028</div><div class="line">1029</div><div class="line">1030</div><div class="line">1031</div><div class="line">1032</div><div class="line">1033</div><div class="line">1034</div><div class="line">1035</div><div class="line">1036</div><div class="line">1037</div><div class="line">1038</div><div class="line">1039</div><div class="line">1040</div><div class="line">1041</div><div class="line">1042</div><div class="line">1043</div><div class="line">1044</div><div class="line">1045</div><div class="line">1046</div><div class="line">1047</div><div class="line">1048</div><div class="line">1049</div><div class="line">1050</div><div class="line">1051</div><div class="line">1052</div><div class="line">1053</div><div class="line">1054</div><div class="line">1055</div><div class="line">1056</div><div class="line">1057</div><div class="line">1058</div><div class="line">1059</div><div class="line">1060</div><div class="line">1061</div><div class="line">1062</div><div class="line">1063</div><div class="line">1064</div><div class="line">1065</div><div class="line">1066</div><div class="line">1067</div><div class="line">1068</div><div class="line">1069</div><div class="line">1070</div><div class="line">1071</div><div class="line">1072</div><div class="line">1073</div><div class="line">1074</div><div class="line">1075</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// traDlg.cpp : implementation file</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdafx.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"tra.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"traDlg.h"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _DEBUG</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> new DEBUG_NEW</span></div><div class="line"><span class="meta">#<span class="meta-keyword">undef</span> THIS_FILE</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">char</span> THIS_FILE[] = <span class="number">__F</span>ILE__;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;dlgs.h&gt;</span></span></div><div class="line"><span class="comment">/////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><span class="comment">// CAboutDlg dialog used for App About</span></div><div class="line"></div><div class="line"><span class="keyword">class</span> CAboutDlg : <span class="keyword">public</span> CDialog</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">	CAboutDlg();</div><div class="line">	</div><div class="line">	<span class="comment">// Dialog Data</span></div><div class="line">	<span class="comment">//&#123;&#123;AFX_DATA(CAboutDlg)</span></div><div class="line">	<span class="keyword">enum</span> &#123; IDD = IDD_ABOUTBOX &#125;;</div><div class="line">	<span class="comment">//&#125;&#125;AFX_DATA</span></div><div class="line">	</div><div class="line">	<span class="comment">// ClassWizard generated virtual function overrides</span></div><div class="line">	<span class="comment">//&#123;&#123;AFX_VIRTUAL(CAboutDlg)</span></div><div class="line"><span class="keyword">protected</span>:</div><div class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">DoDataExchange</span><span class="params">(CDataExchange* pDX)</span></span>;    <span class="comment">// DDX/DDV support</span></div><div class="line">	<span class="comment">//&#125;&#125;AFX_VIRTUAL</span></div><div class="line">	</div><div class="line">	<span class="comment">// Implementation</span></div><div class="line"><span class="keyword">protected</span>:</div><div class="line">	<span class="comment">//&#123;&#123;AFX_MSG(CAboutDlg)</span></div><div class="line">	<span class="comment">//&#125;&#125;AFX_MSG</span></div><div class="line">	DECLARE_MESSAGE_MAP()</div><div class="line">&#125;;</div><div class="line"></div><div class="line">CAboutDlg::CAboutDlg() : CDialog(CAboutDlg::IDD)</div><div class="line">&#123;</div><div class="line">	<span class="comment">//&#123;&#123;AFX_DATA_INIT(CAboutDlg)</span></div><div class="line">	<span class="comment">//&#125;&#125;AFX_DATA_INIT</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CAboutDlg::DoDataExchange(CDataExchange* pDX)</div><div class="line">&#123;</div><div class="line">	CDialog::DoDataExchange(pDX);</div><div class="line">	<span class="comment">//&#123;&#123;AFX_DATA_MAP(CAboutDlg)</span></div><div class="line">	<span class="comment">//&#125;&#125;AFX_DATA_MAP</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">BEGIN_MESSAGE_MAP(CAboutDlg, CDialog)</div><div class="line"><span class="comment">//&#123;&#123;AFX_MSG_MAP(CAboutDlg)</span></div><div class="line"><span class="comment">// No message handlers</span></div><div class="line"><span class="comment">//&#125;&#125;AFX_MSG_MAP</span></div><div class="line">END_MESSAGE_MAP()</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><span class="comment">// CtraDlg dialog</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> PORT		34567</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> FLAG		2</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SIZEFILE	1024</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> SOCK_TCP	= <span class="number">0</span>;	<span class="comment">//TCP模式</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> SOCK_UDP  = <span class="number">1</span>;	<span class="comment">//UDP模式</span></div><div class="line"></div><div class="line">CWinThread	*pThreadSendFile;	<span class="comment">//发送文件线程--&gt;_SendFileThread</span></div><div class="line">CWinThread	*pThreadSendMsg;		<span class="comment">//发送消息线程</span></div><div class="line">CWinThread	*pThreadLisen;		<span class="comment">//监听线程--&gt;_ListenTcpThread</span></div><div class="line">CWinThread	*pReceiveThread;		<span class="comment">//接受线程--&gt;_ReceiveThread</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//////////////////////////////////////////////////////////////////////////////</span></div><div class="line"></div><div class="line"></div><div class="line">CtraDlg::CtraDlg(CWnd* pParent <span class="comment">/*=NULL*/</span>)</div><div class="line">: CDialog(CtraDlg::IDD, pParent)</div><div class="line">&#123;</div><div class="line">	<span class="comment">//&#123;&#123;AFX_DATA_INIT(CtraDlg)</span></div><div class="line">	m_MsgSend = <span class="number">_</span>T(<span class="string">""</span>);</div><div class="line">	<span class="comment">//&#125;&#125;AFX_DATA_INIT</span></div><div class="line">	<span class="comment">// Note that LoadIcon does not require a subsequent DestroyIcon in Win32</span></div><div class="line">	m_hIcon = AfxGetApp()-&gt;LoadIcon(IDR_MAINFRAME);</div><div class="line">	m_nSockType = <span class="number">0</span>;<span class="comment">//TCP</span></div><div class="line">	m_WorkType = <span class="number">2</span>;<span class="comment">//两者</span></div><div class="line">	m_client = <span class="number">0</span>;</div><div class="line">	m_server = <span class="number">0</span>;</div><div class="line">	FileWork = <span class="literal">false</span>;</div><div class="line">	FileStop = <span class="literal">false</span>;</div><div class="line">	StopServer = <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CtraDlg::DoDataExchange(CDataExchange* pDX)</div><div class="line">&#123;</div><div class="line">	CDialog::DoDataExchange(pDX);</div><div class="line">	<span class="comment">//&#123;&#123;AFX_DATA_MAP(CtraDlg)</span></div><div class="line">	DDX_Control(pDX, IDC_PROGRESS_SEND_FILE, m_Progress);</div><div class="line">	DDX_Control(pDX, IDC_LIST_BOX_ADDMSG, m_AddMsgLIst);</div><div class="line">	DDX_Control(pDX, IDC_IPADDRESS, m_You_IP);</div><div class="line">	DDX_Text(pDX, IDC_EDIT_SENDMSG, m_MsgSend);</div><div class="line">	<span class="comment">//&#125;&#125;AFX_DATA_MAP</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">BEGIN_MESSAGE_MAP(CtraDlg, CDialog)</div><div class="line"><span class="comment">//&#123;&#123;AFX_MSG_MAP(CtraDlg)</span></div><div class="line">ON_WM_SYSCOMMAND()</div><div class="line">ON_WM_PAINT()</div><div class="line">ON_WM_QUERYDRAGICON()</div><div class="line">ON_BN_CLICKED(IDC_BUTTON_CONNECT, OnButtonConnect)</div><div class="line">ON_BN_CLICKED(IDC_BUTTON_DISCONNECT, OnButtonDisconnect)</div><div class="line">ON_BN_CLICKED(IDC_BUTTON_SEND_MSG, OnButtonSendMsg)</div><div class="line">ON_BN_CLICKED(IDC_BUTTON_SEND_FILE, OnButtonSendFile)</div><div class="line">ON_BN_CLICKED(IDC_BUTTON_CLEAR, OnButtonClear)</div><div class="line">ON_BN_CLICKED(IDC_RADIO_TCP, OnRadioTcp)</div><div class="line">ON_BN_CLICKED(IDC_RADIO_UDP, OnRadioUdp)</div><div class="line">ON_BN_CLICKED(IDC_RADIO_SERVER, OnRadioServer)</div><div class="line">ON_BN_CLICKED(IDC_RADIO_CLIENT, OnRadioClient)</div><div class="line">ON_BN_CLICKED(IDC_RADIO_BOTH, OnRadioBoth)</div><div class="line">ON_BN_CLICKED(IDC_BUTTON_STOP_FILE, OnButtonStopFile)</div><div class="line">ON_MESSAGE(WM_KSEND,OnKSend)</div><div class="line"><span class="comment">//ON_BN_CLICKED(IDC_BUTTON_CAPUTER, OnButtonCaputer)</span></div><div class="line"><span class="comment">//&#125;&#125;AFX_MSG_MAP</span></div><div class="line">END_MESSAGE_MAP()</div><div class="line"></div><div class="line"><span class="comment">/////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><span class="comment">// CtraDlg message handlers</span></div><div class="line"></div><div class="line">BOOL CtraDlg::OnInitDialog()</div><div class="line">&#123;</div><div class="line">	CDialog::OnInitDialog();</div><div class="line">	</div><div class="line">	<span class="comment">// Add "About..." menu item to system menu.</span></div><div class="line">	</div><div class="line">	<span class="comment">// IDM_ABOUTBOX must be in the system command range.</span></div><div class="line">	ASSERT((IDM_ABOUTBOX &amp; <span class="number">0xFFF0</span>) == IDM_ABOUTBOX);</div><div class="line">	ASSERT(IDM_ABOUTBOX &lt; <span class="number">0xF000</span>);</div><div class="line">	</div><div class="line">	CMenu* pSysMenu = GetSystemMenu(FALSE);</div><div class="line">	<span class="keyword">if</span> (pSysMenu != <span class="literal">NULL</span>)</div><div class="line">	&#123;</div><div class="line">		CString strAboutMenu;</div><div class="line">		strAboutMenu.LoadString(IDS_ABOUTBOX);</div><div class="line">		<span class="keyword">if</span> (!strAboutMenu.IsEmpty())</div><div class="line">		&#123;</div><div class="line">			pSysMenu-&gt;AppendMenu(MF_SEPARATOR);</div><div class="line">			pSysMenu-&gt;AppendMenu(MF_STRING, IDM_ABOUTBOX, strAboutMenu);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">// Set the icon for this dialog.  The framework does this automatically</span></div><div class="line">	<span class="comment">//  when the application's main window is not a dialog</span></div><div class="line">	SetIcon(m_hIcon, TRUE);			<span class="comment">// Set big icon</span></div><div class="line">	SetIcon(m_hIcon, FALSE);		<span class="comment">// Set small icon</span></div><div class="line">	</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add extra initialization here</span></div><div class="line">	<span class="comment">/////////////////////////////////////////////////////////</span></div><div class="line">	CString strLocalName;</div><div class="line">	GetLocalHostName(strLocalName);</div><div class="line">	CString strLocalIP;</div><div class="line">	GetIpAddress(strLocalName,strLocalIP);</div><div class="line">	m_You_IP.SetWindowText(<span class="string">"127.0.0.1"</span>);	<span class="comment">//设置默认IP</span></div><div class="line">	<span class="comment">/////////////////////////////////////////////////////////</span></div><div class="line">	((CButton*)GetDlgItem(IDC_RADIO_BOTH))-&gt;SetCheck(BST_CHECKED);<span class="comment">//默认为服务器、客户端一体</span></div><div class="line">	SetWindowText(<span class="string">"博靖牌聊天+文件传输小工具"</span>);</div><div class="line"></div><div class="line">	GetDlgItem(IDC_BUTTON_CONNECT)-&gt;SetWindowText(<span class="string">"启动"</span>);</div><div class="line">	GetDlgItem(IDC_BUTTON_DISCONNECT)-&gt;SetWindowText(<span class="string">"关闭"</span>);</div><div class="line">	</div><div class="line">	<span class="comment">//GetDlgItem(IDC_BUTTON_CAPUTER)-&gt;EnableWindow(false);//默认为不可用</span></div><div class="line">	((CButton*)GetDlgItem(IDC_RADIO_TCP))-&gt;SetCheck(BST_CHECKED);<span class="comment">//默认为TCP</span></div><div class="line">	GetDlgItem(IDC_BUTTON_SEND_MSG)-&gt;EnableWindow(<span class="literal">false</span>);<span class="comment">//发送消息不可用</span></div><div class="line">	GetDlgItem(IDC_BUTTON_SEND_FILE)-&gt;EnableWindow(<span class="literal">false</span>);<span class="comment">//发送文件不可用</span></div><div class="line">	GetDlgItem(IDC_BUTTON_CLEAR)-&gt;EnableWindow(<span class="literal">false</span>);<span class="comment">//清除不可用</span></div><div class="line">	GetDlgItem(IDC_BUTTON_DISCONNECT)-&gt;EnableWindow(<span class="literal">false</span>);<span class="comment">//断开连接不可用</span></div><div class="line">	GetDlgItem(IDC_PROGRESS_SEND_FILE)-&gt;ShowWindow(SW_HIDE);</div><div class="line">	<span class="keyword">return</span> TRUE;  <span class="comment">// return TRUE  unless you set the focus to a control</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CtraDlg::OnSysCommand(UINT nID, LPARAM lParam)</div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span> ((nID &amp; <span class="number">0xFFF0</span>) == IDM_ABOUTBOX)</div><div class="line">	&#123;</div><div class="line">		CAboutDlg dlgAbout;</div><div class="line">		dlgAbout.DoModal();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		CDialog::OnSysCommand(nID, lParam);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// If you add a minimize button to your dialog, you will need the code below</span></div><div class="line"><span class="comment">//  to draw the icon.  For MFC applications using the document/view model,</span></div><div class="line"><span class="comment">//  this is automatically done for you by the framework.</span></div><div class="line"></div><div class="line"><span class="keyword">void</span> CtraDlg::OnPaint() </div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span> (IsIconic())</div><div class="line">	&#123;</div><div class="line">		<span class="function">CPaintDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>; <span class="comment">// device context for painting</span></div><div class="line">		</div><div class="line">		SendMessage(WM_ICONERASEBKGND, (WPARAM) dc.GetSafeHdc(), <span class="number">0</span>);</div><div class="line">		</div><div class="line">		<span class="comment">// Center icon in client rectangle</span></div><div class="line">		<span class="keyword">int</span> cxIcon = GetSystemMetrics(SM_CXICON);</div><div class="line">		<span class="keyword">int</span> cyIcon = GetSystemMetrics(SM_CYICON);</div><div class="line">		CRect rect;</div><div class="line">		GetClientRect(&amp;rect);</div><div class="line">		<span class="keyword">int</span> x = (rect.Width() - cxIcon + <span class="number">1</span>) / <span class="number">2</span>;</div><div class="line">		<span class="keyword">int</span> y = (rect.Height() - cyIcon + <span class="number">1</span>) / <span class="number">2</span>;</div><div class="line">		</div><div class="line">		<span class="comment">// Draw the icon</span></div><div class="line">		dc.DrawIcon(x, y, m_hIcon);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		CDialog::OnPaint();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// The system calls this to obtain the cursor to display while the user drags</span></div><div class="line"><span class="comment">//  the minimized window.</span></div><div class="line">HCURSOR CtraDlg::OnQueryDragIcon()</div><div class="line">&#123;</div><div class="line">	<span class="keyword">return</span> (HCURSOR) m_hIcon;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**************************************线程************************************************/</span></div><div class="line"></div><div class="line"><span class="comment">/******************************服务器线程开始***********************************************/</span></div><div class="line"><span class="comment">//TCP监听线程</span></div><div class="line">UINT <span class="number">_L</span>istenTcpThread(LPVOID lparam)</div><div class="line">&#123;</div><div class="line">	CtraDlg *pDlg=(CtraDlg *)lparam;</div><div class="line">	<span class="keyword">if</span> (pDlg-&gt;StopServer==<span class="literal">true</span>)	</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	&#125;</div><div class="line">	CSocket sockSrvr;</div><div class="line">	pDlg-&gt;m_Potr = PORT+pDlg-&gt;m_server;<span class="comment">//保存当前使用端口，用于关闭</span></div><div class="line">	<span class="keyword">int</span> createSucceed=sockSrvr.Create(pDlg-&gt;m_Potr);</div><div class="line">	<span class="keyword">if</span> (createSucceed == <span class="number">0</span>)</div><div class="line">	&#123;</div><div class="line">		AfxMessageBox(<span class="string">"ListenTcpThread Create错误!"</span>+pDlg-&gt;GetError(GetLastError()));</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">int</span> listenSucceed=sockSrvr.Listen();	<span class="comment">//开始监听</span></div><div class="line">	<span class="keyword">if</span>(listenSucceed==<span class="number">0</span>)</div><div class="line">	&#123;</div><div class="line">		AfxMessageBox(<span class="string">"ListenTcpThread Listen错误!"</span>+pDlg-&gt;GetError(GetLastError()));</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	CSocket recSo;</div><div class="line">	SOCKADDR_IN client;</div><div class="line">	<span class="keyword">int</span> iAddrSize=<span class="keyword">sizeof</span>(client);</div><div class="line">	</div><div class="line">	<span class="keyword">int</span> acceptSucceed=sockSrvr.Accept(recSo,(SOCKADDR *)&amp;client,&amp;iAddrSize);	<span class="comment">//接受连接并取得对方IP</span></div><div class="line">	<span class="keyword">if</span> (acceptSucceed==<span class="number">0</span>)</div><div class="line">	&#123;</div><div class="line">		AfxMessageBox(<span class="string">"ListenTcpThread Accept错误!"</span>+pDlg-&gt;GetError(GetLastError()));</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	&#125;</div><div class="line">	sockSrvr.Close();</div><div class="line">	<span class="keyword">char</span> flag[FLAG] = &#123;<span class="number">0</span>&#125;;		</div><div class="line">	<span class="keyword">if</span> (recSo.Receive(flag,FLAG) != <span class="number">2</span>) </div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;	</div><div class="line">	&#125;</div><div class="line">	pDlg-&gt;m_type=flag[<span class="number">0</span>];</div><div class="line">	<span class="keyword">if</span> (pDlg-&gt;m_type==<span class="string">'D'</span>) </div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">	&#125;</div><div class="line">	pThreadLisen=::AfxBeginThread(<span class="number">_L</span>istenTcpThread,pDlg);</div><div class="line">	pDlg-&gt;ReceiveFileMsg(recSo,client);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line">UINT <span class="number">_U</span>DPThread(LPVOID lparam)	<span class="comment">//UDP接受信息线程开始</span></div><div class="line">&#123;</div><div class="line">	</div><div class="line">	CtraDlg *pDlg=(CtraDlg *)lparam;</div><div class="line">	<span class="keyword">if</span> (pDlg-&gt;StopServer == <span class="literal">true</span>)	</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	CSocket sockSrvrUdp;</div><div class="line">	sockSrvrUdp.Create(PORT+pDlg-&gt;m_client,SOCK_DGRAM);</div><div class="line">	<span class="keyword">char</span> buff[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</div><div class="line">	<span class="keyword">int</span> ret=<span class="number">0</span>;</div><div class="line">	CString ipStr;</div><div class="line">	CString msg;</div><div class="line">	UINT port;</div><div class="line">	<span class="keyword">for</span>(;;)</div><div class="line">	&#123;</div><div class="line">		</div><div class="line">		ret=sockSrvrUdp.ReceiveFrom(buff,<span class="number">100</span>,ipStr,port);<span class="comment">//IP和port均为返回值</span></div><div class="line">		</div><div class="line">		<span class="keyword">if</span> (buff[<span class="number">0</span>]==<span class="string">'D'</span>) </div><div class="line">		&#123;</div><div class="line">			<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> (ret==SOCKET_ERROR) </div><div class="line">		&#123;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		&#125;</div><div class="line">		msg.Format(buff);</div><div class="line">		pDlg-&gt;AddMsgList(ipStr,msg);</div><div class="line">	&#125;</div><div class="line">	sockSrvrUdp.Close();</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//服务器线程结束</span></div><div class="line"><span class="comment">/*********************************************客户端线程开始*****************************************************/</span></div><div class="line"><span class="comment">//发送文件线程</span></div><div class="line">UINT <span class="number">_</span>SendFileThread(LPVOID lparam)</div><div class="line">&#123;</div><div class="line">	</div><div class="line">	CtraDlg *pDlg = (CtraDlg *)lparam;</div><div class="line">	<span class="keyword">if</span> (pDlg-&gt;StopServer == <span class="literal">true</span>)	</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	&#125;</div><div class="line">	CSocket sockClient;</div><div class="line">	sockClient.Create();</div><div class="line">	CString ip;</div><div class="line">	pDlg-&gt;m_You_IP.GetWindowText(ip);</div><div class="line">	sockClient.Connect(ip, PORT+pDlg-&gt;m_client); </div><div class="line">	<span class="comment">//首先发送标记F为文件,2</span></div><div class="line">	<span class="keyword">int</span> end = <span class="number">0</span>;</div><div class="line">	end = sockClient.Send(<span class="string">"F"</span>, FLAG);</div><div class="line">	</div><div class="line">	<span class="comment">//发送标志是否成功</span></div><div class="line">	<span class="keyword">if</span> (end == SOCKET_ERROR)										</div><div class="line">	&#123;</div><div class="line">		AfxMessageBox(<span class="string">"_SendFileThread Send错误!"</span>+pDlg-&gt;GetError(GetLastError()));</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (end != <span class="number">2</span>) </div><div class="line">	&#123;</div><div class="line">		AfxMessageBox(<span class="string">"文件头错误！"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">///////////////////////////////////////////////////////////////////</span></div><div class="line">	CFile myFile;</div><div class="line">	FILEINFO myFileInfo;</div><div class="line">	<span class="keyword">if</span> (!myFile.Open(pDlg-&gt;m_fileName, CFile::modeRead | CFile::typeBinary))</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	&#125;</div><div class="line">	myFileInfo.fileLength=myFile.GetLength();		<span class="comment">//得到文件大小</span></div><div class="line">	<span class="built_in">strcpy</span>(myFileInfo.fileName,myFile.GetFileName());<span class="comment">//得到文件名称</span></div><div class="line">	</div><div class="line">	sockClient.Send(&amp;myFileInfo,<span class="keyword">sizeof</span>(myFileInfo));	<span class="comment">//发送文件信息</span></div><div class="line">	</div><div class="line">	pDlg-&gt;m_Progress.SetRange32(<span class="number">0</span>, myFileInfo.fileLength);</div><div class="line">	</div><div class="line">	myFile.Seek(<span class="number">0</span>, CFile::begin);</div><div class="line">	<span class="keyword">char</span> m_buf[SIZEFILE] = &#123;<span class="number">0</span>&#125;;</div><div class="line">	CString strError;</div><div class="line">	<span class="keyword">int</span> num = <span class="number">0</span>;</div><div class="line">	end = <span class="number">0</span>;</div><div class="line">	<span class="keyword">int</span> temp = <span class="number">0</span>;</div><div class="line">	pDlg-&gt;GetDlgItem(IDC_BUTTON_STOP_FILE)-&gt;EnableWindow(<span class="literal">true</span>);</div><div class="line">	</div><div class="line">	<span class="keyword">for</span> (;;)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span> (pDlg-&gt;FileWork == <span class="literal">false</span>)</div><div class="line">		&#123;</div><div class="line">			pDlg-&gt;FileWork = <span class="literal">true</span>;</div><div class="line">			pDlg-&gt;GetDlgItem(IDCANCEL)-&gt;EnableWindow(<span class="literal">false</span>);</div><div class="line">			pDlg-&gt;GetDlgItem(IDC_BUTTON_DISCONNECT)-&gt;EnableWindow(<span class="literal">false</span>);</div><div class="line">		&#125;</div><div class="line">		num = myFile.Read(m_buf, SIZEFILE);</div><div class="line">		<span class="keyword">if</span> (num == <span class="number">0</span>) </div><div class="line">		&#123;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		&#125;</div><div class="line">		end = sockClient.Send(m_buf, num); </div><div class="line">		temp += end;</div><div class="line">		pDlg-&gt;m_Progress.SetPos(temp);</div><div class="line">		<span class="keyword">if</span> (pDlg-&gt;FileStop == <span class="literal">true</span>) </div><div class="line">		&#123;</div><div class="line">			pDlg-&gt;FileStop = <span class="literal">false</span>;</div><div class="line">			pDlg-&gt;FileWork = <span class="literal">false</span>;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="keyword">if</span> (end == SOCKET_ERROR)</div><div class="line">		&#123;</div><div class="line">			AfxMessageBox(<span class="string">"_SendFileThread Send错误!"</span>+pDlg-&gt;GetError(GetLastError()));</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">			</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	pDlg-&gt;m_Progress.SetPos(<span class="number">0</span>);</div><div class="line">	CString strLocalName;</div><div class="line">	pDlg-&gt;GetLocalHostName(strLocalName);</div><div class="line">	CString strLocalIP;</div><div class="line">	pDlg-&gt;GetIpAddress(strLocalName,strLocalIP);</div><div class="line">	<span class="keyword">if</span>(temp == myFileInfo.fileLength)</div><div class="line">	&#123;</div><div class="line">		pDlg-&gt;AddMsgList(strLocalName, <span class="string">"文件发送成功！"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		pDlg-&gt;AddMsgList(strLocalName, <span class="string">"文件发送失败！"</span>);</div><div class="line">	&#125;</div><div class="line">	myFile.Close();</div><div class="line">	sockClient.Close();</div><div class="line">	pDlg-&gt;FileWork = <span class="literal">false</span>;</div><div class="line">	pDlg-&gt;GetDlgItem(IDC_PROGRESS_SEND_FILE)-&gt;ShowWindow(SW_HIDE);</div><div class="line">	pDlg-&gt;GetDlgItem(IDC_BUTTON_STOP_FILE)-&gt;EnableWindow(<span class="literal">false</span>);</div><div class="line"></div><div class="line">	pDlg-&gt;GetDlgItem(IDCANCEL)-&gt;EnableWindow(<span class="literal">true</span>);</div><div class="line">	pDlg-&gt;GetDlgItem(IDC_BUTTON_DISCONNECT)-&gt;EnableWindow(<span class="literal">true</span>);</div><div class="line">	</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">UINT <span class="number">_</span>SendMsgThread(LPVOID lparam)	<span class="comment">//TCP发送信息线程</span></div><div class="line">&#123;</div><div class="line">	</div><div class="line">	CtraDlg *pDlg=(CtraDlg *)lparam;</div><div class="line">	<span class="keyword">if</span> (pDlg-&gt;StopServer == <span class="literal">true</span>)	</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	&#125;</div><div class="line">	CSocket sockClient;</div><div class="line">	sockClient.Create();</div><div class="line">	CString ip,strError;</div><div class="line">	pDlg-&gt;m_You_IP.GetWindowText(ip);</div><div class="line">	<span class="keyword">int</span> conn = sockClient.Connect(ip, PORT+pDlg-&gt;m_client);</div><div class="line">	<span class="keyword">if</span> (conn == <span class="number">0</span>)</div><div class="line">	&#123;</div><div class="line">		AfxMessageBox(<span class="string">"_SendMsgThread Connect错误!"</span>+pDlg-&gt;GetError(GetLastError()));</div><div class="line">		sockClient.ShutDown(<span class="number">2</span>);</div><div class="line">		sockClient.Close();</div><div class="line">		AfxEndThread(<span class="number">1L</span>);</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">		</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//首先发送标记M为信息,2</span></div><div class="line">	<span class="keyword">int</span> end = <span class="number">0</span>;</div><div class="line">	end = sockClient.Send(<span class="string">"M"</span>,FLAG); </div><div class="line">	<span class="keyword">if</span>(end == SOCKET_ERROR)</div><div class="line">	&#123;</div><div class="line">		AfxMessageBox(<span class="string">"_SendMsgThread Send错误!"</span>+pDlg-&gt;GetError(GetLastError()));</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(end != <span class="number">2</span>)</div><div class="line">	&#123;</div><div class="line">		AfxMessageBox(<span class="string">"消息头错误！"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	&#125;</div><div class="line">	CString strMsg = pDlg-&gt;m_MsgSend;</div><div class="line">	end = sockClient.Send(strMsg,strMsg.GetLength()); </div><div class="line">	<span class="keyword">if</span> (end == SOCKET_ERROR)</div><div class="line">	&#123;</div><div class="line">		AfxMessageBox(<span class="string">"_SendMsgThread Send错误!"</span>+pDlg-&gt;GetError(GetLastError()));</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	&#125;</div><div class="line">	CString strLocalName;</div><div class="line">	pDlg-&gt;GetLocalHostName(strLocalName);</div><div class="line">	CString strLocalIP;</div><div class="line">	pDlg-&gt;GetIpAddress(strLocalName,strLocalIP);</div><div class="line">	pDlg-&gt;AddMsgList(strLocalName,strMsg);</div><div class="line">	<span class="keyword">int</span> i=<span class="number">0</span>;</div><div class="line">	sockClient.Close();</div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">///////////////////////////////////////////////////////////////////</span></div><div class="line">UINT <span class="number">_</span>SendMsgUdpThread(LPVOID lparam)	<span class="comment">//UDP发送信息</span></div><div class="line">&#123;</div><div class="line">	</div><div class="line">	CtraDlg *pDlg = (CtraDlg *)lparam;</div><div class="line">	<span class="keyword">if</span> (pDlg-&gt;StopServer == <span class="literal">true</span>)	</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	&#125;</div><div class="line">	CSocket sockClientUdp;</div><div class="line">	pDlg-&gt;m_type = PORT+pDlg-&gt;m_client+<span class="number">10</span>;</div><div class="line">	sockClientUdp.Create(pDlg-&gt;m_type, SOCK_DGRAM);</div><div class="line">	CString strMsg = pDlg-&gt;m_MsgSend;</div><div class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">	CString ipStr;</div><div class="line">	pDlg-&gt;m_You_IP.GetWindowText(ipStr);</div><div class="line">	UINT port = PORT+pDlg-&gt;m_server;</div><div class="line">	ret=sockClientUdp.SendTo(strMsg, strMsg.GetLength(), port, ipStr);</div><div class="line">	<span class="keyword">if</span> (ret == SOCKET_ERROR) </div><div class="line">	&#123;</div><div class="line">		DWORD error = GetLastError();</div><div class="line">		</div><div class="line">	&#125;</div><div class="line">	CString strLocalName;</div><div class="line">	pDlg-&gt;GetLocalHostName(strLocalName);</div><div class="line">	CString strLocalIP;</div><div class="line">	pDlg-&gt;GetIpAddress(strLocalName, strLocalIP);</div><div class="line">	pDlg-&gt;AddMsgList(strLocalName, strMsg);</div><div class="line">	sockClientUdp.Close();</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/************************************客户端线程结束**********************************/</span></div><div class="line"></div><div class="line"><span class="comment">/*************************************函数****************************************/</span></div><div class="line"></div><div class="line"><span class="keyword">int</span> CtraDlg::ReceiveFileMsg(CSocket &amp;recSo,SOCKADDR_IN &amp;client)<span class="comment">//接受函数</span></div><div class="line">&#123;</div><div class="line">		<span class="keyword">if</span> (m_type == <span class="string">'F'</span>)			<span class="comment">//文件</span></div><div class="line">	&#123;</div><div class="line">		SaveYouFile(recSo, client);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (m_type == <span class="string">'M'</span>)	<span class="comment">//信息</span></div><div class="line">	&#123;</div><div class="line">		<span class="keyword">char</span> buff[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</div><div class="line">		CString msg;</div><div class="line">		<span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span> (;;)</div><div class="line">		&#123;</div><div class="line">			ret = recSo.Receive(buff,<span class="number">100</span>);</div><div class="line">			<span class="keyword">if</span> (ret == <span class="number">0</span>)</div><div class="line">			&#123;</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			&#125;</div><div class="line">			msg += buff;</div><div class="line">		&#125;</div><div class="line">		CString strOut,strIn;</div><div class="line">		m_You_IP.GetWindowText(strIn);</div><div class="line">		GetNamebyAddress(strIn,strOut);</div><div class="line">		CString youName;</div><div class="line">	<span class="comment">//	youName.Format(inet_ntoa(client.sin_addr));</span></div><div class="line">	<span class="comment">//	CString str = youName+"&lt;-"+strOut;</span></div><div class="line">		CString str = strOut;</div><div class="line">		AddMsgList(str, msg);</div><div class="line">	&#125;</div><div class="line">	recSo.Close();	</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">int</span> CtraDlg::SaveYouFile(CSocket &amp;recSo, SOCKADDR_IN &amp;client)<span class="comment">//接受文件</span></div><div class="line">&#123;</div><div class="line">	CString fname;</div><div class="line">	<span class="function">CFileDialog <span class="title">dlg</span><span class="params">(<span class="literal">false</span>)</span></span>;	<span class="comment">//另存文件</span></div><div class="line">	FILEINFO myFileInfo;</div><div class="line">	recSo.Receive(&amp;myFileInfo, <span class="keyword">sizeof</span>(FILEINFO));</div><div class="line">	<span class="keyword">int</span> fileLength=myFileInfo.fileLength;</div><div class="line">	CString strfileIp,strfileName,strfileLength;</div><div class="line">	strfileIp.Format(inet_ntoa(client.sin_addr));</div><div class="line">	strfileName.Format(myFileInfo.fileName);</div><div class="line">	strfileLength.Format(<span class="string">"%f"</span>, myFileInfo.fileLength/<span class="number">1024.0</span>);</div><div class="line">	CString title = <span class="string">"文件"</span>+strfileName + <span class="string">" 大小"</span> + strfileLength + <span class="string">"KB "</span> + <span class="string">"来自"</span> + strfileIp + <span class="string">" 是否接受？"</span>;</div><div class="line">	dlg.m_ofn.lpstrTitle = title;<span class="comment">//标题条</span></div><div class="line">	<span class="keyword">char</span> fileme[<span class="number">500</span>] = &#123;<span class="number">0</span>&#125;;<span class="comment">//必须足够大小</span></div><div class="line">	<span class="built_in">strcpy</span>(fileme, strfileName);</div><div class="line">	dlg.m_ofn.lpstrFile = fileme;	<span class="comment">//文件名称</span></div><div class="line">	<span class="keyword">if</span> (dlg.DoModal() == IDOK)</div><div class="line">	&#123;</div><div class="line">		fname = dlg.GetPathName();	<span class="comment">//得到文件名名称、路径</span></div><div class="line">		GetDlgItem(IDC_PROGRESS_SEND_FILE)-&gt;ShowWindow(SW_SHOW);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		GetDlgItem(IDC_PROGRESS_SEND_FILE)-&gt;ShowWindow(SW_HIDE);</div><div class="line">		GetDlgItem(IDC_BUTTON_STOP_FILE)-&gt;EnableWindow(<span class="literal">false</span>);</div><div class="line">		</div><div class="line">		GetDlgItem(IDC_BUTTON_DISCONNECT)-&gt;EnableWindow(<span class="literal">true</span>);</div><div class="line">		GetDlgItem(IDCANCEL)-&gt;EnableWindow(<span class="literal">true</span>);</div><div class="line">		</div><div class="line">		recSo.Close();	</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;	</div><div class="line">		</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">char</span> buf[SIZEFILE] = &#123;<span class="number">0</span>&#125;;</div><div class="line">	<span class="function">CFile <span class="title">f</span><span class="params">(fname, CFile::modeCreate|CFile::modeWrite)</span></span>;	<span class="comment">//存文件</span></div><div class="line">	</div><div class="line">	m_Progress.SetRange32(<span class="number">0</span>,fileLength);</div><div class="line">	</div><div class="line">	<span class="keyword">int</span> n = <span class="number">0</span>;	<span class="comment">//接受的字节数 0表示结束</span></div><div class="line">	<span class="keyword">int</span> temp = <span class="number">0</span>;</div><div class="line">	GetDlgItem(IDC_BUTTON_STOP_FILE)-&gt;EnableWindow(<span class="literal">true</span>);</div><div class="line">	</div><div class="line">	GetDlgItem(IDCANCEL)-&gt;EnableWindow(<span class="literal">false</span>);</div><div class="line">	GetDlgItem(IDC_BUTTON_DISCONNECT)-&gt;EnableWindow(<span class="literal">false</span>);</div><div class="line">	</div><div class="line">	</div><div class="line">	<span class="keyword">for</span> (;;)</div><div class="line">	&#123;</div><div class="line">		n = recSo.Receive(buf,SIZEFILE);	<span class="comment">//接受</span></div><div class="line">		<span class="keyword">if</span> (n == <span class="number">0</span>)		<span class="comment">//0表示结束</span></div><div class="line">		&#123;</div><div class="line">			<span class="keyword">break</span>;<span class="comment">//接受完毕</span></div><div class="line">		&#125;	</div><div class="line">		f.Write(buf,n);</div><div class="line">		temp += n;</div><div class="line">		m_Progress.SetPos(temp);</div><div class="line">		<span class="keyword">if</span> (FileWork == <span class="literal">false</span>) </div><div class="line">		&#123;</div><div class="line">			FileWork = <span class="literal">true</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> (FileStop == <span class="literal">true</span>) </div><div class="line">		&#123;</div><div class="line">			FileStop = <span class="literal">false</span>;</div><div class="line">			FileWork = <span class="literal">false</span>;</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">	&#125;</div><div class="line">	f.Close();</div><div class="line">	m_Progress.SetPos(<span class="number">0</span>);</div><div class="line">	<span class="keyword">if</span> (temp == fileLength)</div><div class="line">	&#123;</div><div class="line">		AddMsgList(inet_ntoa(client.sin_addr),<span class="string">"文件接收成功！"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		AddMsgList(inet_ntoa(client.sin_addr),<span class="string">"文件接收失败！"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	FileWork = <span class="literal">false</span>;</div><div class="line">	GetDlgItem(IDC_PROGRESS_SEND_FILE)-&gt;ShowWindow(SW_HIDE);</div><div class="line">	GetDlgItem(IDC_BUTTON_STOP_FILE)-&gt;EnableWindow(<span class="literal">false</span>);</div><div class="line">	</div><div class="line">	GetDlgItem(IDCANCEL)-&gt;EnableWindow(<span class="literal">true</span>);</div><div class="line">	GetDlgItem(IDC_BUTTON_DISCONNECT)-&gt;EnableWindow(<span class="literal">true</span>);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/*********************************************按钮*****************************************/</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">void</span> CtraDlg::OnButtonConnect() <span class="comment">//开始连接</span></div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></div><div class="line">	CString str;</div><div class="line">	m_You_IP.GetWindowText(str);</div><div class="line">	CString strOut,strIn;</div><div class="line">	m_You_IP.GetWindowText(strIn);</div><div class="line">	<span class="keyword">if</span>(GetNamebyAddress(strIn,strOut) == <span class="number">-1</span>)</div><div class="line">	&#123;</div><div class="line">		GetDlgItem(IDC_BUTTON_CONNECT)-&gt;EnableWindow(<span class="literal">true</span>);<span class="comment">//连接不可用</span></div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//m_MsgSend = "你好" + strOut + "!";</span></div><div class="line">	m_MsgSend =<span class="string">" "</span>;</div><div class="line">	UpdateData(<span class="literal">false</span>);</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (m_nSockType == SOCK_TCP)</div><div class="line">	&#123;</div><div class="line">		</div><div class="line">		pThreadLisen=::AfxBeginThread(<span class="number">_L</span>istenTcpThread,<span class="keyword">this</span>);	<span class="comment">//开始TCP线程</span></div><div class="line">		GetDlgItem(IDC_BUTTON_SEND_MSG)-&gt;EnableWindow(<span class="literal">true</span>);<span class="comment">//发送消息可用</span></div><div class="line">		GetDlgItem(IDC_BUTTON_SEND_FILE)-&gt;EnableWindow(<span class="literal">true</span>);<span class="comment">//文件可用</span></div><div class="line">		</div><div class="line">		<span class="comment">//显示上线</span></div><div class="line">		CString strLocalName;</div><div class="line">		GetLocalHostName(strLocalName);</div><div class="line">		AddMsgList(strLocalName, <span class="string">"上线！"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		pThreadLisen=::AfxBeginThread(<span class="number">_U</span>DPThread,<span class="keyword">this</span>);	<span class="comment">//开始UDP线程</span></div><div class="line">		GetDlgItem(IDC_BUTTON_SEND_MSG)-&gt;EnableWindow(<span class="literal">true</span>);<span class="comment">//发送可用</span></div><div class="line">		GetDlgItem(IDC_BUTTON_SEND_FILE)-&gt;EnableWindow(<span class="literal">false</span>);<span class="comment">//文件不可用</span></div><div class="line"></div><div class="line">		<span class="comment">//显示上线</span></div><div class="line">		CString strLocalName;</div><div class="line">		GetLocalHostName(strLocalName);</div><div class="line">		AddMsgList(strLocalName, <span class="string">"上线！"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	GetDlgItem(IDC_RADIO_TCP)-&gt;EnableWindow(<span class="literal">false</span>);<span class="comment">//单选不可用</span></div><div class="line">	GetDlgItem(IDC_RADIO_UDP)-&gt;EnableWindow(<span class="literal">false</span>);<span class="comment">//单选不可用</span></div><div class="line">	GetDlgItem(IDC_BUTTON_DISCONNECT)-&gt;EnableWindow(<span class="literal">true</span>);<span class="comment">//断开可用</span></div><div class="line">	GetDlgItem(IDC_BUTTON_CONNECT)-&gt;EnableWindow(<span class="literal">false</span>);<span class="comment">//连接不可用</span></div><div class="line">	GetDlgItem(IDC_RADIO_SERVER)-&gt;EnableWindow(<span class="literal">false</span>);</div><div class="line">	GetDlgItem(IDC_RADIO_CLIENT)-&gt;EnableWindow(<span class="literal">false</span>);</div><div class="line">	GetDlgItem(IDC_RADIO_BOTH)-&gt;EnableWindow(<span class="literal">false</span>);</div><div class="line">	GetDlgItem(IDC_IPADDRESS)-&gt;EnableWindow(<span class="literal">false</span>);</div><div class="line"></div><div class="line">	</div><div class="line">	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CtraDlg::OnButtonDisconnect() <span class="comment">//关闭</span></div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></div><div class="line">	GetDlgItem(IDC_BUTTON_CONNECT)-&gt;EnableWindow(<span class="literal">true</span>);</div><div class="line">	GetDlgItem(IDC_RADIO_TCP)-&gt;EnableWindow(<span class="literal">true</span>);</div><div class="line">	((CButton*)GetDlgItem(IDC_RADIO_UDP))-&gt;EnableWindow(<span class="literal">true</span>);</div><div class="line">	GetDlgItem(IDC_BUTTON_DISCONNECT)-&gt;EnableWindow(<span class="literal">false</span>);</div><div class="line">	GetDlgItem(IDC_BUTTON_SEND_MSG)-&gt;EnableWindow(<span class="literal">false</span>);</div><div class="line">	GetDlgItem(IDC_BUTTON_SEND_FILE)-&gt;EnableWindow(<span class="literal">false</span>);</div><div class="line">	m_AddMsgLIst.ResetContent();</div><div class="line">	GetDlgItem(IDC_BUTTON_CLEAR)-&gt;EnableWindow(<span class="literal">false</span>);</div><div class="line">	((CButton*)GetDlgItem(IDC_RADIO_SERVER))-&gt;EnableWindow(<span class="literal">true</span>);</div><div class="line">	((CButton*)GetDlgItem(IDC_RADIO_CLIENT))-&gt;EnableWindow(<span class="literal">true</span>);</div><div class="line">	((CButton*)GetDlgItem(IDC_RADIO_BOTH))-&gt;EnableWindow(<span class="literal">true</span>);</div><div class="line">	GetDlgItem(IDC_IPADDRESS)-&gt;EnableWindow(<span class="literal">true</span>);</div><div class="line">	m_AddMsgLIst.SendMessage(LB_SETHORIZONTALEXTENT,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/**********************************************发送结束***********************************************/</span></div><div class="line">	<span class="keyword">if</span>(m_nSockType == SOCK_TCP)</div><div class="line">	&#123;</div><div class="line">		DWORD   dwStatus;</div><div class="line">		<span class="keyword">if</span> (pThreadLisen != <span class="literal">NULL</span>)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">if</span>(::GetExitCodeThread(pThreadLisen-&gt;m_hThread, &amp;dwStatus)==<span class="number">0</span>)</div><div class="line">			&#123;</div><div class="line">				<span class="keyword">int</span> errror = GetLastError();</div><div class="line">				<span class="keyword">return</span>;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span> (dwStatus == STILL_ACTIVE)</div><div class="line">			&#123;</div><div class="line">				CSocket sockClient;</div><div class="line">				sockClient.Create();</div><div class="line">				CString ip,strError;</div><div class="line">				ip=<span class="string">"127.0.0.1"</span>;</div><div class="line">				<span class="keyword">int</span> conn = sockClient.Connect(ip, m_Potr);</div><div class="line">				<span class="keyword">if</span> (conn == <span class="number">0</span>)	</div><div class="line">				&#123;</div><div class="line">					AfxMessageBox(<span class="string">"关闭错误!"</span>+GetError(GetLastError()));</div><div class="line">					sockClient.ShutDown(<span class="number">2</span>);</div><div class="line">					sockClient.Close();</div><div class="line">					<span class="keyword">return</span>;</div><div class="line">					</div><div class="line">				&#125;</div><div class="line">				sockClient.Send(<span class="string">"D"</span>,FLAG); <span class="comment">//结束</span></div><div class="line">				</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span></div><div class="line">			&#123;</div><div class="line">				<span class="keyword">delete</span> pThreadLisen;</div><div class="line">				pThreadLisen = <span class="literal">NULL</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		CSocket sockClientUdp;</div><div class="line">		<span class="keyword">int</span> succeedCreate = sockClientUdp.Create(m_type, SOCK_DGRAM);</div><div class="line">		CString strMsg = <span class="string">"D"</span>;</div><div class="line">		<span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">		CString ipStr;</div><div class="line">		m_You_IP.GetWindowText(ipStr);</div><div class="line">		UINT port = PORT+m_server;</div><div class="line">		ret = sockClientUdp.SendTo(strMsg, <span class="number">1</span>, port, ipStr);</div><div class="line">		</div><div class="line">	&#125;</div><div class="line">		<span class="comment">//显示下线</span></div><div class="line">		CString strLocalName;</div><div class="line">		GetLocalHostName(strLocalName);</div><div class="line">		AddMsgList(strLocalName, <span class="string">"下线！"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CtraDlg::OnButtonSendMsg() <span class="comment">//发送消息</span></div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></div><div class="line">	UpdateData(<span class="literal">true</span>);</div><div class="line">	<span class="keyword">if</span> (m_MsgSend.GetLength() == <span class="number">0</span>) </div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (m_nSockType == SOCK_TCP)</div><div class="line">	&#123;</div><div class="line">		::AfxBeginThread(<span class="number">_</span>SendMsgThread, <span class="keyword">this</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;	</div><div class="line">		::AfxBeginThread(<span class="number">_</span>SendMsgUdpThread, <span class="keyword">this</span>);</div><div class="line">	&#125;</div><div class="line">	SetDlgItemText(IDC_EDIT_SENDMSG, <span class="string">""</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">void</span> CtraDlg::OnButtonSendFile() <span class="comment">//发送文件</span></div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></div><div class="line">	<span class="function">CFileDialog <span class="title">dlg</span><span class="params">(<span class="literal">true</span>)</span></span>;</div><div class="line">	CString ip;</div><div class="line">	m_You_IP.GetWindowText(ip);</div><div class="line">	CString title = <span class="string">"文件发往"</span> + ip + <span class="string">"请选择"</span>;</div><div class="line">	dlg.m_ofn.lpstrTitle = title;<span class="comment">//标题条</span></div><div class="line">	<span class="keyword">if</span> (dlg.DoModal() == IDOK)</div><div class="line">	&#123;</div><div class="line">		m_fileName = dlg.GetPathName();</div><div class="line">		GetDlgItem(IDC_PROGRESS_SEND_FILE)-&gt;ShowWindow(SW_SHOW);</div><div class="line">		pThreadSendFile=::AfxBeginThread(<span class="number">_</span>SendFileThread, <span class="keyword">this</span>);	<span class="comment">//开始传送文件线程</span></div><div class="line">	&#125;</div><div class="line">	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CtraDlg::AddMsgList(CString IP,CString str) <span class="comment">//添加信息于LISTBOX 控件中</span></div><div class="line">&#123;</div><div class="line">	SYSTEMTIME tm;</div><div class="line">	GetLocalTime(&amp;tm);</div><div class="line">	CString time;</div><div class="line">	time.Format(<span class="number">_</span>T(<span class="string">" %d:%02.2d "</span>), tm.wHour, tm.wMinute);</div><div class="line">	m_AddMsgLIst.AddString(IP+<span class="string">"("</span>+time+<span class="string">")"</span>+str);</div><div class="line">	<span class="keyword">int</span> numList = m_AddMsgLIst.GetCount()<span class="number">-1</span>;</div><div class="line">	GetDlgItem(IDC_BUTTON_CLEAR)-&gt;EnableWindow(<span class="literal">true</span>);</div><div class="line">	m_AddMsgLIst.SetTopIndex(numList);</div><div class="line">	m_AddMsgLIst.SetCurSel(numList);</div><div class="line">	<span class="comment">//水平滚动</span></div><div class="line">	<span class="keyword">int</span> max_width = <span class="number">0</span>;</div><div class="line">	CSize sz;</div><div class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;m_AddMsgLIst.GetCount(); i++)</div><div class="line">	&#123;</div><div class="line">		m_AddMsgLIst.GetText(i,str);</div><div class="line">		sz = dc.GetTextExtent(str);</div><div class="line">		<span class="keyword">if</span> (max_width &lt; sz.cx)</div><div class="line">		&#123;</div><div class="line">			max_width = sz.cx;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	m_AddMsgLIst.SendMessage(LB_SETHORIZONTALEXTENT,max_width,<span class="number">0</span>);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CtraDlg::OnButtonClear() <span class="comment">//清除聊天内容</span></div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></div><div class="line">	m_AddMsgLIst.ResetContent();</div><div class="line">	GetDlgItem(IDC_BUTTON_CLEAR)-&gt;EnableWindow(<span class="literal">false</span>);</div><div class="line">	m_AddMsgLIst.SendMessage(LB_SETHORIZONTALEXTENT,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CtraDlg::OnRadioTcp()		<span class="comment">//选择TCP模式</span></div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></div><div class="line">	m_nSockType = SOCK_TCP;</div><div class="line">	CString text;</div><div class="line">	<span class="keyword">if</span> (m_WorkType== <span class="number">0</span>) </div><div class="line">	&#123;</div><div class="line">		text = <span class="string">"服务器"</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (m_WorkType == <span class="number">1</span>) </div><div class="line">	&#123;</div><div class="line">		text = <span class="string">"客户端"</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> </div><div class="line">	&#123;</div><div class="line">		text = <span class="string">"小工具"</span>;</div><div class="line">	&#125;</div><div class="line">	SetWindowText(text + <span class="string">"TCP方式"</span>);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CtraDlg::OnRadioUdp()		<span class="comment">//选择UDP模式</span></div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></div><div class="line">	m_nSockType = SOCK_UDP;</div><div class="line">	CString text;</div><div class="line">	<span class="keyword">if</span> (m_WorkType == <span class="number">0</span>) </div><div class="line">	&#123;</div><div class="line">		text = <span class="string">"服务器"</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (m_WorkType == <span class="number">1</span>) </div><div class="line">	&#123;</div><div class="line">		text = <span class="string">"客户端"</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> </div><div class="line">	&#123;</div><div class="line">		text = <span class="string">"小工具"</span>;</div><div class="line">	&#125;</div><div class="line">	SetWindowText(text + <span class="string">"UDP方式"</span>);</div><div class="line"></div><div class="line">	</div><div class="line">&#125;</div><div class="line"></div><div class="line">CString CtraDlg::GetError(DWORD error)	<span class="comment">//返回错误信息</span></div><div class="line">&#123;</div><div class="line">	CString strError;</div><div class="line">	<span class="keyword">switch</span>(error)</div><div class="line">	&#123;</div><div class="line">	<span class="keyword">case</span> WSANOTINITIALISED:</div><div class="line">		strError = <span class="string">"初始化错误"</span>;</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> WSAENOTCONN:</div><div class="line">		strError = <span class="string">"对方没有启动"</span>;</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> WSAEWOULDBLOCK :</div><div class="line">		strError = <span class="string">"对方已经关闭"</span>;</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> WSAECONNREFUSED:</div><div class="line">		strError = <span class="string">"连接的尝试被拒绝"</span>;</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> WSAENOTSOCK:</div><div class="line">		strError = <span class="string">"在一个非套接字上尝试了一个操作"</span>;</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> WSAEADDRINUSE:</div><div class="line">		strError = <span class="string">"特定的地址已在使用中"</span>;</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> WSAECONNRESET:</div><div class="line">		strError = <span class="string">"与主机的连接被关闭"</span>;</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">default</span>:</div><div class="line">		strError = <span class="string">"一般错误"</span>;	</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> strError;</div><div class="line">	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> CtraDlg::GetLocalHostName(CString &amp;sHostName)	<span class="comment">//获得本地计算机名称</span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">char</span> szHostName[<span class="number">256</span>];</div><div class="line">	<span class="keyword">int</span> nRetCode;</div><div class="line">	nRetCode = gethostname(szHostName,<span class="keyword">sizeof</span>(szHostName));</div><div class="line">	<span class="keyword">if</span>(nRetCode!=<span class="number">0</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="comment">//产生错误</span></div><div class="line">		sHostName = <span class="number">_</span>T(<span class="string">"获取不到主机名！"</span>);</div><div class="line">		<span class="keyword">return</span> GetLastError();</div><div class="line">	&#125;</div><div class="line">	sHostName = szHostName;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> CtraDlg::GetIpAddress(<span class="keyword">const</span> CString &amp;sHostName, CString &amp;sIpAddress)<span class="comment">//获得本地IP</span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">struct</span> hostent FAR * lpHostEnt=gethostbyname(sHostName);</div><div class="line">	<span class="keyword">if</span>(lpHostEnt==<span class="literal">NULL</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="comment">//产生错误</span></div><div class="line">		sIpAddress = <span class="number">_</span>T(<span class="string">""</span>);</div><div class="line">		<span class="keyword">return</span> GetLastError();</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//获取IP</span></div><div class="line">	LPSTR lpAddr = lpHostEnt-&gt;h_addr_list[<span class="number">0</span>];</div><div class="line">	<span class="keyword">if</span>(lpAddr)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">struct</span> in_addr inAddr;</div><div class="line">		memmove(&amp;inAddr, lpAddr, <span class="number">4</span>);</div><div class="line">		<span class="comment">//转换为标准格式</span></div><div class="line">		sIpAddress = inet_ntoa(inAddr);</div><div class="line">		<span class="keyword">if</span> (sIpAddress.IsEmpty())</div><div class="line">		&#123;</div><div class="line">			sIpAddress = <span class="number">_</span>T(<span class="string">"获取不到IP！"</span>);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> CtraDlg::GetNamebyAddress(<span class="keyword">const</span> CString &amp;IpAddress,CString &amp;sYouName)<span class="comment">//获得对方计算机名称</span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> addr;</div><div class="line">	addr = inet_addr(IpAddress);</div><div class="line">	<span class="keyword">struct</span> hostent FAR * lpHostEnt = gethostbyaddr((<span class="keyword">char</span> *)&amp;addr, <span class="number">4</span>, AF_INET);</div><div class="line">	<span class="keyword">if</span> (lpHostEnt == <span class="literal">NULL</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="comment">//产生错误</span></div><div class="line">		sYouName = <span class="number">_</span>T(<span class="string">""</span>);</div><div class="line"></div><div class="line">		AfxMessageBox(<span class="string">"无法连接！"</span>);<span class="comment">//应该取得其错误</span></div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	&#125;</div><div class="line">	CString name = lpHostEnt-&gt;h_name;</div><div class="line">	sYouName = name;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CtraDlg::OnRadioServer() </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></div><div class="line">	CString text;</div><div class="line">	<span class="keyword">if</span> (m_nSockType == SOCK_TCP) </div><div class="line">	&#123;</div><div class="line">		text = <span class="string">"TCP方式"</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> </div><div class="line">	&#123;</div><div class="line">		text = <span class="string">"UDP方式"</span>;</div><div class="line">	&#125;</div><div class="line">	m_server = <span class="number">1</span>;</div><div class="line">	m_client = <span class="number">2</span>;</div><div class="line">	m_WorkType = <span class="number">0</span>;</div><div class="line">	SetWindowText(<span class="string">"服务器 "</span> + text);</div><div class="line">	GetDlgItem(IDC_BUTTON_CONNECT)-&gt;SetWindowText(<span class="string">"启动服务"</span>);</div><div class="line">	GetDlgItem(IDC_BUTTON_DISCONNECT)-&gt;SetWindowText(<span class="string">"关闭服务"</span>);</div><div class="line">	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CtraDlg::OnRadioClient() </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></div><div class="line">	CString text;</div><div class="line">	<span class="keyword">if</span> (m_nSockType == SOCK_TCP) </div><div class="line">	&#123;</div><div class="line">		text = <span class="string">"TCP方式"</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> </div><div class="line">	&#123;</div><div class="line">		text = <span class="string">"UDP方式"</span>;</div><div class="line">	&#125;</div><div class="line">	m_server = <span class="number">2</span>;</div><div class="line">	m_client = <span class="number">1</span>;</div><div class="line">	m_WorkType = <span class="number">1</span>;</div><div class="line">	SetWindowText(<span class="string">"客户端 "</span> + text);</div><div class="line">	GetDlgItem(IDC_BUTTON_CONNECT)-&gt;SetWindowText(<span class="string">"连接"</span>);</div><div class="line">	GetDlgItem(IDC_BUTTON_DISCONNECT)-&gt;SetWindowText(<span class="string">"断开连接"</span>);</div><div class="line">	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CtraDlg::OnRadioBoth() </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></div><div class="line">	CString text;</div><div class="line">	<span class="keyword">if</span> (m_nSockType == SOCK_TCP) </div><div class="line">	&#123;</div><div class="line">		text = <span class="string">"TCP方式"</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> </div><div class="line">	&#123;</div><div class="line">		text = <span class="string">"UDP方式"</span>;</div><div class="line">	&#125;</div><div class="line">	m_server = m_client = <span class="number">0</span>;</div><div class="line">	m_WorkType = <span class="number">2</span>;</div><div class="line">	SetWindowText(text);</div><div class="line">	GetDlgItem(IDC_BUTTON_CONNECT)-&gt;SetWindowText(<span class="string">"启动"</span>);</div><div class="line">	GetDlgItem(IDC_BUTTON_DISCONNECT)-&gt;SetWindowText(<span class="string">"关闭"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CtraDlg::OnButtonStopFile() </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></div><div class="line">	FileStop = <span class="literal">true</span>;</div><div class="line">	FileWork = <span class="literal">false</span>;</div><div class="line">	GetDlgItem(IDCANCEL)-&gt;EnableWindow(<span class="literal">true</span>);</div><div class="line">	GetDlgItem(IDC_BUTTON_DISCONNECT)-&gt;EnableWindow(<span class="literal">true</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">LRESULT CtraDlg::OnKSend(WPARAM wParam,LPARAM lParam)</div><div class="line">&#123;</div><div class="line">	OnButtonSendMsg();</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">BOOL CtraDlg::PreTranslateMessage(MSG* pMsg) </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your specialized code here and/or call the base class</span></div><div class="line">	<span class="keyword">if</span> (pMsg-&gt;message == WM_KEYDOWN &amp;&amp; pMsg-&gt;wParam == VK_RETURN)</div><div class="line">	&#123;	</div><div class="line">		<span class="keyword">if</span> (GetFocus()-&gt;GetDlgCtrlID()==IDC_EDIT_SENDMSG || GetFocus()-&gt;GetDlgCtrlID()==IDC_BUTTON_SEND_MSG)</div><div class="line">		&#123;</div><div class="line">			AfxGetMainWnd()-&gt;SendMessage(WM_KSEND);</div><div class="line">			<span class="keyword">return</span> TRUE;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> CDialog::PreTranslateMessage(pMsg);</div><div class="line"></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// traDlg.h : header file</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> !defined(AFX_traDLG_H__F42FE5AC_E2CC_44AB_9D0A_748191BC989F__INCLUDED_)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> AFX_traDLG_H__F42FE5AC_E2CC_44AB_9D0A_748191BC989F__INCLUDED_</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> _MSC_VER &gt; 1000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// _MSC_VER &gt; 1000</span></span></div><div class="line"></div><div class="line"><span class="comment">//#include "ColorListBox.h"</span></div><div class="line"><span class="comment">/////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><span class="comment">// CtraDlg dialog</span></div><div class="line"></div><div class="line"><span class="keyword">class</span> CtraDlg : <span class="keyword">public</span> CDialog</div><div class="line">&#123;</div><div class="line"><span class="comment">// Construction</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">	CtraDlg(CWnd* pParent = <span class="literal">NULL</span>);	<span class="comment">// standard constructor</span></div><div class="line"></div><div class="line"><span class="comment">// Dialog Data</span></div><div class="line">	<span class="comment">//&#123;&#123;AFX_DATA(CtraDlg)</span></div><div class="line">	<span class="keyword">enum</span> &#123; IDD = IDD_tra_DIALOG &#125;;</div><div class="line">	CProgressCtrl	m_Progress;</div><div class="line">	CListBox	m_AddMsgLIst;</div><div class="line">	CIPAddressCtrl	m_You_IP;</div><div class="line">	CString	m_MsgSend;</div><div class="line">	<span class="comment">//&#125;&#125;AFX_DATA</span></div><div class="line"></div><div class="line">	<span class="comment">// ClassWizard generated virtual function overrides</span></div><div class="line">	<span class="comment">//&#123;&#123;AFX_VIRTUAL(CtraDlg)</span></div><div class="line">	<span class="keyword">public</span>:</div><div class="line">	<span class="function"><span class="keyword">virtual</span> BOOL <span class="title">PreTranslateMessage</span><span class="params">(MSG* pMsg)</span></span>;</div><div class="line">	<span class="keyword">protected</span>:</div><div class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">DoDataExchange</span><span class="params">(CDataExchange* pDX)</span></span>;	<span class="comment">// DDX/DDV support</span></div><div class="line">	<span class="comment">//&#125;&#125;AFX_VIRTUAL</span></div><div class="line"></div><div class="line"><span class="comment">// Implementation</span></div><div class="line"><span class="keyword">protected</span>:</div><div class="line">	HICON m_hIcon;</div><div class="line"></div><div class="line">	<span class="comment">// Generated message map functions</span></div><div class="line">	<span class="comment">//&#123;&#123;AFX_MSG(CtraDlg)</span></div><div class="line">	<span class="function"><span class="keyword">virtual</span> BOOL <span class="title">OnInitDialog</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnSysCommand</span><span class="params">(UINT nID, LPARAM lParam)</span></span>;</div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnPaint</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">afx_msg HCURSOR <span class="title">OnQueryDragIcon</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnButtonConnect</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnButtonDisconnect</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnButtonSendMsg</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnButtonSendFile</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnButtonClear</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnRadioTcp</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnRadioUdp</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnRadioServer</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnRadioClient</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnRadioBoth</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnButtonStopFile</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">afx_msg LRESULT <span class="title">OnKSend</span><span class="params">(WPARAM wParam,LPARAM lParam)</span></span>;<span class="comment">//发送消息</span></div><div class="line">	<span class="comment">//afx_msg void OnButtonCaputer();</span></div><div class="line">	<span class="comment">//&#125;&#125;AFX_MSG</span></div><div class="line">	DECLARE_MESSAGE_MAP()</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">SaveYouFile</span><span class="params">(CSocket &amp;recSo,SOCKADDR_IN &amp;client)</span></span>;</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">ReceiveFileMsg</span><span class="params">(CSocket &amp; socket,SOCKADDR_IN &amp;client)</span></span>;</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">GetIpAddress</span><span class="params">(<span class="keyword">const</span> CString &amp; sHostName,CString &amp; sIpAddress)</span></span>;</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">GetLocalHostName</span><span class="params">(CString &amp;sHostName)</span></span>;</div><div class="line">	<span class="function">CString <span class="title">GetError</span><span class="params">(DWORD error)</span></span>;</div><div class="line">	<span class="keyword">int</span>	m_nSockType;	<span class="comment">//连接类型</span></div><div class="line">	<span class="keyword">int</span> m_WorkType;		<span class="comment">//工作方式 server0,client1,both2</span></div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddMsgList</span><span class="params">(CString IP, CString str)</span></span>; <span class="comment">//LISTBOX控件添加信息</span></div><div class="line">	<span class="keyword">int</span> m_client, m_server;</div><div class="line">	CString m_fileName;</div><div class="line">	<span class="keyword">bool</span> FileWork, FileStop, StopServer;</div><div class="line">	<span class="keyword">char</span> m_type;<span class="comment">//接受类型/F-文件，C-抓平，D-关闭,M-消息</span></div><div class="line">	<span class="keyword">int</span> m_Potr;<span class="comment">//当前使用端口</span></div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">GetNamebyAddress</span><span class="params">(<span class="keyword">const</span> CString &amp;IpAddress,CString &amp;sYouName)</span></span>;<span class="comment">//获得对方计算机名称</span></div><div class="line"></div><div class="line">&#125;;</div><div class="line"><span class="keyword">struct</span> FILEINFO</div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> fileLength;</div><div class="line">	<span class="keyword">char</span> fileName[<span class="number">100</span>];</div><div class="line"></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//&#123;&#123;AFX_INSERT_LOCATION&#125;&#125;</span></div><div class="line"><span class="comment">// Microsoft Visual C++ will insert additional declarations immediately before the previous line.</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// !defined(AFX_traDLG_H__F42FE5AC_E2CC_44AB_9D0A_748191BC989F__INCLUDED_)</span></span></div></pre></td></tr></table></figure>
<hr>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>网上的资料，查到的大部分都是用的MFC的socket类做的……</p>
<p>高级版→→→→<br>1.<a href="https://wenku.baidu.com/view/69afd693dd88d0d233d46a49.html" target="_blank" rel="external">基于MFC仿QQ聊天程序设计完整实例教程</a><br>2.<a href="http://blog.csdn.net/akof1314/article/details/5983443" target="_blank" rel="external">CRichEditCtrlEx支持静态表情聊天类的使用</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1494249495796&amp;di=6e913a58ff8ec3713e96983683e150b8&amp;imgtype=0&amp;src=http%3A%2F%2Fimg.my.csdn.net%2Fuploads%2F201304%2F08%2F1365431054_1015.png&quot; width=&quot;300&quot; height=&quot;180&quot; style=&quot;float:right;&quot;/&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;　Socket编程。　&lt;br&gt;&lt;br&gt;&lt;br&gt; &lt;/div&gt;
    
    </summary>
    
      <category term="互联网" scheme="http://hubojing.github.io/categories/%E4%BA%92%E8%81%94%E7%BD%91/"/>
    
    
      <category term="MFC" scheme="http://hubojing.github.io/tags/MFC/"/>
    
      <category term="C++" scheme="http://hubojing.github.io/tags/C/"/>
    
      <category term="socket" scheme="http://hubojing.github.io/tags/socket/"/>
    
  </entry>
  
  <entry>
    <title>四大组件之ContentProvider记录</title>
    <link href="http://hubojing.github.io/2017/05/05/ContentProvider%E8%AE%B0%E5%BD%95/"/>
    <id>http://hubojing.github.io/2017/05/05/ContentProvider记录/</id>
    <published>2017-05-05T14:00:42.000Z</published>
    <updated>2017-05-05T15:05:43.000Z</updated>
    
    <content type="html"><![CDATA[<div align="left"><br><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1493829797406&di=c1112aa632e463c9a69b23a84b37c681&imgtype=0&src=http%3A%2F%2Fs15.sinaimg.cn%2Fmiddle%2F448dd084gaa5d8b13a09e%26690" width="300" height="180" style="float:right;"><br><br><br>ContentProvider记录。<br><br><br> </div>

<a id="more"></a>
<p>数据存储方式：</p>
<ul>
<li>Shared Preferences</li>
<li>文件存储</li>
<li>SQLite</li>
<li>其他还有网络存储等</li>
</ul>
<p>上述不可完成的任务：都只是在单独的一个应用程序之中达到一个数据的共享</p>
<p><img src="http://img.blog.csdn.net/20170505230346413?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="ContentProvider"><br><img src="http://img.blog.csdn.net/20170505230425672?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="Uri"><br><img src="http://img.blog.csdn.net/20170505230442148?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="UriMatcher类"></p>
<h1 id="contentprovider"><a href="#ContentProvider" class="headerlink" title="ContentProvider"></a>ContentProvider</h1><ol>
<li>使用 ContentResolver 操作 ContentProvider 中的数据：<br>当外部应用需要对 ContentProvider 中的数据进行增删改查的时候，可以使用 ContentResolver 类来完成。</li>
<li>使用 Activity 提供的 getContentResolver() 方法获取 ContentResolver 对象。</li>
<li>ContentResolver 类提供了与 ContentProvider 类相同签名的四个方法：</li>
</ol>
<ul>
<li>public Uri insert(Uri uri,ContentValues values)<br>该方法用于往ContentProvider里面添加数据</li>
<li>public int delete(Uri uri,String selection,String[] selectionArgs)<br>该方法从ContentProvider中删除数据</li>
<li>public int update(Uri uri,ContentValues values,String selection,String[] selectionArgs)<br>该方法用于更新ContentProvider里面的数据</li>
<li>public Cursor query(Uri uri,String[] projection,String selection,String[] selectionArgs,String sortOrder)<br>该方法用于从ContentProvider中获取数据</li>
</ul>
<h1 id="使用系统提供的contentprovider"><a href="#使用系统提供的ContentProvider" class="headerlink" title="使用系统提供的ContentProvider"></a>使用系统提供的ContentProvider</h1><h2 id="查询联系人"><a href="#查询联系人" class="headerlink" title="查询联系人"></a>查询联系人</h2><p>MyContentProvider.java</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">package com<span class="selector-class">.abc</span><span class="selector-class">.contentproviderdemo1</span>;</div><div class="line"></div><div class="line">import android<span class="selector-class">.content</span><span class="selector-class">.ContentProvider</span>;</div><div class="line">import android<span class="selector-class">.content</span><span class="selector-class">.ContentValues</span>;</div><div class="line">import android<span class="selector-class">.database</span><span class="selector-class">.Cursor</span>;</div><div class="line">import android<span class="selector-class">.net</span><span class="selector-class">.Uri</span>;</div><div class="line"></div><div class="line"><span class="selector-tag">public</span> <span class="selector-tag">class</span> <span class="selector-tag">MyContentProvider</span> <span class="selector-tag">extends</span> <span class="selector-tag">ContentProvider</span> &#123;</div><div class="line"></div><div class="line">	<span class="variable">@Override</span> <span class="comment">// 在ContentProvider创建后被调用</span></div><div class="line">	public boolean onCreate() &#123;</div><div class="line">		<span class="comment">// TODO Auto-generated method stub</span></div><div class="line">		return false;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="variable">@Override</span> <span class="comment">// 根据uri查询出selection指定的条件所匹配的全部记录，并且可以指定查询哪些列 以什么方式（order）排序</span></div><div class="line">	public Cursor query(Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder) &#123;</div><div class="line">		<span class="comment">// TODO Auto-generated method stub</span></div><div class="line">		return null;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="variable">@Override</span> <span class="comment">// 返回当前uri的MIME类型，如果该URI对应的数据可能包括多条记录</span></div><div class="line">	<span class="comment">// 如果该URI对应的数据只有一条记录 该MIME类型字符串 就是以vnd.android.cursor.item/开头</span></div><div class="line">	public String getType(Uri uri) &#123;</div><div class="line">		<span class="comment">// TODO Auto-generated method stub</span></div><div class="line">		return null;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="variable">@Override</span> <span class="comment">// 根据uri插入Values对应的数据</span></div><div class="line">	public Uri insert(Uri uri, ContentValues values) &#123;</div><div class="line">		<span class="comment">// TODO Auto-generated method stub</span></div><div class="line">		return null;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="variable">@Override</span> <span class="comment">// 根据Uri删除selection指定的条件所匹配的全部记录</span></div><div class="line">	public int delete(Uri uri, String selection, String[] selectionArgs) &#123;</div><div class="line">		<span class="comment">// TODO Auto-generated method stub</span></div><div class="line">		return 0;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="variable">@Override</span> <span class="comment">// 根据uri修改selection指定的条件所匹配的全部记录</span></div><div class="line">	public int update(Uri uri, ContentValues values, String selection, String[] selectionArgs) &#123;</div><div class="line">		<span class="comment">// TODO Auto-generated method stub</span></div><div class="line">		return 0;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MainActivity.java</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.abc.contentproviderdemo1;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.<span class="type">Activity</span>;</div><div class="line"><span class="keyword">import</span> android.content.<span class="type">ContentResolver</span>;</div><div class="line"><span class="keyword">import</span> android.database.<span class="type">Cursor</span>;</div><div class="line"><span class="keyword">import</span> android.os.<span class="type">Bundle</span>;</div><div class="line"><span class="keyword">import</span> android.provider.<span class="type">ContactsContract</span>.<span class="type">CommonDataKinds</span>.<span class="type">Email</span>;</div><div class="line"><span class="keyword">import</span> android.provider.<span class="type">ContactsContract</span>.<span class="type">CommonDataKinds</span>.<span class="type">Phone</span>;</div><div class="line"><span class="keyword">import</span> android.provider.<span class="type">ContactsContract</span>.<span class="type">Contacts</span>;</div><div class="line"><span class="keyword">import</span> android.util.<span class="type">Log</span>;</div><div class="line"></div><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</div><div class="line">		<span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">		setContentView(<span class="type">R</span>.layout.activity_main);</div><div class="line"></div><div class="line">		<span class="type">ContentResolver</span> cr = getContentResolver();</div><div class="line">		<span class="type">Cursor</span> c = cr.query(<span class="type">Contacts</span>.<span class="type">CONTENT_URI</span>, <span class="keyword">new</span> <span class="type">String</span>[] &#123; <span class="type">Contacts</span>._ID, <span class="type">Contacts</span>.<span class="type">DISPLAY_NAME</span> &#125;, <span class="literal">null</span>, <span class="literal">null</span>,</div><div class="line">				<span class="literal">null</span>);</div><div class="line">		<span class="keyword">if</span> (c != <span class="literal">null</span>) &#123;</div><div class="line">			<span class="keyword">while</span> (c.moveToNext()) &#123;</div><div class="line">				int id = c.getInt(c.getColumnIndex(<span class="string">"_id"</span>));</div><div class="line">				<span class="type">Log</span>.i(<span class="string">"info"</span>, <span class="string">"_id"</span> + id);</div><div class="line">				<span class="type">Log</span>.i(<span class="string">"info"</span>, <span class="string">"name:"</span> + c.getString(c.getColumnIndex(<span class="string">"display_name"</span>)));</div><div class="line">				<span class="type">Cursor</span> c1 = cr.query(<span class="type">Phone</span>.<span class="type">CONTENT_URI</span>, <span class="keyword">new</span> <span class="type">String</span>[] &#123; <span class="type">Phone</span>.<span class="type">NUMBER</span>, <span class="type">Phone</span>.<span class="type">TYPE</span> &#125;,</div><div class="line">						<span class="type">Phone</span>.<span class="type">CONTACT_ID</span> + <span class="string">"="</span> + id, <span class="literal">null</span>, <span class="literal">null</span>);</div><div class="line">				<span class="comment">// 根据联系人ID查询出联系人的电话号码</span></div><div class="line">				<span class="keyword">if</span> (c1 != <span class="literal">null</span>) &#123;</div><div class="line">					<span class="keyword">while</span> (c1.moveToNext()) &#123;</div><div class="line">						int <span class="class"><span class="keyword">type</span> </span>= c1.getInt(c1.getColumnIndex(<span class="type">Phone</span>.<span class="type">TYPE</span>));</div><div class="line">						<span class="keyword">if</span> (<span class="class"><span class="keyword">type</span> <span class="title">==</span> <span class="title">Phone</span>.<span class="title">TYPE_HOME</span>) </span>&#123;</div><div class="line">							<span class="type">Log</span>.i(<span class="string">"info"</span>, <span class="string">"家庭电话："</span> + c1.getString(c1.getColumnIndex(<span class="type">Phone</span>.<span class="type">NUMBER</span>)));</div><div class="line">						&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="class"><span class="keyword">type</span> <span class="title">==</span> <span class="title">Phone</span>.<span class="title">TYPE_MOBILE</span>) </span>&#123;</div><div class="line">							<span class="type">Log</span>.i(<span class="string">"info"</span>, <span class="string">"手机"</span> + c1.getString(c1.getColumnIndex(<span class="type">Phone</span>.<span class="type">NUMBER</span>)));</div><div class="line">						&#125;</div><div class="line">					&#125;</div><div class="line">					c1.close();</div><div class="line">				&#125;</div><div class="line">				<span class="comment">// 根据联系人的ID去查询出联系人的邮箱地址</span></div><div class="line">				<span class="type">Cursor</span> c2 = cr.query(<span class="type">Email</span>.<span class="type">CONTENT_URI</span>, <span class="keyword">new</span> <span class="type">String</span>[] &#123; <span class="type">Email</span>.<span class="type">DATA</span>, <span class="type">Email</span>.<span class="type">TYPE</span> &#125;,</div><div class="line">						<span class="type">Email</span>.<span class="type">CONTACT_ID</span> + <span class="string">"="</span> + id, <span class="literal">null</span>, <span class="literal">null</span>);</div><div class="line"></div><div class="line">				<span class="keyword">if</span> (c2 != <span class="literal">null</span>) &#123;</div><div class="line">					<span class="keyword">while</span> (c2.moveToNext()) &#123;</div><div class="line">						int <span class="class"><span class="keyword">type</span> </span>= c2.getInt(c2.getColumnIndex(<span class="type">Email</span>.<span class="type">TYPE</span>));</div><div class="line">						<span class="keyword">if</span> (<span class="class"><span class="keyword">type</span> <span class="title">==</span> <span class="title">Email</span>.<span class="title">TYPE_WORK</span>) </span>&#123;</div><div class="line">							<span class="type">Log</span>.i(<span class="string">"info"</span>, <span class="string">"工作邮箱："</span> + c2.getString(c2.getColumnIndex(<span class="type">Email</span>.<span class="type">DATA</span>)));</div><div class="line">						&#125;</div><div class="line">					&#125;</div><div class="line">					c2.close();</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			c.close();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>AndroidManifest.xml注册</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:<span class="built_in">name</span>=<span class="string">"android.permission.READ_CONTACTS"</span>/&gt;</div></pre></td></tr></table></figure>
<h2 id="增加联系人"><a href="#增加联系人" class="headerlink" title="增加联系人"></a>增加联系人</h2><p>MainActivity.java</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">package com<span class="selector-class">.abc</span><span class="selector-class">.contentproviderdemo2</span>;</div><div class="line"></div><div class="line">import android<span class="selector-class">.app</span><span class="selector-class">.Activity</span>;</div><div class="line">import android<span class="selector-class">.content</span><span class="selector-class">.ContentResolver</span>;</div><div class="line">import android<span class="selector-class">.content</span><span class="selector-class">.ContentUris</span>;</div><div class="line">import android<span class="selector-class">.content</span><span class="selector-class">.ContentValues</span>;</div><div class="line">import android<span class="selector-class">.net</span><span class="selector-class">.Uri</span>;</div><div class="line">import android<span class="selector-class">.os</span><span class="selector-class">.Bundle</span>;</div><div class="line">import android<span class="selector-class">.provider</span><span class="selector-class">.ContactsContract</span><span class="selector-class">.CommonDataKinds</span><span class="selector-class">.Phone</span>;</div><div class="line">import android<span class="selector-class">.provider</span><span class="selector-class">.ContactsContract</span><span class="selector-class">.CommonDataKinds</span><span class="selector-class">.StructuredName</span>;</div><div class="line">import android<span class="selector-class">.provider</span><span class="selector-class">.ContactsContract</span><span class="selector-class">.Data</span>;</div><div class="line">import android<span class="selector-class">.provider</span><span class="selector-class">.ContactsContract</span><span class="selector-class">.RawContacts</span>;</div><div class="line"></div><div class="line"><span class="selector-tag">public</span> <span class="selector-tag">class</span> <span class="selector-tag">MainActivity</span> <span class="selector-tag">extends</span> <span class="selector-tag">Activity</span> &#123;</div><div class="line"></div><div class="line">	<span class="variable">@Override</span></div><div class="line">	protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">		super<span class="selector-class">.onCreate</span>(savedInstanceState);</div><div class="line">		setContentView(R<span class="selector-class">.layout</span><span class="selector-class">.activity_main</span>);</div><div class="line">		ContentResolver cr = getContentResolver();</div><div class="line">		<span class="comment">// 向联系人中插入一行数据</span></div><div class="line">		ContentValues values = new ContentValues();</div><div class="line">		Uri uri = cr<span class="selector-class">.insert</span>(RawContacts.CONTENT_URI, values);</div><div class="line">		Long raw_contact_id = ContentUris<span class="selector-class">.parseId</span>(uri);</div><div class="line">		values<span class="selector-class">.clear</span>();</div><div class="line">		values<span class="selector-class">.put</span>(StructuredName.RAW_CONTACT_ID, raw_contact_id);</div><div class="line">		values<span class="selector-class">.put</span>(StructuredName.DISPLAY_NAME, <span class="string">"胡博靖"</span>);</div><div class="line">		values<span class="selector-class">.put</span>(StructuredName.MIMETYPE, StructuredName.CONTENT_ITEM_TYPE);</div><div class="line">		uri = cr<span class="selector-class">.insert</span>(Data.CONTENT_URI, values);</div><div class="line">		<span class="comment">// 插入电话信息</span></div><div class="line">		values<span class="selector-class">.clear</span>();</div><div class="line">		values<span class="selector-class">.put</span>(Phone.RAW_CONTACT_ID, raw_contact_id);</div><div class="line">		values<span class="selector-class">.put</span>(Phone.NUMBER, <span class="string">"12345678910"</span>);</div><div class="line">		values<span class="selector-class">.put</span>(Phone.MIMETYPE, Phone.CONTENT_ITEM_TYPE);</div><div class="line">		uri = cr<span class="selector-class">.insert</span>(Data.CONTENT_URI, values);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在AndroidManifest.xml中注册</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:<span class="built_in">name</span>=<span class="string">"android.permission.WRITE_CONTACTS"</span>/&gt;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1493829797406&amp;di=c1112aa632e463c9a69b23a84b37c681&amp;imgtype=0&amp;src=http%3A%2F%2Fs15.sinaimg.cn%2Fmiddle%2F448dd084gaa5d8b13a09e%26690&quot; width=&quot;300&quot; height=&quot;180&quot; style=&quot;float:right;&quot;/&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;ContentProvider记录。&lt;br&gt;&lt;br&gt;&lt;br&gt; &lt;/div&gt;
    
    </summary>
    
      <category term="互联网" scheme="http://hubojing.github.io/categories/%E4%BA%92%E8%81%94%E7%BD%91/"/>
    
    
      <category term="Android" scheme="http://hubojing.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>四大组件之Service记录</title>
    <link href="http://hubojing.github.io/2017/05/01/Service%E8%AE%B0%E5%BD%95/"/>
    <id>http://hubojing.github.io/2017/05/01/Service记录/</id>
    <published>2017-05-01T08:14:00.000Z</published>
    <updated>2017-05-03T13:44:34.000Z</updated>
    
    <content type="html"><![CDATA[<div align="left"><br><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1493829797406&di=c1112aa632e463c9a69b23a84b37c681&imgtype=0&src=http%3A%2F%2Fs15.sinaimg.cn%2Fmiddle%2F448dd084gaa5d8b13a09e%26690" width="300" height="180" style="float:right;"><br>　　根据广大程序员经验，初学者请告别Eclipse，拥抱Android Studio！<br>　　原因：<br>　　1. 未来是Android Studio的天下（Google自己出品）。<br>　　2. Eclipse的配置和相关安装可以磨灭初学者一半的耐心，简直是拦路虎。（比如和我一样做类似题目毕设的同学已经哭晕在厕所）<br>　　3. 促使你换一台高配电脑。（心累，Android Studio在垃圾本上跑，几分钟编译一次，卡到怀疑人生，其实垃圾本四年前还是一条能跑lol的好本本，岁月催laptop老）<br> </div>

<a id="more"></a>
<p>　　Android sdk文件夹到了80几G…撑爆了我的硬盘……电脑里装的软件过于多了…趁着五一大好春光（下雨）都给卸载了！包括毕设用的eclipse和各种版本的VS，以及以前用过现在用的少的各种专业软件（每一个都是10G大户）。不过我还是毅然留下了常年没有玩耍的游戏们（加起来也才80多G！相比之下，sdk里都放了些什么！）。</p>
<p>　　但毕设是要做的。<br>　　所以Android套装们需要重新下载下来，当年安装的时候，对JDK、SDK、ADT这种东西一点儿不了解，现在重新来一遍。<br>这几天写了一些文字，但不能发上来，因为放入我的毕业论文里了。</p>
<p>－－－－－－－－－－－－－－－－－－－－－－－－废话终结线－－－－－－－－－－－－－－－－－－－－－－－－</p>
<h1 id="service生命周期"><a href="#Service生命周期" class="headerlink" title="Service生命周期"></a>Service生命周期</h1><p><img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1493825041654&amp;di=c2451aea42f042f63f4de6675f5659d3&amp;imgtype=0&amp;src=http%3A%2F%2Fstatic.oschina.net%2Fuploads%2Fimg%2F201210%2F16102027_blLg.gif" alt="Service生命周期"></p>
<p><strong>注意</strong></p>
<ul>
<li>运行在主线程，不能用它做耗时的请求或动作</li>
<li>可在服务中开一个线程，在线程中做耗时动作</li>
</ul>
<h1 id="两种方式本地服务"><a href="#两种方式（本地服务）" class="headerlink" title="两种方式（本地服务）"></a>两种方式（本地服务）</h1><p>Start方式：</p>
<ul>
<li>服务跟启动页没有任何联系</li>
<li>无法得到服务对象</li>
</ul>
<p>Bind方式（支持数据回传）：</p>
<ul>
<li>通过Ibinder接口实例，返回一个ServiceConnection对象给启动源。</li>
<li>通过ServiceConnection对象的相关方法可以得到Service对象</li>
</ul>
<h1 id="start启动"><a href="#Start启动" class="headerlink" title="Start启动"></a>Start启动</h1><p>activity_main.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    android:orientation=&quot;vertical&quot;</div><div class="line">    android:paddingBottom=&quot;@dimen/activity_vertical_margin&quot;</div><div class="line">    android:paddingLeft=&quot;@dimen/activity_horizontal_margin&quot;</div><div class="line">    android:paddingRight=&quot;@dimen/activity_horizontal_margin&quot;</div><div class="line">    android:paddingTop=&quot;@dimen/activity_vertical_margin&quot;</div><div class="line">    tools:context=&quot;com.abc.service.MainActivity&quot; &gt;</div><div class="line"></div><div class="line">    &lt;TextView</div><div class="line">        android:id=&quot;@+id/textView1&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:text=&quot;start:&quot; /&gt;</div><div class="line"></div><div class="line">    &lt;Button</div><div class="line">        android:id=&quot;@+id/start&quot;</div><div class="line">        android:onClick=&quot;doClick&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:text=&quot;StartService&quot; /&gt;</div><div class="line"></div><div class="line">    &lt;Button</div><div class="line">        android:id=&quot;@+id/stop&quot;</div><div class="line">        android:onClick=&quot;doClick&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:text=&quot;StopService&quot; /&gt;</div><div class="line"></div><div class="line">    &lt;TextView</div><div class="line">        android:id=&quot;@+id/textView2&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:text=&quot;Bind:&quot; /&gt;</div><div class="line"></div><div class="line">    &lt;Button</div><div class="line">        android:id=&quot;@+id/bind&quot;</div><div class="line">         android:onClick=&quot;doClick&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:text=&quot;BindService&quot; /&gt;</div><div class="line"></div><div class="line">    &lt;Button</div><div class="line">        android:id=&quot;@+id/play&quot;</div><div class="line">        android:onClick=&quot;doClick&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:text=&quot;播放&quot; /&gt;</div><div class="line"></div><div class="line">    &lt;Button</div><div class="line">        android:id=&quot;@+id/pause&quot;</div><div class="line">        android:onClick=&quot;doClick&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:text=&quot;暂停&quot; /&gt;</div><div class="line"></div><div class="line">    &lt;Button</div><div class="line">        android:id=&quot;@+id/next&quot;</div><div class="line">         android:onClick=&quot;doClick&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:text=&quot;下一首&quot; /&gt;</div><div class="line"></div><div class="line">    &lt;Button</div><div class="line">        android:id=&quot;@+id/pervious&quot;</div><div class="line">        android:onClick=&quot;doClick&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:text=&quot;上一首&quot; /&gt;</div><div class="line"></div><div class="line">    &lt;Button</div><div class="line">        android:id=&quot;@+id/unbind&quot;</div><div class="line">        android:onClick=&quot;doClick&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:text=&quot;UnBindService&quot; /&gt;</div><div class="line"></div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure>
<p>如图。</p>
<p><img src="http://img.blog.csdn.net/20170503214551276?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="样式"></p>
<p>MainActivity.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">package com.abc.service;</div><div class="line"></div><div class="line">import android.app.Activity;</div><div class="line">import android.content.Intent;</div><div class="line">import android.os.Bundle;</div><div class="line">import android.view.Menu;</div><div class="line">import android.view.MenuItem;</div><div class="line">import android.view.View;</div><div class="line"></div><div class="line">public class MainActivity extends Activity &#123;</div><div class="line">	Intent intent1;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">		super.onCreate(savedInstanceState);</div><div class="line">		setContentView(R.layout.activity_main);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public void doClick(View v) &#123;</div><div class="line">		switch (v.getId()) &#123;</div><div class="line">		case R.id.start:</div><div class="line">			intent1 = new Intent(MainActivity.this, MyStartService.class);</div><div class="line">			startService(intent1);</div><div class="line">			break;</div><div class="line">		case R.id.stop:</div><div class="line">			stopService(intent1);</div><div class="line">			break;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public boolean onCreateOptionsMenu(Menu menu) &#123;</div><div class="line">		// Inflate the menu; this adds items to the action bar if it is present.</div><div class="line">		getMenuInflater().inflate(R.menu.main, menu);</div><div class="line">		return true;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public boolean onOptionsItemSelected(MenuItem item) &#123;</div><div class="line">		// Handle action bar item clicks here. The action bar will</div><div class="line">		// automatically handle clicks on the Home/Up button, so long</div><div class="line">		// as you specify a parent activity in AndroidManifest.xml.</div><div class="line">		int id = item.getItemId();</div><div class="line">		if (id == R.id.action_settings) &#123;</div><div class="line">			return true;</div><div class="line">		&#125;</div><div class="line">		return super.onOptionsItemSelected(item);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MyStartService.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">package com.abc.service;</div><div class="line"></div><div class="line">import android.app.Service;</div><div class="line">import android.content.Intent;</div><div class="line">import android.os.IBinder;</div><div class="line">import android.util.Log;</div><div class="line"></div><div class="line">public class MyStartService extends Service &#123;</div><div class="line">	@Override</div><div class="line">	public void onCreate() &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		Log.i(&quot;info&quot;, &quot;Service--onCreate()&quot;);</div><div class="line">		super.onCreate();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public int onStartCommand(Intent intent, int flags, int startId) &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		Log.i(&quot;info&quot;, &quot;Service--onStartCommand()&quot;);</div><div class="line">		return super.onStartCommand(intent, flags, startId);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void onDestroy() &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		Log.i(&quot;info&quot;, &quot;Service--onDestroy()&quot;);</div><div class="line">		super.onDestroy();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public IBinder onBind(Intent intent) &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		Log.i(&quot;info&quot;, &quot;Service--onBind()&quot;);</div><div class="line">		return null;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注册</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    package=&quot;com.abc.service&quot;</div><div class="line">    android:versionCode=&quot;1&quot;</div><div class="line">    android:versionName=&quot;1.0&quot; &gt;</div><div class="line"></div><div class="line">    &lt;uses-sdk</div><div class="line">        android:minSdkVersion=&quot;14&quot;</div><div class="line">        android:targetSdkVersion=&quot;25&quot; /&gt;</div><div class="line"></div><div class="line">    &lt;application</div><div class="line">        android:allowBackup=&quot;true&quot;</div><div class="line">        android:icon=&quot;@drawable/ic_launcher&quot;</div><div class="line">        android:label=&quot;@string/app_name&quot;</div><div class="line">        android:theme=&quot;@style/AppTheme&quot; &gt;</div><div class="line">        &lt;activity</div><div class="line">            android:name=&quot;.MainActivity&quot;</div><div class="line">            android:label=&quot;@string/app_name&quot; &gt;</div><div class="line">            &lt;intent-filter&gt;</div><div class="line">                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;</div><div class="line"></div><div class="line">                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;</div><div class="line">            &lt;/intent-filter&gt;</div><div class="line">        &lt;/activity&gt;</div><div class="line">        &lt;service android:name=&quot;com.abc.service.MyStartService&quot;&gt;&lt;/service&gt;</div><div class="line">    &lt;/application&gt;</div><div class="line"></div><div class="line">&lt;/manifest&gt;</div></pre></td></tr></table></figure>
<p>可在LogCat中看到执行情况。</p>
<h1 id="bind启动"><a href="#Bind启动" class="headerlink" title="Bind启动"></a>Bind启动</h1><p>注册新类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;service android:name=&quot;com.abc.service.MyBindService&quot;&gt;&lt;/service&gt;</div></pre></td></tr></table></figure>
<p>MyBindService.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">package com.abc.service;</div><div class="line"></div><div class="line">import android.app.Service;</div><div class="line">import android.content.Intent;</div><div class="line">import android.content.ServiceConnection;</div><div class="line">import android.os.Binder;</div><div class="line">import android.os.IBinder;</div><div class="line">import android.util.Log;</div><div class="line"></div><div class="line">public class MyBindService extends Service &#123;</div><div class="line">	@Override</div><div class="line">	public void onCreate() &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		super.onCreate();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public class MyBinder extends Binder &#123;</div><div class="line">		public MyBindService getService() &#123;</div><div class="line">			return MyBindService.this;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public IBinder onBind(Intent intent) &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		Log.i(&quot;info&quot;, &quot;onBind--onCreate()&quot;);</div><div class="line">		return new MyBinder();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void unbindService(ServiceConnection conn) &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		Log.i(&quot;info&quot;, &quot;BindService--unbindService()&quot;);</div><div class="line">		super.unbindService(conn);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void onDestroy() &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		Log.i(&quot;info&quot;, &quot;BindService--onDestroy()&quot;);</div><div class="line">		super.onDestroy();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public void Play() &#123;</div><div class="line">		Log.i(&quot;info&quot;, &quot;播放&quot;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public void Pause() &#123;</div><div class="line">		Log.i(&quot;info&quot;, &quot;暂停&quot;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public void Pervious() &#123;</div><div class="line">		Log.i(&quot;info&quot;, &quot;上一首&quot;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public void next() &#123;</div><div class="line">		Log.i(&quot;info&quot;, &quot;下一首&quot;);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MainActivity.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div></pre></td><td class="code"><pre><div class="line">package com.abc.service;</div><div class="line"></div><div class="line">import com.abc.service.MyBindService.MyBinder;</div><div class="line"></div><div class="line">import android.app.Activity;</div><div class="line">import android.app.Service;</div><div class="line">import android.content.ComponentName;</div><div class="line">import android.content.Intent;</div><div class="line">import android.content.ServiceConnection;</div><div class="line">import android.os.Bundle;</div><div class="line">import android.os.IBinder;</div><div class="line">import android.view.Menu;</div><div class="line">import android.view.MenuItem;</div><div class="line">import android.view.View;</div><div class="line"></div><div class="line">public class MainActivity extends Activity &#123;</div><div class="line">	Intent intent1;</div><div class="line">	Intent intent2;</div><div class="line">	MyBindService service;</div><div class="line">	ServiceConnection conn = new ServiceConnection() &#123;</div><div class="line"></div><div class="line">		@Override // 当启动源跟Service的连接意外丢失的时候会调用这个方法</div><div class="line">		// 比如当Service崩溃了或者被强行杀死了</div><div class="line">		public void onServiceDisconnected(ComponentName name) &#123;</div><div class="line">			// TODO Auto-generated method stub</div><div class="line"></div><div class="line">		&#125;</div><div class="line"></div><div class="line">		@Override // 当启动页跟Service成功连接之后将会在自动调用这个方法</div><div class="line">		public void onServiceConnected(ComponentName name, IBinder binder) &#123;</div><div class="line">			// TODO Auto-generated method stub</div><div class="line">			service = ((MyBinder) binder).getService();</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">		super.onCreate(savedInstanceState);</div><div class="line">		setContentView(R.layout.activity_main);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public void doClick(View v) &#123;</div><div class="line">		switch (v.getId()) &#123;</div><div class="line">		case R.id.start:</div><div class="line">			intent1 = new Intent(MainActivity.this, MyStartService.class);</div><div class="line">			startService(intent1);</div><div class="line">			break;</div><div class="line"></div><div class="line">		case R.id.stop:</div><div class="line">			stopService(intent1);</div><div class="line">			break;</div><div class="line"></div><div class="line">		case R.id.play:</div><div class="line">			service.Play();</div><div class="line">			break;</div><div class="line"></div><div class="line">		case R.id.pause:</div><div class="line">			service.Pause();</div><div class="line">			break;</div><div class="line"></div><div class="line">		case R.id.pervious:</div><div class="line">			service.Pervious();</div><div class="line">			break;</div><div class="line"></div><div class="line">		case R.id.next:</div><div class="line">			service.next();</div><div class="line">			break;</div><div class="line"></div><div class="line">		case R.id.bind:</div><div class="line">			intent2 = new Intent(MainActivity.this, MyBindService.class);</div><div class="line">			bindService(intent2, conn, Service.BIND_AUTO_CREATE);</div><div class="line">			break;</div><div class="line"></div><div class="line">		case R.id.unbind:</div><div class="line">			unbindService(conn);</div><div class="line">			break;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public boolean onCreateOptionsMenu(Menu menu) &#123;</div><div class="line">		// Inflate the menu; this adds items to the action bar if it is present.</div><div class="line">		getMenuInflater().inflate(R.menu.main, menu);</div><div class="line">		return true;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public boolean onOptionsItemSelected(MenuItem item) &#123;</div><div class="line">		// Handle action bar item clicks here. The action bar will</div><div class="line">		// automatically handle clicks on the Home/Up button, so long</div><div class="line">		// as you specify a parent activity in AndroidManifest.xml.</div><div class="line">		int id = item.getItemId();</div><div class="line">		if (id == R.id.action_settings) &#123;</div><div class="line">			return true;</div><div class="line">		&#125;</div><div class="line">		return super.onOptionsItemSelected(item);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>UnBindService只能点击一次，否则会报错。</strong></p>
<h1 id="两种方法混用"><a href="#两种方法混用" class="headerlink" title="两种方法混用"></a>两种方法混用</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div></pre></td><td class="code"><pre><div class="line">package com.abc.service;</div><div class="line"></div><div class="line">import com.abc.service.MyBindService.MyBinder;</div><div class="line"></div><div class="line">import android.app.Activity;</div><div class="line">import android.app.Service;</div><div class="line">import android.content.ComponentName;</div><div class="line">import android.content.Intent;</div><div class="line">import android.content.ServiceConnection;</div><div class="line">import android.os.Bundle;</div><div class="line">import android.os.IBinder;</div><div class="line">import android.view.Menu;</div><div class="line">import android.view.MenuItem;</div><div class="line">import android.view.View;</div><div class="line"></div><div class="line">public class MainActivity extends Activity &#123;</div><div class="line">	Intent intent1;</div><div class="line">	Intent intent2;</div><div class="line">	MyBindService service;</div><div class="line">	ServiceConnection conn = new ServiceConnection() &#123;</div><div class="line"></div><div class="line">		@Override // 当启动源跟Service的连接意外丢失的时候会调用这个方法</div><div class="line">		// 比如当Service崩溃了或者被强行杀死了</div><div class="line">		public void onServiceDisconnected(ComponentName name) &#123;</div><div class="line">			// TODO Auto-generated method stub</div><div class="line"></div><div class="line">		&#125;</div><div class="line"></div><div class="line">		@Override // 当启动页跟Service成功连接之后将会在自动调用这个方法</div><div class="line">		public void onServiceConnected(ComponentName name, IBinder binder) &#123;</div><div class="line">			// TODO Auto-generated method stub</div><div class="line">			service = ((MyBinder) binder).getService();</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">		super.onCreate(savedInstanceState);</div><div class="line">		setContentView(R.layout.activity_main);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public void doClick(View v) &#123;</div><div class="line">		switch (v.getId()) &#123;</div><div class="line">		case R.id.start:</div><div class="line">			intent1 = new Intent(MainActivity.this, MyStartService.class);</div><div class="line">			startService(intent1);</div><div class="line">			break;</div><div class="line"></div><div class="line">		case R.id.stop:</div><div class="line">			stopService(intent1);</div><div class="line">			break;</div><div class="line"></div><div class="line">		case R.id.play:</div><div class="line">			service.Play();</div><div class="line">			break;</div><div class="line"></div><div class="line">		case R.id.pause:</div><div class="line">			service.Pause();</div><div class="line">			break;</div><div class="line"></div><div class="line">		case R.id.pervious:</div><div class="line">			service.Pervious();</div><div class="line">			break;</div><div class="line"></div><div class="line">		case R.id.next:</div><div class="line">			service.next();</div><div class="line">			break;</div><div class="line"></div><div class="line">		case R.id.bind:</div><div class="line">			intent2 = new Intent(MainActivity.this, MyBindService.class);</div><div class="line">			startService(intent2);</div><div class="line">			bindService(intent2, conn, Service.BIND_AUTO_CREATE);</div><div class="line">			break;</div><div class="line"></div><div class="line">		case R.id.unbind:</div><div class="line">			unbindService(conn);</div><div class="line">			break;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	@Override</div><div class="line">	protected void onDestroy() &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		stopService(intent2);</div><div class="line">		unbindService(conn);</div><div class="line">		super.onDestroy();</div><div class="line">	&#125;</div><div class="line">	@Override</div><div class="line">	public boolean onCreateOptionsMenu(Menu menu) &#123;</div><div class="line">		// Inflate the menu; this adds items to the action bar if it is present.</div><div class="line">		getMenuInflater().inflate(R.menu.main, menu);</div><div class="line">		return true;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public boolean onOptionsItemSelected(MenuItem item) &#123;</div><div class="line">		// Handle action bar item clicks here. The action bar will</div><div class="line">		// automatically handle clicks on the Home/Up button, so long</div><div class="line">		// as you specify a parent activity in AndroidManifest.xml.</div><div class="line">		int id = item.getItemId();</div><div class="line">		if (id == R.id.action_settings) &#123;</div><div class="line">			return true;</div><div class="line">		&#125;</div><div class="line">		return super.onOptionsItemSelected(item);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1493829797406&amp;di=c1112aa632e463c9a69b23a84b37c681&amp;imgtype=0&amp;src=http%3A%2F%2Fs15.sinaimg.cn%2Fmiddle%2F448dd084gaa5d8b13a09e%26690&quot; width=&quot;300&quot; height=&quot;180&quot; style=&quot;float:right;&quot;/&gt;&lt;br&gt;　　根据广大程序员经验，初学者请告别Eclipse，拥抱Android Studio！&lt;br&gt;　　原因：&lt;br&gt;　　1. 未来是Android Studio的天下（Google自己出品）。&lt;br&gt;　　2. Eclipse的配置和相关安装可以磨灭初学者一半的耐心，简直是拦路虎。（比如和我一样做类似题目毕设的同学已经哭晕在厕所）&lt;br&gt;　　3. 促使你换一台高配电脑。（心累，Android Studio在垃圾本上跑，几分钟编译一次，卡到怀疑人生，其实垃圾本四年前还是一条能跑lol的好本本，岁月催laptop老）&lt;br&gt; &lt;/div&gt;
    
    </summary>
    
      <category term="互联网" scheme="http://hubojing.github.io/categories/%E4%BA%92%E8%81%94%E7%BD%91/"/>
    
    
      <category term="Android" scheme="http://hubojing.github.io/tags/Android/"/>
    
      <category term="eclipse" scheme="http://hubojing.github.io/tags/eclipse/"/>
    
  </entry>
  
  <entry>
    <title>MFC绘制时钟</title>
    <link href="http://hubojing.github.io/2017/04/23/MFC%E7%BB%98%E5%88%B6%E6%97%B6%E9%92%9F/"/>
    <id>http://hubojing.github.io/2017/04/23/MFC绘制时钟/</id>
    <published>2017-04-23T08:14:07.000Z</published>
    <updated>2017-04-27T12:31:16.000Z</updated>
    
    <content type="html"><![CDATA[<div align="left"><br><img src="http://img.blog.csdn.net/20170424220400837?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" width="300" height="180" style="float:right;"><br><br> 　　使用GDI接口在视图上绘制一个时钟。<br>　　<br><br><br> </div>

<a id="more"></a>
<blockquote>
<p>　　GDI是Graphics Device Interface的缩写，含义是图形设备接口，它的主要任务是负责系统与绘图程序之间的信息交换，处理所有Windows程序的图形输出。<br>　　在Windows操作系统下，绝大多数具备图形界面的应用程序都离不开GDI，我们利用GDI所提供的众多函数就可以方便的在屏幕、打印机及其它输出设备上输出图形，文本等操作。<br>GDI函数大致可分类为：<br>　　设备上下文函数(如GetDC、CreateDC、DeleteDC)、 画线函数(如LineTo、Polyline、Arc)、填充画图函数(如Ellipse、FillRect、Pie)、画图属性函数(如SetBkColor、SetBkMode、SetTextColor)、文本、字体函数(如TextOut、GetFontData)、位图函数(如SetPixel、BitBlt、StretchBlt)、坐标函数(如DPtoLP、LPtoDP、ScreenToClient、ClientToScreen)、映射函数(如SetMapMode、SetWindowExtEx、SetViewportExtEx)、元文件函数(如PlayMetaFile、SetWinMetaFileBits)、区域函数(如FillRgn、FrameRgn、InvertRgn)、路径函数(如BeginPath、EndPath、StrokeAndFillPath)、裁剪函数(如SelectClipRgn、SelectClipPath)等。<br>                                            　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　——百度百科</p>
</blockquote>
<p>最初想法：<br>建立一个单文档工程，在OnDraw利用<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</div><div class="line">dc.Ellipse(CRect(<span class="number">100</span>,<span class="number">100</span>,<span class="number">500</span>,<span class="number">500</span>));</div></pre></td></tr></table></figure></p>
<p>画圆，但是打开的窗口太大了。于是，想初始化窗口，在CMainFrame里的PreCreateWindow设置窗口大小：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">BOOL CMainFrame::PreCreateWindow(CREATESTRUCT&amp; cs)</div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span>( !CFrameWnd::PreCreateWindow(cs) )</div><div class="line">		<span class="keyword">return</span> FALSE;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Modify the Window class or styles here by modifying</span></div><div class="line">	<span class="comment">//  the CREATESTRUCT cs</span></div><div class="line">	cs.cx = <span class="number">630</span>;</div><div class="line">	cs.cy = <span class="number">680</span>;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> TRUE;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>接下来画钟面上的格子。用MoveTo和LineTo确定线段起始点和终点。我用了一个比较蠢的方法：手算坐标！于是，产生了这样的代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CClockView::OnDraw(CDC* pDC)</div><div class="line">&#123;</div><div class="line">	CClockDoc* pDoc = GetDocument();</div><div class="line">	ASSERT_VALID(pDoc);</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> add draw code for native data here</span></div><div class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</div><div class="line">	dc.Ellipse(CRect(<span class="number">100</span>,<span class="number">100</span>,<span class="number">500</span>,<span class="number">500</span>));</div><div class="line">	<span class="comment">//上</span></div><div class="line">	dc.MoveTo(<span class="number">300</span>,<span class="number">140</span>);</div><div class="line">	dc.LineTo(<span class="number">300</span>,<span class="number">100</span>);</div><div class="line">	<span class="comment">//下</span></div><div class="line">	dc.MoveTo(<span class="number">300</span>,<span class="number">460</span>);</div><div class="line">	dc.LineTo(<span class="number">300</span>,<span class="number">500</span>);</div><div class="line">	<span class="comment">//左</span></div><div class="line">	dc.MoveTo(<span class="number">140</span>,<span class="number">300</span>);</div><div class="line">	dc.LineTo(<span class="number">100</span>,<span class="number">300</span>);</div><div class="line">	<span class="comment">//右</span></div><div class="line">	dc.MoveTo(<span class="number">460</span>,<span class="number">300</span>);</div><div class="line">	dc.LineTo(<span class="number">500</span>,<span class="number">300</span>);</div><div class="line">	<span class="comment">//第一区间第二点</span></div><div class="line">	dc.MoveTo(<span class="number">380</span>,<span class="number">300</span><span class="number">-80</span>*<span class="number">1.73</span>);</div><div class="line">	dc.LineTo(<span class="number">400</span>,<span class="number">300</span><span class="number">-100</span>*<span class="number">1.73</span>);</div><div class="line">	<span class="comment">//第一区间第三点</span></div><div class="line">	dc.MoveTo(<span class="number">300</span>+<span class="number">80</span>*<span class="number">1.73</span>,<span class="number">220</span>);</div><div class="line">	dc.LineTo(<span class="number">300</span>+<span class="number">100</span>*<span class="number">1.73</span>,<span class="number">200</span>);</div><div class="line">	<span class="comment">//第二区间第二点</span></div><div class="line">	dc.MoveTo(<span class="number">300</span>+<span class="number">80</span>*<span class="number">1.73</span>,<span class="number">380</span>);</div><div class="line">	dc.LineTo(<span class="number">300</span>+<span class="number">100</span>*<span class="number">1.73</span>,<span class="number">400</span>);</div><div class="line">	<span class="comment">//第二区间第三点</span></div><div class="line">	dc.MoveTo(<span class="number">380</span>,<span class="number">300</span>+<span class="number">80</span>*<span class="number">1.73</span>);</div><div class="line">	dc.LineTo(<span class="number">400</span>,<span class="number">300</span>+<span class="number">100</span>*<span class="number">1.73</span>);</div><div class="line">	<span class="comment">//第三区间第二点</span></div><div class="line">	dc.MoveTo(<span class="number">220</span>,<span class="number">300</span>+<span class="number">80</span>*<span class="number">1.73</span>);</div><div class="line">	dc.LineTo(<span class="number">200</span>,<span class="number">300</span>+<span class="number">100</span>*<span class="number">1.73</span>);</div><div class="line">	<span class="comment">//第三区间第三点</span></div><div class="line">	dc.MoveTo(<span class="number">300</span><span class="number">-80</span>*<span class="number">1.73</span>,<span class="number">380</span>);</div><div class="line">	dc.LineTo(<span class="number">300</span><span class="number">-100</span>*<span class="number">1.73</span>,<span class="number">400</span>);</div><div class="line">	<span class="comment">//第四区间第二点</span></div><div class="line">	dc.MoveTo(<span class="number">300</span><span class="number">-80</span>*<span class="number">1.73</span>,<span class="number">220</span>);</div><div class="line">	dc.LineTo(<span class="number">300</span><span class="number">-100</span>*<span class="number">1.73</span>,<span class="number">200</span>);</div><div class="line">	<span class="comment">//第四区间第三点</span></div><div class="line">	dc.MoveTo(<span class="number">220</span>,<span class="number">300</span><span class="number">-80</span>*<span class="number">1.73</span>);</div><div class="line">	dc.LineTo(<span class="number">200</span>,<span class="number">300</span><span class="number">-100</span>*<span class="number">1.73</span>);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>[连三角函数都近似等于的我……等会儿会谈优化问题]</p>
<p>效果是这样：<br><img src="http://img.blog.csdn.net/20170423165107245?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>在视类添加ＷＭ_CREATE响应函数，设置一个定时器，1秒发送一次消息。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> CClockView::OnCreate(LPCREATESTRUCT lpCreateStruct) </div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span> (CView::OnCreate(lpCreateStruct) == <span class="number">-1</span>)</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your specialized creation code here</span></div><div class="line">	SetTimer(<span class="number">1</span>, <span class="number">1000</span>, <span class="literal">NULL</span>);</div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>因为指针是在动的，所以要及时刷新页面，在视类添加WM_TIMER响应函数：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CClockView::OnTimer(UINT nIDEvent) </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your message handler code here and/or call default</span></div><div class="line">	InvalidateRect(<span class="literal">NULL</span>, TRUE);</div><div class="line">	UpdateWindow();</div><div class="line"></div><div class="line">	CView::OnTimer(nIDEvent);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>为了和系统时间一致，就要获取时间，在OnDraw中加入：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CTime Time = CTime::GetCurrentTime();</div></pre></td></tr></table></figure></p>
<p>接下来就是创建三个指针：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">double</span> Radians;</div><div class="line"></div><div class="line"><span class="comment">//时针</span></div><div class="line">Radians = Time.GetHour() + Time.GetMinute()/<span class="number">60.0</span> + Time.GetSecond()/<span class="number">3600.0</span>;</div><div class="line">Radians *= <span class="number">2</span> * <span class="number">3.14</span> / <span class="number">12.0</span>;</div><div class="line">dc.MoveTo(<span class="number">300</span>, <span class="number">300</span>);</div><div class="line">dc.LineTo(<span class="number">300</span> + (<span class="keyword">int</span>)((<span class="keyword">double</span>)<span class="number">100</span> * <span class="built_in">sin</span>(Radians)), <span class="number">300</span> - (<span class="keyword">int</span>)((<span class="keyword">double</span>)<span class="number">100</span> * <span class="built_in">cos</span>(Radians)));  <span class="comment">//取半径的1/2</span></div><div class="line"></div><div class="line"><span class="comment">//分针</span></div><div class="line">Radians = Time.GetMinute() + Time.GetSecond()/<span class="number">60</span>;</div><div class="line">Radians *= <span class="number">2</span> * <span class="number">3.14</span> / <span class="number">60.0</span>;</div><div class="line">dc.MoveTo(<span class="number">300</span>, <span class="number">300</span>);</div><div class="line">dc.LineTo(<span class="number">300</span> + (<span class="keyword">int</span>)((<span class="keyword">double</span>)<span class="number">150</span> * <span class="built_in">sin</span>(Radians)), <span class="number">300</span> - (<span class="keyword">int</span>)((<span class="keyword">double</span>)<span class="number">150</span> * <span class="built_in">cos</span>(Radians)));	<span class="comment">//取半径的3/4</span></div><div class="line"></div><div class="line"><span class="comment">//秒针</span></div><div class="line">Radians = Time.GetSecond();</div><div class="line">Radians *= <span class="number">2</span> * <span class="number">3.14</span> / <span class="number">60.0</span>;</div><div class="line">dc.MoveTo(<span class="number">300</span>, <span class="number">300</span>);</div><div class="line">dc.LineTo(<span class="number">300</span> + (<span class="keyword">int</span>)((<span class="keyword">double</span>)<span class="number">190</span> * <span class="built_in">sin</span>(Radians)), <span class="number">300</span> - (<span class="keyword">int</span>)((<span class="keyword">double</span>)<span class="number">190</span> * <span class="built_in">cos</span>(Radians))); <span class="comment">//取半径的19/20</span></div></pre></td></tr></table></figure></p>
<p>为了三角函数能用，在函数头部添加<code>#include &quot;math.h&quot;</code>。<br><img src="http://img.blog.csdn.net/20170423180359516?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>美化界面：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">BOOL CClockApp::InitInstance()</div><div class="line">&#123;</div><div class="line">…</div><div class="line">	m_pMainWnd-&gt;SetWindowText(<span class="string">"博靖牌时钟 V1.0"</span>);</div><div class="line"></div><div class="line">	<span class="keyword">return</span> TRUE;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>隐藏菜单、状态栏、工具条：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> CMainFrame::OnCreate(LPCREATESTRUCT lpCreateStruct)</div><div class="line">&#123;</div><div class="line">	…</div><div class="line">	</div><div class="line">	SetMenu(<span class="literal">NULL</span>); <span class="comment">//隐藏菜单  </span></div><div class="line">    ShowControlBar(&amp;m_wndToolBar,FALSE,FALSE); <span class="comment">//隐藏工具条  </span></div><div class="line">    ShowControlBar(&amp;m_wndStatusBar,FALSE,FALSE); <span class="comment">//隐藏状态栏  </span></div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>效果：<br><img src="http://img.blog.csdn.net/20170423202811199?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>详解：<br>InvalidateRect是一个函数，该函数向指定的窗体更新区域添加一个矩形，然后窗口客户区域的这一部分将被重新绘制。</p>
<p>ShowControlBar：<br>void ShowControlBar(CControlBar* pBar,BOOL bShow,Bool bDelay);<br>参数：<br>pBar 指向要显示或隐含的控件条<br>bShow 如果为TRUE ,指定控件条将显示；如果为FALSE，则隐藏。<br>bDelay 如果为TRUE，延迟显示控件条；如果为FALSE,则立即显示<br>说明：<br>调用该函数显示或隐藏一个控件条。</p>
<p>缺点：1.不能修改指针和线条样式（例如颜色、粗细等）。<br>2.窗口拉伸后，钟面不能随窗口拉伸。</p>
<p>改进版：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line">void CClock2View::OnDraw(CDC* pDC)</div><div class="line">&#123;</div><div class="line">	CClock2Doc* pDoc = GetDocument();</div><div class="line">	ASSERT_VALID(pDoc);</div><div class="line">	// TODO: add draw code for native data here</div><div class="line">	CRect r1;  </div><div class="line">    GetClientRect(&amp;r1);</div><div class="line">	</div><div class="line">	CTime Time = CTime::GetCurrentTime();  </div><div class="line">	</div><div class="line">	//创建画笔</div><div class="line">	CPen pen(PS_SOLID, 10, RGB(139, 115, 8));  </div><div class="line">	CPen *pOldPen = pDC-&gt;SelectObject(&amp;pen);  </div><div class="line">	</div><div class="line">	//创建钟面</div><div class="line">	pDC-&gt;Ellipse(CRect(30, 30, r1.right-30, r1.bottom-30));</div><div class="line">	CPoint pt = r1.CenterPoint();</div><div class="line">	pDC-&gt;SetTextColor(RGB(255,0,0));  </div><div class="line">	CString strNumber;</div><div class="line">	CSize size;</div><div class="line">	double Radians;</div><div class="line"></div><div class="line">	//设置钟面数字</div><div class="line">	 for (int i = 1; i &lt;= 12; i++)  </div><div class="line">    &#123;  </div><div class="line">        strNumber.Format("%d",i);</div><div class="line">		Radians = (double)i*2*3.14/12.0; </div><div class="line">        size = pDC-&gt;GetTextExtent(strNumber,strNumber.GetLength());  </div><div class="line">		//计算钟点放置位置 </div><div class="line">		//x = CenterX - (size.cx/2) + (int)((double)(CenterX - 20) * sin(Radians));  </div><div class="line">        //y = CenterY - (size.cy/2) - (int)((double)(CenterY - 20) * cos(Radians));  </div><div class="line"></div><div class="line">		double x = pt.x - (size.cx/2) + (int)((double)(pt.x - 70) * sin(Radians));  </div><div class="line">		double y = pt.y - (size.cy/2) - (int)((double)(pt.y - 70) * cos(Radians));  </div><div class="line"></div><div class="line">         </div><div class="line">       //double x = pt.x + (double)(r1.right - 50 - pt.x) * sin(Radians);  </div><div class="line">       //double y = pt.y - (double)(r1.bottom - 60 - pt.y) * cos(Radians);  </div><div class="line">        pDC-&gt;TextOut(x, y, strNumber);</div><div class="line"></div><div class="line">    &#125;  </div><div class="line"> 		</div><div class="line">	//设置钟面上的格子</div><div class="line">		</div><div class="line">	 for (int j = 1; j &lt;= 12; j++)  </div><div class="line">    &#123;  </div><div class="line">		Radians = (double)j*2*3.14/12.0; 	</div><div class="line">        int x = pt.x  + (int)((double)(pt.x - 30) * sin(Radians));  </div><div class="line">		int y = pt.y  - (int)((double)(pt.y - 30) * cos(Radians));  </div><div class="line">		int m = pt.x  + (int)((double)(pt.x - 50) * sin(Radians));  </div><div class="line">		int n = pt.y  - (int)((double)(pt.y - 50) * cos(Radians));  </div><div class="line">		pDC-&gt;MoveTo(m, n);</div><div class="line">		pDC-&gt;LineTo(x, y);</div><div class="line">		</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	//时针</div><div class="line">	 CPen HourPen(PS_SOLID, 6, RGB(255, 20, 147));  </div><div class="line">    pDC-&gt;SelectObject(&amp;HourPen);  </div><div class="line">	Radians = Time.GetHour() + Time.GetMinute()/60.0 + Time.GetSecond()/3600.0;</div><div class="line">	Radians *= 2 * 3.14 / 12.0;</div><div class="line">	pDC-&gt;MoveTo(pt.x, pt.y);  </div><div class="line">    pDC-&gt;LineTo(pt.x + (int)((double)(pt.x/3) * sin(Radians)), pt.y - (int)((double)(pt.y/3) * cos(Radians)));  </div><div class="line"></div><div class="line">	//分针</div><div class="line">	CPen MinPen(PS_SOLID, 4, RGB(78, 238, 148));  </div><div class="line">    pDC-&gt;SelectObject(&amp;MinPen);  </div><div class="line">	Radians = Time.GetMinute() + Time.GetSecond()/60;</div><div class="line">	Radians *= 2 * 3.14 / 60.0;</div><div class="line">	pDC-&gt;MoveTo(pt.x, pt.y);  </div><div class="line">    pDC-&gt;LineTo(pt.x + (int)((double)(pt.y*1/2) * sin(Radians)), pt.y - (int)((double)(pt.y*1/2) * cos(Radians)));  </div><div class="line"></div><div class="line">	//秒针</div><div class="line">	CPen SecPen(PS_SOLID, 2, RGB(0, 0, 205));  </div><div class="line">    pDC-&gt;SelectObject(&amp;SecPen); </div><div class="line">	Radians = Time.GetSecond();</div><div class="line">	Radians *= 2 * 3.14 / 60.0;</div><div class="line">	pDC-&gt;MoveTo(pt.x, pt.y);  </div><div class="line">    pDC-&gt;LineTo(pt.x + (int)((double)(pt.x*2/3) * sin(Radians)), pt.y - (int)((double)(pt.y*2/3) * cos(Radians)));  </div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>详解：<br>弧长公式：时针：α=l/r=(2πr/12)/r=2π/12  分针、秒针同理。<br>GetTextExtent<br>函数功能：使用该函数获得所选字体中指定字符串的高度和宽度<br>函数原型一：CSize GetTextExtent(LPCTSTR lpszString, int nCount) const；<br>参数：<br>lpszString是字符串的指针，也可以用CString 对象<br>nCount是指字符串的长度<br>函数原型二： CSize GetTextExtent( const CString&amp; str) const;<br>参数：<br>str是一个字符串对象，包含指定的字符。<br>返回值：<br>以逻辑单位返回字符串的尺寸，保存在一个CSize对象中。</p>
<p>TextOut，函数名。该函数用当前选择的字体、背景颜色和正文颜色将一个字符串写到指定位置。</p>
<p>效果：<br><img src="http://img.blog.csdn.net/20170424220400837?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>值得改进处：<br>1.每秒刷新时整个频幕闪动较大。<br>2.可以突出12、3、6、9的格子长度。<br>3.调整数字的大小和字体。<br>4.指针做的更美观，考虑用位图或图片替代。</p>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20170424220400837?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast&quot; width=&quot;300&quot; height=&quot;180&quot; style=&quot;float:right;&quot;/&gt;&lt;br&gt;&lt;br&gt; 　　使用GDI接口在视图上绘制一个时钟。&lt;br&gt;　　&lt;br&gt;&lt;br&gt;&lt;br&gt; &lt;/div&gt;
    
    </summary>
    
      <category term="互联网" scheme="http://hubojing.github.io/categories/%E4%BA%92%E8%81%94%E7%BD%91/"/>
    
    
      <category term="MFC" scheme="http://hubojing.github.io/tags/MFC/"/>
    
      <category term="C++" scheme="http://hubojing.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>折腾才是人生</title>
    <link href="http://hubojing.github.io/2017/04/21/%E6%8A%98%E8%85%BE%E6%89%8D%E6%98%AF%E4%BA%BA%E7%94%9F/"/>
    <id>http://hubojing.github.io/2017/04/21/折腾才是人生/</id>
    <published>2017-04-20T16:02:54.000Z</published>
    <updated>2017-04-20T16:35:27.230Z</updated>
    
    <content type="html"><![CDATA[<div align="left"><br><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1492716014892&di=39eb7cb27e728bbbea6be20b6d2501c8&imgtype=0&src=http%3A%2F%2Fjrsh.hangzhou.com.cn%2Fsale%2Fcontent%2Fattachement%2Fjpg%2Fsite2%2F20151215%2F90b11c6dae5a17da23d850.jpg" width="300" height="180" style="float:right;"><br><br> 　　其实是一篇吐槽贴和一个标准的Flag。<br>　　<br><br><br> </div>

<a id="more"></a>
<p>　　虽然现在天色已深，哦，应该说是凌晨了，明天还要早起。但！我真的还是想吐槽……</p>
<p>　　一篇文章怎么可以没有目录？ 啊？啊？啊？ 要我一篇上万字的文章怎么翻…… （于是抛弃了yilia,hueman）<br>（认真脸：我试过给hueman加目录的，一个toc函数，明明很简单的样子……然后就把主题玩崩了，其实要还原还是可以的，只是我对没目录的怨念很深呐）</p>
<p>　　为什么每一种主题评论的格式都不能统一一下……我终于找到每换一次主题就丢评论的解决方法了……（虽然数据量有点庞大，周末看有没有时间搞定）</p>
<p>　　为什么换个主题，不蒜子计数就从头开始！（尤其是近期更换频繁）现在都打算不显示点击数（网站点击和每篇文章浏览量）了（几千的点击噢，好气）……（百度统计什么的用过，然而还是直接显示出来方便（主要是显得网站有人气哈哈哈）其实到底有几个人看，无所谓啦~）</p>
<p>　　快五月了，好愁，多说到底用什么替换？？</p>
<p>　　另外，真的，图床贴图还没有CSDN博客上图来得方便。（比如刚才上传三十几张图，要是图床的话自己要不停复制外链，那效率可想而知。）</p>
<p>　　综上所述，<br>　　<strong>这都是自己不会写主题的后果！！！</strong></p>
<p>　　Flag: 　　<br>　　现在不敢说完全独立写一个主题出来（主要是时间、精力、学习工作、学习方向的问题），毕竟博客以文章质量为主，但我希望今年能修改出自己满意的样子来……</p>
<p><span id="busuanzi_container_page_pv"><br>本文已被阅读 <span id="busuanzi_value_page_pv"></span> 次。感谢您的点击！</span></p>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1492716014892&amp;di=39eb7cb27e728bbbea6be20b6d2501c8&amp;imgtype=0&amp;src=http%3A%2F%2Fjrsh.hangzhou.com.cn%2Fsale%2Fcontent%2Fattachement%2Fjpg%2Fsite2%2F20151215%2F90b11c6dae5a17da23d850.jpg&quot; width=&quot;300&quot; height=&quot;180&quot; style=&quot;float:right;&quot;/&gt;&lt;br&gt;&lt;br&gt; 　　其实是一篇吐槽贴和一个标准的Flag。&lt;br&gt;　　&lt;br&gt;&lt;br&gt;&lt;br&gt; &lt;/div&gt;
    
    </summary>
    
      <category term="杂谈" scheme="http://hubojing.github.io/categories/%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="主题" scheme="http://hubojing.github.io/tags/%E4%B8%BB%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>MFC傻瓜式教程</title>
    <link href="http://hubojing.github.io/2017/04/13/MFC%E5%82%BB%E7%93%9C%E5%BC%8F%E6%95%99%E7%A8%8B/"/>
    <id>http://hubojing.github.io/2017/04/13/MFC傻瓜式教程/</id>
    <published>2017-04-13T14:26:01.000Z</published>
    <updated>2017-04-30T13:01:49.000Z</updated>
    
    <content type="html"><![CDATA[<div align="left"><br><img src="http://img.blog.csdn.net/20170413231922633?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" width="300" height="180" style="float:right;"><br>　　很多技术书废话连篇。——公司某优秀工程师<br>　　（本教程重操作，轻理论，为操作减负。需了解详细原理的朋友可以自行看各种书籍。）<br>　　直接上菜。<br><br> </div>

<a id="more"></a>
<p>MFC：Microsoft Foundation Class ，微软基础类库。</p>
<h1 id="对话框"><a href="#对话框" class="headerlink" title="对话框"></a>对话框</h1><h2 id="对话框的创建和显示"><a href="#对话框的创建和显示" class="headerlink" title="对话框的创建和显示"></a>对话框的创建和显示</h2><ol>
<li>新建MFC AppWizard(exe)工程，单文档类型。工程名：Mybole。编译运行。<br><img src="http://img.blog.csdn.net/20170413231922633?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="新建"></li>
<li><p>点击帮助-关于Mybole。这是MFC自动创建的。<br><img src="http://img.blog.csdn.net/20170413231954758?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="关于"></p>
</li>
<li><p>创建自己的对话框。点击Insert-Resource。选择Dialog，点击New。VC++自动将其标识设置为IDD_DIALOG1，并自动添加到ResourceView-Dialog项中。Dialog项下还有一个对话框资源标识：IDD_ABOUTBOX，即上一步中的“关于”对话框。<br><img src="http://img.blog.csdn.net/20170413232035196?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="Insert Resource对话框"></p>
</li>
</ol>
<p> <img src="http://img.blog.csdn.net/20170413232222055?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="新建的对话框资源"></p>
<ol>
<li>选中对话框本身，右键点击属性。将Caption设置为“测试”。</li>
<li>选择View-ClassWizard，点击create a new class，OK。出现下图，并输入下图选项。<br><img src="http://img.blog.csdn.net/20170413232907845?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="New Class"></li>
<li>在随后出现的MFC ClassWizard对话框上点击OK。<br><img src="http://img.blog.csdn.net/20170413233804513?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="列表"><br><strong>注意</strong>：看看左侧类列表中是否添加好了CTestDlg，否则会影响后续操作。</li>
</ol>
<p>接下来，我们希望在程序中显示这个对话窗口。</p>
<ol>
<li><p>点击右侧菜单Menu，选中IDR_MAINFRAME。点击帮助旁边的虚线框。<br><img src="http://img.blog.csdn.net/20170413233914861?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="Menu"></p>
</li>
<li><p>对虚线框右键属性，修改为下图。<br><img src="http://img.blog.csdn.net/20170413234011986?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="属性"></p>
</li>
<li><p>关闭属性。点击View-ClassWizard（中文是建立类向导），选择CMyboleView，用COMMAND命令消息响应函数。如图。<br><img src="http://img.blog.csdn.net/20170414000004060?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="COMMAND"></p>
</li>
</ol>
<h3 id="模态对话框的创建"><a href="#模态对话框的创建" class="headerlink" title="模态对话框的创建"></a>模态对话框的创建</h3><p>　　需要调用CDialog类的成员函数：DoModal，它能创建并显示一个模态对话框，其返回值将作为CDialog类的另一个成员函数：EndDialog的参数，后者功能是关闭模态对话框。</p>
<p>　　在FileView中选择MyboleView.cpp，编写程序。<br>　　记得在开头添加头文件 #include “testdlg.h” （头文件大小写问题，linux区分，windows不区分）<br> <img src="http://img.blog.csdn.net/20170414000303079?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="编程"><br>　　显示模态对话框的具体实现代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CMyboleView::OnDialog() </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your command handler code here</span></div><div class="line">	CTestDlg dlg;</div><div class="line">	dlg.DoModal();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>编译运行，点击对话框。会发现若不确认该窗口，将无法点击其他窗口。<br> <img src="http://img.blog.csdn.net/20170414000500779?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="模态对话框1"></p>
<p><img src="http://img.blog.csdn.net/20170414000612202?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="模态对话框2"></p>
<h3 id="非模态对话框的创建"><a href="#非模态对话框的创建" class="headerlink" title="非模态对话框的创建"></a>非模态对话框的创建</h3><p>将上面的模态对话框代码注释掉。</p>
<p>改为：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CMyboleView::OnDialog() </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your command handler code here</span></div><div class="line">	<span class="comment">//CTestDlg dlg;</span></div><div class="line">	<span class="comment">//dlg.DoModal();</span></div><div class="line"></div><div class="line">	CTestDlg *pDlg = <span class="keyword">new</span> CTestDlg;</div><div class="line">	pDlg-&gt;Create(IDD_DIALOG1,<span class="keyword">this</span>);</div><div class="line">	pDlg-&gt;ShowWindow(SW_SHOW);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>注意</strong>：需要把之前运行的对话框关掉才能编译成功。</p>
<p>然而，当它生命周期结束时，所保存的内存地址就丢失了，那么程序中也就无法再引用到它所指向的那块内存。于是，我们这样解决该问题。<br><img src="http://img.blog.csdn.net/20170414000901869?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="MFC ClassWizard"></p>
<p><strong>注意</strong>：Message里双击添加函数或者点击add Class…</p>
<p>void CTestDlg::PostNcDestroy()<br>{<br>    // TODO: Add your specialized code here and/or call the base class<br>    delete this;<br>    CDialog::PostNcDestroy();<br>}</p>
<p><strong>区别</strong>：点击确定，对话框都会消失。但是，模态对话框窗口对象被销毁了。对非模态对话框来说，只是隐藏起来了，并未被销毁。<br>因此，若要销毁对话框，若有一个ID为IDOK的按钮，就必须重写基类的OnOK这个虚函数，并在重写的函数中调用DestroyWindow函数，完成销毁。并不要再调用基类的OnOK函数。<br>同样地，若有一个ID为IDCANCEL的按钮，也必须重写基类的OnCancel虚函数，并在重写的函数中调用DestroyWindow函数，完成销毁。并不要再调用基类的OnCancel函数。</p>
<h1 id="动态创建按钮"><a href="#动态创建按钮" class="headerlink" title="动态创建按钮"></a>动态创建按钮</h1><p>注释掉非模态对话框代码，还原模态对话框代码。</p>
<p>点击ResourceView-IDD_DIALOG1，打开资源，用鼠标拖出控件面板上的Button按钮控件，对按钮右键，选择属性，设置如下。<br> <img src="http://img.blog.csdn.net/20170414001008658?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="按钮"></p>
<p>接下来，我们实现当单击Add按钮时，在对话框中动态创建一个按钮这一功能。</p>
<ol>
<li>为CTestDlg类添加一个私有的CButton成员变量。<br>　　点击ClassView标签页右键，如图点击。<br><img src="http://img.blog.csdn.net/20170414001252061?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="ClassView"></li>
</ol>
<p>　　填入信息。<br> <img src="http://img.blog.csdn.net/20170414001335972?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="添加成员变量"></p>
<ol>
<li>添加Add按钮单击消息的响应函数。<br>　　按钮点右键，选ClassWizard（建立类向导），如图。<br><img src="http://img.blog.csdn.net/20170414001137294?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="建立类向导"></li>
</ol>
<p>　　单击Edit Code，即可定位到该函数定义处。<br>　　添加一下代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></div><div class="line">	m_btn.Create(<span class="string">"New"</span>,BS_DEFPUSHBUTTON | WS_VISIBLE | WS_CHILD,</div><div class="line">				 CRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>,<span class="number">100</span>),<span class="keyword">this</span>,<span class="number">123</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　为避免多次点击Add出现非法操作，我们需要进行如下步骤。</p>
<ol>
<li><p>为CTestDlg类增加一个私有的BOOL类型成员变量。<br>变量类型：BOOL<br>变量名称：m_bIsCreated<br>Access: private</p>
</li>
<li><p>在TestDlg.cpp中找到构造函数，将m_bIsCreated初始为FALSE。如图所示。<br><img src="http://img.blog.csdn.net/20170415152155489?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
</li>
</ol>
<p>　　或者改为如下亦可。<br>Static BOOL bIsCreated = FALSE;</p>
<ol>
<li>回到Add，双击它，进入代码部分，改之。<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></div><div class="line">	<span class="keyword">if</span>(m_bIsCreated==FALSE)</div><div class="line">	&#123;</div><div class="line">	m_btn.Create(<span class="string">"New"</span>,BS_DEFPUSHBUTTON | WS_VISIBLE | WS_CHILD,</div><div class="line">				CRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>,<span class="number">100</span>),<span class="keyword">this</span>,<span class="number">123</span>);</div><div class="line">	m_bIsCreated = TRUE;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		m_btn.DestroyWindow();</div><div class="line">		m_bIsCreated = FALSE;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>　　或者以下亦能实现。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></div><div class="line">	<span class="keyword">if</span>(!m_btn.m_hWnd)</div><div class="line">	&#123;</div><div class="line">	m_btn.Create(<span class="string">"New"</span>,BS_DEFPUSHBUTTON | WS_VISIBLE | WS_CHILD,</div><div class="line">				CRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>,<span class="number">100</span>),<span class="keyword">this</span>,<span class="number">123</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		m_btn.DestroyWindow();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　效果：<br>　　<img src="http://img.blog.csdn.net/20170415152224880?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　点击Add出现New窗口，再点击就销毁。</p>
<h2 id="控件的访问"><a href="#控件的访问" class="headerlink" title="控件的访问"></a>控件的访问</h2><h3 id="控件的调整"><a href="#控件的调整" class="headerlink" title="控件的调整"></a>控件的调整</h3><p>用Layout-Align，Layout-Make Same Size，Layout-Space Evenly里的选项进行调整。<br><img src="http://img.blog.csdn.net/20170415152247131?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="静态文本控件"><a href="#静态文本控件" class="headerlink" title="静态文本控件"></a>静态文本控件</h3><p>　　查看三个静态文本框，它们ID相同。我们可以更改第一个静态文本框ID为IDC_NUMBER1，再打开ClassWizard，可以在ObjectIDs看到新ID。<br> <img src="http://img.blog.csdn.net/20170415152324147?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>　　对BN_CLICKED进行Add Function，并Edit Code:</p>
<p>　　此时运行程序点击第一个静态文本框并没有反应。这是因为：<strong>静态文本控件在默认状态下是不发送通告消息的</strong>。</p>
<p>　　为了该控件能向父窗口发送鼠标事件，我们对该文本框右键-属性，切换到styles选项卡，勾上Notify。<br> <img src="http://img.blog.csdn.net/20170415152341882?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　现在可以显示了：<br>　　点击就改变。<br> <img src="http://img.blog.csdn.net/20170415152354773?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　<strong>总结：为了使一个静态文本控件能够响应鼠标单击消息，那么需要进行两个特殊的步骤：第一步，改变它的ID；第二步，在它的属性对话框中选中Notify选项。</strong></p>
<h3 id="编辑框控件"><a href="#编辑框控件" class="headerlink" title="编辑框控件"></a>编辑框控件</h3><p>利用上面的对话框实现这样的功能：在前两个编辑框中分别输入一个数字，然后单击Add按钮，对前两个编辑框中的数字求和，并将结果显示在第三个编辑框中。</p>
<h4 id="第一种方式"><a href="#第一种方式" class="headerlink" title="第一种方式"></a>第一种方式</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> num1, num2, num3; </div><div class="line">	<span class="keyword">char</span> ch1[<span class="number">10</span>], ch2[<span class="number">10</span>], ch3[<span class="number">10</span>]; </div><div class="line">	GetDlgItem(IDC_EDIT1)-&gt;GetWindowText(ch1,<span class="number">10</span>); </div><div class="line">	GetDlgItem(IDC_EDIT2)-&gt;GetWindowText(ch2,<span class="number">10</span>);</div><div class="line"></div><div class="line">	num1 = atoi(ch1); </div><div class="line">	num2 = atoi(ch2); </div><div class="line">	num3 = num1 + num2; </div><div class="line"></div><div class="line">	itoa(num3,ch3,<span class="number">10</span>);</div><div class="line">	GetDlgItem(IDC_EDIT3)-&gt;SetWindowText(ch3);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>C语言转换函数：atoi 将一个由数字组成的字符串转换为相应的数值<br>itoa 数值转换为文本<br>itoa函数的第三个参数表示转换的进制，数字10表示十进制。</p>
<p>效果：<br> <img src="http://img.blog.csdn.net/20170415152409742?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h4 id="第二种方式"><a href="#第二种方式" class="headerlink" title="第二种方式"></a>第二种方式</h4><p>　　代码如下：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> num1, num2, num3; </div><div class="line">	<span class="keyword">char</span> ch1[<span class="number">10</span>], ch2[<span class="number">10</span>], ch3[<span class="number">10</span>]; </div><div class="line">	<span class="comment">//GetDlgItem(IDC_EDIT1)-&gt;GetWindowText(ch1,10); </span></div><div class="line">	<span class="comment">//GetDlgItem(IDC_EDIT2)-&gt;GetWindowText(ch2,10);</span></div><div class="line">	</div><div class="line">	GetDlgItemText(IDC_EDIT1,ch1,<span class="number">10</span>);</div><div class="line">	GetDlgItemText(IDC_EDIT2,ch2,<span class="number">10</span>);</div><div class="line"></div><div class="line">	num1 = atoi(ch1); </div><div class="line">	num2 = atoi(ch2); </div><div class="line">	num3 = num1 + num2; </div><div class="line"></div><div class="line">	itoa(num3,ch3,<span class="number">10</span>);</div><div class="line">	<span class="comment">//GetDlgItem(IDC_EDIT3)-&gt;SetWindowText(ch3);</span></div><div class="line">	SetDlgItemText(IDC_EDIT3,ch3);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　GetDlgItemText 将返回对话框中指定ID的控件上的文本，相当于将上面的GetDlgItem和GetWindowText这两个函数功能组合起来了。<br>与之对应的是SetDlgItemText，用来设置对话框中指定ID的控件上的文本。</p>
<h4 id="第三种方式"><a href="#第三种方式" class="headerlink" title="第三种方式"></a>第三种方式</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> num1, num2, num3; </div><div class="line">	<span class="comment">//char ch1[10], ch2[10], ch3[10]; </span></div><div class="line">	<span class="comment">//GetDlgItem(IDC_EDIT1)-&gt;GetWindowText(ch1,10); </span></div><div class="line">	<span class="comment">//GetDlgItem(IDC_EDIT2)-&gt;GetWindowText(ch2,10);</span></div><div class="line">	</div><div class="line">	<span class="comment">//GetDlgItemText(IDC_EDIT1,ch1,10);</span></div><div class="line">	<span class="comment">//GetDlgItemText(IDC_EDIT2,ch2,10);</span></div><div class="line"></div><div class="line">	num1 = GetDlgItemInt(IDC_EDIT1);</div><div class="line">	num2 = GetDlgItemInt(IDC_EDIT2);</div><div class="line"></div><div class="line">	<span class="comment">//num1 = atoi(ch1); </span></div><div class="line">	<span class="comment">//num2 = atoi(ch2); </span></div><div class="line">	num3 = num1 + num2; </div><div class="line"></div><div class="line">	<span class="comment">//itoa(num3,ch3,10);</span></div><div class="line">	<span class="comment">//GetDlgItem(IDC_EDIT3)-&gt;SetWindowText(ch3);</span></div><div class="line">	<span class="comment">//SetDlgItemText(IDC_EDIT3,ch3);</span></div><div class="line">	SetDlgItemInt(IDC_EDIT3,num3);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="第四种方式"><a href="#第四种方式" class="headerlink" title="第四种方式"></a>第四种方式</h4><p>　　将这三个编辑框分别与对话框类的三个成员变量相关联，然后通过这些成员变量来检索和设置编辑框的文本，这是最简单的访问控件的方式。<br>打开ClassWizard对话框，切换到Member Variables选项卡，如图。<br> <img src="http://img.blog.csdn.net/20170415152431039?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>　　首先为IDC_EDIT1编辑框添加一个关联的成员变量，方法是在Control IDs列表中选中IDC_EDIT1，再单击Add Variable按钮，如图。<br><img src="http://img.blog.csdn.net/20170415152451118?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br> <img src="http://img.blog.csdn.net/20170415152505259?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　同样地，为IDC_EDIT2和IDC_EDIT3分别添加好成员变量。<br>　　接着修改代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </div><div class="line">&#123;</div><div class="line">	UpdateData();</div><div class="line">	m_num3 = m_num1 + m_num2;</div><div class="line">	UpdateData(FALSE);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>　　对编辑框控件中输入的数值设定一个范围：<br>　　打开ClassWizard-Member Variable，选中IDC_EDIT1，下方输入0和100。同样为IDC_EDIT2也设置好。<br><img src="http://img.blog.csdn.net/20170415152522025?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h4 id="第五种方式"><a href="#第五种方式" class="headerlink" title="第五种方式"></a>第五种方式</h4><p>　　将编辑框控件再与一个变量相关联，代表控件本身。为IDC_EDIT1增加一个控件类型的变量：m_edit1，类别为Control。同样地，也为IDC_EDIT2和IDC_EDIT3添加。<br> <img src="http://img.blog.csdn.net/20170415152547447?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　修改代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> num1, num2, num3; </div><div class="line">	<span class="keyword">char</span> ch1[<span class="number">10</span>], ch2[<span class="number">10</span>], ch3[<span class="number">10</span>]; </div><div class="line">	</div><div class="line">	m_edit1.GetWindowText(ch1,<span class="number">10</span>);</div><div class="line">	m_edit2.GetWindowText(ch2,<span class="number">10</span>);</div><div class="line"></div><div class="line">	<span class="comment">//num1 = GetDlgItemInt(IDC_EDIT1);</span></div><div class="line">	<span class="comment">//num2 = GetDlgItemInt(IDC_EDIT2);</span></div><div class="line"></div><div class="line">	num1 = atoi(ch1); </div><div class="line">	num2 = atoi(ch2); </div><div class="line">	num3 = num1 + num2; </div><div class="line"></div><div class="line">	itoa(num3,ch3,<span class="number">10</span>);</div><div class="line">	m_edit3.SetWindowText(ch3);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="第六种方式"><a href="#第六种方式" class="headerlink" title="第六种方式"></a>第六种方式</h4><p>　　修改代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> num1, num2, num3; </div><div class="line">	<span class="keyword">char</span> ch1[<span class="number">10</span>], ch2[<span class="number">10</span>], ch3[<span class="number">10</span>]; </div><div class="line"></div><div class="line">	::SendMessage(GetDlgItem(IDC_EDIT1)-&gt;m_hWnd, WM_GETTEXT, <span class="number">10</span>, (LPARAM)ch1);</div><div class="line">	::SendMessage(m_edit2.m_hWnd, WM_GETTEXT, <span class="number">10</span>, (LPARAM)ch2);</div><div class="line"></div><div class="line">	num1 = atoi(ch1); </div><div class="line">	num2 = atoi(ch2); </div><div class="line">	num3 = num1 + num2; </div><div class="line"></div><div class="line">	itoa(num3,ch3,<span class="number">10</span>);</div><div class="line">	m_edit3.SendMessage(WM_SETTEXT, <span class="number">0</span>, (LPARAM)ch3);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="第七种方式"><a href="#第七种方式" class="headerlink" title="第七种方式"></a>第七种方式</h4><p>　　修改代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTestDlg::OnBtnAdd() </div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> num1, num2, num3; </div><div class="line">	<span class="keyword">char</span> ch1[<span class="number">10</span>], ch2[<span class="number">10</span>], ch3[<span class="number">10</span>]; </div><div class="line">	</div><div class="line">	SendDlgItemMessage(IDC_EDIT1, WM_GETTEXT, <span class="number">10</span>, (LPARAM)ch1);</div><div class="line">	SendDlgItemMessage(IDC_EDIT2, WM_GETTEXT, <span class="number">10</span>, (LPARAM)ch2);</div><div class="line">	</div><div class="line">num1 = atoi(ch1); </div><div class="line">	num2 = atoi(ch2); </div><div class="line">	num3 = num1 + num2; </div><div class="line"></div><div class="line">	itoa(num3,ch3,<span class="number">10</span>);</div><div class="line">	SendDlgItemMessage(IDC_EDIT3, WM_SETTEXT, <span class="number">0</span>, (LPARAM)ch3);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　获得编辑框复选的内容：<br>　　在上述代码最后添加：<br>    SendDlgItemMessage(IDC_EDIT3, EM_SETSEL, 0, -1); //0,-1表示全选若1,3表示选中1-3位复选<br>    m_edit3.SetFocus();</p>
<p>　　效果：<br> <img src="http://img.blog.csdn.net/20170415152614010?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>1    GetDlgItem()-&gt;Get(Set)WindowTest()<br>2    GetDlgItemText()/SetDlgItemText()<br>3    GetDlgItemInt()/SetDlgItemInt()<br>4    将控件和整型变量相关联<br>5    将控件和控件变量相关联<br>6    SendMessage()<br>7    SendDlgItemMessage()<br>　　最常用是1、4、5。在利用MFC编程时，6、7用得少。</p>
<h2 id="对话框伸缩功能的实现"><a href="#对话框伸缩功能的实现" class="headerlink" title="对话框伸缩功能的实现"></a>对话框伸缩功能的实现</h2><p>　　对话框上再添加一个按钮，Caption设置为“收缩&lt;&lt;”点击ClassWizard，添加一个命令相应函数（BN_CLICKED）。具体实现代码为：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTestDlg::OnButton1() </div><div class="line">&#123;</div><div class="line">	CString str; </div><div class="line">	<span class="keyword">if</span>(GetDlgItemText(IDC_BUTTON1,str), str == <span class="string">"收缩&lt;&lt;"</span>)</div><div class="line">	&#123;</div><div class="line">		SetDlgItemText(IDC_BUTTON1, <span class="string">"拓展&gt;&gt;"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		SetDlgItemText(IDC_BUTTON1, <span class="string">"收缩&lt;&lt;"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　拖动一个图像控件来划分对话框中要动态切除的部分。<br> <img src="http://img.blog.csdn.net/20170415152648992?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　修改该控件ID为IDC_SEPATATOR，styles选项卡勾上Sunken选项。<br>　　修改代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTestDlg::OnButton1() </div><div class="line">&#123;</div><div class="line">	CString str; </div><div class="line">	<span class="keyword">if</span>(GetDlgItemText(IDC_BUTTON1,str), str == <span class="string">"收缩&lt;&lt;"</span>)</div><div class="line">	&#123;</div><div class="line">		SetDlgItemText(IDC_BUTTON1, <span class="string">"拓展&gt;&gt;"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		SetDlgItemText(IDC_BUTTON1, <span class="string">"收缩&lt;&lt;"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">static</span> CRect rectLarge;</div><div class="line">	<span class="keyword">static</span> CRect rectSmall;</div><div class="line"></div><div class="line">	<span class="function">CRect <span class="title">rect1</span><span class="params">(<span class="number">10</span>,<span class="number">10</span>,<span class="number">10</span>,<span class="number">10</span>)</span></span>;</div><div class="line">	<span class="function">CRect <span class="title">rect2</span><span class="params">(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span></span>;</div><div class="line"></div><div class="line">	<span class="keyword">if</span>(rectLarge.IsRectNull())</div><div class="line">	&#123;</div><div class="line">		CRect rectSeparator;</div><div class="line">		GetWindowRect(&amp;rectLarge);</div><div class="line">		GetDlgItem(IDC_SEPARATOR)-&gt;GetWindowRect(&amp;rectSeparator);</div><div class="line"></div><div class="line">		rectSmall.left=rectLarge.left;</div><div class="line">		rectSmall.top=rectLarge.top;</div><div class="line">		rectSmall.right=rectLarge.right;</div><div class="line">		rectSmall.bottom=rectSeparator.bottom;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span>(str == <span class="string">"收缩&lt;&lt;"</span>)</div><div class="line">	&#123;</div><div class="line">		SetWindowPos(<span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>, rectSmall.Width(), rectSmall.Height(), SWP_NOMOVE | SWP_NOZORDER);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		SetWindowPos(<span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>, rectLarge.Width(), rectLarge.Height(), SWP_NOMOVE | SWP_NOZORDER);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　效果：<br> <img src="http://img.blog.csdn.net/20170415152705855?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　点击“收缩&lt;&lt;”：<br> <img src="http://img.blog.csdn.net/20170415152725793?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　若希望隐藏分隔条，则设置属性去掉“Visible”前的勾。</p>
<h2 id="输入焦点的传递"><a href="#输入焦点的传递" class="headerlink" title="输入焦点的传递"></a>输入焦点的传递</h2><p>　　为了屏蔽掉默认的回车键关闭对话框这一功能，应该在对话框子类（此处是CTestDlg类）中重写OK按钮的消息响应函数。<br>　　首先点击OK按钮，添加鼠标单击消息响应函数。注释掉原有函数。</p>
<h3 id="法一"><a href="#法一" class="headerlink" title="法一"></a>法一</h3><p>　　在ClassView选项卡的CTestDlg类添加WM_INITDIALOG消息的响应函数。对类右键，选择Add Windows Message Handler，在弹出的框左侧选择WM_INITDIALOG，直接单击Add and Edit，跳转。<br>　　修改代码为：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTestDlg::OnOK() </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add extra validation here</span></div><div class="line">	</div><div class="line">	<span class="comment">//CDialog::OnOK();</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">WNDPROC prevProc;</div><div class="line">	<span class="function">LRESULT CALLBACK <span class="title">NewEditProc</span><span class="params">(</span></span></div><div class="line">		HWND hwnd,</div><div class="line">		UINT uMsg,</div><div class="line">		WPARAM wParam,</div><div class="line">		LPARAM lParam</div><div class="line">		)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span>(uMsg == WM_CHAR &amp;&amp; wParam == <span class="number">0x0d</span>)</div><div class="line">		&#123;</div><div class="line">			::SetFocus(GetNextWindow(hwnd,GW_HWNDNEXT));</div><div class="line">			<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span></div><div class="line">		&#123;</div><div class="line">			<span class="keyword">return</span> prevProc(hwnd,uMsg,wParam,lParam);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">BOOL CTestDlg::OnInitDialog() </div><div class="line">&#123;</div><div class="line">	CDialog::OnInitDialog();</div><div class="line">	prevProc=(WNDPROC)SetWindowLong(GetDlgItem(IDC_EDIT1)-&gt;m_hWnd,</div><div class="line">		GWL_WNDPROC, (LONG)NewEditProc);</div><div class="line">	<span class="keyword">return</span> TRUE;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　查看第一个编辑框的属性，打开styles选项卡，勾上MultiLine（多行）。即可实现焦点的传递。</p>
<h3 id="法二"><a href="#法二" class="headerlink" title="法二"></a>法二</h3><p>　　只需要改变一行代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">WNDPROC prevProc;</div><div class="line">	<span class="function">LRESULT CALLBACK <span class="title">NewEditProc</span><span class="params">(</span></span></div><div class="line">		HWND hwnd,</div><div class="line">		UINT uMsg,</div><div class="line">		WPARAM wParam,</div><div class="line">		LPARAM lParam</div><div class="line">		)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span>(uMsg == WM_CHAR &amp;&amp; wParam == <span class="number">0x0d</span>)</div><div class="line">		&#123;</div><div class="line">			<span class="comment">//::SetFocus(GetNextWindow(hwnd,GW_HWNDNEXT));</span></div><div class="line">			SetFocus(::GetWindow(hwnd,GW_HWNDNEXT));</div><div class="line">			<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span></div><div class="line">		&#123;</div><div class="line">			<span class="keyword">return</span> prevProc(hwnd,uMsg,wParam,lParam);</div><div class="line">		&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<h3 id="法三"><a href="#法三" class="headerlink" title="法三"></a>法三</h3><p>　　编辑框属性有一个WS_TABSTOP，如果勾选了，则在对话框中按下Tab键后，输入焦点可以转移到此控件上。</p>
<p>　　修改一行代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">WNDPROC prevProc;</div><div class="line">	<span class="function">LRESULT CALLBACK <span class="title">NewEditProc</span><span class="params">(</span></span></div><div class="line">		HWND hwnd,</div><div class="line">		UINT uMsg,</div><div class="line">		WPARAM wParam,</div><div class="line">		LPARAM lParam</div><div class="line">		)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span>(uMsg == WM_CHAR &amp;&amp; wParam == <span class="number">0x0d</span>)</div><div class="line">		&#123;</div><div class="line">			SetFocus(::GetNextDlgTabItem(::GetParent(hwnd),hwnd,FALSE));</div><div class="line">			<span class="comment">//::SetFocus(GetNextWindow(hwnd,GW_HWNDNEXT));</span></div><div class="line">			<span class="comment">//SetFocus(::GetWindow(hwnd,GW_HWNDNEXT));</span></div><div class="line">			<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span></div><div class="line">		&#123;</div><div class="line">			<span class="keyword">return</span> prevProc(hwnd,uMsg,wParam,lParam);</div><div class="line">		&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>　　三种方法的缺点：只修改了第一个编辑框的窗口过程，因此从第二到第三个编辑框的焦点转移无法实现，除非继续修改第二个编辑窗口。</p>
<p>　　再介绍一种方法解决这个问题。</p>
<h3 id="法四"><a href="#法四" class="headerlink" title="法四"></a>法四</h3><p>　　在MFC中，默认情况下，当在对话框窗口中按下回车键时，会调用对话框的默认按钮的响应函数，我们可以在此默认按钮的响应函数中把焦点依次向下传递。</p>
<p>　　首先取消第一个编辑框的MultiLine。<br>　　接着修改OnOK函数为：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTestDlg::OnOK() </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add extra validation here</span></div><div class="line">	<span class="comment">//GetDlgItem(IDC_EDIT1)-&gt;GetNextWindow()-&gt;SetFocus();</span></div><div class="line">	<span class="comment">//GetFocus()-&gt;GetNextWindow()-&gt;SetFocus();</span></div><div class="line">	<span class="comment">//GetFocus()-&gt;GetWindow(GW_HWNDNEXT)-&gt;SetFocus();</span></div><div class="line">	GetNextDlgTabItem(GetFocus())-&gt;SetFocus();</div><div class="line">	<span class="comment">//CDialog::OnOK();</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　注释掉的部分是各种失败的尝试，各有各的bug。现在程序是正常的。</p>
<pre><code>**注意：然而该屏蔽回车键的方法并非是常规做法，应该在PreTranslateMessage中进行拦截。（return TRUE即拦截）**
</code></pre><p>　　具体做法：<br>　　现在Testdlg.h中添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> CTestDlg : <span class="keyword">public</span> CDialog</div><div class="line">&#123;</div><div class="line"></div><div class="line"><span class="keyword">protected</span>:</div><div class="line">	<span class="function"><span class="keyword">virtual</span> BOOL <span class="title">PreTranslateMessage</span><span class="params">(MSG* pMsg)</span></span>;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnOK</span><span class="params">()</span></span>;</div><div class="line">……</div></pre></td></tr></table></figure></p>
<p>　　接着：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">CTestDlg::PreTranslateMessage(MSG* pMsg)</div><div class="line">&#123;</div><div class="line">	<span class="comment">//屏蔽ESC关闭窗体</span></div><div class="line">	<span class="keyword">if</span> (pMsg-&gt;message == WM_KEYDOWN &amp;&amp; pMsg-&gt;wParam == VK_ESCAPE)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> TRUE;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//屏蔽回车关闭窗体，但会导致回车在窗体上失效.</span></div><div class="line">	<span class="comment">/*</span></div><div class="line">	if (pMsg-&gt;message == WM_KEYDOWN &amp;&amp; pMsg-&gt;wParam == VK_RETURN &amp;&amp; pMsg-&gt;wParam)</div><div class="line">	&#123;</div><div class="line">		return TRUE;</div><div class="line">	&#125;</div><div class="line">	*/</div><div class="line">	<span class="keyword">else</span> </div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> CDialog::PreTranslateMessage(pMsg);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CTestDlg::OnOK() </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add extra validation here</span></div><div class="line">	</div><div class="line">	<span class="comment">//CDialog::OnOK();</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　点击Layout-Tab order，这些序号就是各控件的Tab顺序。顺序可改变，依次点击希望的顺序控件即可。</p>
<p>　　调用顺序：当用户按下回车键时，Windows将查看对话框中是否存在指定的默认按钮，如果有，就调用该默认按钮单击消息的响应函数。如果没有，就会调用虚拟的OnOK函数，即使对话框没有包含默认的OK按钮（这个默认OK按钮的ID是IDOK）。</p>
<h1 id="文件和注册表操作"><a href="#文件和注册表操作" class="headerlink" title="文件和注册表操作"></a>文件和注册表操作</h1><h2 id="c语言对文件操作的支持"><a href="#C语言对文件操作的支持" class="headerlink" title="C语言对文件操作的支持"></a>C语言对文件操作的支持</h2><p>　　新建单文档类型的MFC应用程序，工程名为File，并为主菜单添加一个子菜单，名称为“文件操作”，然后为其添加两个菜单项，并分别为它们添加相应的命令响应函数（通过COMMAND），让CFileView类接收这些菜单项的命令响应。<br> <img src="http://img.blog.csdn.net/20170420224900928?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br> <img src="http://img.blog.csdn.net/20170420224921428?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="文件的打开和写入"><a href="#文件的打开和写入" class="headerlink" title="文件的打开和写入"></a>文件的打开和写入</h3><p>　　代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </div><div class="line">&#123;</div><div class="line">	FILE *pFile = fopen(<span class="string">"1.txt"</span>,<span class="string">"w"</span>);</div><div class="line">	fwrite(<span class="string">"http://www.sunxin.org"</span>, <span class="number">1</span>, <span class="built_in">strlen</span>(<span class="string">"http://www.sunxin.org"</span>), pFile); </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　编译后可看到文件夹中生成了1.txt，打开有一行网址。</p>
<h3 id="文件的关闭"><a href="#文件的关闭" class="headerlink" title="文件的关闭"></a>文件的关闭</h3><p>　　增加一行代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </div><div class="line">&#123;</div><div class="line">	FILE *pFile = fopen(<span class="string">"1.txt"</span>,<span class="string">"w"</span>);</div><div class="line">	fwrite(<span class="string">"http://www.sunxin.org"</span>, <span class="number">1</span>, <span class="built_in">strlen</span>(<span class="string">"http://www.sunxin.org"</span>), pFile); </div><div class="line">	fclose(pFile);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="文件指针定位"><a href="#文件指针定位" class="headerlink" title="文件指针定位"></a>文件指针定位</h3><p>　　代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </div><div class="line">&#123;</div><div class="line">	FILE *pFile = fopen(<span class="string">"1.txt"</span>,<span class="string">"w"</span>);</div><div class="line">	fwrite(<span class="string">"http://www.sunxin.org"</span>, <span class="number">1</span>, <span class="built_in">strlen</span>(<span class="string">"http://www.sunxin.org"</span>), pFile); </div><div class="line">	fwrite(<span class="string">"欢迎访问"</span>, <span class="number">1</span>, <span class="built_in">strlen</span>(<span class="string">"欢迎访问"</span>), pFile);</div><div class="line">	fclose(pFile);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　显示：<a href="http://www.sunxin.org欢迎访问" target="_blank" rel="external">http://www.sunxin.org欢迎访问</a></p>
<p>　　将文件指针移动到文件的开始位置处：<br>　　代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </div><div class="line">&#123;</div><div class="line">	FILE *pFile = fopen(<span class="string">"1.txt"</span>,<span class="string">"w"</span>);</div><div class="line">	fwrite(<span class="string">"http://www.sunxin.org"</span>, <span class="number">1</span>, <span class="built_in">strlen</span>(<span class="string">"http://www.sunxin.org"</span>), pFile); </div><div class="line">	fseek(pFile, <span class="number">0</span>, SEEK_SET);</div><div class="line">	fwrite(<span class="string">"ftp:"</span>, <span class="number">1</span>, <span class="built_in">strlen</span>(<span class="string">"ftp:"</span>),pFile);</div><div class="line">	<span class="comment">//fwrite("欢迎访问", 1, strlen("欢迎访问"), pFile);</span></div><div class="line">	fclose(pFile);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　显示：ftp:://www.sunxin.org</p>
<h3 id="文件的读取"><a href="#文件的读取" class="headerlink" title="文件的读取"></a>文件的读取</h3><p>　　在OnFileRead函数中写入代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CFileView::OnFileRead() </div><div class="line">&#123;</div><div class="line">	FILE *pFile = fopen(<span class="string">"1.txt"</span>,<span class="string">"r"</span>);</div><div class="line">	<span class="keyword">char</span> ch[<span class="number">100</span>];</div><div class="line">	fread(ch, <span class="number">1</span>, <span class="number">100</span>, pFile);</div><div class="line">	fclose(pFile);</div><div class="line">	MessageBox(ch);</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　编译运行：<br>　　<br> <img src="http://img.blog.csdn.net/20170420224951225?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　原因：C语言以“\0”结束。</p>
<p>　　解决方法：<br>　　法一：<br>　　修改代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </div><div class="line">&#123;</div><div class="line">	FILE *pFile = fopen(<span class="string">"1.txt"</span>,<span class="string">"w"</span>);</div><div class="line">	<span class="keyword">char</span> buf[<span class="number">22</span>] = <span class="string">"http://www.sunxin.org"</span>;</div><div class="line">	buf[<span class="number">21</span>] = <span class="string">'\0'</span>;</div><div class="line">	fwrite(buf, <span class="number">1</span>, <span class="number">22</span>, pFile);</div><div class="line">	fclose(pFile);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　先点击写入文件，再点击读取文件，就可以看到正确的内容。<br>　　缺点：增加了文件大小。</p>
<p>法二：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CFileView::OnFileRead() </div><div class="line">&#123;</div><div class="line">	FILE *pFile = fopen(<span class="string">"1.txt"</span>,<span class="string">"r"</span>);</div><div class="line">	<span class="keyword">char</span> ch[<span class="number">100</span>];</div><div class="line">	<span class="built_in">memset</span>(ch, <span class="number">0</span>, <span class="number">100</span>);</div><div class="line">	fread(ch, <span class="number">1</span>, <span class="number">100</span>, pFile);</div><div class="line">	fclose(pFile);</div><div class="line">	MessageBox(ch);</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>法三：<br>　　读取文件时，不知道文件大小时的做法。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CFileView::OnFileRead() </div><div class="line">&#123;</div><div class="line">	FILE *pFile = fopen(<span class="string">"1.txt"</span>,<span class="string">"r"</span>);</div><div class="line">	<span class="keyword">char</span> *pBuf;</div><div class="line">	fseek(pFile, <span class="number">0</span>, SEEK_END);</div><div class="line">	<span class="keyword">int</span> len=ftell(pFile);</div><div class="line">	pBuf = <span class="keyword">new</span> <span class="keyword">char</span>[len+<span class="number">1</span>];</div><div class="line">	rewind(pFile);</div><div class="line">	fread(pBuf, <span class="number">1</span>, len, pFile);</div><div class="line">	pBuf[len] = <span class="number">0</span>;</div><div class="line">	fclose(pFile);</div><div class="line">	MessageBox(pBuf);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="二进制文件和文本文件"><a href="#二进制文件和文本文件" class="headerlink" title="二进制文件和文本文件"></a>二进制文件和文本文件</h3><p>　　代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </div><div class="line">&#123;</div><div class="line">	FILE *pFile = fopen(<span class="string">"2.txt"</span>, <span class="string">"w"</span>);</div><div class="line">	<span class="keyword">char</span> ch[<span class="number">3</span>];</div><div class="line">	ch[<span class="number">0</span>] = <span class="string">'a'</span>;</div><div class="line">	ch[<span class="number">1</span>] = <span class="number">10</span>;</div><div class="line">	ch[<span class="number">2</span>] = <span class="string">'b'</span>;</div><div class="line">	fwrite(ch, <span class="number">1</span>, <span class="number">3</span>, pFile);</div><div class="line">	fclose(pFile);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CFileView::OnFileRead() </div><div class="line">&#123;</div><div class="line">	FILE *pFile = fopen(<span class="string">"2.txt"</span>,<span class="string">"r"</span>);</div><div class="line">	<span class="keyword">char</span> ch[<span class="number">100</span>];</div><div class="line">	fread(ch, <span class="number">1</span>, <span class="number">3</span>, pFile);</div><div class="line">	ch[<span class="number">3</span>] = <span class="number">0</span>;</div><div class="line">	fclose(pFile);</div><div class="line">	MessageBox(ch);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　效果：<br>　　<br> <img src="http://img.blog.csdn.net/20170420225018961?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　文本方式：10实际上是换行符的ASCII码。</p>
<p>　　以文本方式和二进制方式读取文件是有明显的区别的。</p>
<h3 id="文本方式和二进制方式"><a href="#文本方式和二进制方式" class="headerlink" title="文本方式和二进制方式"></a>文本方式和二进制方式</h3><p>　　二进制方式：换行是由两个字符组成的，即ASCII码10（回车符）和13（换行符）。<br>　　写入和读取文件时要保持一致。如果采用文本方式写入，应采用文本方式读取；如果采用二进制方式写入数据，在读取时也应采用二进制方式。</p>
<p>　　面试题：给你一个整数，如：98341，将这个整数保存到文件中，要求在以记事本程序打开该文件时，显示的是：98341。<br>　　法一：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </div><div class="line">&#123;</div><div class="line">	FILE *pFile = fopen(<span class="string">"3.txt"</span>, <span class="string">"w"</span>);</div><div class="line">	<span class="keyword">char</span> ch[<span class="number">5</span>];</div><div class="line">	ch[<span class="number">0</span>] = <span class="number">9</span> + <span class="number">48</span>;</div><div class="line">	ch[<span class="number">1</span>] = <span class="number">8</span> + <span class="number">48</span>;</div><div class="line">	ch[<span class="number">2</span>] = <span class="number">3</span> + <span class="number">48</span>;</div><div class="line">	ch[<span class="number">3</span>] = <span class="number">4</span> + <span class="number">48</span>;</div><div class="line">	ch[<span class="number">4</span>] = <span class="number">1</span> + <span class="number">48</span>;</div><div class="line"></div><div class="line">	fwrite(ch, <span class="number">1</span>, <span class="number">5</span>, pFile);</div><div class="line">	fclose(pFile);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　或</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </div><div class="line">&#123;</div><div class="line">	FILE *pFile = fopen(<span class="string">"3.txt"</span>, <span class="string">"w"</span>);</div><div class="line">	<span class="keyword">int</span> i = <span class="number">98341</span>;</div><div class="line">	<span class="keyword">char</span> ch[<span class="number">5</span>];</div><div class="line">	itoa(i, ch, <span class="number">10</span>);</div><div class="line"></div><div class="line">	fwrite(ch, <span class="number">1</span>, <span class="number">5</span>, pFile);</div><div class="line">	fclose(pFile);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>　　面试题：给定一个字符串，其中既有数字字符，又有26个英文字母中的几个字符，让你判断一下哪些是数字字符。</p>
<p>　　对这种问题，实际上就是判断各字符的ASCII码，对于数字字符来说，它们的ASCII码大于等于48，小于等于57。</p>
<h2 id="c对文件操作的支持"><a href="#C-对文件操作的支持" class="headerlink" title="C++对文件操作的支持"></a>C++对文件操作的支持</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </div><div class="line">&#123;</div><div class="line">	<span class="function">ofstream <span class="title">ofs</span><span class="params">(<span class="string">"4.txt"</span>)</span></span>;</div><div class="line">	ofs.write(<span class="string">"http://www.sunxin.org"</span>,<span class="built_in">strlen</span>(<span class="string">"http://www.sunxin.org"</span>));</div><div class="line">	ofs.close;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CFileView::OnFileRead() </div><div class="line">&#123;</div><div class="line">	<span class="function">ifstream <span class="title">ifs</span><span class="params">(<span class="string">"4.txt"</span>)</span></span>;</div><div class="line">	<span class="keyword">char</span> ch[<span class="number">100</span>];</div><div class="line">	<span class="built_in">memset</span>(ch, <span class="number">0</span>, <span class="number">100</span>);</div><div class="line">	ifs.read(ch,<span class="number">100</span>);</div><div class="line">	ifs.close();</div><div class="line">	MessageBox(ch);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="win32-api-对文件操作的支持"><a href="#Win32-API-对文件操作的支持" class="headerlink" title="Win32 API 对文件操作的支持"></a>Win32 API 对文件操作的支持</h2><h3 id="文件的创建-打开和写入"><a href="#文件的创建、打开和写入" class="headerlink" title="文件的创建、打开和写入"></a>文件的创建、打开和写入</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CFileView::OnFileWrite() </div><div class="line">&#123;</div><div class="line">	<span class="comment">//定义一个句柄变量</span></div><div class="line">	HANDLE hFile;</div><div class="line">	<span class="comment">//创建文件</span></div><div class="line">	hFile = CreateFile(<span class="string">"5.txt"</span>, GENERIC_WRITE, <span class="number">0</span>, <span class="literal">NULL</span>, CREATE_NEW, </div><div class="line">		FILE_ATTRIBUTE_NORMAL, <span class="literal">NULL</span>);</div><div class="line">	<span class="comment">//接收实际写入的字节数</span></div><div class="line">	DWORD dwWrites;</div><div class="line">	<span class="comment">//写入数据</span></div><div class="line">	WriteFile(hFile,<span class="string">"http://www.sunxin.org"</span>,<span class="built_in">strlen</span>(<span class="string">"http://www.sunxin.org"</span>),</div><div class="line">		&amp;dwWrites, <span class="literal">NULL</span>);</div><div class="line">	<span class="comment">//关闭文件句柄</span></div><div class="line">	CloseHandle(hFile);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="文件的读取"><a href="#文件的读取-1" class="headerlink" title="文件的读取"></a>文件的读取</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CFileView::OnFileRead() </div><div class="line">&#123;</div><div class="line">	HANDLE hFile;</div><div class="line">	<span class="comment">//打开文件</span></div><div class="line">	hFile = CreateFile(<span class="string">"5.txt"</span>, GENERIC_READ, <span class="number">0</span>, <span class="literal">NULL</span>, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, <span class="literal">NULL</span>);</div><div class="line">	<span class="comment">//接收实际收到的数据</span></div><div class="line">	<span class="keyword">char</span> ch[<span class="number">100</span>];</div><div class="line">	<span class="comment">//接收实际读取到的字节数</span></div><div class="line">	DWORD dwReads;</div><div class="line">	<span class="comment">//读取数据</span></div><div class="line">	ReadFile(hFile, ch, <span class="number">100</span>, &amp;dwReads, <span class="literal">NULL</span>);</div><div class="line">	<span class="comment">//设置字符串结束字符</span></div><div class="line">	ch[dwReads] = <span class="number">0</span>;</div><div class="line">	<span class="comment">//关闭打开的文件对象的句柄</span></div><div class="line">	CloseHandle(hFile);</div><div class="line">	<span class="comment">//显示读取到的数据</span></div><div class="line">	MessageBox(ch);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="菜单"><a href="#菜单" class="headerlink" title="菜单"></a>菜单</h1><h2 id="菜单命令响应函数"><a href="#菜单命令响应函数" class="headerlink" title="菜单命令响应函数"></a>菜单命令响应函数</h2><p>　　新建一个单文档的MFC AppWizard(exe)工程，工程名为Menu。Build运行。</p>
<p> <img src="http://img.blog.csdn.net/20170420225058617?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>　　左上角点击按钮，可以让属性框始终显示，不会因为点击对话框以外的地方就消失。<br>　　去掉Pop-up弹出前的勾，将ID改为ID_TEST。给Test添加响应函数在CMainFrame中，在函数中加入    MessageBox(“MainFrame Clicked”);<br>　　效果：<br> <img src="http://img.blog.csdn.net/20170420225116851?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="菜单命令的路由"><a href="#菜单命令的路由" class="headerlink" title="菜单命令的路由"></a>菜单命令的路由</h2><h3 id="程序类对菜单命令的响应顺序"><a href="#程序类对菜单命令的响应顺序" class="headerlink" title="程序类对菜单命令的响应顺序"></a>程序类对菜单命令的响应顺序</h3><p>　　响应Test<br>　　菜单项命令的顺序依次是：视类、文档类、框架类，最后才是应用程序类。</p>
<h3 id="windows消息的分类"><a href="#Windows消息的分类" class="headerlink" title="Windows消息的分类"></a>Windows消息的分类</h3><p>　　凡是从CWnd派生的类，它们既可以接收标准消息，也可以接收命令消息和通告消息。而对于那些从CCmdTarget派生的类，则只能接收命令消息和通告消息，不能接收标准消息。<br>本例中的文档类（CMenuDoc）和应用程序类（CWinApp），因为它们都派生于CCmdTarget类，所以它们可以接收菜单命令消息。但它们不是从CWnd类派生的，所以不能接收标准消息。</p>
<h3 id="菜单命令的路由"><a href="#菜单命令的路由-1" class="headerlink" title="菜单命令的路由"></a>菜单命令的路由</h3><p>　　菜单命令消息路由的具体过程：当点击某个菜单项时，最先接收到这个菜单命令消息的是框架类。框架类将把接收到的这个消息交给它的子窗口，即视类，由视类首先进行处理。视类首先根据命令消息映射机制查找自身是否对此消息进行了响应，如果响应了，就调用相应响应函数对这个消息进行处理，消息路由过程结束；如果视类没有对此命令消息做出响应，就交由文档类，文档类同样查找自身是否对这个菜单命令进行了响应，如果响应了，就由文档类的命令消息响应函数进行处理，路由过程结束。如果文档类也未做出响应，就把这个命令消息交还给视类，后者又把该消息交还给框架类。框架类查看自己是否对这个命令消息进行了响应，如果它也没有做出响应，就把这个菜单命令消息交给应用程序类，由后者来进行处理。</p>
<h2 id="基本菜单操作"><a href="#基本菜单操作" class="headerlink" title="基本菜单操作"></a>基本菜单操作</h2><h3 id="标记菜单"><a href="#标记菜单" class="headerlink" title="标记菜单"></a>标记菜单</h3><p>　　运行刚才创建的Menu程序，点击查看，前面都有一个对号，这种类型就是标记菜单。<br>在CMainFrame类的OnCreate的return语句之前添加这句代码    GetMenu()-&gt;GetSubMenu(0)-&gt;CheckMenuItem(0, MF_BYPOSITION | MF_CHECKED);  或者GetMenu()-&gt;GetSubMenu(0)-&gt;CheckMenuItem(ID_FILE_NEW, MF_BYCOMMAND | MF_CHECKED);<br>　　Build并运行，可发现新建左边已添加一个复选标记。</p>
<h3 id="默认菜单项"><a href="#默认菜单项" class="headerlink" title="默认菜单项"></a>默认菜单项</h3><p>　　在刚才的代码下，添加    GetMenu()-&gt;GetSubMenu(0)-&gt;SetDefaultItem(1, TRUE); 或者GetMenu()-&gt;GetSubMenu(0)-&gt;SetDefaultItem(ID_FILE_OPEN,  FALSE);  编译运行，会发现“打开”变成了粗体。</p>
<p>　　<strong>注意：“打印”的索引是5，不是4。计算菜单项索引时，一定要把分割栏菜单项计算在内。并且，一个子菜单只能有一个默认菜单项。</strong></p>
<h3 id="图形标记菜单"><a href="#图形标记菜单" class="headerlink" title="图形标记菜单"></a>图形标记菜单</h3><p>　　Insert-Resource-Bitmap，创建一个位图资源。如图。<br> <img src="http://img.blog.csdn.net/20170420225150945?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>　　为CMainFrame类添加一个CBitmap类型的成员变量：m_bitmap。</p>
<p>　　接着添加代码：<br>    CString str;<br>    str.Format(“x=%d”,y=%d”, GetSystemMetrics(SM_CXMENUCHECK),GetSystemMetrics(SM_CYMENUCHECK));<br>    MessageBox(str);<br>    m_bitmap.LoadBitmap(IDB_BITMAP1);<br>    GetMenu()-&gt;GetSubMenu(0)-&gt;SetMenuItemBitmaps(0, MF_BYPOSITION, &amp;m_bitmap, &amp;m_bitmap);</p>
<h3 id="禁用菜单项"><a href="#禁用菜单项" class="headerlink" title="禁用菜单项"></a>禁用菜单项</h3><p>　　通常把MF_GRAYED和MF_DISABLED这两个标志放在一起使用。不过这么做并不是必需的。<br>　　删除之前的代码，写入    GetMenu()-&gt;GetSubMenu(0)-&gt;EnableMenuItem(1, MF_BYPOSITION | MF_DISABLED | MF_GRAYED);<br>　　打开“文件”子菜单，发现“打开”菜单栏变灰，点击不起作用。</p>
<h3 id="移除和装载菜单"><a href="#移除和装载菜单" class="headerlink" title="移除和装载菜单"></a>移除和装载菜单</h3><p>　　再添加一行代码：    SetMenu(NULL);  此时菜单栏被移除了。<br>　　再添加几行代码：<br>CMenu menu;<br>    menu.LoadMenu(IDR_MAINFRAME);<br>    SetMenu(&amp;menu);<br>    menu.Detach();<br>　　此时菜单栏又装载了。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">CMenu menu;</div><div class="line">menu.CreateMenu();</div><div class="line">GetMenu()-&gt;AppendMenu(MF_POPUP, (UINT)menu.m_hMenu, <span class="string">"Test1"</span>);</div><div class="line">menu.AppendMenu(MF_STRING, <span class="number">111</span>, <span class="string">"Hello"</span>);</div><div class="line">menu.AppendMenu(MF_STRING, <span class="number">112</span>, <span class="string">"Bye"</span>);</div><div class="line">menu.AppendMenu(MF_STRING, <span class="number">113</span>, <span class="string">"Mybole"</span>);</div><div class="line"></div><div class="line"></div><div class="line">menu.Detach();</div><div class="line"></div><div class="line">CMenu menu1;</div><div class="line">menu1.CreateMenu();</div><div class="line">GetMenu()-&gt;InsertMenu(<span class="number">2</span>, MF_POPUP | MF_BYPOSITION, (UINT)menu1. m_hMenu,<span class="string">"Test"</span>);</div><div class="line"></div><div class="line"></div><div class="line">menu1.Detach();</div><div class="line"></div><div class="line">GetMenu()-&gt;GetSubMenu(<span class="number">2</span>)-&gt;AppendMenu(MF_STRING, <span class="number">118</span>, <span class="string">"Welcome"</span>);</div><div class="line">GetMenu()-&gt;GetSubMenu(<span class="number">0</span>)-&gt;AppendMenu(MF_STRING, <span class="number">114</span>, <span class="string">"Welcome"</span>);</div><div class="line">GetMenu()-&gt;GetSubMenu(<span class="number">0</span>)-&gt;InsertMenu(ID_FILE_OPEN, MF_BYCOMMAND | MF_STRING, <span class="number">115</span>, <span class="string">"VC编程"</span>);</div></pre></td></tr></table></figure></p>
<h3 id="mfc菜单命令更新机制"><a href="#MFC菜单命令更新机制" class="headerlink" title="MFC菜单命令更新机制"></a>MFC菜单命令更新机制</h3><p> <img src="http://img.blog.csdn.net/20170420225218087?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　MFC命令更新机制：当要显示菜单时，操作系统发出WM_INITMENUPOPOP消息，然后由程序窗口的基类如CFrameWnd接管，它会创建一个CCmdUI对象，并与程序的第一个菜单项相关联，调用该对象的一个成员函数DoUpdate()。这个函数发出CN_UPDATE_COMMAND_UI消息，这条消息带有一个指向CCmdUI对象的指针。这时，系统会判断是否存在一个ON_UPDATE_COMMAND_UI宏去捕获这个菜单项消息。如果找到这样一个宏，就调用相应的消息响应函数进行处理，在这个函数中，可以利用传递过来的CCmdUI对象去调用相应的函数，使该菜单项可以使用，或禁用该菜单项。当更新完第一个菜单项后，同一个CCmdUI对象就设置为与第二个菜单项相关联，依此顺序进行，直到完成所有菜单项的处理。</p>
<p>　　添加代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CMainFrame::OnUpdateEditCut(CCmdUI* pCmdUI) </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your command update UI handler code here</span></div><div class="line">	pCmdUI-&gt;Enable();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　编辑-剪切 可用了。<br>　　如果要把工具栏上的一个工具按钮与菜单栏中的某个菜单项相关联，只要将它们的ID设置为同一个标识就可以了。</p>
<p>　　如果希望禁用文件-新建，为ID_FILE_NEW添加UPDATE_COMMAND_UI消息响应函数。<br>　　代码如下：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">void</span> CMainFrame::OnUpdateFileNew(CCmdUI* pCmdUI) </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your command update UI handler code here</span></div><div class="line">	pCmdUI-&gt;Enable(FALSE);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　或者<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CMainFrame::OnUpdateFileNew(CCmdUI* pCmdUI) </div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span> (<span class="number">2</span> == pCmdUI-&gt;m_nIndex)</div><div class="line">	pCmdUI-&gt;Enable();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="快捷菜单"><a href="#快捷菜单" class="headerlink" title="快捷菜单"></a>快捷菜单</h3><p>　　1. 新增一个新的菜单资源。点开，顶级菜单设置任意的文本，如abc。添加两个菜单项：<br>　　显示 IDM_SHOW<br>　　退出 IDM_EXIT<br>　　2. 给CMenuView类添加WM_RBUTTONDOWN消息响应函数。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CMenu2View::OnRButtonDown(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	CMenu menu;</div><div class="line">	menu.LoadMenu(IDR_MENU1);</div><div class="line">	CMenu* pPopup = menu.GetSubMenu(<span class="number">0</span>);</div><div class="line">	ClientToScreen(&amp;point);</div><div class="line">	pPopup-&gt;TrackPopupMenu(TPM_LEFTALIGN | TPM_RIGHTBUTTON, point.x, point.y, <span class="keyword">this</span>);</div><div class="line"></div><div class="line">	CView::OnRButtonDown(nFlags, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　效果：<br>　　<br> <img src="http://img.blog.csdn.net/20170420225352728?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>　　3.对“显示”右键ClassWizard，可以取消创建新类的询问。分别为CMainFrame类和CMenuView类添加一个响应。<br>　　代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CMenu2View::OnShow() </div><div class="line">&#123;</div><div class="line">	MessageBox(<span class="string">"View show"</span>);	</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CMainFrame::OnShow() </div><div class="line">&#123;</div><div class="line">	MessageBox(<span class="string">"Main show"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>　　结果是显示“View show”。说明只有视类才能对快捷菜单项命令做出响应。若想让CMainView类对此快捷菜单项进行响应的话，修改代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CMenu2View::OnRButtonDown(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	CMenu menu;</div><div class="line">	menu.LoadMenu(IDR_MENU1);</div><div class="line">	CMenu* pPopup = menu.GetSubMenu(<span class="number">0</span>);</div><div class="line">	ClientToScreen(&amp;point);</div><div class="line">	<span class="comment">//pPopup-&gt;TrackPopupMenu(TPM_LEFTALIGN | TPM_RIGHTBUTTON, point.x, point.y, this);</span></div><div class="line">	pPopup-&gt;TrackPopupMenu(TPM_LEFTALIGN | TPM_RIGHTBUTTON, point.x, point.y, GetParent());</div><div class="line"></div><div class="line">	CView::OnRButtonDown(nFlags, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　同时删去视类的显示。</p>
<h2 id="动态菜单操作"><a href="#动态菜单操作" class="headerlink" title="动态菜单操作"></a>动态菜单操作</h2><h3 id="添加菜单项目"><a href="#添加菜单项目" class="headerlink" title="添加菜单项目"></a>添加菜单项目</h3><p>　　在CMainFrame类的OnCreate函数中添加代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">CMenu menu;</div><div class="line">menu.CreateMenu();</div><div class="line">GetMenu()-&gt;AppendMenu(MF_POPUP, (UINT)menu.m_hMenu, <span class="string">"Test"</span>);</div><div class="line">menu.Detach();</div></pre></td></tr></table></figure></p>
<h3 id="插入菜单项目"><a href="#插入菜单项目" class="headerlink" title="插入菜单项目"></a>插入菜单项目</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">CMenu menu;</div><div class="line">menu.CreateMenu();</div><div class="line"><span class="comment">/*GetMenu()-&gt;AppendMenu(MF_POPUP, (UINT)menu.m_hMenu, "Test");</span></div><div class="line">menu.Detach();*/</div><div class="line">GetMenu()-&gt;InsertMenu(<span class="number">2</span>, MF_POPUP | MF_BYPOSITION, (UINT)menu. m_hMenu,<span class="string">"Test"</span>);</div><div class="line">menu.Detach();</div></pre></td></tr></table></figure>
<p>　　如果要在新插入的子菜单中添加菜单项的话，同样可以使用AppendMenu函数来实现。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">CMenu menu;</div><div class="line">	menu.CreateMenu();</div><div class="line">	<span class="comment">/*GetMenu()-&gt;AppendMenu(MF_POPUP, (UINT)menu.m_hMenu, "Test");</span></div><div class="line">	menu.Detach();*/</div><div class="line">	GetMenu()-&gt;InsertMenu(<span class="number">2</span>, MF_POPUP | MF_BYPOSITION, (UINT)menu. m_hMenu,<span class="string">"Test"</span>);</div><div class="line"></div><div class="line">	menu.AppendMenu(MF_STRING, <span class="number">111</span>, <span class="string">"Hello"</span>);</div><div class="line">	menu.AppendMenu(MF_STRING, <span class="number">112</span>, <span class="string">"Bye"</span>);</div><div class="line">	menu.AppendMenu(MF_STRING, <span class="number">113</span>, <span class="string">"Mybole"</span>);</div><div class="line">	menu.Detach();</div></pre></td></tr></table></figure></p>
<p>　　111、112、113是随便赋予的ID号。<br>　　<br> <img src="http://img.blog.csdn.net/20170420230125731?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　若要在“文件”子菜单下添加一个菜单项Welcome，再添加一行代码：    GetMenu()-&gt;GetSubMenu(0)-&gt;AppendMenu(MF_STRING, 114, “Welcome”);<br>　　若要在“文件”中的“新建”和“打开”插入一个菜单项VC编程，再添加一行代码：<br>    GetMenu()-&gt;GetSubMenu(0)-&gt;InsertMenu(ID_FILE_OPEN, MF_BYCOMMAND | MF_STRING, 115， “VC编程”);</p>
<h3 id="删除菜单"><a href="#删除菜单" class="headerlink" title="删除菜单"></a>删除菜单</h3><p>　　删除“编辑”：在CMainFrame类的OnCreate函数最后（return之前）添加：<br>　　GetMenu()-&gt;DeleteMenu(1, MF_BYPOSITION);<br>　　删除“文件”下的“打开”：<br>　　GetMenu()-&gt;GetSubMenu(0)-&gt;DeleteMenu(2, MF_BYPOSITION);</p>
<h3 id="动态添加的菜单项的命令响应"><a href="#动态添加的菜单项的命令响应" class="headerlink" title="动态添加的菜单项的命令响应"></a>动态添加的菜单项的命令响应</h3><p>　　Resource.h中添加新ID<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> IDM_HELLO	111</span></div><div class="line">将menu.AppendMenu(MF_STRING, <span class="number">111</span>, “Hello”); 改为 menu.AppendMenu(MF_STRING, IDM_HELLO, “Hello”);</div><div class="line"></div><div class="line">　　三部曲：</div><div class="line">　　<span class="number">1.</span>	点开MainFrm.h，增加为</div><div class="line">```C++</div><div class="line"><span class="comment">//&#123;&#123;AFX_MSG(CMainFrame)</span></div><div class="line">	<span class="function">afx_msg <span class="keyword">int</span> <span class="title">OnCreate</span><span class="params">(LPCREATESTRUCT lpCreateStruct)</span></span>;</div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnShow</span><span class="params">()</span></span>;</div><div class="line">	<span class="comment">//&#125;&#125;AFX_MSG</span></div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnHello</span><span class="params">()</span></span>;</div><div class="line">	DECLARE_MESSAGE_MAP()</div></pre></td></tr></table></figure></p>
<p>　　2. 点开MainFrm.cpp，增加为<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">BEGIN_MESSAGE_MAP(CMainFrame, CFrameWnd)</div><div class="line">	<span class="comment">//&#123;&#123;AFX_MSG_MAP(CMainFrame)</span></div><div class="line">	ON_WM_CREATE()</div><div class="line">	ON_COMMAND(IDM_SHOW, OnShow)</div><div class="line">	ON_COMMAND(IDM_HELLO, OnHello)</div><div class="line">	<span class="comment">//&#125;&#125;AFX_MSG_MAP</span></div><div class="line">END_MESSAGE_MAP()</div></pre></td></tr></table></figure></p>
<p>　　3. CMainFrame类中添加<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CMainFrame::OnHello()</div><div class="line">&#123;</div><div class="line">	MessageBox(<span class="string">"Hello"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="电话本示例程序"><a href="#电话本示例程序" class="headerlink" title="电话本示例程序"></a>电话本示例程序</h2><p>　　删除之前写入CMainFrame类的OnCreate函数，留下原始函数。</p>
<h3 id="动态添加子菜单的实现"><a href="#动态添加子菜单的实现" class="headerlink" title="动态添加子菜单的实现"></a>动态添加子菜单的实现</h3><p>　　利用ClassWizard添加WM_CHAR消息。在Menu2View.h中添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span>:</div><div class="line">	<span class="keyword">int</span> m_nIndex;</div><div class="line">	CMenu m_menu;</div></pre></td></tr></table></figure></p>
<p>在Menu2View.cpp里，添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">CMenu2View::CMenu2View()</div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> add construction code here</span></div><div class="line">	m_nIndex = <span class="number">-1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="显示输入的字符"><a href="#显示输入的字符" class="headerlink" title="显示输入的字符"></a>显示输入的字符</h3><h3 id="添加菜单项及其命令响应函数"><a href="#添加菜单项及其命令响应函数" class="headerlink" title="添加菜单项及其命令响应函数"></a>添加菜单项及其命令响应函数</h3><p>　　在资源编辑器中打开程序的菜单，在“帮助”后添加一个新菜单abc，添加4个菜单项。名称为1，ID为IDM_PHONE1，以此类推。用ClassWizard为CMenu2View类分别加上这四个菜单项的命令响应函数。<br>　　修改CMenu2View类的头文件，如下：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">protected</span>:</div><div class="line">	<span class="comment">//&#123;&#123;AFX_MSG(CMenu2View)</span></div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnRButtonDown</span><span class="params">(UINT nFlags, CPoint point)</span></span>;</div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnChar</span><span class="params">(UINT nChar, UINT nRepCnt, UINT nFlags)</span></span>;</div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnPhone1</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnPhone2</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnPhone3</span><span class="params">()</span></span>;</div><div class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnPhone4</span><span class="params">()</span></span>;</div><div class="line">	<span class="comment">//&#125;&#125;AFX_MSG</span></div><div class="line">	DECLARE_MESSAGE_MAP()</div></pre></td></tr></table></figure></p>
<p>CMenu2View.cpp中，<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">	<span class="comment">//&#123;&#123;AFX_MSG_MAP(CMenu2View)</span></div><div class="line">	ON_WM_CHAR()</div><div class="line">	<span class="comment">//&#125;&#125;AFX_MSG_MAP</span></div><div class="line">	ON_COMMAND(IDM_PHONE1, OnPhone1)</div><div class="line">	ON_COMMAND(IDM_PHONE2, OnPhone2)</div><div class="line">	ON_COMMAND(IDM_PHONE3, OnPhone3)</div><div class="line">	ON_COMMAND(IDM_PHONE4, OnPhone4)</div><div class="line">	<span class="comment">// Standard printing commands</span></div><div class="line">	ON_COMMAND(ID_FILE_PRINT, CView::OnFilePrint)</div><div class="line">	ON_COMMAND(ID_FILE_PRINT_DIRECT, CView::OnFilePrint)</div><div class="line">	ON_COMMAND(ID_FILE_PRINT_PREVIEW, CView::OnFilePrintPreview)</div><div class="line">END_MESSAGE_MAP()</div></pre></td></tr></table></figure></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CMenu2View::OnPhone1() </div><div class="line">&#123;</div><div class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</div><div class="line">	dc.TextOut(<span class="number">0</span>, <span class="number">0</span>, m_strArray.GetAt(<span class="number">0</span>));</div><div class="line">	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CMenu2View::OnPhone2() </div><div class="line">&#123;</div><div class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</div><div class="line">	dc.TextOut(<span class="number">0</span>, <span class="number">0</span>, m_strArray.GetAt(<span class="number">1</span>));</div><div class="line">	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CMenu2View::OnPhone3() </div><div class="line">&#123;</div><div class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</div><div class="line">	dc.TextOut(<span class="number">0</span>, <span class="number">0</span>, m_strArray.GetAt(<span class="number">2</span>));</div><div class="line">	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CMenu2View::OnPhone4() </div><div class="line">&#123;</div><div class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</div><div class="line">	dc.TextOut(<span class="number">0</span>, <span class="number">0</span>, m_strArray.GetAt(<span class="number">3</span>));</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="框架类窗口截获菜单命令消息"><a href="#框架类窗口截获菜单命令消息" class="headerlink" title="框架类窗口截获菜单命令消息"></a>框架类窗口截获菜单命令消息</h3><p>　　右键单击CMainFrame，选择Add Virtual Functions-OnCommand，单击Add Handler，再点击Edit Existing。<br> <img src="http://img.blog.csdn.net/20170420230209594?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>　　代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">BOOL CMainFrame::OnCommand(WPARAM wParam, LPARAM lParam) </div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> MenuCmdID = LOWORD(wParam);</div><div class="line">	CMenu2View *pView = (CMenu2View *)GetActiveView();</div><div class="line">	<span class="keyword">if</span> (MenuCmdID &gt;= IDM_PHONE1 &amp;&amp; MenuCmdID &lt; IDM_PHONE1 + pView-&gt;m_strArray.GetSize())</div><div class="line">	&#123;</div><div class="line">	<span class="comment">//MessageBox("Test");</span></div><div class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(pView)</span></span>;</div><div class="line">	dc.TextOut(<span class="number">0</span>, <span class="number">0</span>, pView-&gt;m_strArray.GetAt(MenuCmdID - IDM_PHONE1));</div><div class="line">	<span class="keyword">return</span> TRUE;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> CFrameWnd::OnCommand(wParam, lParam);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　将MainFrm.cpp里添加#include “Menu2View.h” 。<br>　　将Menu2View.cpp中的#include “Menu2Doc.h”剪切到Menu2View.h文件的前部（#endif // _MSC_VER &gt; 1000下面）。</p>
<p>　　最终代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">void</span> CMenu2View::OnChar(UINT nChar, UINT nRepCnt, UINT nFlags) </div><div class="line">&#123;</div><div class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</div><div class="line">	<span class="keyword">if</span> (<span class="number">0x0d</span> == nChar)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span> (<span class="number">0</span> == ++m_nIndex)</div><div class="line">		&#123;</div><div class="line">			m_menu.CreatePopupMenu();</div><div class="line">			GetParent()-&gt;GetMenu()-&gt;AppendMenu(MF_POPUP, (UINT)m_menu.m_hMenu, <span class="string">"PhoneBook"</span>);</div><div class="line">			GetParent()-&gt;DrawMenuBar();</div><div class="line">		&#125;</div><div class="line">		m_menu.AppendMenu(MF_STRING, IDM_PHONE1 + m_nIndex, m_strLine.Left(m_strLine.Find(<span class="string">' '</span>)));</div><div class="line">		m_strArray.Add(m_strLine);</div><div class="line">		m_strLine.Empty();</div><div class="line">		Invalidate();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		m_strLine += nChar;</div><div class="line">		dc.TextOut(<span class="number">0</span>, <span class="number">0</span>, m_strLine);</div><div class="line">	&#125;</div><div class="line">	CView::OnChar(nChar, nRepCnt, nFlags);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　效果：<br> <img src="http://img.blog.csdn.net/20170420230235013?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="简单绘图"><a href="#简单绘图" class="headerlink" title="简单绘图"></a>简单绘图</h1><h2 id="mfc消息映射机制"><a href="#MFC消息映射机制" class="headerlink" title="MFC消息映射机制"></a>MFC消息映射机制</h2><p>　　与消息有关的三处信息：1.头文件XXXX.h中 2.源文件XXXX.cpp中 3.源文件XXXX.cpp的响应函数中</p>
<h2 id="绘制线条"><a href="#绘制线条" class="headerlink" title="绘制线条"></a>绘制线条</h2><p>　　对CDrawView右键点击Add Member Variable，变量名称：m_ptOrigin，类型：CPoint，访问权限设置：Private。<br>　　代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CDrawView::OnLButtonDown(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	m_ptOrigin = point;</div><div class="line">	CView::OnLButtonDown(nFlags, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CDrawView::OnLButtonUp(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	<span class="comment">//首先获得窗口的设备描述表</span></div><div class="line">	HDC hdc;</div><div class="line">	hdc = ::GetDC(m_hWnd);</div><div class="line">	<span class="comment">//移动到线条的起点</span></div><div class="line">	MoveToEx(hdc, m_ptOrigin.x, m_ptOrigin.y, <span class="literal">NULL</span>);</div><div class="line">	<span class="comment">//画线</span></div><div class="line">	LineTo(hdc, point.x, point.y);</div><div class="line">	<span class="comment">//释放设备描述表</span></div><div class="line">	::ReleaseDC(m_hWnd, hdc);</div><div class="line"></div><div class="line">	CView::OnLButtonUp(nFlags, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20170420230302938?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="利用mfc的cdc类实现画线功能"><a href="#利用MFC的CDC类实现画线功能" class="headerlink" title="利用MFC的CDC类实现画线功能"></a>利用MFC的CDC类实现画线功能</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CDrawView::OnLButtonUp(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	<span class="comment">/*//首先获得窗口的设备描述表</span></div><div class="line">	HDC hdc;</div><div class="line">	hdc = ::GetDC(m_hWnd);</div><div class="line">	//移动到线条的起点</div><div class="line">	MoveToEx(hdc, m_ptOrigin.x, m_ptOrigin.y, NULL);</div><div class="line">	//画线</div><div class="line">	LineTo(hdc, point.x, point.y);</div><div class="line">	//释放设备描述表</div><div class="line">	::ReleaseDC(m_hWnd, hdc);*/</div><div class="line"></div><div class="line">	CDC* pDC = GetDC();</div><div class="line">	pDC-&gt;MoveTo(m_ptOrigin);</div><div class="line">	pDC-&gt;LineTo(point);</div><div class="line">	ReleaseDC(pDC);</div><div class="line"></div><div class="line">	CView::OnLButtonUp(nFlags, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="利用mfc的cwindowdc类实现画线功能"><a href="#利用MFC的CWindowDC类实现画线功能" class="headerlink" title="利用MFC的CWindowDC类实现画线功能"></a>利用MFC的CWindowDC类实现画线功能</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">void CDrawView::OnLButtonUp(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	CWindowDC dc(GetParent());</div><div class="line">	dc.MoveTo(m_ptOrigin);</div><div class="line">	dc.LineTo(point);</div><div class="line"></div><div class="line">	CView::OnLButtonUp(nFlags, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> <img src="http://img.blog.csdn.net/20170420230346873?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="在桌面窗口中画线"><a href="#在桌面窗口中画线" class="headerlink" title="在桌面窗口中画线"></a>在桌面窗口中画线</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">void CDrawView::OnLButtonUp(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	CWindowDC dc(GetDesktopWindow());</div><div class="line">	dc.MoveTo(m_ptOrigin);</div><div class="line">	dc.LineTo(point);</div><div class="line"></div><div class="line">	CView::OnLButtonUp(nFlags, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> <img src="http://img.blog.csdn.net/20170420230404138?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　<strong>注意</strong>：在桌面上画图需要权限（一般写代码时需要避免软件以外的操作）。</p>
<h3 id="绘制彩色线条"><a href="#绘制彩色线条" class="headerlink" title="绘制彩色线条"></a>绘制彩色线条</h3><p>　　在程序中，当构造一个GDI对象后，该对象并不会立即生效，必须选入设备描述表，它才会在以后的绘制操作中生效。<br>一般情况下，在完成绘图操作之后，都要利用SelectObject函数把之前的GDI对象选入设备描述表，以便使其恢复到先前的状态。<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">void CDrawView::OnLButtonUp(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	CPen pen(PS_SOLID, 1, RGB(255, 0, 0));</div><div class="line">	CClientDC dc(this);</div><div class="line">	CPen* pOldPen = dc.SelectObject(&amp;pen);</div><div class="line">	dc.MoveTo(m_ptOrigin);</div><div class="line">	dc.LineTo(point);</div><div class="line">	dc.SelectObject(pOldPen);</div><div class="line"></div><div class="line">	CView::OnLButtonUp(nFlags, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　运行的效果是红色线条。</p>
<p>　　改为    CPen pen(PS_DASH, 1, RGB(255, 0, 0));  是虚线。（其中第二个参数需小于等于10）<br>    CPen pen(PS_DOT, 1, RGB(255, 0, 0)); 是点线。</p>
<h2 id="使用画刷绘图"><a href="#使用画刷绘图" class="headerlink" title="使用画刷绘图"></a>使用画刷绘图</h2><h3 id="简单画刷"><a href="#简单画刷" class="headerlink" title="简单画刷"></a>简单画刷</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">void CDrawView::OnLButtonUp(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	//创建一个红色画刷</div><div class="line">	CBrush brush(RGB(255, 0, 0));</div><div class="line">	//创建并获得设备描述表</div><div class="line">	CClientDC dc(this);</div><div class="line">	//利用红色画刷填充鼠标拖拽过程中形成的矩形区域</div><div class="line">	dc.FillRect(CRect(m_ptOrigin, point),&amp;brush);</div><div class="line"></div><div class="line">	CView::OnLButtonUp(nFlags, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> <img src="http://img.blog.csdn.net/20170420230440190?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="位图画刷"><a href="#位图画刷" class="headerlink" title="位图画刷"></a>位图画刷</h3><p>　　Insert-Resource-Bitmap-New，在这里发挥灵魂画手的天赋吧！<br>　　代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CDrawView::OnLButtonUp(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	<span class="comment">//创建位图对象</span></div><div class="line">	CBitmap bitmap;</div><div class="line">	<span class="comment">//加载位图资源</span></div><div class="line">	bitmap.LoadBitmap(IDB_BITMAP1);</div><div class="line">	<span class="comment">//创建位图画刷</span></div><div class="line">	<span class="function">CBrush <span class="title">brush</span><span class="params">(&amp;bitmap)</span></span>;</div><div class="line">	<span class="comment">//创建并获得设备描述表</span></div><div class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</div><div class="line">	<span class="comment">//利用位图画刷填充鼠标拖拽过程中形成的矩形区域</span></div><div class="line">	dc.FillRect(CRect(m_ptOrigin, point),&amp;brush);</div><div class="line"></div><div class="line">	CView::OnLButtonUp(nFlags, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> <img src="http://img.blog.csdn.net/20170420230503092?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>　　我画的是不是很滑稽（手动滑稽）</p>
<h3 id="透明画刷"><a href="#透明画刷" class="headerlink" title="透明画刷"></a>透明画刷</h3><p>　　先进行一种尝试：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CDrawView::OnLButtonUp(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	<span class="comment">//创建并获得设备描述表</span></div><div class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</div><div class="line">	<span class="comment">//绘制一个矩形</span></div><div class="line">	dc.Rectangle(CRect(m_ptOrigin,point));</div><div class="line"></div><div class="line">	CView::OnLButtonUp(nFlags, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> <img src="http://img.blog.csdn.net/20170420230521295?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>　　如果希望矩形内部是透明的，能够看到被遮挡的图形，就要创建一个透明画刷。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CDrawView::OnLButtonUp(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	<span class="comment">//创建并获得设备描述表</span></div><div class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</div><div class="line">	<span class="comment">//创建一个空画刷</span></div><div class="line">	CBrush *pBrush = CBrush::FromHandle((HBRUSH)GetStockObject(NULL_BRUSH));</div><div class="line">	<span class="comment">//将空画刷选入设备描述表</span></div><div class="line">	CBrush *pOldBrush = dc.SelectObject(pBrush);</div><div class="line">	<span class="comment">//绘制一个矩形</span></div><div class="line">	dc.Rectangle(CRect(m_ptOrigin, point));</div><div class="line">	<span class="comment">//恢复先前的画刷</span></div><div class="line">	dc.SelectObject(pOldBrush);</div><div class="line"></div><div class="line">	CView::OnLButtonUp(nFlags, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="http://img.blog.csdn.net/20170420230550253?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="绘制连续线条"><a href="#绘制连续线条" class="headerlink" title="绘制连续线条"></a>绘制连续线条</h2><p>　　首先为视类增加鼠标移动消息（WM_MOUSEMOVE）的响应函数（默认OnMouseMove），并为视类添加一个BOOL型的私有成员变量m_bDraw。<br>在视类头文件定义：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">　Private:</div><div class="line">　BOOL m_bDraw;</div></pre></td></tr></table></figure></p>
<p>在视类的构造函数中：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">m_bDraw = FALSE;</div></pre></td></tr></table></figure></p>
<p>在OnLButtonDown中：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">m_bDraw = TRUE;</div></pre></td></tr></table></figure></p>
<p>在OnLButtonUp中：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">m_bDraw = FALSE;</div></pre></td></tr></table></figure></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CDrawView::OnMouseMove(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</div><div class="line">	<span class="keyword">if</span>(m_bDraw == TRUE)</div><div class="line">	&#123;</div><div class="line">		dc.MoveTo(m_ptOrigin);</div><div class="line">		dc.LineTo(point);</div><div class="line">		<span class="comment">//修改线段的起点</span></div><div class="line">		m_ptOrigin = point;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	CView::OnMouseMove(nFlags, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20170420230616957?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>给线条换色：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">void CDrawView::OnMouseMove(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	CClientDC dc(this);</div><div class="line">		//创建一个红色的、宽度为1的实线画笔</div><div class="line">		CPen pen(PS_SOLID, 1, RGB(255, 0, 0));</div><div class="line">		//把创建的画笔选入设备描述表</div><div class="line">		CPen *pOldPen = dc.SelectObject(&amp;pen);</div><div class="line">		if (m_bDraw == TRUE)</div><div class="line">		&#123;</div><div class="line">		dc.MoveTo(m_ptOrigin);</div><div class="line">		dc.LineTo(point);</div><div class="line">		//修改线段的起点</div><div class="line">		m_ptOrigin = point;</div><div class="line">	&#125;</div><div class="line">	//恢复设备描述表</div><div class="line">		dc.SelectObject(pOldPen);</div><div class="line"></div><div class="line">	CView::OnMouseMove(nFlags, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="绘制扇形效果的线条"><a href="#绘制扇形效果的线条" class="headerlink" title="绘制扇形效果的线条"></a>绘制扇形效果的线条</h2><p>　　去掉上述代码中的     m_ptOrigin = point;</p>
<p>　　效果：<br>　　<img src="http://img.blog.csdn.net/20170420230636254?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　绘制一个带边线的扇形：<br>　　为CDrawView类增加一个CPoint类型的私有成员变量m_ptOld，用来保存鼠标上一个移动点。</p>
<p>　　在OnLButton中：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">m_ptOld = point;</div></pre></td></tr></table></figure></p>
<p>　　在OnMouseMove中：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">void CDrawView::OnMouseMove(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	CClientDC dc(this);</div><div class="line">		//创建一个红色的、宽度为1的实线画笔</div><div class="line">		CPen pen(PS_SOLID, 1, RGB(255, 0, 0));</div><div class="line">		//把创建的画笔选入设备描述表</div><div class="line">		CPen *pOldPen = dc.SelectObject(&amp;pen);</div><div class="line">		if (m_bDraw == TRUE)</div><div class="line">		&#123;</div><div class="line">		dc.MoveTo(m_ptOrigin);</div><div class="line">		dc.LineTo(point);</div><div class="line">		dc.LineTo(m_ptOld);</div><div class="line">		//修改线段的起点</div><div class="line">		//m_ptOrigin = point;</div><div class="line">		m_ptOld = point;</div><div class="line">	&#125;</div><div class="line">	//恢复设备描述表</div><div class="line">		dc.SelectObject(pOldPen);</div><div class="line"></div><div class="line">	CView::OnMouseMove(nFlags, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　最好将OnLButtonUp里原来写的代码删除或注释之。<br>　　效果：<br> <img src="http://img.blog.csdn.net/20170420230656311?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　MFC提供一个设置绘图模式的函数SetROP2，带有一个参数R2_BLACK、R2_WHITE、R2_MERGENOTPEN等。<br>　　例如，在CClientDC dc(this); 下方添加代码：     dc.SetROP2(R2_MERGENOTPEN);  编译运行后看不到绘制的线条，这就是设置了R2_MERGENOTPEN这种绘图模式。<br>使用R2_BLACK，将会发现绘制的线条颜色始终都是黑色的。</p>
<h1 id="文本编程"><a href="#文本编程" class="headerlink" title="文本编程"></a>文本编程</h1><h2 id="插入符"><a href="#插入符" class="headerlink" title="插入符"></a>插入符</h2><h3 id="创建文本插入符"><a href="#创建文本插入符" class="headerlink" title="创建文本插入符"></a>创建文本插入符</h3><p>　　创建一个单文档类型的MFC AppWizard(exe)工程，取名为Text。<br>为CTextView类添加WM_CREATE消息的响应函数OnCreate，在此函数中创建一个宽度为20、高度为100的插入符。代码如下。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> CTextView::OnCreate(LPCREATESTRUCT lpCreateStruct) </div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span> (CView::OnCreate(lpCreateStruct) == <span class="number">-1</span>)</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	</div><div class="line">	CreateSolidCaret(<span class="number">20</span>,<span class="number">100</span>);</div><div class="line">	ShowCaret();</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="http://img.blog.csdn.net/20170420230721832?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　让插入符适应于当前字体的大小：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> CTextView::OnCreate(LPCREATESTRUCT lpCreateStruct) </div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span> (CView::OnCreate(lpCreateStruct) == <span class="number">-1</span>)</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	</div><div class="line">	<span class="comment">//创建设备描述表</span></div><div class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</div><div class="line">	<span class="comment">//定义文本信息结构体变量</span></div><div class="line">	TEXTMETRIC tm;</div><div class="line">	<span class="comment">//获得设备描述表中的文本信息</span></div><div class="line">	dc.GetTextMetrics(&amp;tm);</div><div class="line">	<span class="comment">//根据字体大小，创建何时的插入符（除以8是经验值）</span></div><div class="line">	CreateSolidCaret(tm.tmAveCharWidth/<span class="number">8</span>, tm.tmHeight);</div><div class="line">	<span class="comment">//显示插入符</span></div><div class="line">	ShowCaret();</div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　运行结果就比较符合常规了。</p>
<h3 id="创建图形插入符"><a href="#创建图形插入符" class="headerlink" title="创建图形插入符"></a>创建图形插入符</h3><p>　　新建一个位图资源，画一个图形。<br>在TextView.h中添加<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span>:</div><div class="line">		CBitmap bitmap;</div></pre></td></tr></table></figure></p>
<p>代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> CTextView::OnCreate(LPCREATESTRUCT lpCreateStruct) </div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span> (CView::OnCreate(lpCreateStruct) == <span class="number">-1</span>)</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	</div><div class="line"></div><div class="line">	bitmap.LoadBitmap(IDB_BITMAP1);</div><div class="line">	CreateCaret(&amp;bitmap);</div><div class="line">	ShowCaret();</div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="http://img.blog.csdn.net/20170420230741630?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="窗口重绘"><a href="#窗口重绘" class="headerlink" title="窗口重绘"></a>窗口重绘</h2><h3 id="ondraw函数"><a href="#OnDraw函数" class="headerlink" title="OnDraw函数"></a>OnDraw函数</h3><p>　　实现在程序窗口中输出一串文字的功能。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTextView::OnDraw(CDC* pDC)</div><div class="line">&#123;</div><div class="line">	CTextDoc* pDoc = GetDocument();</div><div class="line">	ASSERT_VALID(pDoc);</div><div class="line"></div><div class="line">	<span class="function">CString <span class="title">str</span><span class="params">(<span class="string">"VC++ 深入编程"</span>)</span></span>;</div><div class="line">	pDC-&gt;TextOut(<span class="number">50</span>, <span class="number">50</span>, str);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> <img src="http://img.blog.csdn.net/20170420230758895?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="添加字符串资源"><a href="#添加字符串资源" class="headerlink" title="添加字符串资源"></a>添加字符串资源</h3><p>　　点击Resource View-String Table选项，在此字符串表最底部的空行上双击，即可弹出添加新字符串资源的对话框。ID：IDS_STRINGVC，Caption：“VC++编程 文本编程”。代码如下。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTextView::OnDraw(CDC* pDC)</div><div class="line">&#123;</div><div class="line">	CTextDoc* pDoc = GetDocument();</div><div class="line">	ASSERT_VALID(pDoc);</div><div class="line"></div><div class="line">	<span class="comment">//CString str("VC++ 深入编程");</span></div><div class="line">	CString str;</div><div class="line">	str = <span class="string">"VC++ 深入编程"</span>;</div><div class="line">	pDC-&gt;TextOut(<span class="number">50</span>, <span class="number">50</span>, str);</div><div class="line"></div><div class="line">	str.LoadString(IDS_STRINGVC);</div><div class="line">	pDC-&gt;TextOut(<span class="number">0</span>, <span class="number">200</span>, str);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="http://img.blog.csdn.net/20170420230814077?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="路径"><a href="#路径" class="headerlink" title="路径"></a>路径</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">void</span> CTextView::OnDraw(CDC* pDC)</div><div class="line">&#123;</div><div class="line">	CTextDoc* pDoc = GetDocument();</div><div class="line">	ASSERT_VALID(pDoc);</div><div class="line"></div><div class="line">	<span class="comment">//CString str("VC++ 深入编程");</span></div><div class="line">	CString str;</div><div class="line">	str = <span class="string">"VC++ 深入编程"</span>;</div><div class="line">	pDC-&gt;TextOut(<span class="number">50</span>, <span class="number">50</span>, str);</div><div class="line"></div><div class="line">	CSize sz = pDC-&gt;GetTextExtent(str);</div><div class="line"></div><div class="line">	str.LoadString(IDS_STRINGVC);</div><div class="line">	pDC-&gt;TextOut(<span class="number">0</span>, <span class="number">200</span>, str);</div><div class="line"></div><div class="line">	pDC-&gt;BeginPath();</div><div class="line">	pDC-&gt;Rectangle(<span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>+sz.cx, <span class="number">50</span>+sz.cy);</div><div class="line">	pDC-&gt;EndPath();</div><div class="line"></div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">300</span>; i+=<span class="number">10</span>)</div><div class="line">	&#123;</div><div class="line">		pDC-&gt;MoveTo(<span class="number">0</span>, i);</div><div class="line">		pDC-&gt;LineTo(<span class="number">300</span>, i);</div><div class="line">		pDC-&gt;MoveTo(i,<span class="number">0</span>);</div><div class="line">		pDC-&gt;LineTo(i,<span class="number">300</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line"> ![这里写图片描述](http:<span class="comment">//img.blog.csdn.net/20170420230830380?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)</span></div><div class="line"></div><div class="line">```C++</div><div class="line"><span class="keyword">void</span> CTextView::OnDraw(CDC* pDC)</div><div class="line">&#123;</div><div class="line">	CTextDoc* pDoc = GetDocument();</div><div class="line">	ASSERT_VALID(pDoc);</div><div class="line"></div><div class="line">	<span class="comment">//CString str("VC++ 深入编程");</span></div><div class="line">	CString str;</div><div class="line">	str = <span class="string">"VC++ 深入编程"</span>;</div><div class="line">	pDC-&gt;TextOut(<span class="number">50</span>, <span class="number">50</span>, str);</div><div class="line"></div><div class="line">	CSize sz = pDC-&gt;GetTextExtent(str);</div><div class="line"></div><div class="line">	str.LoadString(IDS_STRINGVC);</div><div class="line">	pDC-&gt;TextOut(<span class="number">0</span>, <span class="number">200</span>, str);</div><div class="line"></div><div class="line">	pDC-&gt;BeginPath();</div><div class="line">	pDC-&gt;Rectangle(<span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>+sz.cx, <span class="number">50</span>+sz.cy);</div><div class="line">	pDC-&gt;EndPath();</div><div class="line">	pDC-&gt;SelectClipPath(RGN_DIFF);</div><div class="line"></div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">300</span>; i+=<span class="number">10</span>)</div><div class="line">	&#123;</div><div class="line">		pDC-&gt;MoveTo(<span class="number">0</span>, i);</div><div class="line">		pDC-&gt;LineTo(<span class="number">300</span>, i);</div><div class="line">		pDC-&gt;MoveTo(i,<span class="number">0</span>);</div><div class="line">		pDC-&gt;LineTo(i,<span class="number">300</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> <img src="http://img.blog.csdn.net/20170420230849318?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>　　这正是RGN_DIFF模式的效果。<br>　　如果是RGN_AND，效果是新的裁剪区域是当前裁剪区域和当前路径层的交集。</p>
<p>　　路径层的作用：实现特殊效果。如，希望整幅图形中某一部分与其他部分有所区别，就可以把这部分的图形设置到一个路径层中，然后利用SelectClipPath函数设置一种模式，让路径层和裁剪区域进行互操作以达到一种特殊效果。</p>
<h2 id="字符输入"><a href="#字符输入" class="headerlink" title="字符输入"></a>字符输入</h2><p>　　当用户在键盘上按下某个字符按键后，要把该字符输出到程序窗口上。<br>首先让CTextView捕获WM_CHAR消息，接着为该类定义一个CString类型的成员变量：m_strLine，并在CTextView类的构造函数中将这个变量初始化：m_strLine = “”;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTextView::OnLButtonDown(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	SetCaretPos(point);</div><div class="line"></div><div class="line">	CView::OnLButtonDown(nFlags, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="http://img.blog.csdn.net/20170420230906115?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>　　为CTextView类再增加一个CPoint类型的成员变量，取名m_ptOrigin，权限为私有。在CTextView类的构造函数中设置其初值为0。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTextView::OnLButtonDown(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	SetCaretPos(point);</div><div class="line">	m_strLine.Empty();</div><div class="line">	m_ptOrigin = point;</div><div class="line"></div><div class="line">	CView::OnLButtonDown(nFlags, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　<strong>注意：回车字符的ASCII码十六进制是0x0d，退格键的ASCII码十六进制值是0x08。</strong></p>
<p>　　最终代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTextView::OnChar(UINT nChar, UINT nRepCnt, UINT nFlags) </div><div class="line">&#123;</div><div class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</div><div class="line">	TEXTMETRIC tm;</div><div class="line">	dc.GetTextMetrics(&amp;tm);</div><div class="line">	<span class="keyword">if</span> (<span class="number">0x0d</span> == nChar)</div><div class="line">	&#123;</div><div class="line">	m_strLine.Empty();</div><div class="line">	m_ptOrigin.y += tm.tmHeight;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0x08</span> == nChar)</div><div class="line">	&#123;</div><div class="line">		COLORREF clr = dc.SetTextColor(dc.GetBkColor());</div><div class="line">		dc.TextOut(m_ptOrigin.x, m_ptOrigin.y, m_strLine);</div><div class="line">		m_strLine = m_strLine.Left(m_strLine.GetLength() - <span class="number">1</span>);</div><div class="line">		dc.SetTextColor(clr);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		m_strLine += nChar; </div><div class="line">	&#125;</div><div class="line">	CSize sz = dc.GetTextExtent(m_strLine);</div><div class="line">	CPoint pt;</div><div class="line">	pt.x = m_ptOrigin.x + sz.cx;</div><div class="line">	pt.y = m_ptOrigin.y;</div><div class="line">	SetCaretPos(pt);</div><div class="line"></div><div class="line">	dc.TextOut(m_ptOrigin.x, m_ptOrigin.y, m_strLine);</div><div class="line"></div><div class="line">	</div><div class="line">	CView::OnChar(nChar, nRepCnt, nFlags);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="http://img.blog.csdn.net/20170420230925890?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="设置字体"><a href="#设置字体" class="headerlink" title="设置字体"></a>设置字体</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTextView::OnChar(UINT nChar, UINT nRepCnt, UINT nFlags) </div><div class="line">&#123;</div><div class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</div><div class="line">	CFont font;</div><div class="line">	font.CreatePointFont(<span class="number">300</span>, <span class="string">"华文行楷"</span>, <span class="literal">NULL</span>);</div><div class="line">	CFont *pOldFont = dc.SelectObject(&amp;font);</div><div class="line">……</div><div class="line">	dc.SelectObject(pOldFont);</div><div class="line">	</div><div class="line">	CView::OnChar(nChar, nRepCnt, nFlags);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> <img src="http://img.blog.csdn.net/20170420230949366?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="字幕变色功能的实现"><a href="#字幕变色功能的实现" class="headerlink" title="字幕变色功能的实现"></a>字幕变色功能的实现</h3><p>　　在这个Text例子中，我们在视类的OnCreate 函数中设置定时器，设置一个时间间隔为100ms，标识为1的定时器。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> CTextView::OnCreate(LPCREATESTRUCT lpCreateStruct) </div><div class="line">&#123;</div><div class="line">	……</div><div class="line"></div><div class="line">	SetTimer(<span class="number">1</span>, <span class="number">100</span>, <span class="literal">NULL</span>);</div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　给CTextView类添加WM_TIMER消息的响应函数。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTextView::OnTimer(UINT nIDEvent) </div><div class="line">&#123;</div><div class="line">	m_nWidth += <span class="number">5</span>;</div><div class="line"></div><div class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</div><div class="line">	TEXTMETRIC tm;</div><div class="line">	dc.GetTextMetrics(&amp;tm);</div><div class="line">	CRect rect;</div><div class="line">	rect.left =<span class="number">0</span>;</div><div class="line">	rect.top = <span class="number">200</span>;</div><div class="line">	rect.right = m_nWidth;</div><div class="line">	rect.bottom = rect.top + tm.tmHeight;</div><div class="line"></div><div class="line">	dc.SetTextColor(RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</div><div class="line">	CString str;</div><div class="line">	str.LoadString(IDS_STRINGVC);</div><div class="line">	dc.DrawText(str, rect, DT_LEFT);</div><div class="line">	</div><div class="line">	rect.top = <span class="number">150</span>;</div><div class="line">	rect.bottom = rect.top + tm.tmHeight;</div><div class="line">	dc.DrawText(str, rect, DT_RIGHT);</div><div class="line">	</div><div class="line">	CSize sz = dc.GetTextExtent(str);</div><div class="line">	<span class="keyword">if</span> (m_nWidth &gt; sz.cx)</div><div class="line">	&#123;</div><div class="line">		m_nWidth = <span class="number">0</span>;</div><div class="line">		dc.SetTextColor(RGB(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>));</div><div class="line">		dc.TextOut(<span class="number">0</span>, <span class="number">200</span>, str);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	CView::OnTimer(nIDEvent);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　红色渐变效果可看到。<br><img src="http://img.blog.csdn.net/20170420231009906?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="绘图控制"><a href="#绘图控制" class="headerlink" title="绘图控制"></a>绘图控制</h1><h2 id="简单绘图"><a href="#简单绘图-1" class="headerlink" title="简单绘图"></a>简单绘图</h2><p>　　新建一个单文档类型的MFC AppWizard(exe)工程，取名：Graphic。<br>　　添加的菜单项：<br> <img src="http://img.blog.csdn.net/20170420231023694?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>　　给CGraphicView类中添加一个私有变量：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">UINT m_nDrawType;</div></pre></td></tr></table></figure></p>
<p>　　在视类构造函数中将此变量初始化为0。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CGraphicView::OnDot() </div><div class="line">&#123;</div><div class="line">	m_nDrawType = <span class="number">1</span>;</div><div class="line">	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CGraphicView::OnLine() </div><div class="line">&#123;</div><div class="line">	m_nDrawType = <span class="number">2</span>;	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CGraphicView::OnRectangle() </div><div class="line">&#123;</div><div class="line">	m_nDrawType = <span class="number">3</span>;	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CGraphicView::OnEllipse() </div><div class="line">&#123;</div><div class="line">	m_nDrawType = <span class="number">4</span>;	</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>　　CGraphicView类再增加一个CPoint类型的私有成员变量：m_ptOrigin。在CGraphicView类构造函数中，将该变量的值设置为0。<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">void CGraphicView::OnLButtonDown(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	m_ptOrigin = point;</div><div class="line">	</div><div class="line">	CView::OnLButtonDown(nFlags, point);</div><div class="line">&#125;</div><div class="line"></div><div class="line">void CGraphicView::OnLButtonUp(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	CClientDC dc(this);</div><div class="line">	//为边框设定颜色</div><div class="line">	CPen pen(PS_SOLID, 1, RGB(255, 0, 0));</div><div class="line">	dc.SelectObject(&amp;pen);</div><div class="line">	//能看到图形内部内容(透明)</div><div class="line">	CBrush *pBrush = CBrush::FromHandle((HBRUSH)GetStockObject(NULL_BRUSH));</div><div class="line">	dc.SelectObject(pBrush);</div><div class="line"></div><div class="line">	switch(m_nDrawType)</div><div class="line">	&#123;</div><div class="line">	case 1:</div><div class="line">		dc.SetPixel(point,RGB(255, 0, 0));</div><div class="line">		break;</div><div class="line">	case 2:</div><div class="line">		dc.MoveTo(m_ptOrigin);</div><div class="line">		dc.LineTo(point);</div><div class="line">		break;</div><div class="line">	case 3:</div><div class="line">		dc.Rectangle(CRect(m_ptOrigin,point));</div><div class="line">		break;</div><div class="line">	case 4:</div><div class="line">		dc.Ellipse(CRect(m_ptOrigin, point));</div><div class="line">		break;</div><div class="line">	&#125;</div><div class="line">	CView::OnLButtonUp(nFlags, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> <img src="http://img.blog.csdn.net/20170420231045554?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="设置对话框"><a href="#设置对话框" class="headerlink" title="设置对话框"></a>设置对话框</h2><p>　　再增加一个对话框资源，ID为IDD_DLG_SETTING，Caption为Setting，Font为宋体。</p>
<h3 id="设置线宽"><a href="#设置线宽" class="headerlink" title="设置线宽"></a>设置线宽</h3><p>　　添加一个静态文本框，并将Caption设为“线宽”。再添加一个编辑框，ID：IDC_LINE_WIDTH。为此对话框资源创建一个响应的对话框类，类名为CSettingDlg。对编辑框右键，ClassWizard，为它添加一个成员变量：m_nLineWidth，类型为UINT。为绘图菜单下再增加一个菜单项为“设置”，ID为IDM_SETTING。为此菜单项添加一个命令响应，选择视类做出响应。为CGraphicView类添加一个私有成员变量：m_nLineWidth，类型：UINT，并在CGraphicView类的构造函数初始化为0。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CGraphicView::OnSetting() </div><div class="line">&#123;</div><div class="line">	CSettingDlg dlg;</div><div class="line">	dlg.m_nLineWidth = m_nLineWidth; <span class="comment">//将保存的用户先前设置的线宽再传回给该设置对话框</span></div><div class="line">	<span class="keyword">if</span>(IDOK == dlg.DoModal())<span class="comment">//点击OK才保持线宽值</span></div><div class="line">	&#123;</div><div class="line">		m_nLineWidth = dlg.m_nLineWidth;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　在源文件前部添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Include “SettingDlg.h”</div></pre></td></tr></table></figure></p>
<p>　　修改OnLButtonUp函数：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">void CGraphicView::OnLButtonUp(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	CClientDC dc(this);</div><div class="line">	//为边框设定颜色(m_nLineWidth定义线宽)</div><div class="line">	CPen pen(PS_SOLID, m_nLineWidth, RGB(255, 0, 0));</div><div class="line">……</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="设置线型"><a href="#设置线型" class="headerlink" title="设置线型"></a>设置线型</h3><p>　　为对话框资源添加一个组框，Caption设为线型。ID为IDC_LINE_STYLE。在组框内放三个单选按钮，ID不变，名称分别为：实线、虚线、点线（不要改变顺序）。在第一个单选按钮上右键，属性勾上Group，使三个按钮成为一组。再为CGraphicView类添加一个Int类型的私有成员变量m_nLineStyle，在构造函数中初始化为0。<br>　　由于WINGDI.h定义了一些符号常量，（可以在PS_SOLID右键，Go To Definition Of PS_SOLID），刚好PS_SOLID（实线）值本身就是0；PS_DASH（虚线）是1；PS_DOT（点线）是2。所以此处的排列是故意为之。<br> <img src="http://img.blog.csdn.net/20170424215210507?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br> <img src="http://img.blog.csdn.net/20170424215239306?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　<strong>注意：若要画出虚线和点线，线宽只能为0或1。</strong></p>
<h2 id="颜色对话框"><a href="#颜色对话框" class="headerlink" title="颜色对话框"></a>颜色对话框</h2><p>　　在绘图下增加一个子菜单，ID为IDM_COLOR，Caption为颜色。为其在视类增加一个命令响应，代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CGraphicView::OnColor() </div><div class="line">&#123;</div><div class="line">	CColorDialog dlg;</div><div class="line">	dlg.m_cc.Flags |= CC_RGBINIT;</div><div class="line">	dlg.m_cc.rgbResult = m_clr;</div><div class="line">	<span class="keyword">if</span> (IDOK == dlg.DoModal())</div><div class="line">	&#123;</div><div class="line">		m_clr = dlg.m_cc.rgbResult;</div><div class="line">		<span class="comment">//dlg.m_cc.Flags |= CC_RGBINIT | CC_FULLOPEN;//让颜色对话框完全展开</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　为CGraphicView类再增加一个COLORREF类型的私有成员变量：m_clr，并在构造函数中初始化为红色：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">m_clr = RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line"></div><div class="line">　　修改该函数两处位置：</div><div class="line">```C++</div><div class="line"><span class="keyword">void</span> CGraphicView::OnLButtonUp(UINT nFlags, CPoint point) </div><div class="line">&#123;</div><div class="line">	<span class="function">CClientDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</div><div class="line">	<span class="comment">//为边框设定颜色(m_nLineStyle定义线型，m_nLineWidth定义线宽，m_clr定义颜色)</span></div><div class="line">	<span class="function">CPen <span class="title">pen</span><span class="params">(m_nLineStyle, m_nLineWidth, m_clr)</span></span>;</div><div class="line">	dc.SelectObject(&amp;pen);</div><div class="line">	<span class="comment">//能看到图形内部内容(透明)</span></div><div class="line">	CBrush *pBrush = CBrush::FromHandle((HBRUSH)GetStockObject(NULL_BRUSH));</div><div class="line">	dc.SelectObject(pBrush);</div><div class="line"></div><div class="line">	<span class="keyword">switch</span>(m_nDrawType)</div><div class="line">	&#123;</div><div class="line">	<span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">		dc.SetPixel(point,m_clr);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> <span class="number">2</span>:</div><div class="line">		dc.MoveTo(m_ptOrigin);</div><div class="line">		dc.LineTo(point);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> <span class="number">3</span>:</div><div class="line">		dc.Rectangle(CRect(m_ptOrigin,point));</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> <span class="number">4</span>:</div><div class="line">		dc.Ellipse(CRect(m_ptOrigin, point));</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	&#125;</div><div class="line">	CView::OnLButtonUp(nFlags, point);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> <img src="http://img.blog.csdn.net/20170424215308947?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　注意：//dlg.m_cc.Flags |= CC_RGBINIT | CC_FULLOPEN;//让颜色对话框完全展开<br>这句我没能实现展开效果。</p>
<h2 id="字体对话框"><a href="#字体对话框" class="headerlink" title="字体对话框"></a>字体对话框</h2><p>　　增加一个菜单，ID为IDM_FONT，Caption为字体。在视类增加命令响应，代码：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CGraphicView::OnFont() </div><div class="line">&#123;</div><div class="line">	CFontDialog dlg;</div><div class="line">	<span class="keyword">if</span> (IDOK == dlg.DoModal())</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span> (m_font.m_hObject) <span class="comment">//m_font对象是否已经与某字体资源相关联</span></div><div class="line">			m_font.DeleteObject();</div><div class="line">		m_font.CreateFontIndirect(dlg.m_cf.lpLogFont);</div><div class="line">		m_strFontName = dlg.m_cf.lpLogFont-&gt;lfFaceName;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">void</span> CGraphicView::OnDraw(CDC* pDC)</div><div class="line">&#123;</div><div class="line">	CGraphicDoc* pDoc = GetDocument();</div><div class="line">	ASSERT_VALID(pDoc);</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> add draw code for native data here</span></div><div class="line">	CFont *pOldFont = pDC-&gt;SelectObject(&amp;m_font);</div><div class="line">	pDC-&gt;TextOut(<span class="number">0</span>, <span class="number">0</span>, m_strFontName);</div><div class="line">	pDC-&gt;SelectObject(pOldFont);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="示例对话框"><a href="#示例对话框" class="headerlink" title="示例对话框"></a>示例对话框</h2><p>　　在对话框中增加一个组框，Caption:示例，ID：IDC_SAMPLE。为CSettingDlg类添加编辑框控件的EN_CHANCE响应函数，对三个单选按钮都选择BN_CLICKED消息。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CSettingDlg::OnRadio1() </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></div><div class="line">	Invalidate();	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CSettingDlg::OnRadio2() </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></div><div class="line">	Invalidate();	</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> CSettingDlg::OnRadio3() </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></div><div class="line">	Invalidate();	</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CSettingDlg::OnPaint() </div><div class="line">&#123;</div><div class="line">	<span class="function">CPaintDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>; <span class="comment">// device context for painting</span></div><div class="line">	</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your message handler code here</span></div><div class="line">	UpdateData();</div><div class="line">	<span class="function">CPen <span class="title">pen</span><span class="params">(m_nLineStyle, m_nLineWidth, m_clr)</span></span>;</div><div class="line">	dc.SelectObject(&amp;pen);</div><div class="line"></div><div class="line">	CRect rect;</div><div class="line">	GetDlgItem(IDC_SAMPLE)-&gt;GetWindowRect(&amp;rect);</div><div class="line">	ScreenToClient(&amp;rect);</div><div class="line"></div><div class="line">	dc.MoveTo(rect.left+<span class="number">20</span>, rect.top+rect.Height()/<span class="number">2</span>);</div><div class="line">	dc.LineTo(rect.right<span class="number">-20</span>, rect.top+rect.Height()/<span class="number">2</span>);</div><div class="line">	<span class="comment">// Do not call CDialog::OnPaint() for painting messages</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20170424215335853?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　现在可以实时修改了。</p>
<h2 id="106-改变对话框和控件的背景及文本颜色"><a href="#10-6-改变对话框和控件的背景及文本颜色" class="headerlink" title="10.6 改变对话框和控件的背景及文本颜色"></a>10.6 改变对话框和控件的背景及文本颜色</h2><h3 id="改变整个对话框及其子控件的背景色"><a href="#改变整个对话框及其子控件的背景色" class="headerlink" title="改变整个对话框及其子控件的背景色"></a>改变整个对话框及其子控件的背景色</h3><p>　　为CSettingDlg类添加WM_CTLCOLOR消息，并定义一个CBrush类型的私有成员变量：m_brush，并在构造函数中初始化一个蓝色画刷：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">m_brush.CreateSolidBrush (RGB(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>));</div></pre></td></tr></table></figure></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">HBRUSH CSettingDlg::OnCtlColor(CDC* pDC, CWnd* pWnd, UINT nCtlColor) </div><div class="line">&#123;</div><div class="line">	HBRUSH hbr = CDialog::OnCtlColor(pDC, pWnd, nCtlColor);</div><div class="line">	</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Change any attributes of the DC here</span></div><div class="line">	</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Return a different brush if the default is not desired</span></div><div class="line">	<span class="comment">//return hbr;</span></div><div class="line">	<span class="keyword">return</span> m_brush;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> <img src="http://img.blog.csdn.net/20170424215356165?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="仅改变某个子控件的背景及文本颜色"><a href="#仅改变某个子控件的背景及文本颜色" class="headerlink" title="仅改变某个子控件的背景及文本颜色"></a>仅改变某个子控件的背景及文本颜色</h3><h1 id="图形的保存和重绘"><a href="#图形的保存和重绘" class="headerlink" title="图形的保存和重绘"></a>图形的保存和重绘</h1><h2 id="坐标空间和转换"><a href="#坐标空间和转换" class="headerlink" title="坐标空间和转换"></a>坐标空间和转换</h2><h3 id="坐标空间"><a href="#坐标空间" class="headerlink" title="坐标空间"></a>坐标空间</h3><p>　　Win32应用程序编程接口（API）使用四种坐标空间：世界坐标系空间、页面空间、设备空间和物理设备空间。Win32 API把世界坐标系空间和页面空间称为逻辑空间。</p>
<h3 id="转换"><a href="#转换" class="headerlink" title="转换"></a>转换</h3><p>　　转换是把对象从一个坐标空间复制到另一个坐标空间时改变（或转变）这一对象的大小、方位和形态。</p>
<h2 id="图形的保存和重绘"><a href="#图形的保存和重绘-1" class="headerlink" title="图形的保存和重绘"></a>图形的保存和重绘</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">HBRUSH CSettingDlg::OnCtlColor(CDC* pDC, CWnd* pWnd, UINT nCtlColor) </div><div class="line">&#123;</div><div class="line">	HBRUSH hbr = CDialog::OnCtlColor(pDC, pWnd, nCtlColor);</div><div class="line">	</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Change any attributes of the DC here</span></div><div class="line">	</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Return a different brush if the default is not desired</span></div><div class="line">	<span class="comment">//return hbr;</span></div><div class="line">	<span class="keyword">if</span> (pWnd -&gt; GetDlgCtrlID() == IDC_LINE_STYLE)</div><div class="line">	&#123;</div><div class="line">		pDC-&gt;SetTextColor(RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</div><div class="line">		<span class="keyword">return</span> m_brush;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> hbr;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> <img src="http://img.blog.csdn.net/20170424215530885?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　上述程序再加一行：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pDC-&gt;SetBkMode(TRANSPARENT);</div></pre></td></tr></table></figure></p>
<p> <img src="http://img.blog.csdn.net/20170424215545651?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">HBRUSH CSettingDlg::OnCtlColor(CDC* pDC, CWnd* pWnd, UINT nCtlColor) </div><div class="line">&#123;</div><div class="line">	HBRUSH hbr = CDialog::OnCtlColor(pDC, pWnd, nCtlColor);</div><div class="line">	</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Change any attributes of the DC here</span></div><div class="line">	</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Return a different brush if the default is not desired</span></div><div class="line">	<span class="comment">//return hbr;</span></div><div class="line">	<span class="keyword">if</span> (pWnd -&gt; GetDlgCtrlID() == IDC_LINE_STYLE)</div><div class="line">	&#123;</div><div class="line">		pDC-&gt;SetTextColor(RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</div><div class="line">		pDC-&gt;SetBkMode(TRANSPARENT);</div><div class="line">		<span class="keyword">return</span> m_brush;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (pWnd-&gt;GetDlgCtrlID() == IDC_LINE_WIDTH)</div><div class="line">	&#123;</div><div class="line">		pDC-&gt;SetTextColor(RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</div><div class="line">		<span class="comment">//pDC-&gt;SetBkMode(TRANSPARENT);</span></div><div class="line">		pDC-&gt;SetBkColor(RGB(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>));</div><div class="line">		<span class="keyword">return</span> m_brush;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> hbr;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> <img src="http://img.blog.csdn.net/20170424215606416?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="改变控件上的文本字体"><a href="#改变控件上的文本字体" class="headerlink" title="改变控件上的文本字体"></a>改变控件上的文本字体</h3><p>　　为对话框增加一个静态文本控件，ID:IDC_TEXT，Caption:程序员，为CSettingDlg类增加一个CFont类型的私有成员变量：m_font，在构造函数中添加<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">m_font.CreatePointFont(<span class="number">200</span>, <span class="string">"华文行楷"</span>);</div></pre></td></tr></table></figure></p>
<p>　　在OnCtlColor函数中添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (pWnd-&gt;GetDlgCtrlID() == IDC_TEXT)</div><div class="line">&#123;</div><div class="line">	pDC-&gt;SelectObject(&amp;m_font);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> <img src="http://img.blog.csdn.net/20170424215622479?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="改变按钮控件的背景色及文本颜色"><a href="#改变按钮控件的背景色及文本颜色" class="headerlink" title="改变按钮控件的背景色及文本颜色"></a>改变按钮控件的背景色及文本颜色</h3><p>　　在CSettingDlg类OnCtlColor函数中添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">	<span class="keyword">if</span> (pWnd-&gt;GetDlgCtrlID() == IDOK)</div><div class="line">	&#123;</div><div class="line">		pDC-&gt;SetTextColor(RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</div><div class="line">		<span class="keyword">return</span> m_brush;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> hbr;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　点Insert-New Class，选择MFC Class，新增类名：CTestBtn，基类CButton。<br>　　为此类添加DrawItem虚函数重写。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CTestBtn::DrawItem(LPDRAWITEMSTRUCT lpDrawItemStruct) </div><div class="line">&#123;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your code to draw the specified item</span></div><div class="line">	UINT uStyle = DFCS_BUTTONPUSH;</div><div class="line"></div><div class="line">	ASSERT(lpDrawItemStruct-&gt;CtlType == ODT_BUTTON);</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (lpDrawItemStruct-&gt;itemState &amp; ODS_SELECTED)</div><div class="line">		uStyle |= DFCS_PUSHED;</div><div class="line"></div><div class="line">	::DrawFrameControl(lpDrawItemStruct-&gt;hDC, &amp;lpDrawItemStruct-&gt;rcItem, DFC_BUTTON, uStyle);</div><div class="line"></div><div class="line">	CString strText;</div><div class="line">	GetWindowText(strText);</div><div class="line"></div><div class="line">	COLORREF crOldColor = ::SetTextColor(lpDrawItemStruct-&gt;hDC, RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</div><div class="line">	::DrawText(lpDrawItemStruct-&gt;hDC, strText, strText.GetLength(),</div><div class="line">		&amp;lpDrawItemStruct-&gt;rcItem, DT_SINGLELINE | DT_VCENTER | DT_CENTER);</div><div class="line">	::SetTextColor(lpDrawItemStruct-&gt;hDC, crOldColor);</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　然而，此时我返回双击OK键显示“Cannot add new member”……</p>
<p>　　按理，接下来应该是：<br>　　利用ClassWizard打开Add Member Variable对话框，为OK按钮关联一个成员变量，名称为m_btnTest，类型CTestBtn。在SettingDlg.h文件前部添加<code>#include “TestBtn.h”</code>。对OK右键属性，打开Styles，选中Owner draw选项。此时OK文字变红色。</p>
<h2 id="位图的显示"><a href="#位图的显示" class="headerlink" title="位图的显示"></a>位图的显示</h2><h1 id="定制应用程序外观"><a href="#定制应用程序外观" class="headerlink" title="定制应用程序外观"></a>定制应用程序外观</h1><h2 id="修改应用程序窗口的外观"><a href="#修改应用程序窗口的外观" class="headerlink" title="修改应用程序窗口的外观"></a>修改应用程序窗口的外观</h2><h3 id="在窗口创建之前修改"><a href="#在窗口创建之前修改" class="headerlink" title="在窗口创建之前修改"></a>在窗口创建之前修改</h3><p>　　创建前，打开CMainFrame类的PreCreateWindow成员函数，修改CREATETRUCT结构体中的cx和cy成员。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">BOOL CMainFrame::PreCreateWindow(CREATESTRUCT&amp; cs)</div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span>( !CFrameWnd::PreCreateWindow(cs) )</div><div class="line">		<span class="keyword">return</span> FALSE;</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Modify the Window class or styles here by modifying</span></div><div class="line">	<span class="comment">//  the CREATESTRUCT cs</span></div><div class="line">	cs.cx = <span class="number">300</span>;</div><div class="line">	cs.cy = <span class="number">200</span>;</div><div class="line">	<span class="keyword">return</span> TRUE;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　创建运行，可看到初始大小为300x200的应用程序窗口。</p>
<p>　　修改窗口标题：在上述 return TRUE; 前添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cs.style &amp;= ~FWS_ADDTOTITLE;</div><div class="line">cs.lpszName = <span class="string">"http://www.sunxin.org"</span>;</div></pre></td></tr></table></figure></p>
<h2 id="在窗口创建之后修改"><a href="#在窗口创建之后修改" class="headerlink" title="在窗口创建之后修改"></a>在窗口创建之后修改</h2><p>　　注释掉之前添加的代码。在OnCreate函数中添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> CMainFrame::OnCreate(LPCREATESTRUCT lpCreateStruct)</div><div class="line">&#123;</div><div class="line">	…</div><div class="line"></div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Delete these three lines if you don't want the toolbar to</span></div><div class="line">	<span class="comment">//  be dockable</span></div><div class="line">	m_wndToolBar.EnableDocking(CBRS_ALIGN_ANY);</div><div class="line">	EnableDocking(CBRS_ALIGN_ANY);</div><div class="line">	DockControlBar(&amp;m_wndToolBar);</div><div class="line"></div><div class="line">	SetWindowLong(m_hWnd, GWL_STYLE, WS_OVERLAPPEDWINDOW);</div><div class="line"></div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　创建运行后可看到文档标题去掉了。</p>
<p>　　去掉窗口最大化框类型：<br>　　将上述SetWindowLong函数替换为<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SetWindowLong(m_hWnd, GWL_STYLE, GetWindowLong(m_hWnd, GWL_STYLE) &amp; ~WS_MAXIMIZEBOX);</div></pre></td></tr></table></figure></p>
<p>　　创建运行发现最大化框变灰，不能放大窗口了。</p>
<h2 id="修改窗口的光标-图标和背景"><a href="#修改窗口的光标、图标和背景" class="headerlink" title="修改窗口的光标、图标和背景"></a>修改窗口的光标、图标和背景</h2><h3 id="在窗口创建之前修改"><a href="#在窗口创建之前修改-1" class="headerlink" title="在窗口创建之前修改"></a>在窗口创建之前修改</h3><h1 id="网络编程"><a href="#网络编程" class="headerlink" title="网络编程"></a>网络编程</h1><h2 id="计算机网络基本知识"><a href="#计算机网络基本知识" class="headerlink" title="计算机网络基本知识"></a>计算机网络基本知识</h2><p>ISO/OSI七层参考模型<br>应用层——处理网络应用<br>Telnet、FTP、HTTP、DNS、SMTP、POP3</p>
<p>表示层——数据表示<br>TCP、UDP</p>
<p>会话层——主机间通信<br>传输层——端到端的连接<br>网络层——寻址和最短路径<br>IP、ICMP、IGMP</p>
<p>数据链路层——介质访问（接入）<br>物理层——二进制传输</p>
<h2 id="基于tcp的网络应用程序的编写"><a href="#基于TCP的网络应用程序的编写" class="headerlink" title="基于TCP的网络应用程序的编写"></a>基于TCP的网络应用程序的编写</h2><h3 id="服务器端程序"><a href="#服务器端程序" class="headerlink" title="服务器端程序"></a>服务器端程序</h3><p>　　关闭先前的工作区，新建一个工程，选择Win32 Console Application类型，名为TCPSrv。选择An empty project选项，创建一个空工程。再新建一个C++源文件：TcpSrv.cpp。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Winsock2.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//加载套接字库</span></div><div class="line">	WORD wVersionRequested;</div><div class="line">	WSADATA wsaData;</div><div class="line">	<span class="keyword">int</span> err;</div><div class="line"></div><div class="line">	wVersionRequested = MAKEWORD(<span class="number">1</span>, <span class="number">1</span>);</div><div class="line"></div><div class="line">	err = WSAStartup(wVersionRequested, &amp;wsaData);</div><div class="line">	<span class="keyword">if</span> (err != <span class="number">0</span>)&#123;</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (LOBYTE(wsaData.wVersion) != <span class="number">1</span> ||</div><div class="line">		HIBYTE(wsaData.wVersion) != <span class="number">1</span>)&#123;</div><div class="line">		WSACleanup();</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//创建用于监听的套接字</span></div><div class="line">	SOCKET sockSrv = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</div><div class="line"></div><div class="line">	SOCKADDR_IN addrSrv;</div><div class="line">	addrSrv.sin_addr.S_un.S_addr = htonl(INADDR_ANY);</div><div class="line">	addrSrv.sin_family = AF_INET;</div><div class="line">	addrSrv.sin_port = htons(<span class="number">7000</span>);</div><div class="line"></div><div class="line">	<span class="comment">//绑定套接字</span></div><div class="line">	bind(sockSrv, (SOCKADDR*)&amp;addrSrv, <span class="keyword">sizeof</span>(SOCKADDR));</div><div class="line">	<span class="comment">//将套接字设为监听模式，准备接收客户请求</span></div><div class="line">	listen(sockSrv, <span class="number">5</span>);</div><div class="line"></div><div class="line">	SOCKADDR_IN addrClient;</div><div class="line">	<span class="keyword">int</span> len = <span class="keyword">sizeof</span>(SOCKADDR);</div><div class="line"></div><div class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="comment">//等待客户请求到来</span></div><div class="line">		SOCKET sockConn = accept(sockSrv, (SOCKADDR*)&amp;addrClient, &amp;len);</div><div class="line">		<span class="keyword">char</span> sendBuf[<span class="number">100</span>];</div><div class="line">		<span class="built_in">sprintf</span>(sendBuf, <span class="string">"Welcome %s to http://www.sunxin.org"</span>, inet_ntoa(addrClient.sin_addr));</div><div class="line">		<span class="comment">//发送数据</span></div><div class="line">		send(sockConn, sendBuf, <span class="built_in">strlen</span>(sendBuf)+<span class="number">1</span>, <span class="number">0</span>);</div><div class="line">		<span class="keyword">char</span> recvBuf[<span class="number">100</span>];</div><div class="line">		<span class="comment">//接收数据</span></div><div class="line">		recv(sockConn, recvBuf, <span class="number">100</span>, <span class="number">0</span>);</div><div class="line">		<span class="comment">//打印接收的数据</span></div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%s\n"</span>, recvBuf);</div><div class="line">		<span class="comment">//关闭套接字</span></div><div class="line">		closesocket(sockConn);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　Project-Setting-Link，在Object/library modules编辑框中添加ws2_32.lib文件，注意输入的库文件与前面的库文件之间一定 要有一个空格。<br><img src="http://img.blog.csdn.net/20170428102011032?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="客户端程序"><a href="#客户端程序" class="headerlink" title="客户端程序"></a>客户端程序</h3><p>　　在工作区名称上单击鼠标右键，选择Add New Project to Workspace，再创建一个Win32 Console Application类型的应用程序，创建一个空工程。为此增加一个C++源文件：TcpClient.cpp。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Winsock2.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//加载套接字库</span></div><div class="line">	WORD wVersionRequested;</div><div class="line">	WSADATA wsaData;</div><div class="line">	<span class="keyword">int</span> err;</div><div class="line"></div><div class="line">	wVersionRequested = MAKEWORD(<span class="number">1</span>, <span class="number">1</span>);</div><div class="line"></div><div class="line">	err = WSAStartup(wVersionRequested, &amp;wsaData);</div><div class="line">	<span class="keyword">if</span> (err != <span class="number">0</span>)&#123;</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (LOBYTE(wsaData.wVersion) != <span class="number">1</span> || </div><div class="line">		HIBYTE(wsaData.wVersion) != <span class="number">1</span>)&#123;</div><div class="line">		WSACleanup();</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//创建套接字</span></div><div class="line">	SOCKET sockClient = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</div><div class="line"></div><div class="line">	SOCKADDR_IN addrSrv;</div><div class="line">	addrSrv.sin_addr.S_un.S_addr = inet_addr(<span class="string">"127.0.0.1"</span>);</div><div class="line">	addrSrv.sin_family = AF_INET;</div><div class="line">	addrSrv.sin_port = htons(<span class="number">7000</span>);</div><div class="line"></div><div class="line">	<span class="comment">//向服务器发出连接请求</span></div><div class="line">	connect(sockClient, (SOCKADDR*)&amp;addrSrv, <span class="keyword">sizeof</span>(SOCKADDR));</div><div class="line"></div><div class="line">	<span class="comment">//接收数据</span></div><div class="line">	<span class="keyword">char</span> recvBuf[<span class="number">100</span>];</div><div class="line">	recv(sockClient, recvBuf, <span class="number">100</span>, <span class="number">0</span>);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%s\n"</span>,recvBuf);</div><div class="line">	<span class="comment">//发送数据</span></div><div class="line">	send(sockClient, <span class="string">"This is lisi"</span>, <span class="built_in">strlen</span>(<span class="string">"This is lisi"</span>)+<span class="number">1</span>, <span class="number">0</span>);</div><div class="line">	<span class="comment">//关闭套接字</span></div><div class="line">	closesocket(sockClient);</div><div class="line">	WSACleanup();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　链接库文件：ws2_32.lib。<br>　　创建运行，首先运行服务器程序，然后再运行客户端程序。</p>
<p><img src="http://img.blog.csdn.net/20170428102101643?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　<strong>注意</strong>：当没有报错，服务器端运行结果为“烫烫……烫”（N个烫）时，尝试换一个端口号，有可能你设置的端口号被其它的应用程序占用了。</p>
<h2 id="基于udp的网络应用程序的编写"><a href="#基于UDP的网络应用程序的编写" class="headerlink" title="基于UDP的网络应用程序的编写"></a>基于UDP的网络应用程序的编写</h2><h3 id="服务器端程序"><a href="#服务器端程序-1" class="headerlink" title="服务器端程序"></a>服务器端程序</h3><p>　　关闭先前的工作区，新建一个工程，选择Win32 Console Application类型，名为UdpSrv。选择An empty project选项，创建一个空工程。再新建一个C++源文件：UdpSrv.cpp。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Winsock2.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//加载套接字库</span></div><div class="line">	WORD wVersionRequired;</div><div class="line">	WSADATA wsaData;</div><div class="line">	<span class="keyword">int</span> err;</div><div class="line"></div><div class="line">	wVersionRequired = MAKEWORD(<span class="number">1</span>, <span class="number">1</span>);</div><div class="line"></div><div class="line">	err = WSAStartup(wVersionRequired, &amp;wsaData);</div><div class="line">	<span class="keyword">if</span> (err != <span class="number">0</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (LOBYTE(wsaData.wVersion) != <span class="number">1</span> ||</div><div class="line">		HIBYTE(wsaData.wVersion) !=<span class="number">1</span>)</div><div class="line">	&#123;</div><div class="line">		WSACleanup();</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//创建套接字</span></div><div class="line">	SOCKET sockSrv = socket(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</div><div class="line">	SOCKADDR_IN addrSrv;</div><div class="line">	addrSrv.sin_addr.S_un.S_addr = htonl(INADDR_ANY);</div><div class="line">	addrSrv.sin_family = AF_INET;</div><div class="line">	addrSrv.sin_port = htons(<span class="number">7000</span>);</div><div class="line">	<span class="comment">//绑定套接字</span></div><div class="line">	bind(sockSrv, (SOCKADDR*)&amp;addrSrv, <span class="keyword">sizeof</span>(SOCKADDR));</div><div class="line"></div><div class="line">	<span class="comment">//等待并接收数据</span></div><div class="line">	SOCKADDR_IN addrClient;</div><div class="line">	<span class="keyword">int</span> len = <span class="keyword">sizeof</span>(SOCKADDR);</div><div class="line">	<span class="keyword">char</span> recvBuf[<span class="number">100</span>];</div><div class="line">	recvfrom(sockSrv, recvBuf, <span class="number">100</span>, <span class="number">0</span>, (SOCKADDR*)&amp;addrClient, &amp;len);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%s\n"</span>,recvBuf);</div><div class="line">	<span class="comment">//关闭套接字</span></div><div class="line">	closesocket(sockSrv);</div><div class="line">	WSACleanup();</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　在工程设置对话框的链接选项卡下添加库文件：Ws2_32.lib的链接。</p>
<h3 id="客户端程序"><a href="#客户端程序-1" class="headerlink" title="客户端程序"></a>客户端程序</h3><p>　　在同一个UdpSrv工作区中创建客户端应用程序。创建一个空的Win32 Console Application类型的工程，名为：UdpClient。为该工程添加一个C++源文件：UdpClient.cpp。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Winsock2.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//加载套接字库</span></div><div class="line">	WORD wVersionRequired;</div><div class="line">	WSADATA wsaData;</div><div class="line">	<span class="keyword">int</span> err;</div><div class="line"></div><div class="line">	wVersionRequired = MAKEWORD(<span class="number">1</span>, <span class="number">1</span>);</div><div class="line"></div><div class="line">	err = WSAStartup(wVersionRequired, &amp;wsaData);</div><div class="line">	<span class="keyword">if</span> (err != <span class="number">0</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (LOBYTE(wsaData.wVersion) != <span class="number">1</span> ||</div><div class="line">		HIBYTE(wsaData.wVersion) !=<span class="number">1</span>)</div><div class="line">	&#123;</div><div class="line">		WSACleanup();</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//创建套接字</span></div><div class="line">	SOCKET sockClient = socket(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</div><div class="line">	SOCKADDR_IN addrSrv;</div><div class="line">	addrSrv.sin_addr.S_un.S_addr = inet_addr(<span class="string">"127.0.0.1"</span>);</div><div class="line">	addrSrv.sin_family = AF_INET;</div><div class="line">	addrSrv.sin_port = htons(<span class="number">7000</span>);</div><div class="line">	<span class="comment">//发送数据</span></div><div class="line">	sendto(sockClient, <span class="string">"Hello"</span>, <span class="built_in">strlen</span>(<span class="string">"Hello"</span>)+<span class="number">1</span>, <span class="number">0</span>, </div><div class="line">		(SOCKADDR*)&amp;addrSrv, <span class="keyword">sizeof</span>(SOCKADDR));</div><div class="line">	<span class="comment">//关闭套接字</span></div><div class="line">	closesocket(sockClient);</div><div class="line">	WSACleanup();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　链接库文件：ws2_32.lib。</p>
<p>　　创建运行。服务器端程序应先启动，然后启动客户端程序。</p>
<p><img src="http://img.blog.csdn.net/20170428102150065?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　<strong>基于TCP和基于UDP的网络应用程序在发送和接收数据时使用的函数是不一样的：前者使用send和recv，后者使用sendto和recvfrom。</strong></p>
<h2 id="基于udp的简单聊天程序"><a href="#基于UDP的简单聊天程序" class="headerlink" title="基于UDP的简单聊天程序"></a>基于UDP的简单聊天程序</h2><p>　　在新工作区新建一个空的Win32 Console Application类型的应用程序，名为NetSrv。为该工程添加一个C++源文件：NetSrv.cpp。接着为该工程添加对WinSock库的链接，即在工程设置对话框的Link选项卡上添加ws2_32.lib文件的链接。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Winsock2.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"> <span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"> &#123;</div><div class="line">	 <span class="comment">//加载套接字库</span></div><div class="line">	 WORD wVersionRequested;</div><div class="line">	 WSADATA wsaData;</div><div class="line">	 <span class="keyword">int</span> err;</div><div class="line"></div><div class="line">	 wVersionRequested = MAKEWORD(<span class="number">1</span>, <span class="number">1</span>);</div><div class="line"></div><div class="line">	 err = WSAStartup(wVersionRequested, &amp;wsaData);</div><div class="line">	 <span class="keyword">if</span> (err != <span class="number">0</span>)</div><div class="line">	 &#123;</div><div class="line">		 <span class="keyword">return</span>;</div><div class="line">	 &#125;</div><div class="line"></div><div class="line">		<span class="keyword">if</span> (LOBYTE(wsaData.wVersion) != <span class="number">1</span> ||</div><div class="line">		HIBYTE(wsaData.wVersion) !=<span class="number">1</span>)</div><div class="line">	&#123;</div><div class="line">		WSACleanup();</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	 <span class="comment">//创建套接字</span></div><div class="line">	 SOCKET sockSrv = socket(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</div><div class="line"></div><div class="line">	 SOCKADDR_IN addrSrv;</div><div class="line">	 addrSrv.sin_addr.S_un.S_addr = htonl(INADDR_ANY);</div><div class="line">	 addrSrv.sin_family = AF_INET;</div><div class="line">	 addrSrv.sin_port = htons(<span class="number">7000</span>);</div><div class="line"></div><div class="line">	 <span class="comment">//绑定套接字</span></div><div class="line">	 bind(sockSrv, (SOCKADDR*)&amp;addrSrv, <span class="keyword">sizeof</span>(SOCKADDR));</div><div class="line"></div><div class="line">	 <span class="keyword">char</span> recvBuf[<span class="number">100</span>];</div><div class="line">	 <span class="keyword">char</span> sendBuf[<span class="number">100</span>];</div><div class="line">	 <span class="keyword">char</span> tempBuf[<span class="number">200</span>];</div><div class="line"></div><div class="line">	 SOCKADDR_IN addrClient;</div><div class="line">	 <span class="keyword">int</span> len = <span class="keyword">sizeof</span>(SOCKADDR);</div><div class="line">	 <span class="keyword">while</span>(<span class="number">1</span>)</div><div class="line">	 &#123;</div><div class="line">		 <span class="comment">//等待并接收数据</span></div><div class="line">		 recvfrom(sockSrv, recvBuf, <span class="number">100</span>, <span class="number">0</span>, (SOCKADDR*)&amp;addrClient, &amp;len);</div><div class="line">		 <span class="keyword">if</span> (<span class="string">'q'</span> == recvBuf[<span class="number">0</span>])</div><div class="line">		 &#123;</div><div class="line">			 sendto(sockSrv, <span class="string">"q"</span>, <span class="built_in">strlen</span>(<span class="string">"q"</span>)+<span class="number">1</span>, <span class="number">0</span>, (SOCKADDR*)&amp;addrClient, len);</div><div class="line">			 <span class="built_in">printf</span>(<span class="string">"Chat end!\n"</span>);</div><div class="line">			 <span class="keyword">break</span>;</div><div class="line">		 &#125;</div><div class="line">		 <span class="built_in">sprintf</span>(tempBuf, <span class="string">"%s say : %s"</span>, inet_ntoa(addrClient.sin_addr), recvBuf);</div><div class="line">		 <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, tempBuf);</div><div class="line">		 <span class="comment">//发送数据</span></div><div class="line">		 <span class="built_in">printf</span>(<span class="string">"Please input data:\n"</span>);</div><div class="line">		 gets(sendBuf);</div><div class="line">		 sendto(sockSrv, sendBuf, <span class="built_in">strlen</span>(sendBuf)+<span class="number">1</span>, <span class="number">0</span>, (SOCKADDR*)&amp;addrClient, len);</div><div class="line">	&#125;</div><div class="line">	 <span class="comment">//关闭套接字</span></div><div class="line">	 closesocket(sockSrv);</div><div class="line">	 WSACleanup();</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<h3 id="客户端程序"><a href="#客户端程序-2" class="headerlink" title="客户端程序"></a>客户端程序</h3><p>　　向已有工作区增加一个空的Win32 Console Application类型的工程：NetClient。为此添加一个C++源文件：NetClient.cpp。为该工程添加ws2_32.lib文件的链接。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Winsock2.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"> <span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"> &#123;</div><div class="line">	 <span class="comment">//加载套接字库</span></div><div class="line">	 WORD wVersionRequested;</div><div class="line">	 WSADATA wsaData;</div><div class="line">	 <span class="keyword">int</span> err;</div><div class="line"></div><div class="line">	 wVersionRequested = MAKEWORD(<span class="number">1</span>, <span class="number">1</span>);</div><div class="line"></div><div class="line">	 err = WSAStartup(wVersionRequested, &amp;wsaData);</div><div class="line">	 <span class="keyword">if</span> (err != <span class="number">0</span>)</div><div class="line">	 &#123;</div><div class="line">		 <span class="keyword">return</span>;</div><div class="line">	 &#125;</div><div class="line"></div><div class="line">		<span class="keyword">if</span> (LOBYTE(wsaData.wVersion) != <span class="number">1</span> ||</div><div class="line">		HIBYTE(wsaData.wVersion) !=<span class="number">1</span>)</div><div class="line">	&#123;</div><div class="line">		WSACleanup();</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	 <span class="comment">//创建套接字</span></div><div class="line">	 SOCKET sockClient = socket(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</div><div class="line"></div><div class="line">	 SOCKADDR_IN addrSrv;</div><div class="line">	 addrSrv.sin_addr.S_un.S_addr = inet_addr(<span class="string">"127.0.0.1"</span>);</div><div class="line">	 addrSrv.sin_family = AF_INET;</div><div class="line">	 addrSrv.sin_port = htons(<span class="number">7000</span>);</div><div class="line"></div><div class="line">	 <span class="keyword">char</span> recvBuf[<span class="number">100</span>];</div><div class="line">	 <span class="keyword">char</span> sendBuf[<span class="number">100</span>];</div><div class="line">	 <span class="keyword">char</span> tempBuf[<span class="number">200</span>];</div><div class="line"></div><div class="line">	 <span class="keyword">int</span> len = <span class="keyword">sizeof</span>(SOCKADDR);</div><div class="line"></div><div class="line">	 <span class="keyword">while</span>(<span class="number">1</span>)</div><div class="line">	 &#123;</div><div class="line">		 <span class="comment">//发送数据</span></div><div class="line">		 <span class="built_in">printf</span>(<span class="string">"Please input data:\n"</span>);</div><div class="line">		 gets(sendBuf);</div><div class="line">		 sendto(sockClient, sendBuf, <span class="built_in">strlen</span>(sendBuf)+<span class="number">1</span>, <span class="number">0</span>, (SOCKADDR*)&amp;addrSrv, len);</div><div class="line">		 <span class="comment">//等待并接收数据</span></div><div class="line"></div><div class="line">		 recvfrom(sockClient, recvBuf, <span class="number">100</span>, <span class="number">0</span>, (SOCKADDR*)&amp;addrSrv, &amp;len);</div><div class="line">		 <span class="keyword">if</span>(<span class="string">'q'</span> == recvBuf[<span class="number">0</span>])</div><div class="line">		 &#123;</div><div class="line">			 sendto(sockClient, <span class="string">"q"</span>, <span class="built_in">strlen</span>(<span class="string">"q"</span>)+<span class="number">1</span>, <span class="number">0</span>, (SOCKADDR*)&amp;addrSrv, len);</div><div class="line">			 <span class="built_in">printf</span>(<span class="string">"Chat end!\n"</span>);</div><div class="line">			 <span class="keyword">break</span>;</div><div class="line">		 &#125;</div><div class="line">		 <span class="built_in">sprintf</span>(tempBuf, <span class="string">"%s say : %s"</span>, inet_ntoa(addrSrv.sin_addr), recvBuf);</div><div class="line">		 <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, tempBuf);</div><div class="line">	 &#125;</div><div class="line">	 <span class="comment">//关闭套接字</span></div><div class="line">	 closesocket(sockClient);</div><div class="line">	 WSACleanup();</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p><img src="http://img.blog.csdn.net/20170428102229597?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h1><h2 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h2><h3 id="程序和进程"><a href="#程序和进程" class="headerlink" title="程序和进程"></a>程序和进程</h3><h2 id="简单多线程示例"><a href="#简单多线程示例" class="headerlink" title="简单多线程示例"></a>简单多线程示例</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream.h&gt;</span></span></div><div class="line"></div><div class="line">    <span class="function">DWORD WINAPI <span class="title">Fun1Proc</span><span class="params">(</span></span></div><div class="line">	LPVOID lpParameter  <span class="comment">//thread data					 </span></div><div class="line">	);</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">	&#123;</div><div class="line">		HANDLE hThread1;</div><div class="line">		hThread1 = CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, Fun1Proc, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</div><div class="line">		CloseHandle(hThread1);</div><div class="line">		<span class="built_in">cout</span>&lt;&lt;<span class="string">"main thread is running"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">		Sleep(<span class="number">10</span>);<span class="comment">//让主线程暂停运行，进入分线程</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//线程1的入口函数</span></div><div class="line">	<span class="function">DWORD WINAPI <span class="title">Fun1Proc</span><span class="params">(</span></span></div><div class="line">		LPVOID lpParameter  <span class="comment">//thread data</span></div><div class="line">		)</div><div class="line">	&#123;</div><div class="line">		<span class="built_in">cout</span>&lt;&lt;<span class="string">"thread1 is running"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p> <img src="http://img.blog.csdn.net/20170424215653701?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　交替运行：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream.h&gt;</span></span></div><div class="line"></div><div class="line">    <span class="function">DWORD WINAPI <span class="title">Fun1Proc</span><span class="params">(</span></span></div><div class="line">	LPVOID lpParameter  <span class="comment">//thread data					 </span></div><div class="line">	);</div><div class="line">	</div><div class="line">	<span class="keyword">int</span> index = <span class="number">0</span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">	&#123;</div><div class="line">		HANDLE hThread1;</div><div class="line">		hThread1 = CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, Fun1Proc, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</div><div class="line">		CloseHandle(hThread1);</div><div class="line">		</div><div class="line">		<span class="keyword">while</span> (index ++&lt; <span class="number">100</span>)</div><div class="line">		&#123;</div><div class="line">			<span class="built_in">cout</span>&lt;&lt;<span class="string">"main thread is running"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">		&#125;</div><div class="line">			<span class="comment">//Sleep(10);//让主线程暂停运行，进入分线程</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//线程1的入口函数</span></div><div class="line"></div><div class="line">	<span class="function">DWORD WINAPI <span class="title">Fun1Proc</span><span class="params">(</span></span></div><div class="line">			</div><div class="line">		LPVOID lpParameter  <span class="comment">//thread data</span></div><div class="line">		)</div><div class="line"></div><div class="line">	&#123;</div><div class="line">		<span class="keyword">while</span> (index++&lt; <span class="number">100</span>)</div><div class="line">		<span class="built_in">cout</span>&lt;&lt;<span class="string">"thread1 is running"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p> <img src="http://img.blog.csdn.net/20170424215712448?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="线程同步"><a href="#线程同步" class="headerlink" title="线程同步"></a>线程同步</h2><h3 id="火车站售票系统模拟程序"><a href="#火车站售票系统模拟程序" class="headerlink" title="火车站售票系统模拟程序"></a>火车站售票系统模拟程序</h3><p>　　由主线程创建的两个线程（1和2）负责销售火车票。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream.h&gt;</span></span></div><div class="line"></div><div class="line">    <span class="function">DWORD WINAPI <span class="title">Fun1Proc</span><span class="params">(</span></span></div><div class="line">	LPVOID lpParameter  <span class="comment">//thread data					 </span></div><div class="line">	);</div><div class="line">	</div><div class="line">	 <span class="function">DWORD WINAPI <span class="title">Fun2Proc</span><span class="params">(</span></span></div><div class="line">	LPVOID lpParameter  <span class="comment">//thread data					 </span></div><div class="line">	);</div><div class="line"></div><div class="line">	<span class="keyword">int</span> index = <span class="number">0</span>;</div><div class="line">	<span class="keyword">int</span> tickets = <span class="number">100</span>;</div><div class="line">	HANDLE hMutex;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">	&#123;</div><div class="line">		HANDLE hThread1;</div><div class="line">		HANDLE hThread2;</div><div class="line"></div><div class="line">		<span class="comment">//创建互斥对象</span></div><div class="line">		hMutex = CreateMutex(<span class="literal">NULL</span>, FALSE, <span class="literal">NULL</span>);</div><div class="line"></div><div class="line">		<span class="comment">//创建线程</span></div><div class="line">		hThread1 = CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, Fun1Proc, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</div><div class="line">		hThread2 = CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, Fun2Proc, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</div><div class="line">		CloseHandle(hThread1);</div><div class="line">		CloseHandle(hThread2);</div><div class="line">		Sleep(<span class="number">4000</span>);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	</div><div class="line"></div><div class="line">	</div><div class="line"></div><div class="line">	<span class="comment">//线程1的入口函数</span></div><div class="line">	<span class="function">DWORD WINAPI <span class="title">Fun1Proc</span><span class="params">(</span></span></div><div class="line">			</div><div class="line">		LPVOID lpParameter  <span class="comment">//thread data</span></div><div class="line">		)</div><div class="line"></div><div class="line">	&#123;</div><div class="line">	<span class="keyword">while</span> (TRUE)</div><div class="line">		&#123;</div><div class="line">			WaitForSingleObject(hMutex, INFINITE);<span class="comment">//实现线程同步</span></div><div class="line">			<span class="keyword">if</span> (tickets &gt; <span class="number">0</span>)</div><div class="line">			&#123;</div><div class="line">				Sleep(<span class="number">1</span>);</div><div class="line">				<span class="built_in">cout</span>&lt;&lt;<span class="string">"thread1 sell ticket:"</span>&lt;&lt;tickets--&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span> </div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			ReleaseMutex(hMutex);<span class="comment">//释放当前线程对互斥对象的所有权</span></div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">	&#125;</div><div class="line">	</div><div class="line"></div><div class="line">		<span class="comment">//线程2的入口函数</span></div><div class="line">	<span class="function">DWORD WINAPI <span class="title">Fun2Proc</span><span class="params">(</span></span></div><div class="line">			</div><div class="line">		LPVOID lpParameter  <span class="comment">//thread data</span></div><div class="line">		)</div><div class="line"></div><div class="line"></div><div class="line">	&#123;</div><div class="line">		<span class="keyword">while</span> (TRUE)</div><div class="line">		&#123;</div><div class="line">			WaitForSingleObject(hMutex,INFINITE);</div><div class="line">			<span class="keyword">if</span> (tickets &gt; <span class="number">0</span>)</div><div class="line">			&#123;</div><div class="line">				Sleep(<span class="number">1</span>);</div><div class="line">				<span class="built_in">cout</span>&lt;&lt;<span class="string">"thread2 sell ticket:"</span>&lt;&lt;tickets--&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span> </div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			ReleaseMutex(hMutex);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> <img src="http://img.blog.csdn.net/20170424215734652?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>　　这时所销售的票号正常，没有看到销售了号码为0的票。</p>
<p>　　对互斥对象来说，谁拥有谁释放。</p>
<h2 id="保证应用程序只有一个实例运行"><a href="#保证应用程序只有一个实例运行" class="headerlink" title="保证应用程序只有一个实例运行"></a>保证应用程序只有一个实例运行</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream.h&gt;</span></span></div><div class="line"></div><div class="line">    <span class="function">DWORD WINAPI <span class="title">Fun1Proc</span><span class="params">(</span></span></div><div class="line">	LPVOID lpParameter  <span class="comment">//thread data					 </span></div><div class="line">	);</div><div class="line">	</div><div class="line">	 <span class="function">DWORD WINAPI <span class="title">Fun2Proc</span><span class="params">(</span></span></div><div class="line">	LPVOID lpParameter  <span class="comment">//thread data					 </span></div><div class="line">	);</div><div class="line"></div><div class="line">	<span class="keyword">int</span> index = <span class="number">0</span>;</div><div class="line">	<span class="keyword">int</span> tickets = <span class="number">100</span>;</div><div class="line">	HANDLE hMutex;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">	&#123;</div><div class="line">		HANDLE hThread1;</div><div class="line">		HANDLE hThread2;</div><div class="line"></div><div class="line">		<span class="comment">//创建互斥对象(注意命名)</span></div><div class="line">		hMutex = CreateMutex(<span class="literal">NULL</span>, FALSE, <span class="string">"1"</span>);</div><div class="line">		<span class="keyword">if</span> (hMutex)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">if</span> (ERROR_ALREADY_EXISTS == GetLastError())</div><div class="line">			&#123;</div><div class="line">				<span class="built_in">cout</span>&lt;&lt;<span class="string">"only one instance can run!"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">				<span class="keyword">return</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="comment">//创建线程</span></div><div class="line">		hThread1 = CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, Fun1Proc, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</div><div class="line">		hThread2 = CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, Fun2Proc, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</div><div class="line">		CloseHandle(hThread1);</div><div class="line">		CloseHandle(hThread2);</div><div class="line">		WaitForSingleObject(hMutex, INFINITE);</div><div class="line">		ReleaseMutex(hMutex);</div><div class="line">		ReleaseMutex(hMutex);</div><div class="line">		Sleep(<span class="number">4000</span>);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">//线程1的入口函数</span></div><div class="line">	<span class="function">DWORD WINAPI <span class="title">Fun1Proc</span><span class="params">(</span></span></div><div class="line">			</div><div class="line">		LPVOID lpParameter  <span class="comment">//thread data</span></div><div class="line">		)</div><div class="line"></div><div class="line">	&#123;</div><div class="line">	<span class="keyword">while</span> (TRUE)</div><div class="line">		&#123;</div><div class="line">			WaitForSingleObject(hMutex, INFINITE);<span class="comment">//实现线程同步</span></div><div class="line">			<span class="keyword">if</span> (tickets &gt; <span class="number">0</span>)</div><div class="line">			&#123;</div><div class="line">				Sleep(<span class="number">1</span>);</div><div class="line">				<span class="built_in">cout</span>&lt;&lt;<span class="string">"thread1 sell ticket:"</span>&lt;&lt;tickets--&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span> </div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			ReleaseMutex(hMutex);<span class="comment">//释放当前线程对互斥对象的所有权</span></div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">	&#125;</div><div class="line">	</div><div class="line"></div><div class="line">		<span class="comment">//线程2的入口函数</span></div><div class="line">	<span class="function">DWORD WINAPI <span class="title">Fun2Proc</span><span class="params">(</span></span></div><div class="line">			</div><div class="line">		LPVOID lpParameter  <span class="comment">//thread data</span></div><div class="line">		)</div><div class="line"></div><div class="line"></div><div class="line">	&#123;</div><div class="line">		<span class="keyword">while</span> (TRUE)</div><div class="line">		&#123;</div><div class="line">			WaitForSingleObject(hMutex,INFINITE);</div><div class="line">			<span class="keyword">if</span> (tickets &gt; <span class="number">0</span>)</div><div class="line">			&#123;</div><div class="line">				Sleep(<span class="number">1</span>);</div><div class="line">				<span class="built_in">cout</span>&lt;&lt;<span class="string">"thread2 sell ticket:"</span>&lt;&lt;tickets--&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span> </div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			ReleaseMutex(hMutex);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="网络聊天室程序的实现"><a href="#网络聊天室程序的实现" class="headerlink" title="网络聊天室程序的实现"></a>网络聊天室程序的实现</h2><p>　　新建一个基于对话框的工程，名为：Chat。<br><img src="http://img.blog.csdn.net/20170428102440017?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20170428102449366?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="加载套接字库"><a href="#加载套接字库" class="headerlink" title="加载套接字库"></a>加载套接字库</h3><p>　　在CChatApp类的InitInstance函数开始位置<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">BOOL CChatApp::InitInstance()</div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span> (!AfxSocketInit())</div><div class="line">	&#123;</div><div class="line">		AfxMessageBox(<span class="string">"加载套接字库失败！"</span>);</div><div class="line">		<span class="keyword">return</span> FALSE;</div><div class="line">	&#125;</div><div class="line">……</div><div class="line">&#125;</div><div class="line">　　在stdafx.h中，添加头文件`<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Afxsock.h&gt;</span>`。</span></div><div class="line"></div><div class="line">### 创建并初始化套接字</div><div class="line">```C++</div><div class="line">BOOL CChatDlg::InitSocket()</div><div class="line">&#123;</div><div class="line">	<span class="comment">//创建套接字</span></div><div class="line">	m_socket = socket(AF_INET, SOCK_DGRAM, <span class="number">0</span>);</div><div class="line">	<span class="keyword">if</span> (INVALID_SOCKET == m_socket)</div><div class="line">	&#123;</div><div class="line">		MessageBox(<span class="string">"套接字创建失败！"</span>);</div><div class="line">		<span class="keyword">return</span> FALSE;</div><div class="line">	&#125;</div><div class="line">	SOCKADDR_IN addrSock;</div><div class="line">	addrSock.sin_family = AF_INET;</div><div class="line">	addrSock.sin_port = htons(<span class="number">7000</span>);</div><div class="line">	addrSock.sin_addr.S_un.S_addr = htonl(INADDR_ANY);</div><div class="line"></div><div class="line">	<span class="keyword">int</span> retval;</div><div class="line">	<span class="comment">//绑定套接字</span></div><div class="line">	retval = bind(m_socket, (SOCKADDR*)&amp;addrSock, <span class="keyword">sizeof</span>(SOCKADDR));</div><div class="line">	<span class="keyword">if</span> (SOCKET_ERROR == retval)</div><div class="line">	&#123;</div><div class="line">		closesocket(m_socket);</div><div class="line">		MessageBox(<span class="string">"绑定失败！"</span>);</div><div class="line">		<span class="keyword">return</span> TRUE;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> TRUE;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">BOOL CChatDlg::OnInitDialog()</div><div class="line">&#123;</div><div class="line">……</div><div class="line">	</div><div class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add extra initialization here</span></div><div class="line">	InitSocket();</div><div class="line"></div><div class="line">	<span class="keyword">return</span> TRUE;  <span class="comment">// return TRUE  unless you set the focus to a control</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="实现接收端功能"><a href="#实现接收端功能" class="headerlink" title="实现接收端功能"></a>实现接收端功能</h3><p>　　在CChatDlg类中定义：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/////////////////////////////////////////////////////////////////////////////</span></div><div class="line"><span class="comment">// CChatDlg dialog</span></div><div class="line"></div><div class="line"><span class="keyword">struct</span> RECVPARAM</div><div class="line">&#123;</div><div class="line">	SOCKET sock; <span class="comment">//已创建的套接字</span></div><div class="line">	HWND hwnd; <span class="comment">//对话框句柄</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>　　在Chatdlg.h中添加：<code>static DWORD WINAPI RecvProc(LPVOID lpParameter);</code><br>在OnInitDialog()中添加：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">BOOL CChatDlg::OnInitDialog()</div><div class="line">&#123;</div><div class="line"></div><div class="line">……</div><div class="line"></div><div class="line"><span class="comment">// <span class="doctag">TODO:</span> Add extra initialization here</span></div><div class="line">	InitSocket();</div><div class="line">	RECVPARAM *pRecvParam = <span class="keyword">new</span> RECVPARAM;</div><div class="line">	pRecvParam-&gt;sock = m_socket;</div><div class="line">	pRecvParam-&gt;hwnd = m_hWnd;</div><div class="line">	<span class="comment">//创建接收线程</span></div><div class="line">	HANDLE hThread = CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, RecvProc, (LPVOID)pRecvParam, <span class="number">0</span>, <span class="literal">NULL</span>);</div><div class="line">	<span class="comment">//关闭该接收程句柄，释放其引用计数</span></div><div class="line">	CloseHandle(hThread);</div><div class="line"></div><div class="line"></div><div class="line">	<span class="keyword">return</span> TRUE;  <span class="comment">// return TRUE  unless you set the focus to a control</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">　　在CChatDlg类中添加：</div><div class="line">```C++</div><div class="line">DWORD WINAPI CChatDlg::RecvProc(LPVOID lpParameter)</div><div class="line">&#123;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　若要求采用完全面向对象的思想来编程，不能使用全局函数和全局变量了，可以采用静态成员函数和静态成员变量的方法来解决。<br>　　<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">DWORD WINAPI CChatDlg::RecvProc(LPVOID lpParameter)</div><div class="line">&#123;</div><div class="line">	<span class="comment">//获取主线程传递的套接字和窗口句柄</span></div><div class="line">	SOCKET sock = ((RECVPARAM*)lpParameter)-&gt;sock;</div><div class="line">	HWND hwnd = ((RECVPARAM*)lpParameter)-&gt;hwnd;</div><div class="line">	<span class="keyword">delete</span> lpParameter;</div><div class="line"></div><div class="line">	SOCKADDR_IN addrFrom;</div><div class="line">	<span class="keyword">int</span> len = <span class="keyword">sizeof</span>(SOCKADDR);</div><div class="line"></div><div class="line">	<span class="keyword">char</span> recvBuf[<span class="number">200</span>];</div><div class="line">	<span class="keyword">char</span> tempBuf[<span class="number">300</span>];</div><div class="line">	<span class="keyword">int</span> retval;</div><div class="line">	<span class="keyword">while</span>(TRUE)</div><div class="line">	&#123;</div><div class="line">		<span class="comment">//接收数据</span></div><div class="line">		retval = recvfrom(sock, recvBuf, <span class="number">200</span>, <span class="number">0</span>, (SOCKADDR*)&amp;addrFrom, &amp;len);</div><div class="line">		<span class="keyword">if</span> (SOCKET_ERROR == retval)</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		<span class="built_in">sprintf</span>(tempBuf, <span class="string">"%s 说： %s"</span>, inet_ntoa(addrFrom.sin_addr), recvBuf);</div><div class="line">		::PostMessage(hwnd, WM_RECVDATA, <span class="number">0</span>, (LPARAM)tempBuf);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　在该类添加头文件 <code>#define WM_RECVDATA    WM_USER+1</code></p>
<p>在CChatDlg类头文件中编写该消息响应函数原型的声明：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Generated message map functions</span></div><div class="line"><span class="comment">//&#123;&#123;AFX_MSG(CChatDlg)</span></div><div class="line"><span class="function"><span class="keyword">virtual</span> BOOL <span class="title">OnInitDialog</span><span class="params">()</span></span>;</div><div class="line"><span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnSysCommand</span><span class="params">(UINT nID, LPARAM lParam)</span></span>;</div><div class="line"><span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnPaint</span><span class="params">()</span></span>;</div><div class="line"><span class="function">afx_msg HCURSOR <span class="title">OnQueryDragIcon</span><span class="params">()</span></span>;</div><div class="line"><span class="comment">//&#125;&#125;AFX_MSG</span></div><div class="line"><span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnRecvData</span><span class="params">(WPARAM wParam, LPARAM lParam)</span></span>;</div><div class="line">DECLARE_MESSAGE_MAP()</div></pre></td></tr></table></figure></p>
<p>在CChatDlg类的源文件中添加WM_RECVDATA消息映射。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">BEGIN_MESSAGE_MAP(CChatDlg, CDialog)</div><div class="line">	<span class="comment">//&#123;&#123;AFX_MSG_MAP(CChatDlg)</span></div><div class="line">	ON_WM_SYSCOMMAND()</div><div class="line">	ON_WM_PAINT()</div><div class="line">	ON_WM_QUERYDRAGICON()</div><div class="line">	<span class="comment">//&#125;&#125;AFX_MSG_MAP</span></div><div class="line">	ON_MESSAGE(WM_RECVDATA, OnRecvData)</div><div class="line">END_MESSAGE_MAP()</div></pre></td></tr></table></figure></p>
<p>在构造函数中<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CChatDlg::OnRecvData(WPARAM wParam, LPARAM lParam)</div><div class="line">&#123;</div><div class="line">	<span class="comment">//取出接收到的数据</span></div><div class="line">	CString str = (<span class="keyword">char</span>*)lParam;</div><div class="line">	CString strTemp;</div><div class="line">	<span class="comment">//获得已有数据</span></div><div class="line">	GetDlgItemText(IDC_EDIT_RECV, strTemp);</div><div class="line">	str += <span class="string">"\r\n"</span>;</div><div class="line">	str += strTemp;</div><div class="line">	<span class="comment">//显示所有接收到的数据</span></div><div class="line">	SetDlgItemText(IDC_EDIT_RECV, str);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="实现发送端功能"><a href="#实现发送端功能" class="headerlink" title="实现发送端功能"></a>实现发送端功能</h3><p>双击发送，添加响应函数。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> CChatDlg::OnBtnSend() </div><div class="line">&#123;</div><div class="line">	<span class="comment">//获取对方IP</span></div><div class="line"><span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></div><div class="line">	DWORD dwIP;</div><div class="line">	((CIPAddressCtrl*)GetDlgItem(IDC_IPADDRESS1))-&gt;GetAddress(dwIP);</div><div class="line"></div><div class="line">	SOCKADDR_IN addrTo;</div><div class="line">	addrTo.sin_family = AF_INET;</div><div class="line">	addrTo.sin_port = htons(<span class="number">7000</span>);</div><div class="line">	addrTo.sin_addr.S_un.S_addr = htonl(dwIP);</div><div class="line"></div><div class="line">	CString strSend;</div><div class="line">	<span class="comment">//获得待发送数据</span></div><div class="line">	GetDlgItemText(IDC_EDIT_SEND, strSend);</div><div class="line">	<span class="comment">//发送数据</span></div><div class="line">	sendto(m_socket, strSend, strSend.GetLength()+<span class="number">1</span>, <span class="number">0</span>,</div><div class="line">		(SOCKADDR*)&amp;addrTo, <span class="keyword">sizeof</span>(SOCKADDR));</div><div class="line">	<span class="comment">//清空发送编辑框中的内容</span></div><div class="line">	SetDlgItemText(IDC_EDIT_SEND, <span class="string">""</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　为了让编辑框控件接受换行符，必须设置该控件支持多行数据这一属性。<br><img src="http://img.blog.csdn.net/20170428102525898?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>　　将“发送”设置为Default button，还可以选择取消Visible选项。<br>　　本例在一个程序中同时实现了接收端和发送端的功能，所以只需在聊天双方各自的机器上安装本程序，在聊天时，通过输入对方主机的IP地址，就可以与对方进行通信了。</p>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20170413231922633?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast&quot; width=&quot;300&quot; height=&quot;180&quot; style=&quot;float:right;&quot;/&gt;&lt;br&gt;　　很多技术书废话连篇。——公司某优秀工程师&lt;br&gt;　　（本教程重操作，轻理论，为操作减负。需了解详细原理的朋友可以自行看各种书籍。）&lt;br&gt;　　直接上菜。&lt;br&gt;&lt;br&gt; &lt;/div&gt;
    
    </summary>
    
      <category term="互联网" scheme="http://hubojing.github.io/categories/%E4%BA%92%E8%81%94%E7%BD%91/"/>
    
    
      <category term="MFC" scheme="http://hubojing.github.io/tags/MFC/"/>
    
      <category term="C++" scheme="http://hubojing.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>多说关闭引发的麻烦</title>
    <link href="http://hubojing.github.io/2017/04/05/%E5%A4%9A%E8%AF%B4%E5%85%B3%E9%97%AD%E5%BC%95%E5%8F%91%E7%9A%84%E9%BA%BB%E7%83%A6/"/>
    <id>http://hubojing.github.io/2017/04/05/多说关闭引发的麻烦/</id>
    <published>2017-04-05T08:44:21.000Z</published>
    <updated>2017-07-03T14:04:07.000Z</updated>
    
    <content type="html"><![CDATA[<div align="left"><br><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1491392241106&di=d26487a68371b445aa7b604ab2883ce1&imgtype=0&src=http%3A%2F%2Fimage103.360doc.com%2FDownloadImg%2F2017%2F02%2F1715%2F91672979_2.png" width="300" height="180" style="float:right;"><br><br># 2017.7.3 disqus不用翻墙即可评论<br><br>　　不审核，直接显示。并且，可以回访！<br><br>　　这次折腾好后短期内应该不会再弄评论框了  专注工作专注工作<br><br>　　墙内换成网易云跟帖后，评论量就跳水式下降，仿佛被打入冷宫？加上跟帖各种缺陷，还是用disqus吧，刚好听说了可以不翻墙就能用的方法，遂试之。<br><br> </div>

<a id="more"></a>
<p>之前的600条评论又只能暂以json的形式躺在电脑里了。为什么大家的格式都不一样呢？这真的很不和谐，很不！和！谐！！</p>
<h2 id="登录服务器"><a href="#登录服务器" class="headerlink" title="登录服务器"></a>登录服务器</h2><p>我用的xshell，ssh连接服务器。我的服务器是DigitalOcean买的 512M的……(它已经被闲置了三个月了，心疼money)<br>详见<a href="http://hubojing.me/2017/03/28/DigitalOcean%E8%B4%AD%E4%B9%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%99%E7%A8%8B/" target="_blank" rel="external">DigitalOcean购买服务器教程</a></p>
<h2 id="安装面板"><a href="#安装面板" class="headerlink" title="安装面板"></a>安装面板</h2><p>在服务器上安装<a href="https://www.bt.cn/bbs/thread-1186-1-1.html" target="_blank" rel="external">宝塔Linux面板</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y wget &amp;&amp; wget -O install.sh http://download.bt.cn/install/install.sh &amp;&amp; sh install.sh</div></pre></td></tr></table></figure></p>
<p>然后在浏览器中打开面板。</p>
<h2 id="新建站点"><a href="#新建站点" class="headerlink" title="新建站点"></a>新建站点</h2><p>在网站中添加站点，输入一个域名。（可勾选FTP）</p>
<h2 id="配置api"><a href="#配置API" class="headerlink" title="配置API"></a>配置API</h2><p><a href="https://github.com/fooleap/disqus-php-api" target="_blank" rel="external">利用 PHP cURL 转发 Disqus API 请求</a> ，将文件clone到本地。在config中按要求配置。</p>
<p>将API打包上传到面板，解压。再将dist文件夹下的两个文件上传上去。</p>
<h2 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h2><p>接着打开解析博客的地址，我用的腾讯云。<a href="https://www.dnspod.cn" target="_blank" rel="external">DNSPOD</a> 添加域名。<br>主机记录填对应的新建的站点名（不带网站一级域名），记录类型A，记录值为服务器地址。</p>
<h2 id="disqus配置"><a href="#disqus配置" class="headerlink" title="disqus配置"></a>disqus配置</h2><p>disqus后台中勾选允许匿名评论。</p>
<h2 id="修改主题中评论文件"><a href="#修改主题中评论文件" class="headerlink" title="修改主题中评论文件"></a>修改主题中评论文件</h2><p>完工。</p>
<p>部署时，<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">fatal: Unable <span class="built_in">to</span> <span class="built_in">create</span> <span class="string">'E:/hexo/.deploy_git/.git/index.lock'</span>: File exists.</div><div class="line"></div><div class="line">Another git <span class="built_in">process</span> seems <span class="built_in">to</span> be running <span class="keyword">in</span> this repository, e.g.</div><div class="line"><span class="keyword">an</span> editor opened <span class="keyword">by</span> <span class="string">'git commit'</span>. Please make sure all processes</div><div class="line">are terminated <span class="keyword">then</span> <span class="keyword">try</span> again. If <span class="keyword">it</span> still fails, <span class="keyword">a</span> git <span class="built_in">process</span></div><div class="line">may have crashed <span class="keyword">in</span> this repository earlier:</div><div class="line">remove <span class="keyword">the</span> <span class="built_in">file</span> manually <span class="built_in">to</span> continue.</div><div class="line">FATAL Something<span class="string">'s wrong. Maybe you can find the solution here: http://hexo.io/docs/troubleshooting.html</span></div></pre></td></tr></table></figure></p>
<p>解决：删除对应的index.lock。</p>
<hr>
<blockquote>
<h1 id="2017527-已更换为disqus"><a href="#2017-5-27-已更换为Disqus" class="headerlink" title="2017.5.27 已更换为Disqus"></a>2017.5.27 已更换为Disqus</h1></blockquote>
<p>由于Disqus被墙，可能需要科学上网后才能看到评论。<br>若墙内的朋友们需要评论，可以直接点击QQ图标（PC端在左边栏，移动端在页面上方），和我进行在线对话。</p>
<hr>
<blockquote>
<h1 id="2017530-已导入历史评论"><a href="#2017-5-30-已导入历史评论" class="headerlink" title="2017.5.30 已导入历史评论"></a>2017.5.30 已导入历史评论</h1></blockquote>
<p>虽然比不上多说，比网易云跟帖还是好很多了。<br>目前发现有一篇文章的评论导入失败，Disqus的显示如下：<br>Missing or invalid message 或 Unable to find parent post<br>我再看看怎么解决，是否需要手工导入。<br>参考：<a href="http://urouge.github.io/migrate-to-disqus/" target="_blank" rel="external">多说评论迁移至Disqus</a></p>
<hr>
<p>多说八百年不发邮件通知我有评论，在我换为网易云跟帖后，竟然邮件通知我有评论了！</p>
<p>多说关闭带来的评论区何去何从让我颇为困扰。<br>现在能用的大概只有这些：畅言（需备案）、网易云跟帖（github.io不支持）、友言（也有倒闭趋势）、来必力（韩国）。</p>
<p>没有一个像多说这样好用的！</p>
<p>虽然多说也有很多问题，但它至少解决了核心问题：<br>1.评论显示正确的网友名称。<br>来看看我换上网易云跟帖后的效果：<br><img src="http://img.blog.csdn.net/20170405161942419?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="网易云跟帖"></p>
<p>都是有态度网友…… 我压根分不清谁是谁！</p>
<p>2.点击头像可以回访人家的独立博客。<br>这一点真的很重要，这往往是我们小众的独立博客人交朋友的主要途径啊！</p>
<p>3.可以自定义。<br>头像旋转、评论框自定义，真的可以很好看。这些跟帖做不到。</p>
<p>4.盖楼模式多样。<br>而跟帖只能一种，我不太喜欢，重复率太高，我还是喜欢多说的嵌套。</p>
<p>多说名字没起好啊！多说无益必自毙→_→<br>先换回多说吧，再等一个月看看。</p>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1491392241106&amp;di=d26487a68371b445aa7b604ab2883ce1&amp;imgtype=0&amp;src=http%3A%2F%2Fimage103.360doc.com%2FDownloadImg%2F2017%2F02%2F1715%2F91672979_2.png&quot; width=&quot;300&quot; height=&quot;180&quot; style=&quot;float:right;&quot;/&gt;&lt;br&gt;&lt;br&gt;# 2017.7.3 disqus不用翻墙即可评论&lt;br&gt;&lt;br&gt;　　不审核，直接显示。并且，可以回访！&lt;br&gt;&lt;br&gt;　　这次折腾好后短期内应该不会再弄评论框了  专注工作专注工作&lt;br&gt;&lt;br&gt;　　墙内换成网易云跟帖后，评论量就跳水式下降，仿佛被打入冷宫？加上跟帖各种缺陷，还是用disqus吧，刚好听说了可以不翻墙就能用的方法，遂试之。&lt;br&gt;&lt;br&gt; &lt;/div&gt;
    
    </summary>
    
      <category term="杂谈" scheme="http://hubojing.github.io/categories/%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="多说" scheme="http://hubojing.github.io/tags/%E5%A4%9A%E8%AF%B4/"/>
    
  </entry>
  
  <entry>
    <title>DigitalOcean购买服务器教程</title>
    <link href="http://hubojing.github.io/2017/03/28/DigitalOcean%E8%B4%AD%E4%B9%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%99%E7%A8%8B/"/>
    <id>http://hubojing.github.io/2017/03/28/DigitalOcean购买服务器教程/</id>
    <published>2017-03-28T13:50:20.000Z</published>
    <updated>2017-04-16T09:14:42.267Z</updated>
    
    <content type="html"><![CDATA[<div align="left"><br><img src="http://img.blog.csdn.net/20170326174446026?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" width="300" height="180" style="float:right;"><br><br>GitHub教育礼包有50美金优惠券，加上朋友的链接送的10美金，自己充值的5美金，正好可以买一个服务器用一年了。<br>　<br>　<br><br> </div>




<a id="more"></a>
<h1 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h1><h2 id="注册-优惠码"><a href="#注册、优惠码" class="headerlink" title="注册、优惠码"></a>注册、优惠码</h2><p>1.点击<a href="https://m.do.co/c/9d7b9b7b94ba/" target="_blank" rel="external">https://m.do.co/c/9d7b9b7b94ba/</a> 进入DigitalOcean注册。<br>（通过以上链接，你可以多获得10美金！同时，我也将得到10美金。）</p>
<p>注册时，需要支付5美金完成支付，最好用paypal支付（可以去注册一个账号），最好不要用信用卡（土豪可以用……）。</p>
<p>2.点击头像下的Setting，再点击右侧的Billing<br><img src="http://img.blog.csdn.net/20170326174446026?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="Billing"></p>
<p>3.输入教育礼包优惠码<br><img src="http://img.blog.csdn.net/20170326174542642?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="Promo code"></p>
<p><strong>注意</strong>：很有可能显示“ Account not eligible to use this promo code.”可能滥用优惠码却不是学生的人太多，DO加强了监管，审查比较严格。反正我的是没有通过。<br>于是，需要向客服反映情况。<br>点击Support，<br><img src="http://img.blog.csdn.net/20170326174844940?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="Support"><br>点击Create ticket，把你的情况写清楚，最好说明你是学生，并附带你的优惠码。之后官方会帮你搞定。（在三小时后就处理好了我的）</p>
<h2 id="购买服务器"><a href="#购买服务器" class="headerlink" title="购买服务器"></a>购买服务器</h2><p>点击创建Droplet，</p>
<p><img src="http://img.blog.csdn.net/20170326175306708?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="Create Droplet"></p>
<p><img src="http://img.blog.csdn.net/20170326180620758?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="服务器价格"></p>
<p>学生……穷啊……只能买最便宜的……这样刚好可以用一年。</p>
<p><img src="http://img.blog.csdn.net/20170326175420319?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="选择服务器系统"></p>
<p>选择centos6.8x64</p>
<p><img src="http://img.blog.csdn.net/20170326175528071?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="选择地址"></p>
<p>旧金山比较快。</p>
<p><img src="http://img.blog.csdn.net/20170326175607599?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="可选项"></p>
<p>这个的第一个和第三个可以选，最好不选第三个。</p>
<p>改名</p>
<p><img src="http://img.blog.csdn.net/20170326175720964?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="改名"></p>
<p>点击create，服务器购买成功。<br>DO会给你发送一封带有初始密码的邮件。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>下载puTTY或xshell。<br>puTTY<br><img src="http://img.blog.csdn.net/20170326180124352?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="puTTY"></p>
<p>我以shell为例，<br><img src="http://img.blog.csdn.net/20170326180208206?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="初始页"></p>
<p>新建会话。<br><img src="http://img.blog.csdn.net/20170326180245618?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="属性"></p>
<p>IP地址填你的服务器IP，接受并保存你的主机密钥。<br>输入用户名。<br>输入初始密码。<br>再修改密码。（密码最好复杂一点）</p>
<p>完成。<br>可以愉快地使用你的服务器啦！</p>
<h1 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h1><p>感谢<a href="https://www.domeyi.com/" target="_blank" rel="external">小忆</a>的耐心指导和大力帮助！</p>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20170326174446026?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast&quot; width=&quot;300&quot; height=&quot;180&quot; style=&quot;float:right;&quot;/&gt;&lt;br&gt;&lt;br&gt;GitHub教育礼包有50美金优惠券，加上朋友的链接送的10美金，自己充值的5美金，正好可以买一个服务器用一年了。&lt;br&gt;　&lt;br&gt;　&lt;br&gt;&lt;br&gt; &lt;/div&gt;
    
    </summary>
    
      <category term="互联网" scheme="http://hubojing.github.io/categories/%E4%BA%92%E8%81%94%E7%BD%91/"/>
    
    
      <category term="DigitalOcean" scheme="http://hubojing.github.io/tags/DigitalOcean/"/>
    
      <category term="服务器" scheme="http://hubojing.github.io/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>更换为.me域名教程</title>
    <link href="http://hubojing.github.io/2017/03/26/%E6%9B%B4%E6%8D%A2%E4%B8%BA.me%E5%9F%9F%E5%90%8D%E6%95%99%E7%A8%8B/"/>
    <id>http://hubojing.github.io/2017/03/26/更换为.me域名教程/</id>
    <published>2017-03-26T13:01:21.000Z</published>
    <updated>2017-04-16T09:15:29.091Z</updated>
    
    <content type="html"><![CDATA[<div align="left"><br><img src="http://img.blog.csdn.net/20170326164253754?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" width="300" height="180" style="float:right;"><br><br>既然申请得到Github教育礼包，就应开始使用。<br>我的博客是基于Hexo搭建于Github的博客，原域名：<a href="http://hubojing.github.io/">http://hubojing.github.io/</a> ，现在的新域名是 <a href="http://www.hubojing.me/" target="_blank" rel="external">http://www.hubojing.me/</a> 。<br>　<br>　<br>　<br><br> </div>



<a id="more"></a>
<h1 id="注册me域名"><a href="#注册-me域名" class="headerlink" title="注册.me域名"></a>注册.me域名</h1><p>1.打开教育礼包中的namecheap优惠页面<a href="https://nc.me/，使用你的github账号登录。" target="_blank" rel="external">https://nc.me/，使用你的github账号登录。</a><br><img src="http://img.blog.csdn.net/20170326164253754?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="登录"></p>
<p>登陆后，显示已成功。</p>
<p><img src="http://img.blog.csdn.net/20170326164344646?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="成功"></p>
<p>搜索你想要的域名。</p>
<p><img src="http://img.blog.csdn.net/20170326164007734?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="查询页面"></p>
<p>2.如果该域名未被注册，那么你可以注册该域名。<br><img src="http://img.blog.csdn.net/20170326164441564?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="注册页面"></p>
<p>点击ADD。</p>
<p><img src="http://img.blog.csdn.net/20170326164524022?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="付款"></p>
<p>点击Complete Order。</p>
<p><img src="http://img.blog.csdn.net/20170326164625924?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="详情"></p>
<p>点击下方的Finish Up完成注册，这样该域名就属于你了。</p>
<p>紧接着，会要求你登录你的namecheap账号，如果之前没有用过该网站，就点register注册一个账号。</p>
<p><img src="http://img.blog.csdn.net/20170326164750097?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="注册"></p>
<p>注册完成后，是以下的页面显示。</p>
<p><img src="http://img.blog.csdn.net/20170326164921653?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="注册完成"></p>
<p>在和你的Github账户绑定在一起：<br><img src="http://img.blog.csdn.net/20170326165006630?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="绑定成功"></p>
<p>这样.me域名注册就算是全部完成了。</p>
<h1 id="域名管理"><a href="#域名管理" class="headerlink" title="域名管理"></a>域名管理</h1><p>打开网址<a href="http://www.namecheap.com/，登录自己的账户。" target="_blank" rel="external">http://www.namecheap.com/，登录自己的账户。</a><br>点击Domain List，<br><img src="http://img.blog.csdn.net/20170326165302596?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="点击"></p>
<p>你将看到域名列表。</p>
<p><img src="http://img.blog.csdn.net/20170326165359413?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="域名列表"></p>
<p>由于国外的DNS可能很慢，于是最好托管到国内的服务商来。我选择的是腾讯云。</p>
<h1 id="转移到腾讯云"><a href="#转移到腾讯云" class="headerlink" title="转移到腾讯云"></a>转移到腾讯云</h1><p>进入<a href="https://www.dnspod.cn/，注册新账号（可以用QQ、微信等直接登录免注册）。" target="_blank" rel="external">https://www.dnspod.cn/，注册新账号（可以用QQ、微信等直接登录免注册）。</a></p>
<p>点击添加域名，将刚才的.me域名输入。保存。<br><img src="http://img.blog.csdn.net/20170326165806508?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="添加域名"></p>
<p>控制台全局外观：<br><img src="http://img.blog.csdn.net/20170326170148387?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="控制台"></p>
<p>再回到namecheap控制台，修改NAMESERVERS，选择Custom DNS，如图。<br><img src="http://img.blog.csdn.net/20170326170503918?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="修改DNS"></p>
<p>需要等待一会儿才能成功。（最晚48h，我就等了几分钟就好了。）</p>
<p><img src="http://img.blog.csdn.net/20170326170702856?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="成功提示"></p>
<p>回到腾讯云，域名是红的。<br><img src="http://img.blog.csdn.net/20170326170821412?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="红色"></p>
<p>点击进去看看，再返回，等待一下，再刷新。<br>变成蓝色，说明已经更新成功了。</p>
<p>点击进入，点击添加记录，</p>
<p><img src="http://img.blog.csdn.net/20170326171042541?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="添加记录"></p>
<p>保存。</p>
<h1 id="github博客项目设置"><a href="#GitHub博客项目设置" class="headerlink" title="GitHub博客项目设置"></a>GitHub博客项目设置</h1><p>进入项目页（是博客项目页，非个人资料页），点击Setting，<br><img src="http://img.blog.csdn.net/20170326171232078?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="GitHub Pages"></p>
<p>将Custom domain改为你刚才解析的域名，比如我的 www.hubojing.me ，点击Save保存。</p>
<p><img src="http://img.blog.csdn.net/20170326171403280?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="保存成功"></p>
<p>大功告成！你的新域名已能正常使用，并且也能通过旧域名自动跳转到新域名！（记得重启浏览器，或者使用IE或Edge浏览器打开查看效果！）<br><img src="http://img.blog.csdn.net/20170326171616595?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="大功告成"></p>
<h1 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h1><p>感谢 <a href="https://www.domeyi.com/" target="_blank" rel="external">小忆</a> 在我更换域名时提供的大力帮助！</p>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20170326164253754?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast&quot; width=&quot;300&quot; height=&quot;180&quot; style=&quot;float:right;&quot;/&gt;&lt;br&gt;&lt;br&gt;既然申请得到Github教育礼包，就应开始使用。&lt;br&gt;我的博客是基于Hexo搭建于Github的博客，原域名：&lt;a href=&quot;http://hubojing.github.io/&quot;&gt;http://hubojing.github.io/&lt;/a&gt; ，现在的新域名是 &lt;a href=&quot;http://www.hubojing.me/&quot;&gt;http://www.hubojing.me/&lt;/a&gt; 。&lt;br&gt;　&lt;br&gt;　&lt;br&gt;　&lt;br&gt;&lt;br&gt; &lt;/div&gt;
    
    </summary>
    
      <category term="互联网" scheme="http://hubojing.github.io/categories/%E4%BA%92%E8%81%94%E7%BD%91/"/>
    
    
      <category term="教程" scheme="http://hubojing.github.io/tags/%E6%95%99%E7%A8%8B/"/>
    
      <category term="域名" scheme="http://hubojing.github.io/tags/%E5%9F%9F%E5%90%8D/"/>
    
  </entry>
  
  <entry>
    <title>Github教育礼包</title>
    <link href="http://hubojing.github.io/2017/03/25/Github%E6%95%99%E8%82%B2%E7%A4%BC%E5%8C%85/"/>
    <id>http://hubojing.github.io/2017/03/25/Github教育礼包/</id>
    <published>2017-03-25T03:21:23.000Z</published>
    <updated>2017-04-16T09:13:21.975Z</updated>
    
    <content type="html"><![CDATA[<div align="left"><br><img src="http://img.blog.csdn.net/20170325152139513?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" width="300" height="180" style="float:right;"><br><br><br>　<br>感谢小伙伴让我知道github教育礼包，并教我怎么申请：<br><br><br> </div>


<a id="more"></a>
<ol>
<li>到教育优惠页面申请：<a href="https://education.github.com/" target="_blank" rel="external">https://education.github.com/</a></li>
<li>填写学校信息及申请理由，如果有edu邮箱一般很快就通过了；如果没有，需要提供证件来证明。</li>
<li>一般来说一小时到几天就申请成功了。（我当天晚上收到了邮件）<br>有用的主要三个东西：</li>
<li>me域名免费一年</li>
<li>DO的免费VPS代金券50美金（有效期1年），可以使用最低配置11个月</li>
<li>免费SSL证书</li>
</ol>
<p>收到的邮件（截取片段）：<br>If you need help getting started with Git and GitHub, check out:</p>
<p><a href="https://help.github.com/articles/good-resources-for-learning-git-and-github" target="_blank" rel="external">https://help.github.com/articles/good-resources-for-learning-git-and-github</a></p>
<p>We’ve also given you access to the Student Developer Pack, available at:</p>
<p><a href="https://education.github.com/pack" target="_blank" rel="external">https://education.github.com/pack</a></p>
<p>If you have any questions, contact us:</p>
<p><a href="https://education.github.com/contact" target="_blank" rel="external">https://education.github.com/contact</a></p>
<p>Spread the word: we love giving educational discounts to students, teachers, administrators, and researchers! Please send them to:</p>
<p><a href="https://education.github.com" target="_blank" rel="external">https://education.github.com</a></p>
<p>Have an Octotastic day!（这个 Octotastic 我不造是什么意思……词典也没这个词 望大神解答）</p>
<p>My Pack:<br><img src="http://img.blog.csdn.net/20170325152139513?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="ATOM"><br>A hackable text editor for the 21st Century<br>来自21世纪的可定制文本编辑器<br>免费使用</p>
<p><img src="http://img.blog.csdn.net/20170325152259545?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="aws educate"><br>Access to the AWS cloud, free training, and collaboration resources<br>AWS云，免费教程和资源。</p>
<p><img src="http://img.blog.csdn.net/20170325152452545?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="bitnami"><br>Install cloud applications in a single click<br>轻松安装云应用</p>
<p><img src="http://img.blog.csdn.net/20170325152601503?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="CARTO"><br>An open and powerful platform for spatial data analysis, visualization, and application creation.<br>一个开放有力的空间、视觉、应用创建数据分析平台。</p>
<p><img src="http://img.blog.csdn.net/20170325152759640?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="CrowdFlower"><br>Crowdsourcing and data enrichment platform<br>众包与数据富集平台</p>
<p><img src="http://img.blog.csdn.net/20170325152955501?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="DATADOG"><br>Cloud-based infrastructure monitoring<br>云基础设施监控</p>
<p><img src="http://img.blog.csdn.net/20170325153132065?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="DigitalOcean"><br>Simple cloud hosting, built for developers<br>简单云托管，为开发者而生</p>
<p><img src="http://img.blog.csdn.net/20170325153307467?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="dnsimple"><br>Simple DNS management with one-click services and a robust API<br>简单的DNS管理，包括一键服务和强大的API</p>
<p><img src="http://img.blog.csdn.net/20170325153539661?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="FLATIRON SCHOOL"><br>Learn Web Development from the premier coding bootcamp for launching developers.<br>从最开始的代码集训营开始学习Web开发成为开发者。</p>
<p><img src="http://img.blog.csdn.net/20170325153827865?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="Github"><br>Powerful collaboration, code review, and code management<br>强大的协作、代码审查和代码管理</p>
<p><img src="http://img.blog.csdn.net/20170325153937663?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="GitKraken"><br>The downright luxurious Git client for Windows, Mac and Linux<br>Windows，Mac和Linux上的超级豪华Git客户端</p>
<p><img src="http://img.blog.csdn.net/20170325154114898?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="HACKHANDS"><br>Live programming help available 24/7<br>编程帮助</p>
<p><img src="http://img.blog.csdn.net/20170325154256511?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="Microsoft Imagine"><br>A suite of Microsoft Azure cloud services and developer tools, including the Visual Studio IDE<br>一套微软Azure的云服务和开发工具，包括Visual Studio IDE</p>
<p><img src="http://img.blog.csdn.net/20170325154446405?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="namecheap"><br>Affordable registration, hosting, and domain management<br>便宜的注册，托管和域管理</p>
<p><img src="http://img.blog.csdn.net/20170325154612806?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="SendGrid"><br>Email infrastructure as a service<br>电子邮件基础设施服务</p>
<p><img src="http://img.blog.csdn.net/20170325154722190?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="stripe"><br>Web and mobile payments, built for developers<br>网络和移动支付，为开发者而生</p>
<p><img src="http://img.blog.csdn.net/20170325154820863?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="TAPLYTICS"><br>Dynamic A/B testing, smart push notifications and custom analytics for native mobile apps<br>动态A / B测试，智能推送通知和自定义分析本地移动应用程序</p>
<p><img src="http://img.blog.csdn.net/20170325155641561?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="transifex"><br>Localization platform that easily integrates with your code base<br>易于与代码库集成的本地化平台</p>
<p><img src="http://img.blog.csdn.net/20170325155750954?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="Travis CI"><br>Continuous integration platform for open source and private projects<br>开源和私有项目的连续集成平台</p>
<p><img src="http://img.blog.csdn.net/20170325155909190?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="UDACITY"><br>Enroll in a Nanodegree program, and launch your career in Web and Mobile Development, Machine Learning, Data Science, and more.</p>
<p>Enroll in a Nanodegree program, and launch your career in Web and Mobile Development, Machine Learning, Data Science, and more.<br>报名参加一个nanodegree项目，在Web、移动开发、机器学习、数据科学以及等多方面，开启你的职业生涯。</p>
<p><img src="http://img.blog.csdn.net/20170325162245096?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="UNREAL"><br>A complete suite of game development tools for PC, console, mobile, web and VR<br>一套完整的游戏开发工具，用于PC，控制台，移动，网络和虚拟现实</p>
<p>正在学习其中一些工具的使用中……未完待续。</p>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20170325152139513?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast&quot; width=&quot;300&quot; height=&quot;180&quot;  style=&quot;float:right;&quot;/&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;　&lt;br&gt;感谢小伙伴让我知道github教育礼包，并教我怎么申请：&lt;br&gt;&lt;br&gt;&lt;br&gt; &lt;/div&gt;
    
    </summary>
    
      <category term="杂谈" scheme="http://hubojing.github.io/categories/%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="Github" scheme="http://hubojing.github.io/tags/Github/"/>
    
  </entry>
  
  <entry>
    <title>简易计算器（Android）</title>
    <link href="http://hubojing.github.io/2017/03/22/%E5%88%B6%E4%BD%9C%E7%AE%80%E6%98%93%E8%AE%A1%E7%AE%97%E5%99%A8APP%EF%BC%88%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84%EF%BC%89/"/>
    <id>http://hubojing.github.io/2017/03/22/制作简易计算器APP（线性结构）/</id>
    <published>2017-03-21T16:19:25.000Z</published>
    <updated>2017-03-30T15:54:21.400Z</updated>
    
    <content type="html"><![CDATA[<div align="left"><br><img src="http://img.blog.csdn.net/20170321231830210?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" width="300" height="180" style="float:right;"><br><br><br><br>安卓端简易计算器APP实现。<br><br><br><br></div>

<a id="more"></a>
<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>制作简易计算器（Android）。</p>
<h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><p>第一步：页面布局<br>第二步：事件监听以及实现运算</p>
<h1 id="成品"><a href="#成品" class="headerlink" title="成品"></a>成品</h1><p><img src="http://img.blog.csdn.net/20170321231830210?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="简易计算器"></p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="mainactivityjava"><a href="#MainActivity-java" class="headerlink" title="MainActivity.java"></a>MainActivity.java</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div></pre></td><td class="code"><pre><div class="line">package com.example.calculator;</div><div class="line"></div><div class="line">import android.app.Activity;</div><div class="line">import android.os.Bundle;</div><div class="line">import android.view.View;</div><div class="line">import android.view.View.OnClickListener;</div><div class="line">import android.widget.Button;</div><div class="line">import android.widget.EditText;</div><div class="line"></div><div class="line">public class MainActivity extends Activity implements OnClickListener&#123;</div><div class="line">	Button btn_0;//0按钮</div><div class="line">	Button btn_1;//1按钮</div><div class="line">	Button btn_2;//2按钮</div><div class="line">	Button btn_3;//3按钮</div><div class="line">	Button btn_4;//4按钮</div><div class="line">	Button btn_5;//5按钮</div><div class="line">	Button btn_6;//6按钮</div><div class="line">	Button btn_7;//7按钮</div><div class="line">	Button btn_8;//8按钮</div><div class="line">	Button btn_9;//9按钮</div><div class="line">	Button btn_point;//小数点按钮</div><div class="line">	Button btn_clear;//清除按钮</div><div class="line">	Button btn_del;//删除按钮</div><div class="line">	Button btn_plus;//加按钮</div><div class="line">	Button btn_minus;//减按钮</div><div class="line">	Button btn_multiply;//乘按钮</div><div class="line">	Button btn_divide;//除按钮</div><div class="line">	Button btn_equal;//等号按钮</div><div class="line">	EditText et_input;//显示输入内容的显示屏</div><div class="line">	boolean clear_flag;//清空标识</div><div class="line">	</div><div class="line">	@Override</div><div class="line">	protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">		super.onCreate(savedInstanceState);</div><div class="line">		setContentView(R.layout.activity_main);</div><div class="line">		btn_0 = (Button) findViewById(R.id.btn_0);</div><div class="line">		btn_1 = (Button) findViewById(R.id.btn_1);</div><div class="line">		btn_2 = (Button) findViewById(R.id.btn_2);</div><div class="line">		btn_3 = (Button) findViewById(R.id.btn_3);</div><div class="line">		btn_4 = (Button) findViewById(R.id.btn_4);</div><div class="line">		btn_5 = (Button) findViewById(R.id.btn_5);</div><div class="line">		btn_6 = (Button) findViewById(R.id.btn_6);</div><div class="line">		btn_7 = (Button) findViewById(R.id.btn_7);</div><div class="line">		btn_8 = (Button) findViewById(R.id.btn_8);</div><div class="line">		btn_9 = (Button) findViewById(R.id.btn_9);</div><div class="line">		btn_point = (Button) findViewById(R.id.btn_point);</div><div class="line">		btn_clear = (Button) findViewById(R.id.btn_clear);</div><div class="line">		btn_del = (Button) findViewById(R.id.btn_del);</div><div class="line">		btn_plus = (Button) findViewById(R.id.btn_plus);</div><div class="line">		btn_minus = (Button) findViewById(R.id.btn_minus);</div><div class="line">		btn_multiply = (Button) findViewById(R.id.btn_multiply);</div><div class="line">		btn_divide = (Button) findViewById(R.id.btn_divide);</div><div class="line">		btn_equal = (Button) findViewById(R.id.btn_equal);</div><div class="line">		//以上是实例化按钮</div><div class="line">		et_input=(EditText)findViewById(R.id.et_input);//实例化显示屏</div><div class="line">		</div><div class="line">		btn_0.setOnClickListener(this);</div><div class="line">		btn_1.setOnClickListener(this);</div><div class="line">		btn_2.setOnClickListener(this);</div><div class="line">		btn_3.setOnClickListener(this);</div><div class="line">		btn_4.setOnClickListener(this);</div><div class="line">		btn_5.setOnClickListener(this);</div><div class="line">		btn_6.setOnClickListener(this);</div><div class="line">		btn_7.setOnClickListener(this);</div><div class="line">		btn_8.setOnClickListener(this);</div><div class="line">		btn_9.setOnClickListener(this);</div><div class="line">		btn_point.setOnClickListener(this);</div><div class="line">		btn_clear.setOnClickListener(this);</div><div class="line">		btn_del.setOnClickListener(this);</div><div class="line">		btn_plus.setOnClickListener(this);</div><div class="line">		btn_minus.setOnClickListener(this);</div><div class="line">		btn_multiply.setOnClickListener(this);	</div><div class="line">		btn_divide.setOnClickListener(this);</div><div class="line">		btn_equal.setOnClickListener(this);</div><div class="line">		//以上设置按钮的点击事件</div><div class="line">		</div><div class="line">		</div><div class="line">		</div><div class="line">		</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void onClick(View v) &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		String str =et_input.getText().toString();</div><div class="line">		switch (v.getId()) &#123;</div><div class="line">		case R.id.btn_0:</div><div class="line">		case R.id.btn_1:</div><div class="line">		case R.id.btn_2:</div><div class="line">		case R.id.btn_3:</div><div class="line">		case R.id.btn_4:</div><div class="line">		case R.id.btn_5:</div><div class="line">		case R.id.btn_6:</div><div class="line">		case R.id.btn_7:</div><div class="line">		case R.id.btn_8:</div><div class="line">		case R.id.btn_9:</div><div class="line">		case R.id.btn_point:</div><div class="line">			if(clear_flag)&#123;</div><div class="line">				clear_flag=false;</div><div class="line">				str=&quot;&quot;;</div><div class="line">				et_input.setText(&quot;&quot;);</div><div class="line">			&#125;</div><div class="line">		et_input.setText(str+((Button)v).getText());</div><div class="line">			break;</div><div class="line">			</div><div class="line">		</div><div class="line">		case R.id.btn_plus:</div><div class="line">		case R.id.btn_minus:</div><div class="line">		case R.id.btn_multiply:</div><div class="line">		case R.id.btn_divide:</div><div class="line">			if(clear_flag)&#123;</div><div class="line">				clear_flag=false;</div><div class="line">				str=&quot;&quot;;</div><div class="line">				et_input.setText(&quot;&quot;);</div><div class="line">			&#125;</div><div class="line">		et_input.setText(str+&quot; &quot;+((Button)v).getText()+&quot; &quot;);</div><div class="line">			break;</div><div class="line">		case R.id.btn_clear:</div><div class="line">			clear_flag=false;</div><div class="line">			str=&quot;&quot;;</div><div class="line">			et_input.setText(&quot;&quot;);</div><div class="line">			break;</div><div class="line">		case R.id.btn_del:</div><div class="line">			if(clear_flag)&#123;</div><div class="line">				clear_flag=false;</div><div class="line">				str=&quot;&quot;;</div><div class="line">				et_input.setText(&quot;&quot;);</div><div class="line">			&#125;else if(str!=null&amp;&amp;!str.equals(&quot;&quot;))&#123;</div><div class="line">				et_input.setText(str.substring(0, str.length()-1));</div><div class="line">			&#125;</div><div class="line">			break;</div><div class="line">		case R.id.btn_equal:</div><div class="line">			getResult();</div><div class="line">			break;</div><div class="line">	</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	/**</div><div class="line">	 * 运算结果</div><div class="line">	 */</div><div class="line">	private void getResult()&#123;</div><div class="line">		String exp=et_input.getText().toString();</div><div class="line">		if(exp==null||exp.equals(&quot;&quot;))&#123;</div><div class="line">			return;</div><div class="line">		&#125;</div><div class="line">		if(!exp.contains(&quot; &quot;))&#123;</div><div class="line">			return;</div><div class="line">		&#125;</div><div class="line">	</div><div class="line">		if(clear_flag)&#123;</div><div class="line">			clear_flag=false;</div><div class="line">			return;</div><div class="line">		&#125;</div><div class="line">		clear_flag=true;</div><div class="line">		double result=0;</div><div class="line">		String s1=exp.substring(0, exp.indexOf(&quot; &quot;));//运算符前面的字符串</div><div class="line">		String op=exp.substring(exp.indexOf(&quot; &quot;)+1, exp.indexOf(&quot; &quot;)+2);//运算符</div><div class="line">		String s2=exp.substring(exp.indexOf(&quot; &quot;)+3);//运算符后面的字符串</div><div class="line">		</div><div class="line">		if(!s1.equals(&quot;&quot;)&amp;&amp;!s2.equals(&quot;&quot;))&#123;</div><div class="line">			double d1=Double.parseDouble(s1);</div><div class="line">			double d2=Double.parseDouble(s2);</div><div class="line">			if(op.equals(&quot;+&quot;))&#123;</div><div class="line">				result=d1+d2;</div><div class="line">			&#125;else if(op.equals(&quot;-&quot;))&#123;</div><div class="line">				result=d1-d2;</div><div class="line">			&#125;else if(op.equals(&quot;×&quot;))&#123;</div><div class="line">				result=d1*d2;</div><div class="line">			&#125;else if(op.equals(&quot;÷&quot;))&#123;</div><div class="line">				if(d2==0)&#123;</div><div class="line">					result=0;</div><div class="line">				&#125;else&#123;</div><div class="line">					result=d1/d2;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			if(!s1.contains(&quot;.&quot;)&amp;&amp;!s2.contains(&quot;.&quot;)&amp;&amp;!op.equals(&quot;÷&quot;))&#123;</div><div class="line">				int r=(int)result;</div><div class="line">				et_input.setText(r+&quot;&quot;);</div><div class="line">			&#125;else&#123;</div><div class="line">				et_input.setText(result+&quot;&quot;);</div><div class="line">			&#125;</div><div class="line">		&#125;else if(!s1.equals(&quot;&quot;)&amp;&amp;s2.equals(&quot;&quot;))&#123;</div><div class="line">			et_input.setText(exp);</div><div class="line">		&#125;else if(s1.equals(&quot;&quot;)&amp;&amp;!s2.equals(&quot;&quot;))&#123;</div><div class="line">			double d2=Double.parseDouble(s2);</div><div class="line">			if(op.equals(&quot;+&quot;))&#123;</div><div class="line">				result=0+d2;</div><div class="line">			&#125;else if(op.equals(&quot;-&quot;))&#123;</div><div class="line">				result=0-d2;</div><div class="line">			&#125;else if(op.equals(&quot;×&quot;))&#123;</div><div class="line">				result=0;</div><div class="line">			&#125;else if(op.equals(&quot;÷&quot;))&#123;</div><div class="line">					result=0;</div><div class="line">			&#125;</div><div class="line">			if(!s2.contains(&quot;.&quot;))&#123;</div><div class="line">				int r=(int)result;</div><div class="line">				et_input.setText(r+&quot;&quot;);</div><div class="line">			&#125;else&#123;</div><div class="line">				et_input.setText(result+&quot;&quot;);</div><div class="line">			&#125;</div><div class="line">		&#125;else&#123;</div><div class="line">			et_input.setText(&quot;&quot;);</div><div class="line">		&#125;</div><div class="line">				</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="activity_mainxml"><a href="#activity-main-xml" class="headerlink" title="activity_main.xml"></a>activity_main.xml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div></pre></td><td class="code"><pre><div class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    android:orientation=&quot;vertical&quot;</div><div class="line">    android:paddingBottom=&quot;@dimen/activity_vertical_margin&quot;</div><div class="line">    android:paddingLeft=&quot;@dimen/activity_horizontal_margin&quot;</div><div class="line">    android:paddingRight=&quot;@dimen/activity_horizontal_margin&quot;</div><div class="line">    android:paddingTop=&quot;@dimen/activity_vertical_margin&quot;</div><div class="line">    tools:context=&quot;com.example.calculator.MainActivity&quot; &gt;</div><div class="line"></div><div class="line">   </div><div class="line">	&lt;EditText</div><div class="line">	    android:layout_width=&quot;fill_parent&quot;</div><div class="line">	    android:layout_height=&quot;60dip&quot;</div><div class="line">	    android:id=&quot;@+id/et_input&quot;</div><div class="line">	    android:editable=&quot;false&quot;</div><div class="line">	    android:gravity=&quot;right|bottom&quot;</div><div class="line">	    android:background=&quot;@drawable/white_bg&quot;</div><div class="line">	    /&gt;</div><div class="line">	&lt;LinearLayout</div><div class="line">	    android:layout_width=&quot;fill_parent&quot;</div><div class="line">	    android:layout_height=&quot;wrap_content&quot;</div><div class="line">	    android:layout_marginTop=&quot;20dp&quot;</div><div class="line">	    android:orientation=&quot;horizontal&quot;</div><div class="line">	    android:gravity=&quot;center_horizontal&quot;</div><div class="line">	    &gt;</div><div class="line">	    &lt;Button</div><div class="line">	        android:layout_width=&quot;60dp&quot;</div><div class="line">	        android:layout_height=&quot;60dp&quot;</div><div class="line">	        android:text=&quot;C&quot;</div><div class="line">	         android:paddingRight=&quot;10dp&quot;</div><div class="line">	        android:paddingBottom=&quot;10dp&quot;</div><div class="line">	        android:background=&quot;@drawable/white_selector&quot;</div><div class="line">	        android:textSize=&quot;20sp&quot;</div><div class="line">	        android:gravity=&quot;right|bottom&quot;</div><div class="line">	        android:id=&quot;@+id/btn_clear&quot;</div><div class="line">	        /&gt;</div><div class="line">	     &lt;Button</div><div class="line">	        android:layout_width=&quot;60dp&quot;</div><div class="line">	        android:layout_height=&quot;60dp&quot;</div><div class="line">	        android:text=&quot;DEL&quot;</div><div class="line">	         android:paddingRight=&quot;10dp&quot;</div><div class="line">	        android:paddingBottom=&quot;10dp&quot;</div><div class="line">	         android:background=&quot;@drawable/white_selector&quot;</div><div class="line">	        android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">	        android:textSize=&quot;20sp&quot;</div><div class="line">	        android:gravity=&quot;right|bottom&quot;</div><div class="line">	        android:id=&quot;@+id/btn_del&quot;</div><div class="line">	        /&gt;</div><div class="line">	     &lt;Button</div><div class="line">	        android:layout_width=&quot;60dp&quot;</div><div class="line">	        android:layout_height=&quot;60dp&quot;</div><div class="line">	        android:text=&quot;÷&quot;</div><div class="line">	         android:paddingRight=&quot;10dp&quot;</div><div class="line">	        android:paddingBottom=&quot;10dp&quot;</div><div class="line">	         android:background=&quot;@drawable/white_selector&quot;</div><div class="line">	        android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">	        android:textSize=&quot;20sp&quot;</div><div class="line">	        android:gravity=&quot;right|bottom&quot;</div><div class="line">	        android:id=&quot;@+id/btn_divide&quot;</div><div class="line">	        /&gt;</div><div class="line">	       &lt;Button</div><div class="line">	        android:layout_width=&quot;60dp&quot;</div><div class="line">	        android:layout_height=&quot;60dp&quot;</div><div class="line">	        android:text=&quot;×&quot;</div><div class="line">	         android:paddingRight=&quot;10dp&quot;</div><div class="line">	        android:paddingBottom=&quot;10dp&quot;</div><div class="line">	         android:background=&quot;@drawable/white_selector&quot;</div><div class="line">	        android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">	        android:textSize=&quot;20sp&quot;</div><div class="line">	        android:gravity=&quot;right|bottom&quot;</div><div class="line">	        android:id=&quot;@+id/btn_multiply&quot;</div><div class="line">	        /&gt;</div><div class="line">	    &lt;/LinearLayout&gt;</div><div class="line">	    </div><div class="line">	&lt;LinearLayout</div><div class="line">	    android:layout_width=&quot;fill_parent&quot;</div><div class="line">	    android:layout_height=&quot;wrap_content&quot;</div><div class="line">	    android:layout_marginTop=&quot;10dp&quot;</div><div class="line">	    android:orientation=&quot;horizontal&quot;</div><div class="line">	    android:gravity=&quot;center_horizontal&quot;</div><div class="line">	    &gt;</div><div class="line">	    &lt;Button</div><div class="line">	        android:layout_width=&quot;60dp&quot;</div><div class="line">	        android:layout_height=&quot;60dp&quot;</div><div class="line">	        android:text=&quot;7&quot;</div><div class="line">	         android:paddingRight=&quot;10dp&quot;</div><div class="line">	        android:paddingBottom=&quot;10dp&quot;</div><div class="line">	         android:background=&quot;@drawable/white_selector&quot;</div><div class="line">	        android:textSize=&quot;20sp&quot;</div><div class="line">	        android:gravity=&quot;right|bottom&quot;</div><div class="line">	        android:id=&quot;@+id/btn_7&quot;</div><div class="line">	        /&gt;</div><div class="line">	     &lt;Button</div><div class="line">	        android:layout_width=&quot;60dp&quot;</div><div class="line">	        android:layout_height=&quot;60dp&quot;</div><div class="line">	        android:text=&quot;8&quot;</div><div class="line">	         android:paddingRight=&quot;10dp&quot;</div><div class="line">	        android:paddingBottom=&quot;10dp&quot;</div><div class="line">	         android:background=&quot;@drawable/white_selector&quot;</div><div class="line">	        android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">	        android:textSize=&quot;20sp&quot;</div><div class="line">	        android:gravity=&quot;right|bottom&quot;</div><div class="line">	        android:id=&quot;@+id/btn_8&quot;</div><div class="line">	        /&gt;</div><div class="line">	     &lt;Button</div><div class="line">	        android:layout_width=&quot;60dp&quot;</div><div class="line">	        android:layout_height=&quot;60dp&quot;</div><div class="line">	        android:text=&quot;9&quot;</div><div class="line">	         android:paddingRight=&quot;10dp&quot;</div><div class="line">	        android:paddingBottom=&quot;10dp&quot;</div><div class="line">	         android:background=&quot;@drawable/white_selector&quot;</div><div class="line">	        android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">	        android:textSize=&quot;20sp&quot;</div><div class="line">	        android:gravity=&quot;right|bottom&quot;</div><div class="line">	        android:id=&quot;@+id/btn_9&quot;</div><div class="line">	        /&gt;</div><div class="line">	       &lt;Button</div><div class="line">	        android:layout_width=&quot;60dp&quot;</div><div class="line">	        android:layout_height=&quot;60dp&quot;</div><div class="line">	        android:text=&quot;-&quot;</div><div class="line">	         android:paddingRight=&quot;10dp&quot;</div><div class="line">	        android:paddingBottom=&quot;10dp&quot;</div><div class="line">	         android:background=&quot;@drawable/white_selector&quot;</div><div class="line">	        android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">	        android:textSize=&quot;20sp&quot;</div><div class="line">	        android:gravity=&quot;right|bottom&quot;</div><div class="line">	        android:id=&quot;@+id/btn_minus&quot;</div><div class="line">	        /&gt;</div><div class="line">	    &lt;/LinearLayout&gt;</div><div class="line">	    &lt;LinearLayout</div><div class="line">	    android:layout_width=&quot;fill_parent&quot;</div><div class="line">	    android:layout_height=&quot;wrap_content&quot;</div><div class="line">	    android:layout_marginTop=&quot;10dp&quot;</div><div class="line">	    android:orientation=&quot;horizontal&quot;</div><div class="line">	    android:gravity=&quot;center_horizontal&quot;</div><div class="line">	    &gt;</div><div class="line">	    &lt;Button</div><div class="line">	        android:layout_width=&quot;60dp&quot;</div><div class="line">	        android:layout_height=&quot;60dp&quot;</div><div class="line">	        android:text=&quot;4&quot;</div><div class="line">	         android:paddingRight=&quot;10dp&quot;</div><div class="line">	        android:paddingBottom=&quot;10dp&quot;</div><div class="line">	         android:background=&quot;@drawable/white_selector&quot;</div><div class="line">	        android:textSize=&quot;20sp&quot;</div><div class="line">	        android:gravity=&quot;right|bottom&quot;</div><div class="line">	        android:id=&quot;@+id/btn_4&quot;</div><div class="line">	        /&gt;</div><div class="line">	     &lt;Button</div><div class="line">	        android:layout_width=&quot;60dp&quot;</div><div class="line">	        android:layout_height=&quot;60dp&quot;</div><div class="line">	        android:text=&quot;5&quot;</div><div class="line">	         android:paddingRight=&quot;10dp&quot;</div><div class="line">	        android:paddingBottom=&quot;10dp&quot;</div><div class="line">	         android:background=&quot;@drawable/white_selector&quot;</div><div class="line">	        android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">	        android:textSize=&quot;20sp&quot;</div><div class="line">	        android:gravity=&quot;right|bottom&quot;</div><div class="line">	        android:id=&quot;@+id/btn_5&quot;</div><div class="line">	        /&gt;</div><div class="line">	     &lt;Button</div><div class="line">	        android:layout_width=&quot;60dp&quot;</div><div class="line">	        android:layout_height=&quot;60dp&quot;</div><div class="line">	        android:text=&quot;6&quot;</div><div class="line">	         android:paddingRight=&quot;10dp&quot;</div><div class="line">	        android:paddingBottom=&quot;10dp&quot;</div><div class="line">	         android:background=&quot;@drawable/white_selector&quot;</div><div class="line">	        android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">	        android:textSize=&quot;20sp&quot;</div><div class="line">	        android:gravity=&quot;right|bottom&quot;</div><div class="line">	        android:id=&quot;@+id/btn_6&quot;</div><div class="line">	        /&gt;</div><div class="line">	       &lt;Button</div><div class="line">	        android:layout_width=&quot;60dp&quot;</div><div class="line">	        android:layout_height=&quot;60dp&quot;</div><div class="line">	        android:text=&quot;+&quot;</div><div class="line">	         android:paddingRight=&quot;10dp&quot;</div><div class="line">	        android:paddingBottom=&quot;10dp&quot;</div><div class="line">	         android:background=&quot;@drawable/white_selector&quot;</div><div class="line">	        android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">	        android:textSize=&quot;20sp&quot;</div><div class="line">	        android:gravity=&quot;right|bottom&quot;</div><div class="line">	        android:id=&quot;@+id/btn_plus&quot;</div><div class="line">	        /&gt;</div><div class="line">	    &lt;/LinearLayout&gt;</div><div class="line">	    &lt;LinearLayout </div><div class="line">	       android:layout_width=&quot;fill_parent&quot;</div><div class="line">	       android:layout_height=&quot;wrap_content&quot;</div><div class="line">	       android:orientation=&quot;horizontal&quot;</div><div class="line">	       android:layout_marginTop=&quot;10dp&quot;</div><div class="line">	       android:gravity=&quot;center_horizontal&quot;</div><div class="line">	      </div><div class="line">	        &gt;</div><div class="line">	    &lt;LinearLayout </div><div class="line">	       android:layout_width=&quot;wrap_content&quot; </div><div class="line">	       android:layout_height=&quot;wrap_content&quot;</div><div class="line">	       android:orientation=&quot;vertical&quot;</div><div class="line">	        &gt;    </div><div class="line">	    &lt;LinearLayout</div><div class="line">	        android:layout_width=&quot;wrap_content&quot;</div><div class="line">	        android:layout_height=&quot;wrap_content&quot;</div><div class="line">	        android:orientation=&quot;horizontal&quot;</div><div class="line">	        </div><div class="line">	        &gt;   </div><div class="line">	        &lt;Button</div><div class="line">	        android:layout_width=&quot;60dp&quot;</div><div class="line">	        android:layout_height=&quot;60dp&quot;</div><div class="line">	        android:text=&quot;1&quot;</div><div class="line">	         android:paddingRight=&quot;10dp&quot;</div><div class="line">	        android:paddingBottom=&quot;10dp&quot;</div><div class="line">	         android:background=&quot;@drawable/white_selector&quot;</div><div class="line">	        android:textSize=&quot;20sp&quot;</div><div class="line">	        android:gravity=&quot;right|bottom&quot;</div><div class="line">	        android:id=&quot;@+id/btn_1&quot;</div><div class="line">	        /&gt; </div><div class="line">	        &lt;Button</div><div class="line">	        android:layout_width=&quot;60dp&quot;</div><div class="line">	        android:layout_height=&quot;60dp&quot;</div><div class="line">	        android:text=&quot;2&quot;</div><div class="line">	         android:paddingRight=&quot;10dp&quot;</div><div class="line">	        android:paddingBottom=&quot;10dp&quot;</div><div class="line">	         android:background=&quot;@drawable/white_selector&quot;</div><div class="line">	        android:textSize=&quot;20sp&quot;</div><div class="line">	        android:gravity=&quot;right|bottom&quot;</div><div class="line">	        android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">	        android:id=&quot;@+id/btn_2&quot;</div><div class="line">	        /&gt; </div><div class="line">	        &lt;Button</div><div class="line">	        android:layout_width=&quot;60dp&quot;</div><div class="line">	        android:layout_height=&quot;60dp&quot;</div><div class="line">	        android:text=&quot;3&quot;</div><div class="line">	         android:paddingRight=&quot;10dp&quot;</div><div class="line">	        android:paddingBottom=&quot;10dp&quot;</div><div class="line">	         android:background=&quot;@drawable/white_selector&quot;</div><div class="line">	        android:textSize=&quot;20sp&quot;</div><div class="line">	        android:gravity=&quot;right|bottom&quot;</div><div class="line">	        android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">	        android:id=&quot;@+id/btn_3&quot;</div><div class="line">	        /&gt; </div><div class="line">	    &lt;/LinearLayout&gt;</div><div class="line">	     &lt;LinearLayout</div><div class="line">	        android:layout_width=&quot;wrap_content&quot;</div><div class="line">	        android:layout_height=&quot;wrap_content&quot;</div><div class="line">	        android:layout_marginTop=&quot;10dp&quot;</div><div class="line">	        android:orientation=&quot;horizontal&quot;</div><div class="line">	        &gt;   </div><div class="line">	         &lt;Button</div><div class="line">	        android:layout_width=&quot;130dp&quot;</div><div class="line">	        android:layout_height=&quot;60dp&quot;</div><div class="line">	        android:text=&quot;0&quot;</div><div class="line">	         android:paddingRight=&quot;10dp&quot;</div><div class="line">	        android:paddingBottom=&quot;10dp&quot;</div><div class="line">	         android:background=&quot;@drawable/white_selector&quot;</div><div class="line">	        android:textSize=&quot;20sp&quot;</div><div class="line">	        android:gravity=&quot;right|bottom&quot;</div><div class="line">	        android:id=&quot;@+id/btn_0&quot;</div><div class="line">	        /&gt; </div><div class="line">	        &lt;Button</div><div class="line">	        android:layout_width=&quot;60dp&quot;</div><div class="line">	        android:layout_height=&quot;60dp&quot;</div><div class="line">	        android:text=&quot;.&quot;</div><div class="line">	         android:paddingRight=&quot;10dp&quot;</div><div class="line">	        android:paddingBottom=&quot;10dp&quot;</div><div class="line">	         android:background=&quot;@drawable/white_selector&quot;</div><div class="line">	        android:textSize=&quot;20sp&quot;</div><div class="line">	        android:gravity=&quot;right|bottom&quot;</div><div class="line">	        android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">	        android:id=&quot;@+id/btn_point&quot;</div><div class="line">	        /&gt; </div><div class="line">	     &lt;/LinearLayout&gt;</div><div class="line">	    &lt;/LinearLayout&gt;</div><div class="line">	    &lt;Button</div><div class="line">	        android:layout_width=&quot;60dp&quot;</div><div class="line">	        android:layout_height=&quot;130dp&quot;</div><div class="line">	        android:text=&quot;=&quot;</div><div class="line">	        android:paddingRight=&quot;10dp&quot;</div><div class="line">	        android:paddingBottom=&quot;10dp&quot;</div><div class="line">	         android:background=&quot;@drawable/orange_selector&quot;</div><div class="line">	        android:layout_marginLeft=&quot;10dp&quot;</div><div class="line">	        android:textSize=&quot;20sp&quot;</div><div class="line">	        android:gravity=&quot;right|bottom&quot;</div><div class="line">	        android:id=&quot;@+id/btn_equal&quot;</div><div class="line">	        /&gt; </div><div class="line">	    &lt;/LinearLayout&gt;</div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure>
<h2 id="colorxml"><a href="#color-xml" class="headerlink" title="color.xml"></a>color.xml</h2><p>res/values下新建一个xml.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;resources&gt;</div><div class="line">    &lt;color name=&quot;white&quot;&gt;#FFFFFF&lt;/color&gt;</div><div class="line">	&lt;color name=&quot;red&quot;&gt;#FF0000&lt;/color&gt;</div><div class="line">	&lt;color name=&quot;black&quot;&gt;#000000&lt;/color&gt;</div><div class="line">	&lt;color name=&quot;gray&quot;&gt;#808080&lt;/color&gt;</div><div class="line">	&lt;color name=&quot;orange&quot;&gt;#FFA500&lt;/color&gt;</div><div class="line">	&lt;color name=&quot;ashen&quot;&gt;#CD853F&lt;/color&gt;</div><div class="line">&lt;/resources&gt;</div></pre></td></tr></table></figure></p>
<h2 id="white_bgxml"><a href="#white-bg-xml" class="headerlink" title="white_bg.xml"></a>white_bg.xml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; &gt;</div><div class="line">  &lt;corners android:radius=&quot;5dp&quot;/&gt;</div><div class="line">  &lt;solid</div><div class="line">      android:color=&quot;@color/white&quot;</div><div class="line">  /&gt;</div><div class="line">  &lt;!--  </div><div class="line">  &lt;gradient </div><div class="line">      android:startColor=&quot;@color/white&quot; </div><div class="line">	  android:endColor=&quot;@color/red&quot;</div><div class="line">	  </div><div class="line">	 </div><div class="line">	  /&gt;</div><div class="line">  &lt;stroke</div><div class="line">  android:width=&quot;1dp&quot;</div><div class="line">  android:color=&quot;@color/black&quot;</div><div class="line">  /&gt;	</div><div class="line">  --&gt;</div><div class="line">&lt;/shape&gt;</div></pre></td></tr></table></figure>
<h2 id="white_selectorxml"><a href="#white-selector-xml" class="headerlink" title="white_selector.xml"></a>white_selector.xml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;selector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; &gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/gray_bg&quot; android:state_pressed=&quot;true&quot;/&gt;</div><div class="line">	&lt;item android:drawable=&quot;@drawable/white_bg&quot;/&gt;</div><div class="line">&lt;/selector&gt;</div></pre></td></tr></table></figure>
<h1 id="出现的问题及解决方法"><a href="#出现的问题及解决方法" class="headerlink" title="出现的问题及解决方法"></a>出现的问题及解决方法</h1><blockquote>
<p>1.新建工程时，出现报错：<br>\res\values\styles.xml:7: error: Error retrieving parent for item: No resource found that matches the given name ‘Theme.AppCompat.Light’.<br>\res\values-v11\styles.xml:7: error: Error retrieving parent for item: No resource found that matches the given name ‘Theme.AppCompat.Light’.<br>\res\values-v14\styles.xml:8: error: Error retrieving parent for item: No resource found that matches the given name ‘Theme.AppCompat.Light.DarkActionBar’.</p>
</blockquote>
<p>解决方法：<br>顺着改为：<br>style name=”AppBaseTheme” parent=”android:Theme.Light”<br>style name=”AppBaseTheme” parent=”android:Theme.Holo.Light”<br>style name=”AppBaseTheme”parent=”android:Theme.Holo.Light.DarkActionBar”<br>然后menu会报错，改为：<br>  android:showAsAction=”never”</p>
<blockquote>
<p>2.导入工程时报错The import android cannot be resolved</p>
</blockquote>
<p>解决：在新建Android项目的时候，eclipes新更新的ADT，在创建的Android版本最低版本低于4.0的时候，会新建一个v7的项目，把里面的包导入就可以。如果不想有警告的话，直接在创建项目的时候把最低版本设置为4.0以上就可以。并且不会出现第一个问题。</p>
<blockquote>
<p>3.定义按钮时错误提示：Button cannot be resolved to a type</p>
</blockquote>
<p>解决：没导包，快捷键ctrl+shift+o搞定。</p>
<h1 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h1><h2 id="去掉标题栏"><a href="#去掉标题栏" class="headerlink" title="去掉标题栏"></a>去掉标题栏</h2><p>在res/values/string.xml中和AndroidManifest.xml去掉相应代码即可。</p>
<h2 id="颜色需新建xml"><a href="#颜色需新建xml" class="headerlink" title="颜色需新建xml"></a>颜色需新建xml</h2><p>存放在res/values/colors中，RGB颜色表示。</p>
<h2 id="drawble下文件结构"><a href="#drawble下文件结构" class="headerlink" title="drawble下文件结构"></a>drawble下文件结构</h2><p><img src="http://img.blog.csdn.net/20170321233151779?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="颜色和选择器"></p>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>Main_Activity.java中，首先命名控件，给一个id，其次，按钮要设置点击事件，监听到该控件动作。<br>activity_main.xml中，线性结构可以嵌套使用。</p>
<p>思考：线性结构代码显臃肿，换成TableLayout也许更佳。并且计算器需要进一步优化，目前存在小的问题，例如，加减乘除符号可以在没有数字输入时顺序打印在屏幕上。总之，基本实现了计算器的功能。</p>
<h1 id="app下载"><a href="#APP下载" class="headerlink" title="APP下载"></a>APP下载</h1><p><a href="https://github.com/hubojing/Calculator" target="_blank" rel="external">https://github.com/hubojing/Calculator</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20170321231830210?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast&quot; width=&quot;300&quot; height=&quot;180&quot;  style=&quot;float:right;&quot;/&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;安卓端简易计算器APP实现。&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;
    
    </summary>
    
      <category term="互联网" scheme="http://hubojing.github.io/categories/%E4%BA%92%E8%81%94%E7%BD%91/"/>
    
    
      <category term="Java" scheme="http://hubojing.github.io/tags/Java/"/>
    
      <category term="android" scheme="http://hubojing.github.io/tags/android/"/>
    
  </entry>
  
  <entry>
    <title>模拟借书系统（Java异常机制实现）</title>
    <link href="http://hubojing.github.io/2017/03/19/%E6%A8%A1%E6%8B%9F%E5%80%9F%E4%B9%A6%E7%B3%BB%E7%BB%9F%EF%BC%88java%E5%BC%82%E5%B8%B8%E6%9C%BA%E5%88%B6%E5%AE%9E%E7%8E%B0%EF%BC%89/"/>
    <id>http://hubojing.github.io/2017/03/19/模拟借书系统（java异常机制实现）/</id>
    <published>2017-03-19T09:09:12.000Z</published>
    <updated>2017-03-30T15:56:21.142Z</updated>
    
    <content type="html"><![CDATA[<div align="left"><br><img src="http://img.blog.csdn.net/20170319164926044?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" width="300" height="180" style="float:right;"><br><br><br>java语言实现一个控制台版的模拟借书系统。<br><br><br></div>

<a id="more"></a>
<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>用java语言实现一个控制台版的模拟借书系统，旨在练习java异常机制。</p>
<h1 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h1><p><img src="http://img.blog.csdn.net/20170319164837988?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="要求"></p>
<h1 id="成品"><a href="#成品" class="headerlink" title="成品"></a>成品</h1><p><img src="http://img.blog.csdn.net/20170319164926044?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="最终效果"></p>
<h1 id="参考代码及注释"><a href="#参考代码及注释" class="headerlink" title="参考代码及注释"></a>参考代码及注释</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.jinger;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.Scanner;<span class="comment">//导入Scanner包</span></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookManagerEasy</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Scanner console = <span class="keyword">new</span> Scanner(System.in);<span class="comment">//接收系统输入</span></div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		<span class="comment">//定义”图书“数组</span></div><div class="line">		String[] books = &#123; <span class="string">"C语言"</span>, <span class="string">"数据结构"</span>, <span class="string">"汇编语言"</span>, <span class="string">"高数"</span>, <span class="string">"大学语文"</span>, <span class="string">"毛概"</span> &#125;;</div><div class="line">		<span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">			System.out.println(<span class="string">"输入命令：1-按照名称查找图书；2-按照序号查找图书"</span>);</div><div class="line">			String book;</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				<span class="comment">//取得整型命令</span></div><div class="line">				<span class="keyword">int</span> command = inputCommand();</div><div class="line">				<span class="comment">//根据不同命令值，进行不同操作</span></div><div class="line">				<span class="keyword">switch</span> (command) &#123;</div><div class="line">				<span class="keyword">case</span> <span class="number">1</span>:<span class="comment">//按照图书名称选择图书</span></div><div class="line">					book = getBookByName(books);</div><div class="line">					System.out.println(<span class="string">"book:"</span> + book);</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				<span class="keyword">case</span> <span class="number">2</span>:<span class="comment">//按照图书序号（数组下标）选择图书</span></div><div class="line">					book = getBookByNumber(books);</div><div class="line">					System.out.println(<span class="string">"book:"</span> + book);</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				<span class="keyword">case</span> -<span class="number">1</span>:<span class="comment">//返回值为-1，说明输入有误</span></div><div class="line">					System.out.println(<span class="string">"命令输入错误！请根据提示输入数字命令！"</span>);</div><div class="line">					<span class="keyword">continue</span>;</div><div class="line">				<span class="keyword">default</span>:<span class="comment">//其他值的命令均认为是错误命令</span></div><div class="line">					System.out.println(<span class="string">"命令输入错误！"</span>);</div><div class="line">					<span class="keyword">continue</span>;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">break</span>;<span class="comment">//退出程序</span></div><div class="line">			&#125; <span class="keyword">catch</span> (Exception bne) &#123;</div><div class="line">				<span class="comment">//捕获“图书不存在异常”时，要求重新输入命令</span></div><div class="line">				System.out.println(bne.getMessage());</div><div class="line">				<span class="keyword">continue</span>;</div><div class="line">			&#125; </div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//按照图书名称查询图书</span></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getBookByName</span><span class="params">(String[] books)</span></span></div><div class="line">			<span class="keyword">throws</span> Exception &#123;</div><div class="line">		System.out.println(<span class="string">"输入图书名称："</span>);</div><div class="line">		<span class="comment">//获取输入的图书名称</span></div><div class="line">		String name = console.next();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; books.length; i++) &#123;</div><div class="line">			<span class="keyword">if</span> (name.equals(books[i]))</div><div class="line">				<span class="comment">//输入的名称与某一图书名称匹配，返回该图书</span></div><div class="line">				<span class="keyword">return</span> books[i];</div><div class="line">		&#125;</div><div class="line">		<span class="comment">//若无匹配，抛出”图书不存在异常“</span></div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"图书不存在！"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//根据图书序号（数组下标）查询图书</span></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getBookByNumber</span><span class="params">(String[] books)</span></span></div><div class="line">			<span class="keyword">throws</span> Exception &#123;</div><div class="line">		<span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">			System.out.println(<span class="string">"输入图书序号："</span>);</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				<span class="comment">//获取输入的图书序号（数组下标）</span></div><div class="line">				<span class="keyword">int</span> index = inputCommand();</div><div class="line">				<span class="comment">//若返回值为-1</span></div><div class="line">				<span class="keyword">if</span>(index == -<span class="number">1</span>)&#123;</div><div class="line">					System.out.println(<span class="string">"命令输入错误！请根据提示输入数字命令！"</span>);</div><div class="line">					<span class="keyword">continue</span>;</div><div class="line">				&#125;</div><div class="line">				<span class="comment">//若不出现“数组下标越界异常”，则返回相应位置的图书</span></div><div class="line">				String book = books[index];</div><div class="line">				<span class="keyword">return</span> book;</div><div class="line">			&#125; <span class="keyword">catch</span> (ArrayIndexOutOfBoundsException e) &#123;</div><div class="line">				<span class="comment">//输入的序号不存在（引发“数组下标越界异常”），则抛出“图书不存在异常”</span></div><div class="line">				Exception bookNotExists = <span class="keyword">new</span> Exception(<span class="string">"图书不存在！"</span>);</div><div class="line">				bookNotExists.initCause(e);</div><div class="line">				<span class="keyword">throw</span> bookNotExists;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//从控制台输入命令，用于输入命令和输入图书序号</span></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">inputCommand</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">int</span> command;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			command = console.nextInt();</div><div class="line">			<span class="keyword">return</span> command;</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			<span class="comment">//若输入字符型或者字符串，则抛出异常，捕获该异常，抛出“错误命令异常”</span></div><div class="line">			console = <span class="keyword">new</span> Scanner(System.in);</div><div class="line">			<span class="comment">//返回-1</span></div><div class="line">			<span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><span id="busuanzi_container_page_pv"><br>本文已被阅读 <span id="busuanzi_value_page_pv"></span> 次。感谢您的点击！</span></p>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20170319164926044?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast&quot; width=&quot;300&quot; height=&quot;180&quot;  style=&quot;float:right;&quot;/&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;java语言实现一个控制台版的模拟借书系统。&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;
    
    </summary>
    
      <category term="互联网" scheme="http://hubojing.github.io/categories/%E4%BA%92%E8%81%94%E7%BD%91/"/>
    
    
      <category term="Java" scheme="http://hubojing.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>达达租车系统（Java实现）</title>
    <link href="http://hubojing.github.io/2017/03/18/%E8%BE%BE%E8%BE%BE%E7%A7%9F%E8%BD%A6%E7%B3%BB%E7%BB%9F%EF%BC%88Java%E5%AE%9E%E7%8E%B0%EF%BC%89/"/>
    <id>http://hubojing.github.io/2017/03/18/达达租车系统（Java实现）/</id>
    <published>2017-03-18T10:52:48.000Z</published>
    <updated>2017-03-30T15:55:02.244Z</updated>
    
    <content type="html"><![CDATA[<div align="left"><br><img src="http://img.blog.csdn.net/20170318155606137?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" width="300" height="180" style="float:right;"><br><br>java编写一个控制台版的“达达租车系统”。<br><br></div>

<a id="more"></a>
<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>java编写一个控制台版的“达达租车系统”</p>
<h1 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h1><p>1.展示所有可租车辆<br>2.选择车型、租车量<br>3.展示租车清单，包含：总金额、总载货量及其车型、总载人量及其车型</p>
<h1 id="三大分析"><a href="#三大分析" class="headerlink" title="三大分析"></a>三大分析</h1><h2 id="数据模型分析"><a href="#数据模型分析" class="headerlink" title="数据模型分析"></a>数据模型分析</h2><p><img src="http://img.blog.csdn.net/20170318155606137?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="数据模型分析"></p>
<h2 id="业务模型分析"><a href="#业务模型分析" class="headerlink" title="业务模型分析"></a>业务模型分析</h2><p><img src="http://img.blog.csdn.net/20170318155829714?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="业务模型分析"></p>
<h2 id="显示和流程分析"><a href="#显示和流程分析" class="headerlink" title="显示和流程分析"></a>显示和流程分析</h2><p><img src="http://img.blog.csdn.net/20170318160035300?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="显示和流程分析"></p>
<h2 id="成品"><a href="#成品" class="headerlink" title="成品"></a>成品</h2><p><img src="http://img.blog.csdn.net/20170318180123743?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="租车页面"></p>
<p><img src="http://img.blog.csdn.net/20170318180319432?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="租车账单"></p>
<h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><p>　　首先定义一个Car类，它包含基本功能：车名、载客数、载货量、日租金。接着创建三个小类，分别是客车类、货车类和皮卡类（既能载客又能载货），它们都继承Car类。最后需要一个主类，用于开启整个系统，调用每个小类。</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.jinger;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">int</span> rent;<span class="comment">//日租金</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">int</span> people;<span class="comment">//载客人数</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">int</span> loads;<span class="comment">//载货量</span></div><div class="line">	<span class="keyword">public</span> String name;<span class="comment">//车名</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getRent</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> rent;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRent</span><span class="params">(<span class="keyword">int</span> rent)</span></span>&#123;</div><div class="line">	<span class="keyword">this</span>.rent=rent;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPeople</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> people;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPeople</span><span class="params">(<span class="keyword">int</span> people)</span></span>&#123;</div><div class="line">	<span class="keyword">this</span>.people=people;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getLoads</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> loads;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLoads</span><span class="params">(<span class="keyword">int</span> loads)</span></span>&#123;</div><div class="line">	<span class="keyword">this</span>.loads=loads;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> name;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span></span>&#123;</div><div class="line">	<span class="keyword">this</span>.name=name;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>客车类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.jinger;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PassageCar</span> <span class="keyword">extends</span> <span class="title">Car</span></span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PassageCar</span><span class="params">(String name,<span class="keyword">int</span> people,<span class="keyword">int</span> rent)</span></span>&#123;</div><div class="line">		<span class="keyword">this</span>.setName(name);</div><div class="line">		<span class="keyword">this</span>.setPeople(people);</div><div class="line">		<span class="keyword">this</span>.setRent(rent);</div><div class="line">		</div><div class="line">		</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.getName()+<span class="string">"\t"</span>+<span class="keyword">this</span>.getPeople()+<span class="string">"\t\t\t\t"</span>+<span class="keyword">this</span>.getRent();</div><div class="line">				&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>卡车类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.jinger;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Truck</span> <span class="keyword">extends</span> <span class="title">Car</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Truck</span><span class="params">(String name,<span class="keyword">int</span> loads,<span class="keyword">int</span> rent)</span></span>&#123;</div><div class="line">		<span class="keyword">this</span>.setName(name);</div><div class="line">		<span class="keyword">this</span>.setLoads(loads);</div><div class="line">		<span class="keyword">this</span>.setRent(rent);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.getName()+<span class="string">"\t\t\t"</span>+<span class="keyword">this</span>.getLoads()+<span class="string">"\t\t"</span>+<span class="keyword">this</span>.getRent();</div><div class="line">	&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>皮卡类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.jinger;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pickup</span> <span class="keyword">extends</span> <span class="title">Car</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Pickup</span><span class="params">(String name,<span class="keyword">int</span> people,<span class="keyword">int</span> loads,<span class="keyword">int</span> rent)</span></span>&#123;</div><div class="line">		<span class="keyword">this</span>.setName(name);</div><div class="line">		<span class="keyword">this</span>.setPeople(people);</div><div class="line">		<span class="keyword">this</span>.setLoads(loads);</div><div class="line">		<span class="keyword">this</span>.setRent(rent);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.getName()+<span class="string">"\t"</span>+<span class="keyword">this</span>.getPeople()+<span class="string">"\t\t"</span>+<span class="keyword">this</span>.getLoads()+<span class="string">"\t\t"</span>+<span class="keyword">this</span>.getRent();</div><div class="line">	&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>主类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.jinger;</div><div class="line"><span class="keyword">import</span> java.util.*;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Initial</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		<span class="comment">//对各类车实例化并保存到cars数组</span></div><div class="line">		Car[] cars=&#123;</div><div class="line">				<span class="keyword">new</span> PassageCar(<span class="string">"奥迪A4"</span>,<span class="number">4</span>,<span class="number">500</span>),</div><div class="line">				<span class="keyword">new</span> PassageCar(<span class="string">"马自达6"</span>,<span class="number">4</span>,<span class="number">400</span>),</div><div class="line">				<span class="keyword">new</span> Pickup(<span class="string">"皮卡雪6"</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">450</span>),</div><div class="line">				<span class="keyword">new</span> PassageCar(<span class="string">"金龙"</span>,<span class="number">20</span>,<span class="number">800</span>),</div><div class="line">				<span class="keyword">new</span> Truck(<span class="string">"松花江"</span>,<span class="number">4</span>,<span class="number">400</span>),</div><div class="line">				<span class="keyword">new</span> Truck(<span class="string">"依维柯"</span>,<span class="number">20</span>,<span class="number">1000</span>)&#125;;</div><div class="line"></div><div class="line">		System.out.println(<span class="string">"****欢迎使用达达租车系统！****"</span>);</div><div class="line">		System.out.println(<span class="string">"****您确认租车吗？****"</span>+<span class="string">"\n"</span>+<span class="string">"是（请输入1） \t 否（请输入2）"</span>);</div><div class="line">	</div><div class="line">		Scanner in1=<span class="keyword">new</span> Scanner(System.in);</div><div class="line">		<span class="keyword">int</span> is=in1.nextInt();</div><div class="line">		<span class="keyword">if</span>(is!=<span class="number">1</span>)&#123;</div><div class="line">			System.out.println(<span class="string">"****欢迎下次光临！****"</span>);</div><div class="line">			System.exit(<span class="number">0</span>);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span>(is==<span class="number">1</span>)&#123;</div><div class="line">			System.out.println(<span class="string">"****您可租车的类型及价目表****"</span>);</div><div class="line">			System.out.println(<span class="string">"序号"</span>+<span class="string">"\t车名"</span>+<span class="string">"\t载客数（人）"</span>+<span class="string">"\t载货量（吨）"</span>+<span class="string">"\t日租金（元/天）"</span>);</div><div class="line">		</div><div class="line">			<span class="comment">//使用循环方式将各类车输出</span></div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;cars.length;i++)&#123;</div><div class="line">				System.out.println((i+<span class="number">1</span>)+<span class="string">"\t"</span>+cars[i]);</div><div class="line">			&#125;</div><div class="line">			</div><div class="line">			</div><div class="line">			</div><div class="line">			System.out.println(<span class="string">"****请输入您的租车数量：****"</span>);</div><div class="line">			<span class="keyword">int</span> num1=in1.nextInt();</div><div class="line">			Car[] rentcar=<span class="keyword">new</span> Car[num1];</div><div class="line">			<span class="keyword">int</span> price=<span class="number">0</span>;<span class="comment">//总价格</span></div><div class="line">			<span class="keyword">int</span> totalpeople=<span class="number">0</span>;<span class="comment">//总人数</span></div><div class="line">			<span class="keyword">int</span> totalloads=<span class="number">0</span>;<span class="comment">//总载货量</span></div><div class="line">			</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;num1;i++)&#123;</div><div class="line">				System.out.println(<span class="string">"****请输入第"</span>+(i+<span class="number">1</span>)+<span class="string">"辆车的序号：****"</span>);</div><div class="line">				<span class="keyword">int</span> numx=in1.nextInt();</div><div class="line">				rentcar[i]=cars[numx-<span class="number">1</span>];</div><div class="line">				</div><div class="line">			&#125;</div><div class="line">			System.out.println(<span class="string">"****请输入天数：****"</span>);</div><div class="line">			<span class="keyword">int</span> day=in1.nextInt();</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;num1;i++)&#123;</div><div class="line">			price=price+rentcar[i].rent *day;</div><div class="line">			&#125;</div><div class="line">			System.out.println(<span class="string">"****您的账单：****"</span>);</div><div class="line">			System.out.println(<span class="string">"已选载人车："</span>);</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;num1;i++)&#123;</div><div class="line">				<span class="keyword">if</span>(rentcar[i].people!=<span class="number">0</span>)&#123;</div><div class="line">					System.out.println(rentcar[i].name+<span class="string">"\t"</span>);</div><div class="line">				&#125;</div><div class="line">				</div><div class="line">				totalpeople=totalpeople+rentcar[i].people;</div><div class="line">			&#125;</div><div class="line">			</div><div class="line">			System.out.println(<span class="string">'\n'</span>);</div><div class="line">			System.out.println(<span class="string">"已选载货车："</span>);</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;num1;i++)&#123;</div><div class="line">				<span class="keyword">if</span>(rentcar[i].loads!=<span class="number">0</span>)&#123;</div><div class="line">					System.out.println(rentcar[i].name+<span class="string">"\t"</span>);</div><div class="line">				&#125;</div><div class="line">						</div><div class="line">				totalloads=totalloads+rentcar[i].loads;</div><div class="line">			&#125;</div><div class="line">		</div><div class="line">			</div><div class="line">					System.out.println(<span class="string">'\n'</span>);</div><div class="line">					System.out.println(<span class="string">"共载客："</span>+totalpeople+<span class="string">"人"</span>);</div><div class="line">					System.out.println(<span class="string">"共载货："</span>+totalloads+<span class="string">"吨"</span>);</div><div class="line">					System.out.println(<span class="string">"租车总价格："</span>+price+<span class="string">"元"</span>);</div><div class="line">					System.out.println(<span class="string">'\n'</span>);</div><div class="line">					System.out.println(<span class="string">"****感谢您的惠顾，欢迎再次光临！****"</span>);</div><div class="line">				</div><div class="line">			&#125;</div><div class="line">			&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<h1 id="收获"><a href="#收获" class="headerlink" title="收获"></a>收获</h1><p>思路决定编码。<br>编程要注重<code>自顶而下、逐步求精</code>的设计方法。</p>
<h1 id="源程序下载"><a href="#源程序下载" class="headerlink" title="源程序下载"></a>源程序下载</h1><p><a href="https://github.com/hubojing/Car-rental-system" target="_blank" rel="external">https://github.com/hubojing/Car-rental-system</a></p>
<p><span id="busuanzi_container_page_pv"><br>本文已被阅读 <span id="busuanzi_value_page_pv"></span> 次。感谢您的点击！</span></p>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://img.blog.csdn.net/20170318155606137?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast&quot; width=&quot;300&quot; height=&quot;180&quot;  style=&quot;float:right;&quot;/&gt;&lt;br&gt;&lt;br&gt;java编写一个控制台版的“达达租车系统”。&lt;br&gt;&lt;br&gt;&lt;/div&gt;
    
    </summary>
    
      <category term="互联网" scheme="http://hubojing.github.io/categories/%E4%BA%92%E8%81%94%E7%BD%91/"/>
    
    
      <category term="Java" scheme="http://hubojing.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>别做井底之蛙</title>
    <link href="http://hubojing.github.io/2017/03/06/%E5%8F%8D%E7%9C%81/"/>
    <id>http://hubojing.github.io/2017/03/06/反省/</id>
    <published>2017-03-05T16:11:48.000Z</published>
    <updated>2017-03-30T15:55:52.000Z</updated>
    
    <content type="html"><![CDATA[<div align="left"><br><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1488743337927&di=4273153cdba587ffa9e9dba1db8737fc&imgtype=0&src=http%3A%2F%2Fupload.admin5.com%2F2015%2F1121%2F1448071304470.jpg" width="300" height="180" style="float:right;"><br><br><br>即将毕业了，谈谈最近我关于技术的思考。<br><br><br></div>

<a id="more"></a>
<p>最近总想给自己的四年打个分。<br>给个70分吧。<br>四年来，我一直认为，自己没有辜负这四年。这四年里，自己很多方面得到了成长。但直到最近，我发现了些什么。</p>
<p>这四年来，我一直是大家眼中的优秀学生，绩点高，学生工作也做得好。我时刻提醒自己，千万不要被眼前的赞誉迷了眼。我之所以显得优秀，是因为我所处的环境还不够好。<br>这是我的技术博客，关于其他方面就不提了。尤谈技术。</p>
<p>大一大二沉浸在繁忙的学生工作中，忽略了自己是个十足的工科生，只注重课堂学习，忽视了动手实践。大二在实验室的半年，收获有，却不是很大。一方面是学校实验室的建设不完善，最重要的是实验室方向不是我所感兴趣的，再加上我当时过于急于求成，收效甚微就心烦意乱。<br>大三卸任部分学生工作，时间多了出来。突然就意识到了自己的专业被自己落下了。于是就诞生了这个技术博客，记录我所学的知识。算是对自己学技术的一点弥补。后来表示不服，自己报名了计算机比赛，最后竟意外抱得国奖回，让自己开心了一阵。我就算没在实验室了，我还是能自己干出事情来！我是有些倔。<br>再后来考研。过程不说了，和所有考研人一样平常。<br>考完后让自己彻底放松了二个月，所有和学习的事情都放下了，包括这里。这也是为什么这段时间我的github绿的很少，以及博客长久未更的原因。</p>
<p>简历看似让人羡慕，可我近来愈发觉得，自己就是一只井底之蛙。<br>没有实验室的帮助，没有老师的指导，没有志同道合的伙伴，全靠自己一个人，自己的学习时常走入歧途。不过这都不重要，重要的是我只要愿意不断学习，总会越懂越多。<br>最近我看了大神和牛人甚至是认识的同学们的学习过程，自己的努力与之相比不值一提。之前即使我总是警告自己不要感动自己，可最终还是让自己浮在了表面。</p>
<p>我是通信工程专业的学生，却常“不务正业”地倒弄计算机专业的东西（不过这是我的兴趣所在，我也从不觉得是错误，通信和计算机本是一家），有时候我在想，我的本家知识还没学通学透呢？</p>
<p>寒假放松的两个月，有个网友隔几天就问我有没有敲代码。我都说没有。他当时批评我说，女生果然不适合干技术。我回复他，你可以指责我，但我不能代表整个女性群体。后来想想，他的批评是有理的，像我那样三天打鱼、两天晒网的学习，怎么会有效果？</p>
<p>最近我常常在想，我口口声声说爱技术，还有一个做学术做科研的愿望，到底是不是发自心底的？我在还没深入了解它的时候，有什么资格说爱它？</p>
<p>感觉自己被越甩越远，但自己不想在做井底之蛙了。虽然醒悟地有些晚，但好歹是想过来了。</p>
<p>即将毕业的我，让自己重新做回一个普通的学生，耐心的学习，安心做毕设，回归一个工科学生对技术所抱有的憧憬之心。</p>
<p>先给自己定一个小目标：让github重新绿起来。欢迎各位监督。</p>
<p>写于2017年3月6日凌晨1点</p>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1488743337927&amp;di=4273153cdba587ffa9e9dba1db8737fc&amp;imgtype=0&amp;src=http%3A%2F%2Fupload.admin5.com%2F2015%2F1121%2F1448071304470.jpg&quot; width=&quot;300&quot; height=&quot;180&quot;  style=&quot;float:right;&quot;/&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;即将毕业了，谈谈最近我关于技术的思考。&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;
    
    </summary>
    
      <category term="杂谈" scheme="http://hubojing.github.io/categories/%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="杂谈" scheme="http://hubojing.github.io/tags/%E6%9D%82%E8%B0%88/"/>
    
  </entry>
  
  <entry>
    <title>虚拟实验平台比赛项目记录</title>
    <link href="http://hubojing.github.io/2017/02/10/%E8%99%9A%E6%8B%9F%E5%AE%9E%E9%AA%8C%E5%B9%B3%E5%8F%B0/"/>
    <id>http://hubojing.github.io/2017/02/10/虚拟实验平台/</id>
    <published>2017-02-10T10:27:55.000Z</published>
    <updated>2017-02-25T13:29:34.955Z</updated>
    
    <content type="html"><![CDATA[<div align="left"><br><img src="http://7xray0.com1.z0.glb.clouddn.com/hb.jpg" width="300" height="180" style="float:right;"><br><br><br>　　说话算数，许诺的上海决赛详细情况记录。<br><br><br> </div>


<a id="more"></a>
<h1 id="项目名称"><a href="#项目名称" class="headerlink" title="项目名称"></a>项目名称</h1><p>数字图像处理教学辅助虚拟实验平台</p>
<h1 id="项目平台"><a href="#项目平台" class="headerlink" title="项目平台"></a>项目平台</h1><p>matlab GUI</p>
<h1 id="项目简述"><a href="#项目简述" class="headerlink" title="项目简述"></a>项目简述</h1><p>利用matlabGUI可视化，设计一个方便数字图像处理教学的虚拟实验平台，加深学生兴趣，让学生直观了解。</p>
<h1 id="项目框架"><a href="#项目框架" class="headerlink" title="项目框架"></a>项目框架</h1><p>虚拟实验平台分为实验主窗口和手写数字识别案例。</p>
<h1 id="原理相关"><a href="#原理相关" class="headerlink" title="原理相关"></a>原理相关</h1><p>数字图像处理是通过计算机对图像进行去除噪声、增强、复原、分割、提取特征等处理的方法和技术，它是指将图像信号转换成数字信号并利用计算机对其进行处理的过程。可以用来提高图像的视感质量，提取图像中所包含的某些特征或特殊信息，对图像数据进行变换、编码和压缩，以便于图像的存储和传输。<br><strong>最近邻插值法</strong><br>最近邻插值法nearest_neighbor是最简单的灰度值插值。也称作零阶插值，就是令变换后像素的灰度值等于距它最近的输入像素的灰度值。<br><strong>双三次插值法</strong><br>双三次插值是一种更加复杂的插值方式，它能创造出比双线性插值更平滑的图像边缘。又叫双立方插值，用于在图像中“插值”（Interpolating）或增加“像素”（Pixel）数量/密度的一种方法。通常利用插值技术增加图形数据，以便在它打印或其他形式输出的时候，能够增大打印面积以及（或者）分辨率。<br>属性：通过双三次插值可以得到一个连续的插值函数，它的一阶偏导数连续，并且交叉导数处处连续。<br>公式：<br>计算系数 的过程依赖于插值数据的特性。如果已知插值函数的导数，常用的方法就是使用四个顶点的高度以及每个顶点的三个导数。一阶导数 与 表示 x 与 y 方向的表面斜率，二阶相互导数 表示同时在 x 与 y 方向的斜率。这些值可以通过分别连续对 x 与 y 向量取微分得到。对于网格单元的每个顶点，将局部坐标（0,0, 1,0, 0,1 和 1,1) 带入这些方程，再解这 16 个方程。</p>
<p><strong>图像增强</strong><br>1.直方图作用<br>直方图的观看规则就是“左黑右白”，左边代表暗部，右边代表亮部，而中间则代表中间调。<br>纵向上的高度代表像素密集程度，越高，代表的就是分布在这个亮度上的像素很多。</p>
<p>2.分为空间域和频域<br>空域分为点运算和领域去噪<br>直方图修正属于点运算，平滑和锐化属于领域去噪。<br>平滑是在添加噪声之后进行的处理<br>滤波的本义是指信号有各种频率的成分,滤掉不想要的成分,即为滤掉常说的噪声,留下想要的成分.这即是滤波的过程,也是目的。<br>图像锐化是补偿图像的轮廓，增强图像的边缘及灰度跳变的部分，使图像变得清晰，分为空域处理和频域处理两类。<br>图像平滑往往使图像中的边界、轮廓变得模糊，为了减少这类不利效果的影响，这就需要利用图像锐化技术，使图像的边缘变的清晰<br>直方图修正法<br>分为直方图均衡化和直方图规定化（直方图匹配）<br> 目的：采用直方图修整后可使图像的灰度间距拉开或使灰度分布均匀，从而增大反差，使图像细节清晰，从而增强图像。<br>直方图均衡化：通过对原图像进行某种变换使原图像的灰度直方图修正为均匀的直方图的一种方法。<br>直方图规定化：使原图像灰度直方图变成规定形状的直方图而对图像作修正的增强方法。</p>
<p><strong>频域增强</strong><br>频谱图<br>图像从圆心到外是由低频到高频的一个过程  同心圆表示在不同方向上的同一频率 而频谱有明暗表示分解成的多个正弦波由于相位的不同叠加后就形成了有大小的分别 而相位不同的正弦波又是由在不同位置的原图像的圆（也是不同位置的频率变化组成的）<br><strong>图像分割</strong><br>方法：阈值分割、区域分割、边缘分割、基于特定理论的分割<br>图像分割方法依照分割时所依据的图像特性不同，大致可以分为四大类。第一类是阈值方法，这种方法是根据图像灰度值得分布特性确定某个阈值来进行图像分割的。第二类为边缘检测方法，这类方法是通过检测出封闭某个区域的边界来进行图像分割的。通俗地讲，这类方法实际上是沿着闭合的边缘线将其包围的区域剪切出来。第三类方法是区域提取方法，这类方法的特点是根据特定区域与其他背景区域特性上的不同来进行图像分割的。另外，还有一种基于形态学的分水岭算法。<br>阈值分割：基本原理是：通过设定不同的特征阈值，把图像象素点分为若干类。<br>常用的特征包括：直接来自原始图像的灰度或彩色特征；由原始灰度或彩色值变换得到的特征。<br>设原始图像为f(x，y)，按照一定的准则f(x，y)中找到特征值T，将图像分割为两个部分，分割后的图像为：若取：b0=0(黑)，b1=1(白)，即为我们通常所说的图像二值化。<br>直方图阈值双峰法：双峰法是一种简单的阈值分割方法，即如果灰度级直方图呈现明显的双峰状，则选双峰之间的谷底所对应的灰度级作为阈值分割。<br>均匀性度量法：<br>均匀性度量法的设计思想是，假设当图像被分为目标物和背景两个类别时，属于同一类别内的像素值分布应该具有均匀性。在这里采用方差来度量像素间的均匀性。设原图像为f(x,y)，结果图像为g(x,y)。<br>类间最大方差法（Otsu法）：<br>Otsu是一种使类间方差最大的自动确定阈值的方法，该方法具有简单、处理速度快的特点，是一种常用的阈值选取方法。MATLAB中的graythresh函数求取阈值采用的就是Otsu法。<br>局部阈值法：局部阈值图像分割的原理与全局阈值分割相似，只是在使用之前的程序前，将图像分割成若干子图像进行处理，在处理后，在将各自的结果拼接起来。<br>边缘检测：最简单的边缘检测方法是边缘检测算子，它利用相邻区域的像素值不连续的性质，采用一阶或二阶导数来检测边缘点。<br>边缘检测是图像处理和计算机视觉中的基本问题，边缘检测的目的是标识数字图像中亮度变化明显的点。图像属性中的显著变化通常反映了属性的重要事件和变化。 这些包括（i）深度上的不连续、（ii）表面方向不连续、（iii）物质属性变化和（iv）场景照明变化。 边缘检测是图像处理和计算机视觉中，尤其是特征提取中的一个研究领域。<br>图像分割的意义<br>图像分割是图像分析的第一步，图像分割接下来的任务，如特征提取、目标识别等的好坏，都取决于图像分割的质量如何。<br><strong>图像变换</strong><br>Fourier变换有两个好处，即：可以获得信号的频域特性；可以将卷积运算转换为乘积运算。<br>因此二维Fourier变换的应用也是根据这两个特点来进行的。<br>在图像滤波中的应用<br>首先，我们来看Fourier变换后的图像，中间部分为低频部分，越靠外边频率越高。因此，我们可以在Fourier变换图中，选择所需要的高频或是低频滤波。<br>离散余弦变换，尤其是它的第二种类型，经常被信号处理和图像处理使用，用于对信号和图像(包括静止图像和运动图像)进行有损数据压缩。这是由于离散余弦变换具有很强的”能量集中”特性:大多数的自然信号(包括声音和图像)的能量都集中在离散余弦变换后的低频部分，而且当信号具有接近马尔科夫过程(Markov processes)的统计特性时，离散余弦变换的去相关性接近于K-L变换(Karhunen-Loève 变换–它具有最优的去相关性)的性能。<br><strong>图像的形态学</strong><br>数字图像处理中的形态学处理是指将数字形态学作为工具从图像中提取对于表达和描绘区域形状有用处的图像分量，比如边界、骨架以及凸壳，还包括用于预处理或后处理的形态学过滤、细化和修剪等。图像形态学处理中我们感兴趣的主要是二值图像。<br>在二值图像中，所有黑色像素的集合是图像完整的形态学描述，二值图像的各个分量是Z2的元素。假定二值图像A和形态学处理的结构元素B是定义在笛卡儿网格上的集合，网格中值为1的点是集合的元素，当结构元素的原点移到点(x,y)时，记为Sxy，为简单起见，结构元素为3x3，且全都为1，在这种限制下，决定输出结果的是逻辑运算。<br>膨胀和腐蚀这两种操作是形态学处理的基础，许多形态学算法都是以这两种运算为基础的。<br>开操作是先腐蚀、后膨胀处理。闭操作是先膨胀、后腐蚀处理。<br>腐蚀和膨胀，看上去好像是一对互逆的操作，实际上，这两种操作不具有互逆的关系。<br>开运算和闭运算正是依据腐蚀和膨胀的不可逆性，演变而来的。<br>先腐蚀后膨胀的过程就称为开运算。<br>闭运算是通过对腐蚀和膨胀的另一种不同次序的执行而得到的，<br>闭运算是先膨胀后腐蚀的过程，其功能是用来填充物体内细小空洞、连接邻近物体、平滑其边界，同时不明显改变不明显改变其面积。</p>
<p>#相关函数<br>有关函数的意义<br>inputdlg  输入对话框<br>创建一个输入对话框，prompt为提示字符串，title为对话框名称，num_line为显示的行数，defans为默认的数值</p>
<p>imresize  缩放<br>‘nearest’：改变图像尺寸时采用最近邻插值算法；<br>‘bilinear’：采用双线性插值算法；<br>‘bicubic’： 采用双三次插值算法</p>
<p>msgbox  创建对话框<br>imshow  显示图像<br>ndims  求一个数组维数</p>
<p>numel  计算数组中满足指定条件的元素个数<br>若是一幅图像，则numel(A)将给出它的像素数。</p>
<p>I(:,:,1)<br>:在矩阵引用里，表示所有元素。<br>比如一个二维矩阵A，A(:,1)就表示A的第一列元素。</p>
<p>flipl中提供了许多对矩阵操作的函数，可以实现矩阵的三角矩阵的提取（triu、tril）、矩阵的翻转（flipud、fliplr、Flipdim）和旋转（rot90）等各种操作。</p>
<p>size<br>size(X,1),返回矩阵X的行数；<br>size(X,2),返回矩阵X的列数；<br>N=size(X,2)，就是把矩阵X的列数赋值给N<br>size（）：获取矩阵的行数和列数<br>（1）s=size(A),<br>当只有一个输出参数时，返回一个行向量，该行向量的第一个元素时矩阵的行数，第二个元素是矩阵的列数。<br>（2）[r,c]=size(A),<br>当有两个输出参数时，size函数将矩阵的行数返回到第一个输出变量r，将矩阵的列数返回到第二个输出变量c。<br>（3）size(A,n)如果在size函数的输入参数中再添加一项n，并用1或2为n赋值，则 size将返回矩阵的行数或列数。其中r=size(A,1)该语句返回的时矩阵A的行数， c=size(A,2) 该语句返回的时矩阵A的列数。</p>
<p>imrotate  旋转<br>B = imrotate(A,angle,method,bbox)<br>将图像A（图像的数据矩阵）绕图像的中心点旋转angle度， 正数表示逆时针旋转， 负数表示顺时针旋转。返回旋转后的图像矩阵。<br>使用method参数可以改变插值算法，method参数可以为下面这三个值：<br>‘nearest’：最邻近线性插值（Nearest-neighbor interpolation）<br>‘bilinear’： 双线性插值（Bilinear interpolation）<br>‘bicubic’： 双三次插值（或叫做双立方插值）（Bicubic interpolation）<br>bbox参数用于指定输出图像属性：<br>‘crop’： 通过对旋转后的图像B进行裁剪， 保持旋转后输出图像B的尺寸和输入图像A的尺寸一样。<br>‘loose’： 使输出图像足够大， 以保证源图像旋转后超出图像尺寸范围的像素值没有丢失。 一般这种格式产生的图像的尺寸都要大于源图像的尺寸。</p>
<p>imadd       两个图像相加，或者一个图像加上一个常量<br>imsubstract 两个图像相减，或者一个图像减掉一个常量<br>immultiply     两个图像相乘，或者一个图像乘上一个常量<br>imdivide    两个图像相除，或者一个图像除以一个常量<br>imabsdiff    两个图像的差的绝对值<br>imcomplement 求一个图像的反色图<br>inlincomb    求一组图像的线性组合<br>imadjust  调节灰度图像的亮度或彩色图像的颜色矩阵</p>
<p>histeq  直方图均衡<br>bar(x,y) 其中x必须是严格递增的且一维向量x和一维向量y长度相同。以一维向量x的值为x坐标，对应的y为y坐标画直方图。</p>
<p>var函数实际上求的并不是方差，而是误差理论中“有限次测量数据的标准偏差的估计值”。</p>
<p>graythresh函数用法：使用最大类间方差法找到图片的一个合适的阈值（threshold）。在使用im2bw函数将灰度图像转换为二值图像时，需要设定一个阈值，这个函数可以帮助我们获得一个合适的阈值。利用这个阈值通常比人为设定的阈值能更好地把一张灰度图像转换为二值图像。</p>
<h1 id="手写归纳"><a href="#手写归纳" class="headerlink" title="手写归纳"></a>手写归纳</h1><p><strong>手写数字模块小结</strong><br>handwrite<br>1.exit函数，存在即返回非0值，不存在即返回0<br>2.load template pattern;    %将template文件中的pattern加载到工作环境中<br>3.pattern(1,1).num=0;         %pattern是一个数组，这里.num表示样本数量<br>4.pattern(1,1).feature=[];   %.feature表示特征值（样本）<br>5.save template pattern;  %将pattern保存在template.mat文件中<br>6.pos0=get(handles.WritingAxes,’currentpoint’);<br>%获取最近一次点击的位置，返回一个2x3的矩阵，矩阵的每行代表一个点的坐标<br>这两个点的具体含义，和坐标系的投影类型以及鼠标点击位置是否位于坐标系内有关。对于典型情况（正交投影，鼠标点击位于坐标系范围内），可以通过鼠标点击的位置，作一条垂直于屏幕的直线，则该线与坐标系的六个面必然会有两个交点（想象一下，2D坐标系的外框是一个矩形，3D坐标系外框是一个长方体），这两个交点的坐标就是上面所说的pos0，其第一行是靠近观察者的那个面上的点，而第二行是离观察者稍远的那个面上的点。<br>7.x0=pos0(1,1);  %靠近观察者那个面上点的第一个坐标（即x）<br>  y0=pos0(1,2);  %靠近观察者那个面上点的第一个坐标（即y）<br>8.line(x,y, ‘marker’, ‘.’,’markerSize’,18,   ‘LineStyle’,’-‘,’LineWidth’,2,’Color’,’black’);<br>%默认选择黑笔画线，设定点的模型大小，线的模型宽度颜色<br>9.X=x0:stepX:x;      %设定坐标参数，0.1单位<br>  Y=(y-y0)<em>(X-x0)/(x-x0)+y0;   %两点直线方程<br>11.Img=getframe(handles.WritingAxes);   %获取坐标轴内图像<br>%getframe获得的是一个架构struct类型的数据，其中cdata子域的内容才可以用imwrite内容保存，用Img.cdata表示，是截取区域的数据<br>12.imwrite(I,’当前手写数字.bmp’,’bmp’);  %将图像数据写入图像文件<br>13.data=GetFeature(I);   %对手写数字进行处理，获取特征向量<br>14.pattern(1,1).num=pattern(1,1).num+1;   %样本容量加一<br>15.pattern(1,1).feature(:,pattern(1,1).num)=data;<br>%新增样本（保存的是特征向量）放在最后<br>16.pattern(1,1).num=pattern(1,1).num-1;  %样本容量减一<br>17.pattern(1,1).feature(:,pattern(1,1).num)=[];  %删除倒数第二个<br>18.set(handles.RecognitionResult,’String’,Result); %显示识别结果<br>feature<br>1.[row,col]=find(I==0);                %返回数字的上下左右的边界<br>2.I=I(min(row):max(row),min(col):max(col));<br>%截取手写数字图像，使其紧包含数字边界，不包含多余的空白<br>3.[row,col]=size(I);           %求截取后图像的宽和高，数组的行和列<br>4.r=fix(row/5);                 %fix朝0方向取整<br>5.data=data’; %将当前手写数字的特征向量由行向量变为列向量<br>BayesTwoValue<br>1.sum = sum+pattern(1,i).num;    %样本总数求和<br>2.pw(i) = pattern(1,i).num/sum;  %每个数字的样本概率,先验概率<br>3.[maxval,maxpos] = max(pwx);  %取后验概率中最大的<br>%第一个参数是序列中的最大值 第二个参数是最大值在序列中位置<br>4.Result= maxpos-1;  %最大值即为最匹配的数字，其数值为它所处位置序号减一<br>BayesLeastError<br>1.[pc_template,pc_data]=pcapro(data);  %主成分分析<br>2.mean_data(i).data=mean(pattern(1,i).feature’)’; %求各个类型样品的平均值<br>%mean(x)表示对列向量x求平均值<br>3.h(i)=(pc_data-mean_data(i).data)’</em>s_inv(i).data<em>(pc_data-mean_data(i).data)…
        </em>(-0.5)+log(pw(i))+log(abs(s_det(i)))*(-0.5);  %判别函数<br>BayesLeastRisk<br>1.[minval minpos]=min(risk);  %取损失最小的</p>
<h1 id="答辩"><a href="#答辩" class="headerlink" title="答辩"></a>答辩</h1><p>我们准备的答辩稿（部分）：<br>思路：<br>    为更好的协助老师的教学，充实课堂内容，从而设计的辅助教学实验软件，并拓展手写数字识别系统，用来丰富课堂知识。<br>首先我们选择matlab软件来设计虚拟实验平台，因为大部分工科院校都或多或少 接触过matlab，上手容易。然后由于MatlabGUI强大的可视化界面，让我们决定实现它。一开始我们只设计了手写数字识别，但感觉过于单一，且只涉及到数字图像处理中数字识别模式识别这一块，不够全面，而且学生初学时是从最基本的操作学起，因此，我们根据学习顺序，补充了每一章节的基本实验，使我们的平台更加完善。</p>
<p>遇到的困难：<br>    主要就是程序的问题，这是一个很需要耐心细心的模块，经常会遇到各种奇怪的问题，比如某个功能失效，界面无响应这些，其次就是生成的可执行文件不能很好的适应所有电脑，拓展模块里的手写也可能因为样本的不足出现错误，所以样本的填充也很复杂很需要时间。</p>
<p>作品的优点和缺点：<br>   优点：操作相对简单，界面比较整洁，知识覆盖面广<br>   缺点：可执行文件适应性不够强，部分功能有延迟，没有更详细的解释相关操作的意义，可能还需要一个使用说明的嵌入模块，手写数字模块样本容量不够大。<br>运用技术：<br>    软件的设计基本上全部由matlab/GUI 完成，并使用其特定的命令生成可执行文件，编程时运用了各种简单或复杂的算法，如缩小放大的最近邻插值法，双三次插值法，图像增强里的直方图均衡化、阈值分割的直方图双峰法、均匀性度量法、otsu法、局部阈值法等等。这对于我们两个没有系统学习过这门课的人来说，还是很具有挑战性。<br>贝叶斯决策的原理。<br>   贝叶斯决策理论方法是统计模型决策中的一个基本方法，其基本思想是：<br>   已知类条件概率密度参数表达式和先验概率。<br>   利用贝叶斯公式转换成后验概率。<br>   根据后验概率大小进行决策分类。<br>这个手写识别案例的用处：<br>    是对这门课程的一个拓展，通过对写入的图像灰度化，裁剪，提取特征参数，与贝叶斯决策结合，进行概率分析，匹配，显示最符合的数字，算是部分操作的小应用，同时也涉及到数字图像处理较难的部分：模式识别一块；同时可以用来延伸出车牌识别或人脸识别等更高级的应用系统。  </p>
<p>现场老师问了几个问题，回忆了下，有问和PS的区别和项目的意义。</p>
<h1 id="项目获奖"><a href="#项目获奖" class="headerlink" title="项目获奖"></a>项目获奖</h1><pre><code>第九届中国计算机设计大赛国家三等奖、中南赛区二等奖
</code></pre><p>P.S.配图为我设计的作品海报。</p>
<p><span id="busuanzi_container_page_pv"><br>本文已被阅读 <span id="busuanzi_value_page_pv"></span> 次。感谢您的点击！<br>The article has been viewed <span id="busuanzi_value_page_pv"></span> times.Thank you for your visit!<br></span></p>
]]></content>
    
    <summary type="html">
    
      &lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://7xray0.com1.z0.glb.clouddn.com/hb.jpg&quot; width=&quot;300&quot; height=&quot;180&quot; style=&quot;float:right;&quot;/&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;　　说话算数，许诺的上海决赛详细情况记录。&lt;br&gt;&lt;br&gt;&lt;br&gt; &lt;/div&gt;
    
    </summary>
    
      <category term="通信工程" scheme="http://hubojing.github.io/categories/%E9%80%9A%E4%BF%A1%E5%B7%A5%E7%A8%8B/"/>
    
    
      <category term="matlab" scheme="http://hubojing.github.io/tags/matlab/"/>
    
      <category term="竞赛" scheme="http://hubojing.github.io/tags/%E7%AB%9E%E8%B5%9B/"/>
    
  </entry>
  
  <entry>
    <title>yelee --&gt; hueman主题更换</title>
    <link href="http://hubojing.github.io/2017/01/03/hueman%E4%B8%BB%E9%A2%98%E6%9B%B4%E6%8D%A2/"/>
    <id>http://hubojing.github.io/2017/01/03/hueman主题更换/</id>
    <published>2017-01-03T09:45:10.000Z</published>
    <updated>2017-04-05T09:52:34.845Z</updated>
    
    <content type="html"><![CDATA[<p><div align="left"><br><img src="http://7xray0.com1.z0.glb.clouddn.com/17-1-3/18721350-file_1483437231403_721.png" width="300" height="180" style="float:right;"></div></p>
<p>我又双叒叕把博客玩崩了……<br>淡定——
　
　
　</p>
<p> <br><a id="more"></a><br>　　前两天调双语博客页面失败，顺带着把yelee主题玩垮了。[拆毁天才girl NO.1]<br>　　MoXFIVE也很久没有更新yelee的文档了，索性我就换了个主题。现在的主题是hueman。<br>　　换个主题就仿佛整个人都整容了一样→_→什么都要变！<br>　　改config，调样式，换logo，整个人都不好了！<br>　　hueman很漂亮，优点突出，但对比yelee，也有一些缺点，例如：没有网站计数，没有文章目录等。<br>　　把折腾几个小时的成果记录一下，方便以后接着折腾[手动滑稽]。</p>
<h1 id="主题文档"><a href="#主题文档" class="headerlink" title="主题文档"></a>主题文档</h1><p><a href="https://github.com/ppoffice/hexo-theme-hueman/wiki" target="_blank" rel="external">https://github.com/ppoffice/hexo-theme-hueman/wiki</a></p>
<h1 id="更改背景"><a href="#更改背景" class="headerlink" title="更改背景"></a>更改背景</h1><p>hueman\source\css_partial\header.styl<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-background: color-header-background</div><div class="line">+ background-image: url(<span class="string">"地址"</span>)</div></pre></td></tr></table></figure></p>
<p>记得把footer里的背景也给改了，对称美！</p>
<h1 id="更换logo"><a href="#更换logo" class="headerlink" title="更换logo"></a>更换logo</h1><p>hueman\source\css\images<br>把logo-header.png更换为自己的logo。<br>我在网上随便在线生成了个艺术字就贴上来了……</p>
<p>#加入网站计数<br>\themes\hueman\layout\common\footer.ejs<br>和yelee一样，交给不蒜子[<a href="http://ibruce.info/2015/04/04/busuanzi/" target="_blank" rel="external">http://ibruce.info/2015/04/04/busuanzi/</a>] 。</p>
<h2 id="安装脚本"><a href="#安装脚本" class="headerlink" title="安装脚本"></a>安装脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;script async src=<span class="string">"//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"</span>&gt;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
<h2 id="安装标签"><a href="#安装标签" class="headerlink" title="安装标签"></a>安装标签</h2><p>1.显示站点总访问量<br>要显示站点总访问量，复制以下代码添加到你需要显示的位置。有两种算法可选：<br>算法a：pv的方式，单个用户连续点击n篇文章，记录n次访问量。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;span id=<span class="string">"busuanzi_container_site_pv"</span>&gt;</div><div class="line">    本站总访问量&lt;span id=<span class="string">"busuanzi_value_site_pv"</span>&gt;&lt;/span&gt;次</div><div class="line">&lt;/span&gt;</div></pre></td></tr></table></figure></p>
<p>算法b：uv的方式，单个用户连续点击n篇文章，只记录1次访客数。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;span id=<span class="string">"busuanzi_container_site_uv"</span>&gt;</div><div class="line">  本站访客数&lt;span id=<span class="string">"busuanzi_value_site_uv"</span>&gt;&lt;/span&gt;人次</div><div class="line">&lt;/span&gt;</div></pre></td></tr></table></figure></p>
<p>2.显示单页面访问量<br>要显示每篇文章的访问量，复制以下代码添加到你需要显示的位置。<br>算法：pv的方式，单个用户点击1篇文章，本篇文章记录1次阅读量。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;span id=<span class="string">"busuanzi_container_page_pv"</span>&gt;</div><div class="line">  本文总阅读量&lt;span id=<span class="string">"busuanzi_value_page_pv"</span>&gt;&lt;/span&gt;次</div><div class="line">&lt;/span&gt;</div></pre></td></tr></table></figure></p>
<p>　　后续待解决（欢迎各位大神们给建议）：<br>　　1.文章目录问题（不知道在哪里改，toc怎么调用，&lt;%- toc(str, [options]) %&gt;需点拨）<br>　　2.博客内搜索问题（insight插件总是安装失败，估计是node版本问题，可是有点不敢动node，害怕博客又崩了(瑟瑟发抖.jpg)）<br>　　3.分类顺序问题（应该是互联网、通信工程、杂谈，不知道为什么成了互联网、杂谈、通信工程）<br>    4.文章浏览量丢失（蓝瘦香菇…）<br>　　5.双语页面问题（就是不！死！心！）<br>　　6.微言板块（类似空间的说说，每条下面可以评论，未来会把自己的问题放在这里，等待高手解答）<br>　　……</p>
<p><span id="busuanzi_container_page_pv"><br>本文已被阅读 <span id="busuanzi_value_page_pv"></span> 次。感谢您的点击！</span></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://7xray0.com1.z0.glb.clouddn.com/17-1-3/18721350-file_1483437231403_721.png&quot; width=&quot;300&quot; height=&quot;180&quot; style=&quot;float:right;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;我又双叒叕把博客玩崩了……&lt;br&gt;淡定——
　
　
　&lt;/p&gt;
&lt;p&gt; &lt;/div&gt;&lt;br&gt;
    
    </summary>
    
      <category term="互联网" scheme="http://hubojing.github.io/categories/%E4%BA%92%E8%81%94%E7%BD%91/"/>
    
    
      <category term="blog" scheme="http://hubojing.github.io/tags/blog/"/>
    
      <category term="hexo" scheme="http://hubojing.github.io/tags/hexo/"/>
    
      <category term="主题" scheme="http://hubojing.github.io/tags/%E4%B8%BB%E9%A2%98/"/>
    
  </entry>
  
</feed>
