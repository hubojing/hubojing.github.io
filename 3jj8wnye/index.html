<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="\r本教程重操作，轻理论，为操作减负。需了解详细原理的朋友可以自行看各种书籍。 直接上菜。\n">
<title>MFC傻瓜式教程</title>

<link rel='canonical' href='https://hubojing.github.io/3jj8wnye/'>

<link rel="stylesheet" href="/scss/style.min.b9c8156d464c343bdacaf14a871581fb94cbbdb9dd5cbce4ba017361187cc930.css"><meta property='og:title' content="MFC傻瓜式教程">
<meta property='og:description' content="\r本教程重操作，轻理论，为操作减负。需了解详细原理的朋友可以自行看各种书籍。 直接上菜。\n">
<meta property='og:url' content='https://hubojing.github.io/3jj8wnye/'>
<meta property='og:site_name' content='靖待'>
<meta property='og:type' content='article'><meta property='article:section' content='Posts' /><meta property='article:tag' content='MFC' /><meta property='article:tag' content='CPP' /><meta property='article:published_time' content='2017-04-13T22:26:01&#43;00:00'/><meta property='article:modified_time' content='2017-04-13T22:26:01&#43;00:00'/>
<meta name="twitter:title" content="MFC傻瓜式教程">
<meta name="twitter:description" content="\r本教程重操作，轻理论，为操作减负。需了解详细原理的朋友可以自行看各种书籍。 直接上菜。\n">
    <link rel="shortcut icon" href="/avatar.jpg" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_999351c94d8e06aa.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">靖待</a></h1>
            <h2 class="site-description">创造是人生乐趣</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://blog.csdn.net/hubojing/'
                        target="_blank"
                        title="csdn"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/CaiJimmy/hugo-theme-stack'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='mailto:hubojing@outlook.com'
                        target="_blank"
                        title="mail"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://music.163.com/#/user/home?id=92203594'
                        target="_blank"
                        title="netease"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='/atom.xml'
                        target="_blank"
                        title="rss"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                <span>存档</span>
            </a>
        </li>
        
        
        <li >
            <a href='/tags/' >
                
                
                
                <span>标签</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                <span>搜索</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                <span>关于</span>
            </a>
        </li>
        
        
        <li >
            <a href='/friends/' >
                
                
                
                <span>友链</span>
            </a>
        </li>
        
        
        <li >
            <a href='/comment/' >
                
                
                
                <span>留言板</span>
            </a>
        </li>
        
        
        <li >
            <a href='/littletalk/' >
                
                
                
                <span>自语</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#对话框的创建和显示">对话框的创建和显示</a>
      <ol>
        <li><a href="#模态对话框的创建">模态对话框的创建</a></li>
        <li><a href="#非模态对话框的创建">非模态对话框的创建</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#控件的访问">控件的访问</a>
      <ol>
        <li><a href="#控件的调整">控件的调整</a></li>
        <li><a href="#静态文本控件">静态文本控件</a></li>
        <li><a href="#编辑框控件">编辑框控件</a>
          <ol>
            <li><a href="#第一种方式">第一种方式</a></li>
            <li><a href="#第二种方式">第二种方式</a></li>
            <li><a href="#第三种方式">第三种方式</a></li>
            <li><a href="#第四种方式">第四种方式</a></li>
            <li><a href="#第五种方式">第五种方式</a></li>
            <li><a href="#第六种方式">第六种方式</a></li>
            <li><a href="#第七种方式">第七种方式</a></li>
            <li><a href="#总结">总结</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#对话框伸缩功能的实现">对话框伸缩功能的实现</a></li>
    <li><a href="#输入焦点的传递">输入焦点的传递</a>
      <ol>
        <li><a href="#法一">法一</a></li>
        <li><a href="#法二">法二</a></li>
        <li><a href="#法三">法三</a></li>
        <li><a href="#法四">法四</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#c语言对文件操作的支持">C语言对文件操作的支持</a>
      <ol>
        <li><a href="#文件的打开和写入">文件的打开和写入</a></li>
        <li><a href="#文件的关闭">文件的关闭</a></li>
        <li><a href="#文件指针定位">文件指针定位</a></li>
        <li><a href="#文件的读取">文件的读取</a></li>
        <li><a href="#二进制文件和文本文件">二进制文件和文本文件</a></li>
        <li><a href="#文本方式和二进制方式">文本方式和二进制方式</a></li>
      </ol>
    </li>
    <li><a href="#c对文件操作的支持">C++对文件操作的支持</a></li>
    <li><a href="#win32-api-对文件操作的支持">Win32 API 对文件操作的支持</a>
      <ol>
        <li><a href="#文件的创建打开和写入">文件的创建、打开和写入</a></li>
        <li><a href="#文件的读取-1">文件的读取</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#菜单命令响应函数">菜单命令响应函数</a></li>
    <li><a href="#菜单命令的路由">菜单命令的路由</a>
      <ol>
        <li><a href="#程序类对菜单命令的响应顺序">程序类对菜单命令的响应顺序</a></li>
        <li><a href="#windows消息的分类">Windows消息的分类</a></li>
        <li><a href="#菜单命令的路由-1">菜单命令的路由</a></li>
      </ol>
    </li>
    <li><a href="#基本菜单操作">基本菜单操作</a>
      <ol>
        <li><a href="#标记菜单">标记菜单</a></li>
        <li><a href="#默认菜单项">默认菜单项</a></li>
        <li><a href="#图形标记菜单">图形标记菜单</a></li>
        <li><a href="#禁用菜单项">禁用菜单项</a></li>
        <li><a href="#移除和装载菜单">移除和装载菜单</a></li>
        <li><a href="#mfc菜单命令更新机制">MFC菜单命令更新机制</a></li>
        <li><a href="#快捷菜单">快捷菜单</a></li>
      </ol>
    </li>
    <li><a href="#动态菜单操作">动态菜单操作</a>
      <ol>
        <li><a href="#添加菜单项目">添加菜单项目</a></li>
        <li><a href="#插入菜单项目">插入菜单项目</a></li>
        <li><a href="#删除菜单">删除菜单</a></li>
        <li><a href="#动态添加的菜单项的命令响应">动态添加的菜单项的命令响应</a></li>
      </ol>
    </li>
    <li><a href="#电话本示例程序">电话本示例程序</a>
      <ol>
        <li><a href="#动态添加子菜单的实现">动态添加子菜单的实现</a></li>
        <li><a href="#显示输入的字符">显示输入的字符</a></li>
        <li><a href="#添加菜单项及其命令响应函数">添加菜单项及其命令响应函数</a></li>
        <li><a href="#框架类窗口截获菜单命令消息">框架类窗口截获菜单命令消息</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#mfc消息映射机制">MFC消息映射机制</a></li>
    <li><a href="#绘制线条">绘制线条</a>
      <ol>
        <li><a href="#利用mfc的cdc类实现画线功能">利用MFC的CDC类实现画线功能</a></li>
        <li><a href="#利用mfc的cwindowdc类实现画线功能">利用MFC的CWindowDC类实现画线功能</a></li>
        <li><a href="#在桌面窗口中画线">在桌面窗口中画线</a></li>
        <li><a href="#绘制彩色线条">绘制彩色线条</a></li>
      </ol>
    </li>
    <li><a href="#使用画刷绘图">使用画刷绘图</a>
      <ol>
        <li><a href="#简单画刷">简单画刷</a></li>
        <li><a href="#透明画刷">透明画刷</a></li>
      </ol>
    </li>
    <li><a href="#绘制连续线条">绘制连续线条</a></li>
    <li><a href="#绘制扇形效果的线条">绘制扇形效果的线条</a></li>
  </ol>

  <ol>
    <li><a href="#插入符">插入符</a>
      <ol>
        <li><a href="#创建文本插入符">创建文本插入符</a></li>
        <li><a href="#创建图形插入符">创建图形插入符</a></li>
      </ol>
    </li>
    <li><a href="#窗口重绘">窗口重绘</a>
      <ol>
        <li><a href="#ondraw函数">OnDraw函数</a></li>
        <li><a href="#添加字符串资源">添加字符串资源</a></li>
        <li><a href="#路径">路径</a></li>
      </ol>
    </li>
    <li><a href="#字符输入">字符输入</a>
      <ol>
        <li><a href="#设置字体">设置字体</a></li>
        <li><a href="#字幕变色功能的实现">字幕变色功能的实现</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#简单绘图-1">简单绘图</a></li>
    <li><a href="#设置对话框">设置对话框</a>
      <ol>
        <li><a href="#设置线宽">设置线宽</a></li>
        <li><a href="#设置线型">设置线型</a></li>
      </ol>
    </li>
    <li><a href="#颜色对话框">颜色对话框</a></li>
    <li><a href="#字体对话框">字体对话框</a></li>
    <li><a href="#示例对话框">示例对话框</a></li>
    <li><a href="#106-改变对话框和控件的背景及文本颜色">10.6 改变对话框和控件的背景及文本颜色</a>
      <ol>
        <li><a href="#改变整个对话框及其子控件的背景色">改变整个对话框及其子控件的背景色</a></li>
        <li><a href="#仅改变某个子控件的背景及文本颜色">仅改变某个子控件的背景及文本颜色</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#坐标空间和转换">坐标空间和转换</a>
      <ol>
        <li><a href="#坐标空间">坐标空间</a></li>
        <li><a href="#转换">转换</a></li>
      </ol>
    </li>
    <li><a href="#图形的保存和重绘-1">图形的保存和重绘</a>
      <ol>
        <li><a href="#改变控件上的文本字体">改变控件上的文本字体</a></li>
        <li><a href="#改变按钮控件的背景色及文本颜色">改变按钮控件的背景色及文本颜色</a></li>
      </ol>
    </li>
    <li><a href="#位图的显示">位图的显示</a></li>
  </ol>

  <ol>
    <li><a href="#修改应用程序窗口的外观">修改应用程序窗口的外观</a>
      <ol>
        <li><a href="#在窗口创建之前修改">在窗口创建之前修改</a></li>
      </ol>
    </li>
    <li><a href="#在窗口创建之后修改">在窗口创建之后修改</a></li>
    <li><a href="#修改窗口的光标图标和背景">修改窗口的光标、图标和背景</a>
      <ol>
        <li><a href="#在窗口创建之前修改-1">在窗口创建之前修改</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#计算机网络基本知识">计算机网络基本知识</a></li>
    <li><a href="#基于tcp的网络应用程序的编写">基于TCP的网络应用程序的编写</a>
      <ol>
        <li><a href="#服务器端程序">服务器端程序</a></li>
        <li><a href="#客户端程序">客户端程序</a></li>
      </ol>
    </li>
    <li><a href="#基于udp的网络应用程序的编写">基于UDP的网络应用程序的编写</a>
      <ol>
        <li><a href="#服务器端程序-1">服务器端程序</a></li>
        <li><a href="#客户端程序-1">客户端程序</a></li>
      </ol>
    </li>
    <li><a href="#基于udp的简单聊天程序">基于UDP的简单聊天程序</a>
      <ol>
        <li><a href="#客户端程序-2">客户端程序</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#进程">进程</a>
      <ol>
        <li><a href="#程序和进程">程序和进程</a></li>
      </ol>
    </li>
    <li><a href="#简单多线程示例">简单多线程示例</a></li>
    <li><a href="#线程同步">线程同步</a>
      <ol>
        <li><a href="#火车站售票系统模拟程序">火车站售票系统模拟程序</a></li>
      </ol>
    </li>
    <li><a href="#保证应用程序只有一个实例运行">保证应用程序只有一个实例运行</a></li>
    <li><a href="#网络聊天室程序的实现">网络聊天室程序的实现</a>
      <ol>
        <li><a href="#加载套接字库">加载套接字库</a></li>
        <li><a href="#创建并初始化套接字">创建并初始化套接字</a></li>
        <li><a href="#实现接收端功能">实现接收端功能</a></li>
        <li><a href="#实现发送端功能">实现发送端功能</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#activex控件-1">ActiveX控件</a>
      <ol>
        <li><a href="#mfc-activex-controlwizard">MFC ActiveX ControlWizard</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#win32-dll的创建和使用">Win32 DLL的创建和使用</a>
      <ol>
        <li><a href="#dumpbin命令">Dumpbin命令</a></li>
        <li><a href="#从dll中导出函数">从DLL中导出函数</a></li>
      </ol>
    </li>
    <li><a href="#隐式链接方式加载dll">隐式链接方式加载DLL</a>
      <ol>
        <li><a href="#利用extern声明外部函数">利用extern声明外部函数</a></li>
        <li><a href="#depends工具">Depends工具</a></li>
        <li><a href="#利用_declspecdllimport声明外部函数">利用_declspec(dllimport)声明外部函数</a></li>
      </ol>
    </li>
    <li><a href="#完善win32-dll例子">完善Win32 DLL例子</a></li>
    <li><a href="#从dll中导出c类">从DLL中导出C++类</a></li>
    <li><a href="#解决名字改编问题">解决名字改编问题</a></li>
    <li><a href="#显示加载方式加载dll">显示加载方式加载DLL</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" >
                编程语言
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/3jj8wnye/">MFC傻瓜式教程</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Apr 13, 2017</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 52 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <div align="left">
<img src="http://img.blog.csdn.net/20170413231922633?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" width="300" height="180" style="float:right;"/>
 </div>
<p>　　
　　<strong>本教程重操作，轻理论，为操作减负。需了解详细原理的朋友可以自行看各种书籍。</strong>
　　<strong>直接上菜。</strong></p>
<p>MFC：Microsoft Foundation Class ，微软基础类库。</p>
<h1 id="对话框">对话框
</h1><h2 id="对话框的创建和显示">对话框的创建和显示
</h2><ol>
<li>
<p>新建MFC AppWizard(exe)工程，单文档类型。工程名：Mybole。编译运行。
<img src="http://img.blog.csdn.net/20170413231922633?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="新建"
	
	
></p>
</li>
<li>
<p>点击帮助-关于Mybole。这是MFC自动创建的。
<img src="http://img.blog.csdn.net/20170413231954758?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="关于"
	
	
></p>
</li>
<li>
<p>创建自己的对话框。点击Insert-Resource。选择Dialog，点击New。VC++自动将其标识设置为IDD_DIALOG1，并自动添加到ResourceView-Dialog项中。Dialog项下还有一个对话框资源标识：IDD_ABOUTBOX，即上一步中的“关于”对话框。
<img src="http://img.blog.csdn.net/20170413232035196?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="Insert Resource对话框"
	
	
></p>
</li>
</ol>
<p><img src="http://img.blog.csdn.net/20170413232222055?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="新建的对话框资源"
	
	
></p>
<ol start="4">
<li>选中对话框本身，右键点击属性。将Caption设置为“测试”。</li>
<li>选择View-ClassWizard，点击create a new class，OK。出现下图，并输入下图选项。
<img src="http://img.blog.csdn.net/20170413232907845?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="New Class"
	
	
></li>
<li>在随后出现的MFC ClassWizard对话框上点击OK。
<img src="http://img.blog.csdn.net/20170413233804513?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="列表"
	
	
>
<strong>注意</strong>：看看左侧类列表中是否添加好了CTestDlg，否则会影响后续操作。</li>
</ol>
<p>接下来，我们希望在程序中显示这个对话窗口。</p>
<ol start="7">
<li>
<p>点击右侧菜单Menu，选中IDR_MAINFRAME。点击帮助旁边的虚线框。
<img src="http://img.blog.csdn.net/20170413233914861?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="Menu"
	
	
></p>
</li>
<li>
<p>对虚线框右键属性，修改为下图。
<img src="http://img.blog.csdn.net/20170413234011986?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="属性"
	
	
></p>
</li>
<li>
<p>关闭属性。点击View-ClassWizard（中文是建立类向导），选择CMyboleView，用COMMAND命令消息响应函数。如图。
<img src="http://img.blog.csdn.net/20170414000004060?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="COMMAND"
	
	
></p>
</li>
</ol>
<h3 id="模态对话框的创建">模态对话框的创建
</h3><p>　　需要调用CDialog类的成员函数：DoModal，它能创建并显示一个模态对话框，其返回值将作为CDialog类的另一个成员函数：EndDialog的参数，后者功能是关闭模态对话框。</p>
<p>　　在FileView中选择MyboleView.cpp，编写程序。
　　记得在开头添加头文件 #include “testdlg.h” （头文件大小写问题，linux区分，windows不区分）
<img src="http://img.blog.csdn.net/20170414000303079?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="编程"
	
	
>
　　显示模态对话框的具体实现代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CMyboleView</span><span class="o">::</span><span class="n">OnDialog</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Add your command handler code here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CTestDlg</span> <span class="n">dlg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">dlg</span><span class="p">.</span><span class="n">DoModal</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>编译运行，点击对话框。会发现若不确认该窗口，将无法点击其他窗口。
<img src="http://img.blog.csdn.net/20170414000500779?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="模态对话框1"
	
	
></p>
<p><img src="http://img.blog.csdn.net/20170414000612202?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="模态对话框2"
	
	
></p>
<h3 id="非模态对话框的创建">非模态对话框的创建
</h3><p>将上面的模态对话框代码注释掉。</p>
<p>改为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CMyboleView</span><span class="o">::</span><span class="n">OnDialog</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Add your command handler code here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//CTestDlg dlg;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//dlg.DoModal();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="n">CTestDlg</span> <span class="o">*</span><span class="n">pDlg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CTestDlg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pDlg</span><span class="o">-&gt;</span><span class="n">Create</span><span class="p">(</span><span class="n">IDD_DIALOG1</span><span class="p">,</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">pDlg</span><span class="o">-&gt;</span><span class="n">ShowWindow</span><span class="p">(</span><span class="n">SW_SHOW</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>注意</strong>：需要把之前运行的对话框关掉才能编译成功。</p>
<p>然而，当它生命周期结束时，所保存的内存地址就丢失了，那么程序中也就无法再引用到它所指向的那块内存。于是，我们这样解决该问题。
<img src="http://img.blog.csdn.net/20170414000901869?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="MFC ClassWizard"
	
	
></p>
<p><strong>注意</strong>：Message里双击添加函数或者点击add Class…</p>
<p>void CTestDlg::PostNcDestroy()
{
// TODO: Add your specialized code here and/or call the base class
delete this;
CDialog::PostNcDestroy();
}</p>
<p><strong>区别</strong>：点击确定，对话框都会消失。但是，模态对话框窗口对象被销毁了。对非模态对话框来说，只是隐藏起来了，并未被销毁。
因此，若要销毁对话框，若有一个ID为IDOK的按钮，就必须重写基类的OnOK这个虚函数，并在重写的函数中调用DestroyWindow函数，完成销毁。并不要再调用基类的OnOK函数。
同样地，若有一个ID为IDCANCEL的按钮，也必须重写基类的OnCancel虚函数，并在重写的函数中调用DestroyWindow函数，完成销毁。并不要再调用基类的OnCancel函数。</p>
<h1 id="动态创建按钮">动态创建按钮
</h1><p>注释掉非模态对话框代码，还原模态对话框代码。</p>
<p>点击ResourceView-IDD_DIALOG1，打开资源，用鼠标拖出控件面板上的Button按钮控件，对按钮右键，选择属性，设置如下。
<img src="http://img.blog.csdn.net/20170414001008658?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="按钮"
	
	
></p>
<p>接下来，我们实现当单击Add按钮时，在对话框中动态创建一个按钮这一功能。</p>
<ol>
<li>为CTestDlg类添加一个私有的CButton成员变量。
　　点击ClassView标签页右键，如图点击。
<img src="http://img.blog.csdn.net/20170414001252061?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="ClassView"
	
	
></li>
</ol>
<p>　　填入信息。
<img src="http://img.blog.csdn.net/20170414001335972?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="添加成员变量"
	
	
></p>
<ol start="2">
<li>添加Add按钮单击消息的响应函数。
　　按钮点右键，选ClassWizard（建立类向导），如图。
<img src="http://img.blog.csdn.net/20170414001137294?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="建立类向导"
	
	
></li>
</ol>
<p>　　单击Edit Code，即可定位到该函数定义处。
　　添加一下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTestDlg</span><span class="o">::</span><span class="n">OnBtnAdd</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Add your control notification handler code here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">m_btn</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="s">&#34;New&#34;</span><span class="p">,</span><span class="n">BS_DEFPUSHBUTTON</span> <span class="o">|</span> <span class="n">WS_VISIBLE</span> <span class="o">|</span> <span class="n">WS_CHILD</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				 <span class="n">CRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span><span class="k">this</span><span class="p">,</span><span class="mi">123</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　为避免多次点击Add出现非法操作，我们需要进行如下步骤。</p>
<ol start="3">
<li>
<p>为CTestDlg类增加一个私有的BOOL类型成员变量。
变量类型：BOOL
变量名称：m_bIsCreated
Access: private</p>
</li>
<li>
<p>在TestDlg.cpp中找到构造函数，将m_bIsCreated初始为FALSE。如图所示。
<img src="http://img.blog.csdn.net/20170415152155489?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
</li>
</ol>
<p>　　或者改为如下亦可。
Static BOOL bIsCreated = FALSE;</p>
<ol start="5">
<li>回到Add，双击它，进入代码部分，改之。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTestDlg</span><span class="o">::</span><span class="n">OnBtnAdd</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Add your control notification handler code here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span><span class="p">(</span><span class="n">m_bIsCreated</span><span class="o">==</span><span class="n">FALSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">m_btn</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="s">&#34;New&#34;</span><span class="p">,</span><span class="n">BS_DEFPUSHBUTTON</span> <span class="o">|</span> <span class="n">WS_VISIBLE</span> <span class="o">|</span> <span class="n">WS_CHILD</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="n">CRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span><span class="k">this</span><span class="p">,</span><span class="mi">123</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">m_bIsCreated</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">m_btn</span><span class="p">.</span><span class="n">DestroyWindow</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">m_bIsCreated</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　或者以下亦能实现。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTestDlg</span><span class="o">::</span><span class="n">OnBtnAdd</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Add your control notification handler code here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">m_btn</span><span class="p">.</span><span class="n">m_hWnd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">m_btn</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="s">&#34;New&#34;</span><span class="p">,</span><span class="n">BS_DEFPUSHBUTTON</span> <span class="o">|</span> <span class="n">WS_VISIBLE</span> <span class="o">|</span> <span class="n">WS_CHILD</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="n">CRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span><span class="k">this</span><span class="p">,</span><span class="mi">123</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">m_btn</span><span class="p">.</span><span class="n">DestroyWindow</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　效果：
　　<img src="http://img.blog.csdn.net/20170415152224880?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　点击Add出现New窗口，再点击就销毁。</p>
<h2 id="控件的访问">控件的访问
</h2><h3 id="控件的调整">控件的调整
</h3><p>用Layout-Align，Layout-Make Same Size，Layout-Space Evenly里的选项进行调整。
<img src="http://img.blog.csdn.net/20170415152247131?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h3 id="静态文本控件">静态文本控件
</h3><p>　　查看三个静态文本框，它们ID相同。我们可以更改第一个静态文本框ID为IDC_NUMBER1，再打开ClassWizard，可以在ObjectIDs看到新ID。
<img src="http://img.blog.csdn.net/20170415152324147?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
>
　　对BN_CLICKED进行Add Function，并Edit Code:</p>
<p>　　此时运行程序点击第一个静态文本框并没有反应。这是因为：<strong>静态文本控件在默认状态下是不发送通告消息的</strong>。</p>
<p>　　为了该控件能向父窗口发送鼠标事件，我们对该文本框右键-属性，切换到styles选项卡，勾上Notify。
<img src="http://img.blog.csdn.net/20170415152341882?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　现在可以显示了：
　　点击就改变。
<img src="http://img.blog.csdn.net/20170415152354773?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　<strong>总结：为了使一个静态文本控件能够响应鼠标单击消息，那么需要进行两个特殊的步骤：第一步，改变它的ID；第二步，在它的属性对话框中选中Notify选项。</strong></p>
<h3 id="编辑框控件">编辑框控件
</h3><p>利用上面的对话框实现这样的功能：在前两个编辑框中分别输入一个数字，然后单击Add按钮，对前两个编辑框中的数字求和，并将结果显示在第三个编辑框中。</p>
<h4 id="第一种方式">第一种方式
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTestDlg</span><span class="o">::</span><span class="n">OnBtnAdd</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">,</span> <span class="n">num3</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">ch1</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">ch2</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">ch3</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span> 
</span></span><span class="line"><span class="cl">	<span class="n">GetDlgItem</span><span class="p">(</span><span class="n">IDC_EDIT1</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetWindowText</span><span class="p">(</span><span class="n">ch1</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">	<span class="n">GetDlgItem</span><span class="p">(</span><span class="n">IDC_EDIT2</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetWindowText</span><span class="p">(</span><span class="n">ch2</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">num1</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">ch1</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">	<span class="n">num2</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">ch2</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">	<span class="n">num3</span> <span class="o">=</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">itoa</span><span class="p">(</span><span class="n">num3</span><span class="p">,</span><span class="n">ch3</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">GetDlgItem</span><span class="p">(</span><span class="n">IDC_EDIT3</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">SetWindowText</span><span class="p">(</span><span class="n">ch3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>C语言转换函数：atoi 将一个由数字组成的字符串转换为相应的数值
itoa 数值转换为文本
itoa函数的第三个参数表示转换的进制，数字10表示十进制。</p>
<p>效果：
<img src="http://img.blog.csdn.net/20170415152409742?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h4 id="第二种方式">第二种方式
</h4><p>　　代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTestDlg</span><span class="o">::</span><span class="n">OnBtnAdd</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">,</span> <span class="n">num3</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">ch1</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">ch2</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">ch3</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span> 
</span></span><span class="line"><span class="cl">	<span class="c1">//GetDlgItem(IDC_EDIT1)-&gt;GetWindowText(ch1,10); 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//GetDlgItem(IDC_EDIT2)-&gt;GetWindowText(ch2,10);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	
</span></span><span class="line"><span class="cl">	<span class="n">GetDlgItemText</span><span class="p">(</span><span class="n">IDC_EDIT1</span><span class="p">,</span><span class="n">ch1</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">GetDlgItemText</span><span class="p">(</span><span class="n">IDC_EDIT2</span><span class="p">,</span><span class="n">ch2</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">num1</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">ch1</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">	<span class="n">num2</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">ch2</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">	<span class="n">num3</span> <span class="o">=</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">itoa</span><span class="p">(</span><span class="n">num3</span><span class="p">,</span><span class="n">ch3</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//GetDlgItem(IDC_EDIT3)-&gt;SetWindowText(ch3);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">SetDlgItemText</span><span class="p">(</span><span class="n">IDC_EDIT3</span><span class="p">,</span><span class="n">ch3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　GetDlgItemText 将返回对话框中指定ID的控件上的文本，相当于将上面的GetDlgItem和GetWindowText这两个函数功能组合起来了。
与之对应的是SetDlgItemText，用来设置对话框中指定ID的控件上的文本。</p>
<h4 id="第三种方式">第三种方式
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTestDlg</span><span class="o">::</span><span class="n">OnBtnAdd</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">,</span> <span class="n">num3</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">	<span class="c1">//char ch1[10], ch2[10], ch3[10]; 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//GetDlgItem(IDC_EDIT1)-&gt;GetWindowText(ch1,10); 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//GetDlgItem(IDC_EDIT2)-&gt;GetWindowText(ch2,10);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	
</span></span><span class="line"><span class="cl">	<span class="c1">//GetDlgItemText(IDC_EDIT1,ch1,10);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//GetDlgItemText(IDC_EDIT2,ch2,10);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="n">num1</span> <span class="o">=</span> <span class="n">GetDlgItemInt</span><span class="p">(</span><span class="n">IDC_EDIT1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">num2</span> <span class="o">=</span> <span class="n">GetDlgItemInt</span><span class="p">(</span><span class="n">IDC_EDIT2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//num1 = atoi(ch1); 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//num2 = atoi(ch2); 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">num3</span> <span class="o">=</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//itoa(num3,ch3,10);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//GetDlgItem(IDC_EDIT3)-&gt;SetWindowText(ch3);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//SetDlgItemText(IDC_EDIT3,ch3);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">SetDlgItemInt</span><span class="p">(</span><span class="n">IDC_EDIT3</span><span class="p">,</span><span class="n">num3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="第四种方式">第四种方式
</h4><p>　　将这三个编辑框分别与对话框类的三个成员变量相关联，然后通过这些成员变量来检索和设置编辑框的文本，这是最简单的访问控件的方式。
打开ClassWizard对话框，切换到Member Variables选项卡，如图。
<img src="http://img.blog.csdn.net/20170415152431039?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
>
　　首先为IDC_EDIT1编辑框添加一个关联的成员变量，方法是在Control IDs列表中选中IDC_EDIT1，再单击Add Variable按钮，如图。
<img src="http://img.blog.csdn.net/20170415152451118?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
>
<img src="http://img.blog.csdn.net/20170415152505259?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　同样地，为IDC_EDIT2和IDC_EDIT3分别添加好成员变量。
　　接着修改代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTestDlg</span><span class="o">::</span><span class="n">OnBtnAdd</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">UpdateData</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">m_num3</span> <span class="o">=</span> <span class="n">m_num1</span> <span class="o">+</span> <span class="n">m_num2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">UpdateData</span><span class="p">(</span><span class="n">FALSE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　对编辑框控件中输入的数值设定一个范围：
　　打开ClassWizard-Member Variable，选中IDC_EDIT1，下方输入0和100。同样为IDC_EDIT2也设置好。
<img src="http://img.blog.csdn.net/20170415152522025?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h4 id="第五种方式">第五种方式
</h4><p>　　将编辑框控件再与一个变量相关联，代表控件本身。为IDC_EDIT1增加一个控件类型的变量：m_edit1，类别为Control。同样地，也为IDC_EDIT2和IDC_EDIT3添加。
<img src="http://img.blog.csdn.net/20170415152547447?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　修改代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTestDlg</span><span class="o">::</span><span class="n">OnBtnAdd</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">,</span> <span class="n">num3</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">ch1</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">ch2</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">ch3</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span> 
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">m_edit1</span><span class="p">.</span><span class="n">GetWindowText</span><span class="p">(</span><span class="n">ch1</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">m_edit2</span><span class="p">.</span><span class="n">GetWindowText</span><span class="p">(</span><span class="n">ch2</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//num1 = GetDlgItemInt(IDC_EDIT1);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//num2 = GetDlgItemInt(IDC_EDIT2);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="n">num1</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">ch1</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">	<span class="n">num2</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">ch2</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">	<span class="n">num3</span> <span class="o">=</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">itoa</span><span class="p">(</span><span class="n">num3</span><span class="p">,</span><span class="n">ch3</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">m_edit3</span><span class="p">.</span><span class="n">SetWindowText</span><span class="p">(</span><span class="n">ch3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="第六种方式">第六种方式
</h4><p>　　修改代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTestDlg</span><span class="o">::</span><span class="n">OnBtnAdd</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">,</span> <span class="n">num3</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">ch1</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">ch2</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">ch3</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="o">::</span><span class="n">SendMessage</span><span class="p">(</span><span class="n">GetDlgItem</span><span class="p">(</span><span class="n">IDC_EDIT1</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">m_hWnd</span><span class="p">,</span> <span class="n">WM_GETTEXT</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="p">(</span><span class="n">LPARAM</span><span class="p">)</span><span class="n">ch1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">::</span><span class="n">SendMessage</span><span class="p">(</span><span class="n">m_edit2</span><span class="p">.</span><span class="n">m_hWnd</span><span class="p">,</span> <span class="n">WM_GETTEXT</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="p">(</span><span class="n">LPARAM</span><span class="p">)</span><span class="n">ch2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">num1</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">ch1</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">	<span class="n">num2</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">ch2</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">	<span class="n">num3</span> <span class="o">=</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">itoa</span><span class="p">(</span><span class="n">num3</span><span class="p">,</span><span class="n">ch3</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">m_edit3</span><span class="p">.</span><span class="n">SendMessage</span><span class="p">(</span><span class="n">WM_SETTEXT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">LPARAM</span><span class="p">)</span><span class="n">ch3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="第七种方式">第七种方式
</h4><p>　　修改代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTestDlg</span><span class="o">::</span><span class="n">OnBtnAdd</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">,</span> <span class="n">num3</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">ch1</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">ch2</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">ch3</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span> 
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">SendDlgItemMessage</span><span class="p">(</span><span class="n">IDC_EDIT1</span><span class="p">,</span> <span class="n">WM_GETTEXT</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="p">(</span><span class="n">LPARAM</span><span class="p">)</span><span class="n">ch1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">SendDlgItemMessage</span><span class="p">(</span><span class="n">IDC_EDIT2</span><span class="p">,</span> <span class="n">WM_GETTEXT</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="p">(</span><span class="n">LPARAM</span><span class="p">)</span><span class="n">ch2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"><span class="n">num1</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">ch1</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">	<span class="n">num2</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">ch2</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">	<span class="n">num3</span> <span class="o">=</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">itoa</span><span class="p">(</span><span class="n">num3</span><span class="p">,</span><span class="n">ch3</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">SendDlgItemMessage</span><span class="p">(</span><span class="n">IDC_EDIT3</span><span class="p">,</span> <span class="n">WM_SETTEXT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">LPARAM</span><span class="p">)</span><span class="n">ch3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　获得编辑框复选的内容：
　　在上述代码最后添加：
SendDlgItemMessage(IDC_EDIT3, EM_SETSEL, 0, -1); //0,-1表示全选若1,3表示选中1-3位复选
m_edit3.SetFocus();</p>
<p>　　效果：
<img src="http://img.blog.csdn.net/20170415152614010?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h4 id="总结">总结
</h4><p>1	GetDlgItem()-&gt;Get(Set)WindowTest()
2	GetDlgItemText()/SetDlgItemText()
3	GetDlgItemInt()/SetDlgItemInt()
4	将控件和整型变量相关联
5	将控件和控件变量相关联
6	SendMessage()
7	SendDlgItemMessage()
　　最常用是1、4、5。在利用MFC编程时，6、7用得少。</p>
<h2 id="对话框伸缩功能的实现">对话框伸缩功能的实现
</h2><p>　　对话框上再添加一个按钮，Caption设置为“收缩&laquo;”点击ClassWizard，添加一个命令相应函数（BN_CLICKED）。具体实现代码为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTestDlg</span><span class="o">::</span><span class="n">OnButton1</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CString</span> <span class="n">str</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="n">GetDlgItemText</span><span class="p">(</span><span class="n">IDC_BUTTON1</span><span class="p">,</span><span class="n">str</span><span class="p">),</span> <span class="n">str</span> <span class="o">==</span> <span class="s">&#34;收缩&lt;&lt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">SetDlgItemText</span><span class="p">(</span><span class="n">IDC_BUTTON1</span><span class="p">,</span> <span class="s">&#34;拓展&gt;&gt;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">SetDlgItemText</span><span class="p">(</span><span class="n">IDC_BUTTON1</span><span class="p">,</span> <span class="s">&#34;收缩&lt;&lt;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　拖动一个图像控件来划分对话框中要动态切除的部分。
<img src="http://img.blog.csdn.net/20170415152648992?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　修改该控件ID为IDC_SEPATATOR，styles选项卡勾上Sunken选项。
　　修改代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTestDlg</span><span class="o">::</span><span class="n">OnButton1</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CString</span> <span class="n">str</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="n">GetDlgItemText</span><span class="p">(</span><span class="n">IDC_BUTTON1</span><span class="p">,</span><span class="n">str</span><span class="p">),</span> <span class="n">str</span> <span class="o">==</span> <span class="s">&#34;收缩&lt;&lt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">SetDlgItemText</span><span class="p">(</span><span class="n">IDC_BUTTON1</span><span class="p">,</span> <span class="s">&#34;拓展&gt;&gt;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">SetDlgItemText</span><span class="p">(</span><span class="n">IDC_BUTTON1</span><span class="p">,</span> <span class="s">&#34;收缩&lt;&lt;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">static</span> <span class="n">CRect</span> <span class="n">rectLarge</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">static</span> <span class="n">CRect</span> <span class="n">rectSmall</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CRect</span> <span class="nf">rect1</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">CRect</span> <span class="nf">rect2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="n">rectLarge</span><span class="p">.</span><span class="n">IsRectNull</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">CRect</span> <span class="n">rectSeparator</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">GetWindowRect</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rectLarge</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">GetDlgItem</span><span class="p">(</span><span class="n">IDC_SEPARATOR</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetWindowRect</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rectSeparator</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">rectSmall</span><span class="p">.</span><span class="n">left</span><span class="o">=</span><span class="n">rectLarge</span><span class="p">.</span><span class="n">left</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">rectSmall</span><span class="p">.</span><span class="n">top</span><span class="o">=</span><span class="n">rectLarge</span><span class="p">.</span><span class="n">top</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">rectSmall</span><span class="p">.</span><span class="n">right</span><span class="o">=</span><span class="n">rectLarge</span><span class="p">.</span><span class="n">right</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">rectSmall</span><span class="p">.</span><span class="n">bottom</span><span class="o">=</span><span class="n">rectSeparator</span><span class="p">.</span><span class="n">bottom</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="n">str</span> <span class="o">==</span> <span class="s">&#34;收缩&lt;&lt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">SetWindowPos</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rectSmall</span><span class="p">.</span><span class="n">Width</span><span class="p">(),</span> <span class="n">rectSmall</span><span class="p">.</span><span class="n">Height</span><span class="p">(),</span> <span class="n">SWP_NOMOVE</span> <span class="o">|</span> <span class="n">SWP_NOZORDER</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">SetWindowPos</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rectLarge</span><span class="p">.</span><span class="n">Width</span><span class="p">(),</span> <span class="n">rectLarge</span><span class="p">.</span><span class="n">Height</span><span class="p">(),</span> <span class="n">SWP_NOMOVE</span> <span class="o">|</span> <span class="n">SWP_NOZORDER</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　效果：
<img src="http://img.blog.csdn.net/20170415152705855?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　点击“收缩&laquo;”：
<img src="http://img.blog.csdn.net/20170415152725793?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　若希望隐藏分隔条，则设置属性去掉“Visible”前的勾。</p>
<h2 id="输入焦点的传递">输入焦点的传递
</h2><p>　　为了屏蔽掉默认的回车键关闭对话框这一功能，应该在对话框子类（此处是CTestDlg类）中重写OK按钮的消息响应函数。
　　首先点击OK按钮，添加鼠标单击消息响应函数。注释掉原有函数。</p>
<h3 id="法一">法一
</h3><p>　　在ClassView选项卡的CTestDlg类添加WM_INITDIALOG消息的响应函数。对类右键，选择Add Windows Message Handler，在弹出的框左侧选择WM_INITDIALOG，直接单击Add and Edit，跳转。
　　修改代码为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTestDlg</span><span class="o">::</span><span class="n">OnOK</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Add extra validation here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	
</span></span><span class="line"><span class="cl">	<span class="c1">//CDialog::OnOK();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">WNDPROC</span> <span class="n">prevProc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">LRESULT</span> <span class="n">CALLBACK</span> <span class="nf">NewEditProc</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">		<span class="n">HWND</span> <span class="n">hwnd</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">UINT</span> <span class="n">uMsg</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">WPARAM</span> <span class="n">wParam</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">LPARAM</span> <span class="n">lParam</span>
</span></span><span class="line"><span class="cl">		<span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="n">uMsg</span> <span class="o">==</span> <span class="n">WM_CHAR</span> <span class="o">&amp;&amp;</span> <span class="n">wParam</span> <span class="o">==</span> <span class="mh">0x0d</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="o">::</span><span class="n">SetFocus</span><span class="p">(</span><span class="n">GetNextWindow</span><span class="p">(</span><span class="n">hwnd</span><span class="p">,</span><span class="n">GW_HWNDNEXT</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">prevProc</span><span class="p">(</span><span class="n">hwnd</span><span class="p">,</span><span class="n">uMsg</span><span class="p">,</span><span class="n">wParam</span><span class="p">,</span><span class="n">lParam</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">BOOL</span> <span class="n">CTestDlg</span><span class="o">::</span><span class="n">OnInitDialog</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CDialog</span><span class="o">::</span><span class="n">OnInitDialog</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">prevProc</span><span class="o">=</span><span class="p">(</span><span class="n">WNDPROC</span><span class="p">)</span><span class="n">SetWindowLong</span><span class="p">(</span><span class="n">GetDlgItem</span><span class="p">(</span><span class="n">IDC_EDIT1</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">m_hWnd</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">GWL_WNDPROC</span><span class="p">,</span> <span class="p">(</span><span class="n">LONG</span><span class="p">)</span><span class="n">NewEditProc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　查看第一个编辑框的属性，打开styles选项卡，勾上MultiLine（多行）。即可实现焦点的传递。</p>
<h3 id="法二">法二
</h3><p>　　只需要改变一行代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">WNDPROC</span> <span class="n">prevProc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">LRESULT</span> <span class="n">CALLBACK</span> <span class="nf">NewEditProc</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">		<span class="n">HWND</span> <span class="n">hwnd</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">UINT</span> <span class="n">uMsg</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">WPARAM</span> <span class="n">wParam</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">LPARAM</span> <span class="n">lParam</span>
</span></span><span class="line"><span class="cl">		<span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="n">uMsg</span> <span class="o">==</span> <span class="n">WM_CHAR</span> <span class="o">&amp;&amp;</span> <span class="n">wParam</span> <span class="o">==</span> <span class="mh">0x0d</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//::SetFocus(GetNextWindow(hwnd,GW_HWNDNEXT));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">SetFocus</span><span class="p">(</span><span class="o">::</span><span class="n">GetWindow</span><span class="p">(</span><span class="n">hwnd</span><span class="p">,</span><span class="n">GW_HWNDNEXT</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">prevProc</span><span class="p">(</span><span class="n">hwnd</span><span class="p">,</span><span class="n">uMsg</span><span class="p">,</span><span class="n">wParam</span><span class="p">,</span><span class="n">lParam</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="法三">法三
</h3><p>　　编辑框属性有一个WS_TABSTOP，如果勾选了，则在对话框中按下Tab键后，输入焦点可以转移到此控件上。</p>
<p>　　修改一行代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">WNDPROC</span> <span class="n">prevProc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">LRESULT</span> <span class="n">CALLBACK</span> <span class="nf">NewEditProc</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">		<span class="n">HWND</span> <span class="n">hwnd</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">UINT</span> <span class="n">uMsg</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">WPARAM</span> <span class="n">wParam</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">LPARAM</span> <span class="n">lParam</span>
</span></span><span class="line"><span class="cl">		<span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="n">uMsg</span> <span class="o">==</span> <span class="n">WM_CHAR</span> <span class="o">&amp;&amp;</span> <span class="n">wParam</span> <span class="o">==</span> <span class="mh">0x0d</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">SetFocus</span><span class="p">(</span><span class="o">::</span><span class="n">GetNextDlgTabItem</span><span class="p">(</span><span class="o">::</span><span class="n">GetParent</span><span class="p">(</span><span class="n">hwnd</span><span class="p">),</span><span class="n">hwnd</span><span class="p">,</span><span class="n">FALSE</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//::SetFocus(GetNextWindow(hwnd,GW_HWNDNEXT));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="c1">//SetFocus(::GetWindow(hwnd,GW_HWNDNEXT));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">prevProc</span><span class="p">(</span><span class="n">hwnd</span><span class="p">,</span><span class="n">uMsg</span><span class="p">,</span><span class="n">wParam</span><span class="p">,</span><span class="n">lParam</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　三种方法的缺点：只修改了第一个编辑框的窗口过程，因此从第二到第三个编辑框的焦点转移无法实现，除非继续修改第二个编辑窗口。</p>
<p>　　再介绍一种方法解决这个问题。</p>
<h3 id="法四">法四
</h3><p>　　在MFC中，默认情况下，当在对话框窗口中按下回车键时，会调用对话框的默认按钮的响应函数，我们可以在此默认按钮的响应函数中把焦点依次向下传递。</p>
<p>　　首先取消第一个编辑框的MultiLine。
　　接着修改OnOK函数为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTestDlg</span><span class="o">::</span><span class="n">OnOK</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Add extra validation here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//GetDlgItem(IDC_EDIT1)-&gt;GetNextWindow()-&gt;SetFocus();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//GetFocus()-&gt;GetNextWindow()-&gt;SetFocus();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//GetFocus()-&gt;GetWindow(GW_HWNDNEXT)-&gt;SetFocus();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">GetNextDlgTabItem</span><span class="p">(</span><span class="n">GetFocus</span><span class="p">())</span><span class="o">-&gt;</span><span class="n">SetFocus</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//CDialog::OnOK();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="err">```</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">　　<span class="err">注释掉的部分是各种失败的尝试，各有各的</span><span class="n">bug</span><span class="err">。现在程序是正常的。</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="o">**</span><span class="err">注意：然而该屏蔽回车键的方法并非是常规做法，应该在</span><span class="n">PreTranslateMessage中进行拦截</span><span class="err">。（</span><span class="k">return</span> <span class="n">TRUE即拦截</span><span class="err">）</span><span class="o">**</span>
</span></span><span class="line"><span class="cl">　　<span class="err">具体做法：</span>
</span></span><span class="line"><span class="cl">　　<span class="err">现在</span><span class="n">Testdlg</span><span class="p">.</span><span class="n">h中添加</span><span class="err">：</span>
</span></span><span class="line"><span class="cl"><span class="err">```</span><span class="n">C</span><span class="o">++</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CTestDlg</span> <span class="o">:</span> <span class="k">public</span> <span class="n">CDialog</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">protected</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">virtual</span> <span class="n">BOOL</span> <span class="n">PreTranslateMessage</span><span class="p">(</span><span class="n">MSG</span><span class="o">*</span> <span class="n">pMsg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">OnOK</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="err">……</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　接着：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">CTestDlg</span><span class="o">::</span><span class="n">PreTranslateMessage</span><span class="p">(</span><span class="n">MSG</span><span class="o">*</span> <span class="n">pMsg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//屏蔽ESC关闭窗体
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="n">pMsg</span><span class="o">-&gt;</span><span class="n">message</span> <span class="o">==</span> <span class="n">WM_KEYDOWN</span> <span class="o">&amp;&amp;</span> <span class="n">pMsg</span><span class="o">-&gt;</span><span class="n">wParam</span> <span class="o">==</span> <span class="n">VK_ESCAPE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//屏蔽回车关闭窗体，但会导致回车在窗体上失效.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">	if (pMsg-&gt;message == WM_KEYDOWN &amp;&amp; pMsg-&gt;wParam == VK_RETURN &amp;&amp; pMsg-&gt;wParam)
</span></span></span><span class="line"><span class="cl"><span class="cm">	{
</span></span></span><span class="line"><span class="cl"><span class="cm">		return TRUE;
</span></span></span><span class="line"><span class="cl"><span class="cm">	}
</span></span></span><span class="line"><span class="cl"><span class="cm">	*/</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> 
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">CDialog</span><span class="o">::</span><span class="n">PreTranslateMessage</span><span class="p">(</span><span class="n">pMsg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTestDlg</span><span class="o">::</span><span class="n">OnOK</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Add extra validation here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	
</span></span><span class="line"><span class="cl">	<span class="c1">//CDialog::OnOK();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　点击Layout-Tab order，这些序号就是各控件的Tab顺序。顺序可改变，依次点击希望的顺序控件即可。</p>
<p>　　调用顺序：当用户按下回车键时，Windows将查看对话框中是否存在指定的默认按钮，如果有，就调用该默认按钮单击消息的响应函数。如果没有，就会调用虚拟的OnOK函数，即使对话框没有包含默认的OK按钮（这个默认OK按钮的ID是IDOK）。</p>
<h1 id="文件和注册表操作">文件和注册表操作
</h1><h2 id="c语言对文件操作的支持">C语言对文件操作的支持
</h2><p>　　新建单文档类型的MFC应用程序，工程名为File，并为主菜单添加一个子菜单，名称为“文件操作”，然后为其添加两个菜单项，并分别为它们添加相应的命令响应函数（通过COMMAND），让CFileView类接收这些菜单项的命令响应。
<img src="http://img.blog.csdn.net/20170420224900928?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
>
<img src="http://img.blog.csdn.net/20170420224921428?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h3 id="文件的打开和写入">文件的打开和写入
</h3><p>　　代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CFileView</span><span class="o">::</span><span class="n">OnFileWrite</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">FILE</span> <span class="o">*</span><span class="n">pFile</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;1.txt&#34;</span><span class="p">,</span><span class="s">&#34;w&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">fwrite</span><span class="p">(</span><span class="s">&#34;http://www.sunxin.org&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="s">&#34;http://www.sunxin.org&#34;</span><span class="p">),</span> <span class="n">pFile</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　编译后可看到文件夹中生成了1.txt，打开有一行网址。</p>
<h3 id="文件的关闭">文件的关闭
</h3><p>　　增加一行代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CFileView</span><span class="o">::</span><span class="n">OnFileWrite</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">FILE</span> <span class="o">*</span><span class="n">pFile</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;1.txt&#34;</span><span class="p">,</span><span class="s">&#34;w&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">fwrite</span><span class="p">(</span><span class="s">&#34;http://www.sunxin.org&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="s">&#34;http://www.sunxin.org&#34;</span><span class="p">),</span> <span class="n">pFile</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">	<span class="n">fclose</span><span class="p">(</span><span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="文件指针定位">文件指针定位
</h3><p>　　代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CFileView</span><span class="o">::</span><span class="n">OnFileWrite</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">FILE</span> <span class="o">*</span><span class="n">pFile</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;1.txt&#34;</span><span class="p">,</span><span class="s">&#34;w&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">fwrite</span><span class="p">(</span><span class="s">&#34;http://www.sunxin.org&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="s">&#34;http://www.sunxin.org&#34;</span><span class="p">),</span> <span class="n">pFile</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">	<span class="n">fwrite</span><span class="p">(</span><span class="s">&#34;欢迎访问&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="s">&#34;欢迎访问&#34;</span><span class="p">),</span> <span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">fclose</span><span class="p">(</span><span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　显示：http://www.sunxin.org欢迎访问</p>
<p>　　将文件指针移动到文件的开始位置处：
　　代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CFileView</span><span class="o">::</span><span class="n">OnFileWrite</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">FILE</span> <span class="o">*</span><span class="n">pFile</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;1.txt&#34;</span><span class="p">,</span><span class="s">&#34;w&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">fwrite</span><span class="p">(</span><span class="s">&#34;http://www.sunxin.org&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="s">&#34;http://www.sunxin.org&#34;</span><span class="p">),</span> <span class="n">pFile</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">	<span class="n">fseek</span><span class="p">(</span><span class="n">pFile</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">fwrite</span><span class="p">(</span><span class="s">&#34;ftp:&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="s">&#34;ftp:&#34;</span><span class="p">),</span><span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//fwrite(&#34;欢迎访问&#34;, 1, strlen(&#34;欢迎访问&#34;), pFile);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">fclose</span><span class="p">(</span><span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　显示：ftp:://www.sunxin.org</p>
<h3 id="文件的读取">文件的读取
</h3><p>　　在OnFileRead函数中写入代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CFileView</span><span class="o">::</span><span class="n">OnFileRead</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">FILE</span> <span class="o">*</span><span class="n">pFile</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;1.txt&#34;</span><span class="p">,</span><span class="s">&#34;r&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">ch</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="n">fread</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">fclose</span><span class="p">(</span><span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">MessageBox</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　编译运行：
　　
<img src="http://img.blog.csdn.net/20170420224951225?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　原因：C语言以“\0”结束。</p>
<p>　　解决方法：
　　法一：
　　修改代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CFileView</span><span class="o">::</span><span class="n">OnFileWrite</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">FILE</span> <span class="o">*</span><span class="n">pFile</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;1.txt&#34;</span><span class="p">,</span><span class="s">&#34;w&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;http://www.sunxin.org&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">buf</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">fwrite</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">fclose</span><span class="p">(</span><span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　先点击写入文件，再点击读取文件，就可以看到正确的内容。
　　缺点：增加了文件大小。</p>
<p>法二：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CFileView</span><span class="o">::</span><span class="n">OnFileRead</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">FILE</span> <span class="o">*</span><span class="n">pFile</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;1.txt&#34;</span><span class="p">,</span><span class="s">&#34;r&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">ch</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="n">memset</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">fread</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">fclose</span><span class="p">(</span><span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">MessageBox</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>法三：
　　读取文件时，不知道文件大小时的做法。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CFileView</span><span class="o">::</span><span class="n">OnFileRead</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">FILE</span> <span class="o">*</span><span class="n">pFile</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;1.txt&#34;</span><span class="p">,</span><span class="s">&#34;r&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="o">*</span><span class="n">pBuf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">fseek</span><span class="p">(</span><span class="n">pFile</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_END</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">len</span><span class="o">=</span><span class="n">ftell</span><span class="p">(</span><span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">pBuf</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">len</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="n">rewind</span><span class="p">(</span><span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">fread</span><span class="p">(</span><span class="n">pBuf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">pBuf</span><span class="p">[</span><span class="n">len</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">fclose</span><span class="p">(</span><span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">MessageBox</span><span class="p">(</span><span class="n">pBuf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="二进制文件和文本文件">二进制文件和文本文件
</h3><p>　　代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CFileView</span><span class="o">::</span><span class="n">OnFileWrite</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">FILE</span> <span class="o">*</span><span class="n">pFile</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;2.txt&#34;</span><span class="p">,</span> <span class="s">&#34;w&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">ch</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;a&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">ch</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;b&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">fwrite</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">fclose</span><span class="p">(</span><span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CFileView</span><span class="o">::</span><span class="n">OnFileRead</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">FILE</span> <span class="o">*</span><span class="n">pFile</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;2.txt&#34;</span><span class="p">,</span><span class="s">&#34;r&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">ch</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="n">fread</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">ch</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">fclose</span><span class="p">(</span><span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">MessageBox</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　效果：
　　
<img src="http://img.blog.csdn.net/20170420225018961?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　文本方式：10实际上是换行符的ASCII码。</p>
<p>　　以文本方式和二进制方式读取文件是有明显的区别的。</p>
<h3 id="文本方式和二进制方式">文本方式和二进制方式
</h3><p>　　二进制方式：换行是由两个字符组成的，即ASCII码10（回车符）和13（换行符）。
　　写入和读取文件时要保持一致。如果采用文本方式写入，应采用文本方式读取；如果采用二进制方式写入数据，在读取时也应采用二进制方式。</p>
<p>　　面试题：给你一个整数，如：98341，将这个整数保存到文件中，要求在以记事本程序打开该文件时，显示的是：98341。
　　法一：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CFileView</span><span class="o">::</span><span class="n">OnFileWrite</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">FILE</span> <span class="o">*</span><span class="n">pFile</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;3.txt&#34;</span><span class="p">,</span> <span class="s">&#34;w&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">ch</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span> <span class="o">+</span> <span class="mi">48</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">48</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">ch</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">48</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">ch</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">48</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">ch</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">48</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">fwrite</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">fclose</span><span class="p">(</span><span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　或</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CFileView</span><span class="o">::</span><span class="n">OnFileWrite</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">FILE</span> <span class="o">*</span><span class="n">pFile</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;3.txt&#34;</span><span class="p">,</span> <span class="s">&#34;w&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">98341</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">ch</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="n">itoa</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ch</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">fwrite</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">fclose</span><span class="p">(</span><span class="n">pFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　面试题：给定一个字符串，其中既有数字字符，又有26个英文字母中的几个字符，让你判断一下哪些是数字字符。</p>
<p>　　对这种问题，实际上就是判断各字符的ASCII码，对于数字字符来说，它们的ASCII码大于等于48，小于等于57。</p>
<h2 id="c对文件操作的支持">C++对文件操作的支持
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CFileView</span><span class="o">::</span><span class="n">OnFileWrite</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">ofstream</span> <span class="nf">ofs</span><span class="p">(</span><span class="s">&#34;4.txt&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">ofs</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#34;http://www.sunxin.org&#34;</span><span class="p">,</span><span class="n">strlen</span><span class="p">(</span><span class="s">&#34;http://www.sunxin.org&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">ofs</span><span class="p">.</span><span class="n">close</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CFileView</span><span class="o">::</span><span class="n">OnFileRead</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">ifstream</span> <span class="nf">ifs</span><span class="p">(</span><span class="s">&#34;4.txt&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">ch</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="n">memset</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">ifs</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">ifs</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">MessageBox</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="win32-api-对文件操作的支持">Win32 API 对文件操作的支持
</h2><h3 id="文件的创建打开和写入">文件的创建、打开和写入
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CFileView</span><span class="o">::</span><span class="n">OnFileWrite</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//定义一个句柄变量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">HANDLE</span> <span class="n">hFile</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//创建文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">hFile</span> <span class="o">=</span> <span class="n">CreateFile</span><span class="p">(</span><span class="s">&#34;5.txt&#34;</span><span class="p">,</span> <span class="n">GENERIC_WRITE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">CREATE_NEW</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">		<span class="n">FILE_ATTRIBUTE_NORMAL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//接收实际写入的字节数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">DWORD</span> <span class="n">dwWrites</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//写入数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">WriteFile</span><span class="p">(</span><span class="n">hFile</span><span class="p">,</span><span class="s">&#34;http://www.sunxin.org&#34;</span><span class="p">,</span><span class="n">strlen</span><span class="p">(</span><span class="s">&#34;http://www.sunxin.org&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="o">&amp;</span><span class="n">dwWrites</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//关闭文件句柄
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CloseHandle</span><span class="p">(</span><span class="n">hFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="文件的读取-1">文件的读取
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CFileView</span><span class="o">::</span><span class="n">OnFileRead</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">HANDLE</span> <span class="n">hFile</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//打开文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">hFile</span> <span class="o">=</span> <span class="n">CreateFile</span><span class="p">(</span><span class="s">&#34;5.txt&#34;</span><span class="p">,</span> <span class="n">GENERIC_READ</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">OPEN_EXISTING</span><span class="p">,</span> <span class="n">FILE_ATTRIBUTE_NORMAL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//接收实际收到的数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">char</span> <span class="n">ch</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//接收实际读取到的字节数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">DWORD</span> <span class="n">dwReads</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//读取数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">ReadFile</span><span class="p">(</span><span class="n">hFile</span><span class="p">,</span> <span class="n">ch</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dwReads</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//设置字符串结束字符
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">ch</span><span class="p">[</span><span class="n">dwReads</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//关闭打开的文件对象的句柄
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CloseHandle</span><span class="p">(</span><span class="n">hFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//显示读取到的数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">MessageBox</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="菜单">菜单
</h1><h2 id="菜单命令响应函数">菜单命令响应函数
</h2><p>　　新建一个单文档的MFC AppWizard(exe)工程，工程名为Menu。Build运行。</p>
<p><img src="http://img.blog.csdn.net/20170420225058617?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
>
　　左上角点击按钮，可以让属性框始终显示，不会因为点击对话框以外的地方就消失。
　　去掉Pop-up弹出前的勾，将ID改为ID_TEST。给Test添加响应函数在CMainFrame中，在函数中加入	MessageBox(&ldquo;MainFrame Clicked&rdquo;);
　　效果：
<img src="http://img.blog.csdn.net/20170420225116851?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h2 id="菜单命令的路由">菜单命令的路由
</h2><h3 id="程序类对菜单命令的响应顺序">程序类对菜单命令的响应顺序
</h3><p>　　响应Test
　　菜单项命令的顺序依次是：视类、文档类、框架类，最后才是应用程序类。</p>
<h3 id="windows消息的分类">Windows消息的分类
</h3><p>　　凡是从CWnd派生的类，它们既可以接收标准消息，也可以接收命令消息和通告消息。而对于那些从CCmdTarget派生的类，则只能接收命令消息和通告消息，不能接收标准消息。
本例中的文档类（CMenuDoc）和应用程序类（CWinApp），因为它们都派生于CCmdTarget类，所以它们可以接收菜单命令消息。但它们不是从CWnd类派生的，所以不能接收标准消息。</p>
<h3 id="菜单命令的路由-1">菜单命令的路由
</h3><p>　　菜单命令消息路由的具体过程：当点击某个菜单项时，最先接收到这个菜单命令消息的是框架类。框架类将把接收到的这个消息交给它的子窗口，即视类，由视类首先进行处理。视类首先根据命令消息映射机制查找自身是否对此消息进行了响应，如果响应了，就调用相应响应函数对这个消息进行处理，消息路由过程结束；如果视类没有对此命令消息做出响应，就交由文档类，文档类同样查找自身是否对这个菜单命令进行了响应，如果响应了，就由文档类的命令消息响应函数进行处理，路由过程结束。如果文档类也未做出响应，就把这个命令消息交还给视类，后者又把该消息交还给框架类。框架类查看自己是否对这个命令消息进行了响应，如果它也没有做出响应，就把这个菜单命令消息交给应用程序类，由后者来进行处理。</p>
<h2 id="基本菜单操作">基本菜单操作
</h2><h3 id="标记菜单">标记菜单
</h3><p>　　运行刚才创建的Menu程序，点击查看，前面都有一个对号，这种类型就是标记菜单。
在CMainFrame类的OnCreate的return语句之前添加这句代码	GetMenu()-&gt;GetSubMenu(0)-&gt;CheckMenuItem(0, MF_BYPOSITION | MF_CHECKED);  或者GetMenu()-&gt;GetSubMenu(0)-&gt;CheckMenuItem(ID_FILE_NEW, MF_BYCOMMAND | MF_CHECKED);<br>
　　Build并运行，可发现新建左边已添加一个复选标记。</p>
<h3 id="默认菜单项">默认菜单项
</h3><p>　　在刚才的代码下，添加	GetMenu()-&gt;GetSubMenu(0)-&gt;SetDefaultItem(1, TRUE); 或者GetMenu()-&gt;GetSubMenu(0)-&gt;SetDefaultItem(ID_FILE_OPEN,  FALSE);  编译运行，会发现“打开”变成了粗体。</p>
<p>　　<strong>注意：“打印”的索引是5，不是4。计算菜单项索引时，一定要把分割栏菜单项计算在内。并且，一个子菜单只能有一个默认菜单项。</strong></p>
<h3 id="图形标记菜单">图形标记菜单
</h3><p>　　Insert-Resource-Bitmap，创建一个位图资源。如图。
<img src="http://img.blog.csdn.net/20170420225150945?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
>
　　为CMainFrame类添加一个CBitmap类型的成员变量：m_bitmap。</p>
<p>　　接着添加代码：
CString str;
str.Format(&ldquo;x=%d&rdquo;,y=%d&quot;, GetSystemMetrics(SM_CXMENUCHECK),GetSystemMetrics(SM_CYMENUCHECK));
MessageBox(str);
m_bitmap.LoadBitmap(IDB_BITMAP1);
GetMenu()-&gt;GetSubMenu(0)-&gt;SetMenuItemBitmaps(0, MF_BYPOSITION, &amp;m_bitmap, &amp;m_bitmap);</p>
<h3 id="禁用菜单项">禁用菜单项
</h3><p>　　通常把MF_GRAYED和MF_DISABLED这两个标志放在一起使用。不过这么做并不是必需的。
　　删除之前的代码，写入	GetMenu()-&gt;GetSubMenu(0)-&gt;EnableMenuItem(1, MF_BYPOSITION | MF_DISABLED | MF_GRAYED);
　　打开“文件”子菜单，发现“打开”菜单栏变灰，点击不起作用。</p>
<h3 id="移除和装载菜单">移除和装载菜单
</h3><p>　　再添加一行代码：	SetMenu(NULL);  此时菜单栏被移除了。
　　再添加几行代码：    
CMenu menu;
menu.LoadMenu(IDR_MAINFRAME);
SetMenu(&amp;menu);
menu.Detach();
　　此时菜单栏又装载了。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl">	<span class="n">CMenu</span> <span class="n">menu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">menu</span><span class="p">.</span><span class="n">CreateMenu</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">GetMenu</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">AppendMenu</span><span class="p">(</span><span class="n">MF_POPUP</span><span class="p">,</span> <span class="p">(</span><span class="n">UINT</span><span class="p">)</span><span class="n">menu</span><span class="p">.</span><span class="n">m_hMenu</span><span class="p">,</span> <span class="s">&#34;Test1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">menu</span><span class="p">.</span><span class="n">AppendMenu</span><span class="p">(</span><span class="n">MF_STRING</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="s">&#34;Hello&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">menu</span><span class="p">.</span><span class="n">AppendMenu</span><span class="p">(</span><span class="n">MF_STRING</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="s">&#34;Bye&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">menu</span><span class="p">.</span><span class="n">AppendMenu</span><span class="p">(</span><span class="n">MF_STRING</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="s">&#34;Mybole&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">menu</span><span class="p">.</span><span class="n">Detach</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CMenu</span> <span class="n">menu1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">menu1</span><span class="p">.</span><span class="n">CreateMenu</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">GetMenu</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">InsertMenu</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">MF_POPUP</span> <span class="o">|</span> <span class="n">MF_BYPOSITION</span><span class="p">,</span> <span class="p">(</span><span class="n">UINT</span><span class="p">)</span><span class="n">menu1</span><span class="p">.</span> <span class="n">m_hMenu</span><span class="p">,</span><span class="s">&#34;Test&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">menu1</span><span class="p">.</span><span class="n">Detach</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">GetMenu</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetSubMenu</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">AppendMenu</span><span class="p">(</span><span class="n">MF_STRING</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="s">&#34;Welcome&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">GetMenu</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetSubMenu</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">AppendMenu</span><span class="p">(</span><span class="n">MF_STRING</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="s">&#34;Welcome&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">GetMenu</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetSubMenu</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">InsertMenu</span><span class="p">(</span><span class="n">ID_FILE_OPEN</span><span class="p">,</span> <span class="n">MF_BYCOMMAND</span> <span class="o">|</span> <span class="n">MF_STRING</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="s">&#34;VC编程&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="mfc菜单命令更新机制">MFC菜单命令更新机制
</h3><p><img src="http://img.blog.csdn.net/20170420225218087?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　MFC命令更新机制：当要显示菜单时，操作系统发出WM_INITMENUPOPOP消息，然后由程序窗口的基类如CFrameWnd接管，它会创建一个CCmdUI对象，并与程序的第一个菜单项相关联，调用该对象的一个成员函数DoUpdate()。这个函数发出CN_UPDATE_COMMAND_UI消息，这条消息带有一个指向CCmdUI对象的指针。这时，系统会判断是否存在一个ON_UPDATE_COMMAND_UI宏去捕获这个菜单项消息。如果找到这样一个宏，就调用相应的消息响应函数进行处理，在这个函数中，可以利用传递过来的CCmdUI对象去调用相应的函数，使该菜单项可以使用，或禁用该菜单项。当更新完第一个菜单项后，同一个CCmdUI对象就设置为与第二个菜单项相关联，依此顺序进行，直到完成所有菜单项的处理。</p>
<p>　　添加代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CMainFrame</span><span class="o">::</span><span class="n">OnUpdateEditCut</span><span class="p">(</span><span class="n">CCmdUI</span><span class="o">*</span> <span class="n">pCmdUI</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Add your command update UI handler code here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">pCmdUI</span><span class="o">-&gt;</span><span class="n">Enable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　编辑-剪切 可用了。
　　如果要把工具栏上的一个工具按钮与菜单栏中的某个菜单项相关联，只要将它们的ID设置为同一个标识就可以了。</p>
<p>　　如果希望禁用文件-新建，为ID_FILE_NEW添加UPDATE_COMMAND_UI消息响应函数。
　　代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CMainFrame</span><span class="o">::</span><span class="n">OnUpdateFileNew</span><span class="p">(</span><span class="n">CCmdUI</span><span class="o">*</span> <span class="n">pCmdUI</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Add your command update UI handler code here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">pCmdUI</span><span class="o">-&gt;</span><span class="n">Enable</span><span class="p">(</span><span class="n">FALSE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CMainFrame</span><span class="o">::</span><span class="n">OnUpdateFileNew</span><span class="p">(</span><span class="n">CCmdUI</span><span class="o">*</span> <span class="n">pCmdUI</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="mi">2</span> <span class="o">==</span> <span class="n">pCmdUI</span><span class="o">-&gt;</span><span class="n">m_nIndex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">pCmdUI</span><span class="o">-&gt;</span><span class="n">Enable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="快捷菜单">快捷菜单
</h3><p>　　1. 新增一个新的菜单资源。点开，顶级菜单设置任意的文本，如abc。添加两个菜单项：
　　显示 IDM_SHOW
　　退出 IDM_EXIT
　　2. 给CMenuView类添加WM_RBUTTONDOWN消息响应函数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CMenu2View</span><span class="o">::</span><span class="n">OnRButtonDown</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CMenu</span> <span class="n">menu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">menu</span><span class="p">.</span><span class="n">LoadMenu</span><span class="p">(</span><span class="n">IDR_MENU1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">CMenu</span><span class="o">*</span> <span class="n">pPopup</span> <span class="o">=</span> <span class="n">menu</span><span class="p">.</span><span class="n">GetSubMenu</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">ClientToScreen</span><span class="p">(</span><span class="o">&amp;</span><span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">pPopup</span><span class="o">-&gt;</span><span class="n">TrackPopupMenu</span><span class="p">(</span><span class="n">TPM_LEFTALIGN</span> <span class="o">|</span> <span class="n">TPM_RIGHTBUTTON</span><span class="p">,</span> <span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnRButtonDown</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　效果：
　　
<img src="http://img.blog.csdn.net/20170420225352728?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
	
></p>
<p>　　3.对“显示”右键ClassWizard，可以取消创建新类的询问。分别为CMainFrame类和CMenuView类添加一个响应。
　　代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CMenu2View</span><span class="o">::</span><span class="n">OnShow</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">MessageBox</span><span class="p">(</span><span class="s">&#34;View show&#34;</span><span class="p">);</span>	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CMainFrame</span><span class="o">::</span><span class="n">OnShow</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">MessageBox</span><span class="p">(</span><span class="s">&#34;Main show&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　结果是显示“View show”。说明只有视类才能对快捷菜单项命令做出响应。若想让CMainView类对此快捷菜单项进行响应的话，修改代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CMenu2View</span><span class="o">::</span><span class="n">OnRButtonDown</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CMenu</span> <span class="n">menu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">menu</span><span class="p">.</span><span class="n">LoadMenu</span><span class="p">(</span><span class="n">IDR_MENU1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">CMenu</span><span class="o">*</span> <span class="n">pPopup</span> <span class="o">=</span> <span class="n">menu</span><span class="p">.</span><span class="n">GetSubMenu</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">ClientToScreen</span><span class="p">(</span><span class="o">&amp;</span><span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//pPopup-&gt;TrackPopupMenu(TPM_LEFTALIGN | TPM_RIGHTBUTTON, point.x, point.y, this);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">pPopup</span><span class="o">-&gt;</span><span class="n">TrackPopupMenu</span><span class="p">(</span><span class="n">TPM_LEFTALIGN</span> <span class="o">|</span> <span class="n">TPM_RIGHTBUTTON</span><span class="p">,</span> <span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">GetParent</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnRButtonDown</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　同时删去视类的显示。</p>
<h2 id="动态菜单操作">动态菜单操作
</h2><h3 id="添加菜单项目">添加菜单项目
</h3><p>　　在CMainFrame类的OnCreate函数中添加代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl">	<span class="n">CMenu</span> <span class="n">menu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">menu</span><span class="p">.</span><span class="n">CreateMenu</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">GetMenu</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">AppendMenu</span><span class="p">(</span><span class="n">MF_POPUP</span><span class="p">,</span> <span class="p">(</span><span class="n">UINT</span><span class="p">)</span><span class="n">menu</span><span class="p">.</span><span class="n">m_hMenu</span><span class="p">,</span> <span class="s">&#34;Test&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">menu</span><span class="p">.</span><span class="n">Detach</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="插入菜单项目">插入菜单项目
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl">	<span class="n">CMenu</span> <span class="n">menu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">menu</span><span class="p">.</span><span class="n">CreateMenu</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="cm">/*GetMenu()-&gt;AppendMenu(MF_POPUP, (UINT)menu.m_hMenu, &#34;Test&#34;);
</span></span></span><span class="line"><span class="cl"><span class="cm">	menu.Detach();*/</span>
</span></span><span class="line"><span class="cl">	<span class="n">GetMenu</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">InsertMenu</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">MF_POPUP</span> <span class="o">|</span> <span class="n">MF_BYPOSITION</span><span class="p">,</span> <span class="p">(</span><span class="n">UINT</span><span class="p">)</span><span class="n">menu</span><span class="p">.</span> <span class="n">m_hMenu</span><span class="p">,</span><span class="s">&#34;Test&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">menu</span><span class="p">.</span><span class="n">Detach</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　如果要在新插入的子菜单中添加菜单项的话，同样可以使用AppendMenu函数来实现。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">CMenu</span> <span class="n">menu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">menu</span><span class="p">.</span><span class="n">CreateMenu</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="cm">/*GetMenu()-&gt;AppendMenu(MF_POPUP, (UINT)menu.m_hMenu, &#34;Test&#34;);
</span></span></span><span class="line"><span class="cl"><span class="cm">	menu.Detach();*/</span>
</span></span><span class="line"><span class="cl">	<span class="n">GetMenu</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">InsertMenu</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">MF_POPUP</span> <span class="o">|</span> <span class="n">MF_BYPOSITION</span><span class="p">,</span> <span class="p">(</span><span class="n">UINT</span><span class="p">)</span><span class="n">menu</span><span class="p">.</span> <span class="n">m_hMenu</span><span class="p">,</span><span class="s">&#34;Test&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">menu</span><span class="p">.</span><span class="n">AppendMenu</span><span class="p">(</span><span class="n">MF_STRING</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="s">&#34;Hello&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">menu</span><span class="p">.</span><span class="n">AppendMenu</span><span class="p">(</span><span class="n">MF_STRING</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="s">&#34;Bye&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">menu</span><span class="p">.</span><span class="n">AppendMenu</span><span class="p">(</span><span class="n">MF_STRING</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="s">&#34;Mybole&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">menu</span><span class="p">.</span><span class="n">Detach</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　111、112、113是随便赋予的ID号。
　　
<img src="http://img.blog.csdn.net/20170420230125731?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　若要在“文件”子菜单下添加一个菜单项Welcome，再添加一行代码：	GetMenu()-&gt;GetSubMenu(0)-&gt;AppendMenu(MF_STRING, 114, &ldquo;Welcome&rdquo;);
　　若要在“文件”中的“新建”和“打开”插入一个菜单项VC编程，再添加一行代码：
GetMenu()-&gt;GetSubMenu(0)-&gt;InsertMenu(ID_FILE_OPEN, MF_BYCOMMAND | MF_STRING, 115， &ldquo;VC编程&rdquo;);</p>
<h3 id="删除菜单">删除菜单
</h3><p>　　删除“编辑”：在CMainFrame类的OnCreate函数最后（return之前）添加：
　　GetMenu()-&gt;DeleteMenu(1, MF_BYPOSITION);
　　删除“文件”下的“打开”：
　　GetMenu()-&gt;GetSubMenu(0)-&gt;DeleteMenu(2, MF_BYPOSITION);</p>
<h3 id="动态添加的菜单项的命令响应">动态添加的菜单项的命令响应
</h3><p>　　Resource.h中添加新ID</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#define IDM_HELLO	111
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>将menu.AppendMenu(MF_STRING, 111, “Hello”); 改为 menu.AppendMenu(MF_STRING, IDM_HELLO, “Hello”);</p>
<p>　　三部曲：
　　1.	点开MainFrm.h，增加为</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="c1">//{{AFX_MSG(CMainFrame)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">afx_msg</span> <span class="kt">int</span> <span class="nf">OnCreate</span><span class="p">(</span><span class="n">LPCREATESTRUCT</span> <span class="n">lpCreateStruct</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">afx_msg</span> <span class="kt">void</span> <span class="nf">OnShow</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//}}AFX_MSG
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">afx_msg</span> <span class="kt">void</span> <span class="nf">OnHello</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">DECLARE_MESSAGE_MAP</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　2. 点开MainFrm.cpp，增加为</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">BEGIN_MESSAGE_MAP</span><span class="p">(</span><span class="n">CMainFrame</span><span class="p">,</span> <span class="n">CFrameWnd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//{{AFX_MSG_MAP(CMainFrame)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">ON_WM_CREATE</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="n">ON_COMMAND</span><span class="p">(</span><span class="n">IDM_SHOW</span><span class="p">,</span> <span class="n">OnShow</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">ON_COMMAND</span><span class="p">(</span><span class="n">IDM_HELLO</span><span class="p">,</span> <span class="n">OnHello</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//}}AFX_MSG_MAP
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">END_MESSAGE_MAP</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　3. CMainFrame类中添加</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CMainFrame</span><span class="o">::</span><span class="n">OnHello</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">MessageBox</span><span class="p">(</span><span class="s">&#34;Hello&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="电话本示例程序">电话本示例程序
</h2><p>　　删除之前写入CMainFrame类的OnCreate函数，留下原始函数。</p>
<h3 id="动态添加子菜单的实现">动态添加子菜单的实现
</h3><p>　　利用ClassWizard添加WM_CHAR消息。在Menu2View.h中添加：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">m_nIndex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">CMenu</span> <span class="n">m_menu</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在Menu2View.cpp里，添加：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">CMenu2View</span><span class="o">::</span><span class="n">CMenu2View</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: add construction code here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">m_nIndex</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="显示输入的字符">显示输入的字符
</h3><h3 id="添加菜单项及其命令响应函数">添加菜单项及其命令响应函数
</h3><p>　　在资源编辑器中打开程序的菜单，在“帮助”后添加一个新菜单abc，添加4个菜单项。名称为1，ID为IDM_PHONE1，以此类推。用ClassWizard为CMenu2View类分别加上这四个菜单项的命令响应函数。
　　修改CMenu2View类的头文件，如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="k">protected</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//{{AFX_MSG(CMenu2View)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">afx_msg</span> <span class="kt">void</span> <span class="n">OnRButtonDown</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">afx_msg</span> <span class="kt">void</span> <span class="nf">OnChar</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nChar</span><span class="p">,</span> <span class="n">UINT</span> <span class="n">nRepCnt</span><span class="p">,</span> <span class="n">UINT</span> <span class="n">nFlags</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">afx_msg</span> <span class="kt">void</span> <span class="nf">OnPhone1</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">afx_msg</span> <span class="kt">void</span> <span class="nf">OnPhone2</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">afx_msg</span> <span class="kt">void</span> <span class="nf">OnPhone3</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">afx_msg</span> <span class="kt">void</span> <span class="nf">OnPhone4</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//}}AFX_MSG
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">DECLARE_MESSAGE_MAP</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>CMenu2View.cpp中，</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl">	<span class="c1">//{{AFX_MSG_MAP(CMenu2View)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">ON_WM_CHAR</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//}}AFX_MSG_MAP
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">ON_COMMAND</span><span class="p">(</span><span class="n">IDM_PHONE1</span><span class="p">,</span> <span class="n">OnPhone1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">ON_COMMAND</span><span class="p">(</span><span class="n">IDM_PHONE2</span><span class="p">,</span> <span class="n">OnPhone2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">ON_COMMAND</span><span class="p">(</span><span class="n">IDM_PHONE3</span><span class="p">,</span> <span class="n">OnPhone3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">ON_COMMAND</span><span class="p">(</span><span class="n">IDM_PHONE4</span><span class="p">,</span> <span class="n">OnPhone4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Standard printing commands
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">ON_COMMAND</span><span class="p">(</span><span class="n">ID_FILE_PRINT</span><span class="p">,</span> <span class="n">CView</span><span class="o">::</span><span class="n">OnFilePrint</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">ON_COMMAND</span><span class="p">(</span><span class="n">ID_FILE_PRINT_DIRECT</span><span class="p">,</span> <span class="n">CView</span><span class="o">::</span><span class="n">OnFilePrint</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">ON_COMMAND</span><span class="p">(</span><span class="n">ID_FILE_PRINT_PREVIEW</span><span class="p">,</span> <span class="n">CView</span><span class="o">::</span><span class="n">OnFilePrintPreview</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">END_MESSAGE_MAP</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CMenu2View</span><span class="o">::</span><span class="n">OnPhone1</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">TextOut</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m_strArray</span><span class="p">.</span><span class="n">GetAt</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CMenu2View</span><span class="o">::</span><span class="n">OnPhone2</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">TextOut</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m_strArray</span><span class="p">.</span><span class="n">GetAt</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CMenu2View</span><span class="o">::</span><span class="n">OnPhone3</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">TextOut</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m_strArray</span><span class="p">.</span><span class="n">GetAt</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CMenu2View</span><span class="o">::</span><span class="n">OnPhone4</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">TextOut</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m_strArray</span><span class="p">.</span><span class="n">GetAt</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="框架类窗口截获菜单命令消息">框架类窗口截获菜单命令消息
</h3><p>　　右键单击CMainFrame，选择Add Virtual Functions-OnCommand，单击Add Handler，再点击Edit Existing。
<img src="http://img.blog.csdn.net/20170420230209594?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
>
　　代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">BOOL</span> <span class="n">CMainFrame</span><span class="o">::</span><span class="n">OnCommand</span><span class="p">(</span><span class="n">WPARAM</span> <span class="n">wParam</span><span class="p">,</span> <span class="n">LPARAM</span> <span class="n">lParam</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">MenuCmdID</span> <span class="o">=</span> <span class="n">LOWORD</span><span class="p">(</span><span class="n">wParam</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">CMenu2View</span> <span class="o">*</span><span class="n">pView</span> <span class="o">=</span> <span class="p">(</span><span class="n">CMenu2View</span> <span class="o">*</span><span class="p">)</span><span class="n">GetActiveView</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">MenuCmdID</span> <span class="o">&gt;=</span> <span class="n">IDM_PHONE1</span> <span class="o">&amp;&amp;</span> <span class="n">MenuCmdID</span> <span class="o">&lt;</span> <span class="n">IDM_PHONE1</span> <span class="o">+</span> <span class="n">pView</span><span class="o">-&gt;</span><span class="n">m_strArray</span><span class="p">.</span><span class="n">GetSize</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//MessageBox(&#34;Test&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="n">pView</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">TextOut</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pView</span><span class="o">-&gt;</span><span class="n">m_strArray</span><span class="p">.</span><span class="n">GetAt</span><span class="p">(</span><span class="n">MenuCmdID</span> <span class="o">-</span> <span class="n">IDM_PHONE1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">CFrameWnd</span><span class="o">::</span><span class="n">OnCommand</span><span class="p">(</span><span class="n">wParam</span><span class="p">,</span> <span class="n">lParam</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　将MainFrm.cpp里添加#include “Menu2View.h” 。
　　将Menu2View.cpp中的#include “Menu2Doc.h”剪切到Menu2View.h文件的前部（#endif // _MSC_VER &gt; 1000下面）。</p>
<p>　　最终代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CMenu2View</span><span class="o">::</span><span class="n">OnChar</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nChar</span><span class="p">,</span> <span class="n">UINT</span> <span class="n">nRepCnt</span><span class="p">,</span> <span class="n">UINT</span> <span class="n">nFlags</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="mh">0x0d</span> <span class="o">==</span> <span class="n">nChar</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="o">++</span><span class="n">m_nIndex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">m_menu</span><span class="p">.</span><span class="n">CreatePopupMenu</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">			<span class="n">GetParent</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetMenu</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">AppendMenu</span><span class="p">(</span><span class="n">MF_POPUP</span><span class="p">,</span> <span class="p">(</span><span class="n">UINT</span><span class="p">)</span><span class="n">m_menu</span><span class="p">.</span><span class="n">m_hMenu</span><span class="p">,</span> <span class="s">&#34;PhoneBook&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="n">GetParent</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">DrawMenuBar</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="n">m_menu</span><span class="p">.</span><span class="n">AppendMenu</span><span class="p">(</span><span class="n">MF_STRING</span><span class="p">,</span> <span class="n">IDM_PHONE1</span> <span class="o">+</span> <span class="n">m_nIndex</span><span class="p">,</span> <span class="n">m_strLine</span><span class="p">.</span><span class="n">Left</span><span class="p">(</span><span class="n">m_strLine</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="sc">&#39; &#39;</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">		<span class="n">m_strArray</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">m_strLine</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">m_strLine</span><span class="p">.</span><span class="n">Empty</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">Invalidate</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">m_strLine</span> <span class="o">+=</span> <span class="n">nChar</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">TextOut</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m_strLine</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnChar</span><span class="p">(</span><span class="n">nChar</span><span class="p">,</span> <span class="n">nRepCnt</span><span class="p">,</span> <span class="n">nFlags</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　效果：
<img src="http://img.blog.csdn.net/20170420230235013?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h1 id="简单绘图">简单绘图
</h1><h2 id="mfc消息映射机制">MFC消息映射机制
</h2><p>　　与消息有关的三处信息：1.头文件XXXX.h中 2.源文件XXXX.cpp中 3.源文件XXXX.cpp的响应函数中</p>
<h2 id="绘制线条">绘制线条
</h2><p>　　对CDrawView右键点击Add Member Variable，变量名称：m_ptOrigin，类型：CPoint，访问权限设置：Private。
　　代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CDrawView</span><span class="o">::</span><span class="n">OnLButtonDown</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">m_ptOrigin</span> <span class="o">=</span> <span class="n">point</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnLButtonDown</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CDrawView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//首先获得窗口的设备描述表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">HDC</span> <span class="n">hdc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">hdc</span> <span class="o">=</span> <span class="o">::</span><span class="n">GetDC</span><span class="p">(</span><span class="n">m_hWnd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//移动到线条的起点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">MoveToEx</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="n">m_ptOrigin</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">m_ptOrigin</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//画线
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">LineTo</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//释放设备描述表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="o">::</span><span class="n">ReleaseDC</span><span class="p">(</span><span class="n">m_hWnd</span><span class="p">,</span> <span class="n">hdc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170420230302938?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h3 id="利用mfc的cdc类实现画线功能">利用MFC的CDC类实现画线功能
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CDrawView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="cm">/*//首先获得窗口的设备描述表
</span></span></span><span class="line"><span class="cl"><span class="cm">	HDC hdc;
</span></span></span><span class="line"><span class="cl"><span class="cm">	hdc = ::GetDC(m_hWnd);
</span></span></span><span class="line"><span class="cl"><span class="cm">	//移动到线条的起点
</span></span></span><span class="line"><span class="cl"><span class="cm">	MoveToEx(hdc, m_ptOrigin.x, m_ptOrigin.y, NULL);
</span></span></span><span class="line"><span class="cl"><span class="cm">	//画线
</span></span></span><span class="line"><span class="cl"><span class="cm">	LineTo(hdc, point.x, point.y);
</span></span></span><span class="line"><span class="cl"><span class="cm">	//释放设备描述表
</span></span></span><span class="line"><span class="cl"><span class="cm">	::ReleaseDC(m_hWnd, hdc);*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CDC</span><span class="o">*</span> <span class="n">pDC</span> <span class="o">=</span> <span class="n">GetDC</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">MoveTo</span><span class="p">(</span><span class="n">m_ptOrigin</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">LineTo</span><span class="p">(</span><span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">ReleaseDC</span><span class="p">(</span><span class="n">pDC</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="利用mfc的cwindowdc类实现画线功能">利用MFC的CWindowDC类实现画线功能
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CDrawView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CWindowDC</span> <span class="nf">dc</span><span class="p">(</span><span class="n">GetParent</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">MoveTo</span><span class="p">(</span><span class="n">m_ptOrigin</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">LineTo</span><span class="p">(</span><span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170420230346873?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h3 id="在桌面窗口中画线">在桌面窗口中画线
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CDrawView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CWindowDC</span> <span class="nf">dc</span><span class="p">(</span><span class="n">GetDesktopWindow</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">MoveTo</span><span class="p">(</span><span class="n">m_ptOrigin</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">LineTo</span><span class="p">(</span><span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170420230404138?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　<strong>注意</strong>：在桌面上画图需要权限（一般写代码时需要避免软件以外的操作）。</p>
<h3 id="绘制彩色线条">绘制彩色线条
</h3><p>　　在程序中，当构造一个GDI对象后，该对象并不会立即生效，必须选入设备描述表，它才会在以后的绘制操作中生效。
一般情况下，在完成绘图操作之后，都要利用SelectObject函数把之前的GDI对象选入设备描述表，以便使其恢复到先前的状态。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CDrawView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CPen</span> <span class="nf">pen</span><span class="p">(</span><span class="n">PS_SOLID</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">CPen</span><span class="o">*</span> <span class="n">pOldPen</span> <span class="o">=</span> <span class="n">dc</span><span class="p">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pen</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">MoveTo</span><span class="p">(</span><span class="n">m_ptOrigin</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">LineTo</span><span class="p">(</span><span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">pOldPen</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　运行的效果是红色线条。</p>
<p>　　改为	CPen pen(PS_DASH, 1, RGB(255, 0, 0));  是虚线。（其中第二个参数需小于等于10）
CPen pen(PS_DOT, 1, RGB(255, 0, 0)); 是点线。</p>
<h2 id="使用画刷绘图">使用画刷绘图
</h2><h3 id="简单画刷">简单画刷
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CDrawView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//创建一个红色画刷
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CBrush</span> <span class="nf">brush</span><span class="p">(</span><span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//创建并获得设备描述表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//利用红色画刷填充鼠标拖拽过程中形成的矩形区域
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">dc</span><span class="p">.</span><span class="n">FillRect</span><span class="p">(</span><span class="n">CRect</span><span class="p">(</span><span class="n">m_ptOrigin</span><span class="p">,</span> <span class="n">point</span><span class="p">),</span><span class="o">&amp;</span><span class="n">brush</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="err">```</span>
</span></span><span class="line"><span class="cl"> <span class="o">!</span><span class="p">[</span><span class="err">这里写图片描述</span><span class="p">](</span><span class="nl">http</span><span class="p">:</span><span class="c1">//img.blog.csdn.net/20170420230440190?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">### 位图画刷
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>　　<span class="n">Insert</span><span class="o">-</span><span class="n">Resource</span><span class="o">-</span><span class="n">Bitmap</span><span class="o">-</span><span class="n">New</span><span class="err">，在这里发挥灵魂画手的天赋吧！</span>
</span></span><span class="line"><span class="cl">　　<span class="err">代码：</span>
</span></span><span class="line"><span class="cl"><span class="err">```</span><span class="n">C</span><span class="o">++</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CDrawView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//创建位图对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CBitmap</span> <span class="n">bitmap</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//加载位图资源
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">bitmap</span><span class="p">.</span><span class="n">LoadBitmap</span><span class="p">(</span><span class="n">IDB_BITMAP1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//创建位图画刷
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CBrush</span> <span class="nf">brush</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bitmap</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//创建并获得设备描述表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//利用位图画刷填充鼠标拖拽过程中形成的矩形区域
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">dc</span><span class="p">.</span><span class="n">FillRect</span><span class="p">(</span><span class="n">CRect</span><span class="p">(</span><span class="n">m_ptOrigin</span><span class="p">,</span> <span class="n">point</span><span class="p">),</span><span class="o">&amp;</span><span class="n">brush</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170420230503092?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
>
　　我画的是不是很滑稽（手动滑稽）</p>
<h3 id="透明画刷">透明画刷
</h3><p>　　先进行一种尝试：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CDrawView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//创建并获得设备描述表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//绘制一个矩形
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">dc</span><span class="p">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">CRect</span><span class="p">(</span><span class="n">m_ptOrigin</span><span class="p">,</span><span class="n">point</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170420230521295?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
>
　　如果希望矩形内部是透明的，能够看到被遮挡的图形，就要创建一个透明画刷。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CDrawView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//创建并获得设备描述表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//创建一个空画刷
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CBrush</span> <span class="o">*</span><span class="n">pBrush</span> <span class="o">=</span> <span class="n">CBrush</span><span class="o">::</span><span class="n">FromHandle</span><span class="p">((</span><span class="n">HBRUSH</span><span class="p">)</span><span class="n">GetStockObject</span><span class="p">(</span><span class="n">NULL_BRUSH</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//将空画刷选入设备描述表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CBrush</span> <span class="o">*</span><span class="n">pOldBrush</span> <span class="o">=</span> <span class="n">dc</span><span class="p">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">pBrush</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//绘制一个矩形
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">dc</span><span class="p">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">CRect</span><span class="p">(</span><span class="n">m_ptOrigin</span><span class="p">,</span> <span class="n">point</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//恢复先前的画刷
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">dc</span><span class="p">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">pOldBrush</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170420230550253?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h2 id="绘制连续线条">绘制连续线条
</h2><p>　　首先为视类增加鼠标移动消息（WM_MOUSEMOVE）的响应函数（默认OnMouseMove），并为视类添加一个BOOL型的私有成员变量m_bDraw。
在视类头文件定义：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl">　<span class="nl">Private</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">　<span class="n">BOOL</span> <span class="n">m_bDraw</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">　<span class="err">```</span>
</span></span><span class="line"><span class="cl"><span class="err">在视类的构造函数中：</span>	
</span></span><span class="line"><span class="cl"><span class="err">```</span><span class="n">C</span><span class="o">++</span>
</span></span><span class="line"><span class="cl"><span class="n">m_bDraw</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在OnLButtonDown中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">m_bDraw</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在OnLButtonUp中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">m_bDraw</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CDrawView</span><span class="o">::</span><span class="n">OnMouseMove</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="n">m_bDraw</span> <span class="o">==</span> <span class="n">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">MoveTo</span><span class="p">(</span><span class="n">m_ptOrigin</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">LineTo</span><span class="p">(</span><span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//修改线段的起点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">m_ptOrigin</span> <span class="o">=</span> <span class="n">point</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnMouseMove</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170420230616957?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>给线条换色：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CDrawView</span><span class="o">::</span><span class="n">OnMouseMove</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//创建一个红色的、宽度为1的实线画笔
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">CPen</span> <span class="nf">pen</span><span class="p">(</span><span class="n">PS_SOLID</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//把创建的画笔选入设备描述表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">CPen</span> <span class="o">*</span><span class="n">pOldPen</span> <span class="o">=</span> <span class="n">dc</span><span class="p">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pen</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">m_bDraw</span> <span class="o">==</span> <span class="n">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">MoveTo</span><span class="p">(</span><span class="n">m_ptOrigin</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">LineTo</span><span class="p">(</span><span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//修改线段的起点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">m_ptOrigin</span> <span class="o">=</span> <span class="n">point</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//恢复设备描述表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">dc</span><span class="p">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">pOldPen</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnMouseMove</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="绘制扇形效果的线条">绘制扇形效果的线条
</h2><p>　　去掉上述代码中的 	m_ptOrigin = point;</p>
<p>　　效果：
　　<img src="http://img.blog.csdn.net/20170420230636254?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　绘制一个带边线的扇形：
　　为CDrawView类增加一个CPoint类型的私有成员变量m_ptOld，用来保存鼠标上一个移动点。</p>
<p>　　在OnLButton中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">m_ptOld</span> <span class="o">=</span> <span class="n">point</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　在OnMouseMove中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CDrawView</span><span class="o">::</span><span class="n">OnMouseMove</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//创建一个红色的、宽度为1的实线画笔
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">CPen</span> <span class="nf">pen</span><span class="p">(</span><span class="n">PS_SOLID</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//把创建的画笔选入设备描述表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">CPen</span> <span class="o">*</span><span class="n">pOldPen</span> <span class="o">=</span> <span class="n">dc</span><span class="p">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pen</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">m_bDraw</span> <span class="o">==</span> <span class="n">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">MoveTo</span><span class="p">(</span><span class="n">m_ptOrigin</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">LineTo</span><span class="p">(</span><span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">LineTo</span><span class="p">(</span><span class="n">m_ptOld</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//修改线段的起点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">//m_ptOrigin = point;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">m_ptOld</span> <span class="o">=</span> <span class="n">point</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//恢复设备描述表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">dc</span><span class="p">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">pOldPen</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnMouseMove</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　最好将OnLButtonUp里原来写的代码删除或注释之。
　　效果：
<img src="http://img.blog.csdn.net/20170420230656311?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　MFC提供一个设置绘图模式的函数SetROP2，带有一个参数R2_BLACK、R2_WHITE、R2_MERGENOTPEN等。
　　例如，在CClientDC dc(this); 下方添加代码： 	dc.SetROP2(R2_MERGENOTPEN);  编译运行后看不到绘制的线条，这就是设置了R2_MERGENOTPEN这种绘图模式。
使用R2_BLACK，将会发现绘制的线条颜色始终都是黑色的。</p>
<h1 id="文本编程">文本编程
</h1><h2 id="插入符">插入符
</h2><h3 id="创建文本插入符">创建文本插入符
</h3><p>　　创建一个单文档类型的MFC AppWizard(exe)工程，取名为Text。
为CTextView类添加WM_CREATE消息的响应函数OnCreate，在此函数中创建一个宽度为20、高度为100的插入符。代码如下。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">CTextView</span><span class="o">::</span><span class="n">OnCreate</span><span class="p">(</span><span class="n">LPCREATESTRUCT</span> <span class="n">lpCreateStruct</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">CView</span><span class="o">::</span><span class="n">OnCreate</span><span class="p">(</span><span class="n">lpCreateStruct</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">CreateSolidCaret</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">ShowCaret</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170420230721832?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　让插入符适应于当前字体的大小：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">CTextView</span><span class="o">::</span><span class="n">OnCreate</span><span class="p">(</span><span class="n">LPCREATESTRUCT</span> <span class="n">lpCreateStruct</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">CView</span><span class="o">::</span><span class="n">OnCreate</span><span class="p">(</span><span class="n">lpCreateStruct</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1">//创建设备描述表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//定义文本信息结构体变量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">TEXTMETRIC</span> <span class="n">tm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//获得设备描述表中的文本信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">dc</span><span class="p">.</span><span class="n">GetTextMetrics</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tm</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//根据字体大小，创建何时的插入符（除以8是经验值）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CreateSolidCaret</span><span class="p">(</span><span class="n">tm</span><span class="p">.</span><span class="n">tmAveCharWidth</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span> <span class="n">tm</span><span class="p">.</span><span class="n">tmHeight</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//显示插入符
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">ShowCaret</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　运行结果就比较符合常规了。</p>
<h3 id="创建图形插入符">创建图形插入符
</h3><p>　　新建一个位图资源，画一个图形。
在TextView.h中添加</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">CBitmap</span> <span class="n">bitmap</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">CTextView</span><span class="o">::</span><span class="n">OnCreate</span><span class="p">(</span><span class="n">LPCREATESTRUCT</span> <span class="n">lpCreateStruct</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">CView</span><span class="o">::</span><span class="n">OnCreate</span><span class="p">(</span><span class="n">lpCreateStruct</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">bitmap</span><span class="p">.</span><span class="n">LoadBitmap</span><span class="p">(</span><span class="n">IDB_BITMAP1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">CreateCaret</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bitmap</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">ShowCaret</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170420230741630?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h2 id="窗口重绘">窗口重绘
</h2><h3 id="ondraw函数">OnDraw函数
</h3><p>　　实现在程序窗口中输出一串文字的功能。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTextView</span><span class="o">::</span><span class="n">OnDraw</span><span class="p">(</span><span class="n">CDC</span><span class="o">*</span> <span class="n">pDC</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CTextDoc</span><span class="o">*</span> <span class="n">pDoc</span> <span class="o">=</span> <span class="n">GetDocument</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">ASSERT_VALID</span><span class="p">(</span><span class="n">pDoc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CString</span> <span class="nf">str</span><span class="p">(</span><span class="s">&#34;VC++ 深入编程&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">TextOut</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170420230758895?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h3 id="添加字符串资源">添加字符串资源
</h3><p>　　点击Resource View-String Table选项，在此字符串表最底部的空行上双击，即可弹出添加新字符串资源的对话框。ID：IDS_STRINGVC，Caption：“VC++编程 文本编程”。代码如下。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTextView</span><span class="o">::</span><span class="n">OnDraw</span><span class="p">(</span><span class="n">CDC</span><span class="o">*</span> <span class="n">pDC</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CTextDoc</span><span class="o">*</span> <span class="n">pDoc</span> <span class="o">=</span> <span class="n">GetDocument</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">ASSERT_VALID</span><span class="p">(</span><span class="n">pDoc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//CString str(&#34;VC++ 深入编程&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CString</span> <span class="n">str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">str</span> <span class="o">=</span> <span class="s">&#34;VC++ 深入编程&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">TextOut</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">str</span><span class="p">.</span><span class="n">LoadString</span><span class="p">(</span><span class="n">IDS_STRINGVC</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">TextOut</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170420230814077?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h3 id="路径">路径
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTextView</span><span class="o">::</span><span class="n">OnDraw</span><span class="p">(</span><span class="n">CDC</span><span class="o">*</span> <span class="n">pDC</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CTextDoc</span><span class="o">*</span> <span class="n">pDoc</span> <span class="o">=</span> <span class="n">GetDocument</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">ASSERT_VALID</span><span class="p">(</span><span class="n">pDoc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//CString str(&#34;VC++ 深入编程&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CString</span> <span class="n">str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">str</span> <span class="o">=</span> <span class="s">&#34;VC++ 深入编程&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">TextOut</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CSize</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">pDC</span><span class="o">-&gt;</span><span class="n">GetTextExtent</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">str</span><span class="p">.</span><span class="n">LoadString</span><span class="p">(</span><span class="n">IDS_STRINGVC</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">TextOut</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">BeginPath</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">Rectangle</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="o">+</span><span class="n">sz</span><span class="p">.</span><span class="n">cx</span><span class="p">,</span> <span class="mi">50</span><span class="o">+</span><span class="n">sz</span><span class="p">.</span><span class="n">cy</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">EndPath</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">300</span><span class="p">;</span> <span class="n">i</span><span class="o">+=</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">MoveTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">LineTo</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">MoveTo</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">LineTo</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">300</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170420230830380?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTextView</span><span class="o">::</span><span class="n">OnDraw</span><span class="p">(</span><span class="n">CDC</span><span class="o">*</span> <span class="n">pDC</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CTextDoc</span><span class="o">*</span> <span class="n">pDoc</span> <span class="o">=</span> <span class="n">GetDocument</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">ASSERT_VALID</span><span class="p">(</span><span class="n">pDoc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//CString str(&#34;VC++ 深入编程&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CString</span> <span class="n">str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">str</span> <span class="o">=</span> <span class="s">&#34;VC++ 深入编程&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">TextOut</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CSize</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">pDC</span><span class="o">-&gt;</span><span class="n">GetTextExtent</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">str</span><span class="p">.</span><span class="n">LoadString</span><span class="p">(</span><span class="n">IDS_STRINGVC</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">TextOut</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">BeginPath</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">Rectangle</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="o">+</span><span class="n">sz</span><span class="p">.</span><span class="n">cx</span><span class="p">,</span> <span class="mi">50</span><span class="o">+</span><span class="n">sz</span><span class="p">.</span><span class="n">cy</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">EndPath</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">SelectClipPath</span><span class="p">(</span><span class="n">RGN_DIFF</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">300</span><span class="p">;</span> <span class="n">i</span><span class="o">+=</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">MoveTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">LineTo</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">MoveTo</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">LineTo</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">300</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170420230849318?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
>
　　这正是RGN_DIFF模式的效果。
　　如果是RGN_AND，效果是新的裁剪区域是当前裁剪区域和当前路径层的交集。</p>
<p>　　路径层的作用：实现特殊效果。如，希望整幅图形中某一部分与其他部分有所区别，就可以把这部分的图形设置到一个路径层中，然后利用SelectClipPath函数设置一种模式，让路径层和裁剪区域进行互操作以达到一种特殊效果。</p>
<h2 id="字符输入">字符输入
</h2><p>　　当用户在键盘上按下某个字符按键后，要把该字符输出到程序窗口上。
首先让CTextView捕获WM_CHAR消息，接着为该类定义一个CString类型的成员变量：m_strLine，并在CTextView类的构造函数中将这个变量初始化：m_strLine = “”;</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTextView</span><span class="o">::</span><span class="n">OnLButtonDown</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">SetCaretPos</span><span class="p">(</span><span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnLButtonDown</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170420230906115?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
>
　　为CTextView类再增加一个CPoint类型的成员变量，取名m_ptOrigin，权限为私有。在CTextView类的构造函数中设置其初值为0。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTextView</span><span class="o">::</span><span class="n">OnLButtonDown</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">SetCaretPos</span><span class="p">(</span><span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">m_strLine</span><span class="p">.</span><span class="n">Empty</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">m_ptOrigin</span> <span class="o">=</span> <span class="n">point</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnLButtonDown</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　<strong>注意：回车字符的ASCII码十六进制是0x0d，退格键的ASCII码十六进制值是0x08。</strong></p>
<p>　　最终代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTextView</span><span class="o">::</span><span class="n">OnChar</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nChar</span><span class="p">,</span> <span class="n">UINT</span> <span class="n">nRepCnt</span><span class="p">,</span> <span class="n">UINT</span> <span class="n">nFlags</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">TEXTMETRIC</span> <span class="n">tm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">GetTextMetrics</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tm</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="mh">0x0d</span> <span class="o">==</span> <span class="n">nChar</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">m_strLine</span><span class="p">.</span><span class="n">Empty</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">m_ptOrigin</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">tm</span><span class="p">.</span><span class="n">tmHeight</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="mh">0x08</span> <span class="o">==</span> <span class="n">nChar</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">COLORREF</span> <span class="n">clr</span> <span class="o">=</span> <span class="n">dc</span><span class="p">.</span><span class="n">SetTextColor</span><span class="p">(</span><span class="n">dc</span><span class="p">.</span><span class="n">GetBkColor</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">TextOut</span><span class="p">(</span><span class="n">m_ptOrigin</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">m_ptOrigin</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">m_strLine</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">m_strLine</span> <span class="o">=</span> <span class="n">m_strLine</span><span class="p">.</span><span class="n">Left</span><span class="p">(</span><span class="n">m_strLine</span><span class="p">.</span><span class="n">GetLength</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">SetTextColor</span><span class="p">(</span><span class="n">clr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">m_strLine</span> <span class="o">+=</span> <span class="n">nChar</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">CSize</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">dc</span><span class="p">.</span><span class="n">GetTextExtent</span><span class="p">(</span><span class="n">m_strLine</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">CPoint</span> <span class="n">pt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pt</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">m_ptOrigin</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">sz</span><span class="p">.</span><span class="n">cx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pt</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">m_ptOrigin</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">SetCaretPos</span><span class="p">(</span><span class="n">pt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">TextOut</span><span class="p">(</span><span class="n">m_ptOrigin</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">m_ptOrigin</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">m_strLine</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnChar</span><span class="p">(</span><span class="n">nChar</span><span class="p">,</span> <span class="n">nRepCnt</span><span class="p">,</span> <span class="n">nFlags</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170420230925890?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h3 id="设置字体">设置字体
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTextView</span><span class="o">::</span><span class="n">OnChar</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nChar</span><span class="p">,</span> <span class="n">UINT</span> <span class="n">nRepCnt</span><span class="p">,</span> <span class="n">UINT</span> <span class="n">nFlags</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">CFont</span> <span class="n">font</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">font</span><span class="p">.</span><span class="n">CreatePointFont</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="s">&#34;华文行楷&#34;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">CFont</span> <span class="o">*</span><span class="n">pOldFont</span> <span class="o">=</span> <span class="n">dc</span><span class="p">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="o">&amp;</span><span class="n">font</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="err">……</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">pOldFont</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnChar</span><span class="p">(</span><span class="n">nChar</span><span class="p">,</span> <span class="n">nRepCnt</span><span class="p">,</span> <span class="n">nFlags</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170420230949366?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h3 id="字幕变色功能的实现">字幕变色功能的实现
</h3><p>　　在这个Text例子中，我们在视类的OnCreate 函数中设置定时器，设置一个时间间隔为100ms，标识为1的定时器。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">CTextView</span><span class="o">::</span><span class="n">OnCreate</span><span class="p">(</span><span class="n">LPCREATESTRUCT</span> <span class="n">lpCreateStruct</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="err">……</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">SetTimer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　给CTextView类添加WM_TIMER消息的响应函数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTextView</span><span class="o">::</span><span class="n">OnTimer</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nIDEvent</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">m_nWidth</span> <span class="o">+=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">TEXTMETRIC</span> <span class="n">tm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">GetTextMetrics</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tm</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">CRect</span> <span class="n">rect</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">rect</span><span class="p">.</span><span class="n">left</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">rect</span><span class="p">.</span><span class="n">top</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">rect</span><span class="p">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">m_nWidth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">rect</span><span class="p">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">rect</span><span class="p">.</span><span class="n">top</span> <span class="o">+</span> <span class="n">tm</span><span class="p">.</span><span class="n">tmHeight</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">SetTextColor</span><span class="p">(</span><span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">CString</span> <span class="n">str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">str</span><span class="p">.</span><span class="n">LoadString</span><span class="p">(</span><span class="n">IDS_STRINGVC</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">DrawText</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">DT_LEFT</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">rect</span><span class="p">.</span><span class="n">top</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">rect</span><span class="p">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">rect</span><span class="p">.</span><span class="n">top</span> <span class="o">+</span> <span class="n">tm</span><span class="p">.</span><span class="n">tmHeight</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">DrawText</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">DT_RIGHT</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">CSize</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">dc</span><span class="p">.</span><span class="n">GetTextExtent</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">m_nWidth</span> <span class="o">&gt;</span> <span class="n">sz</span><span class="p">.</span><span class="n">cx</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">m_nWidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">SetTextColor</span><span class="p">(</span><span class="n">RGB</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">TextOut</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnTimer</span><span class="p">(</span><span class="n">nIDEvent</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　红色渐变效果可看到。
<img src="http://img.blog.csdn.net/20170420231009906?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h1 id="绘图控制">绘图控制
</h1><h2 id="简单绘图-1">简单绘图
</h2><p>　　新建一个单文档类型的MFC AppWizard(exe)工程，取名：Graphic。
　　添加的菜单项：
<img src="http://img.blog.csdn.net/20170420231023694?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
>
　　给CGraphicView类中添加一个私有变量：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">UINT</span> <span class="n">m_nDrawType</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　在视类构造函数中将此变量初始化为0。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CGraphicView</span><span class="o">::</span><span class="n">OnDot</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">m_nDrawType</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CGraphicView</span><span class="o">::</span><span class="n">OnLine</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">m_nDrawType</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CGraphicView</span><span class="o">::</span><span class="n">OnRectangle</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">m_nDrawType</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CGraphicView</span><span class="o">::</span><span class="n">OnEllipse</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">m_nDrawType</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　CGraphicView类再增加一个CPoint类型的私有成员变量：m_ptOrigin。在CGraphicView类构造函数中，将该变量的值设置为0。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CGraphicView</span><span class="o">::</span><span class="n">OnLButtonDown</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">m_ptOrigin</span> <span class="o">=</span> <span class="n">point</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnLButtonDown</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CGraphicView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//为边框设定颜色
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CPen</span> <span class="nf">pen</span><span class="p">(</span><span class="n">PS_SOLID</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pen</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//能看到图形内部内容(透明)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CBrush</span> <span class="o">*</span><span class="n">pBrush</span> <span class="o">=</span> <span class="n">CBrush</span><span class="o">::</span><span class="n">FromHandle</span><span class="p">((</span><span class="n">HBRUSH</span><span class="p">)</span><span class="n">GetStockObject</span><span class="p">(</span><span class="n">NULL_BRUSH</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">pBrush</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">switch</span><span class="p">(</span><span class="n">m_nDrawType</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">SetPixel</span><span class="p">(</span><span class="n">point</span><span class="p">,</span><span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">MoveTo</span><span class="p">(</span><span class="n">m_ptOrigin</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">LineTo</span><span class="p">(</span><span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">CRect</span><span class="p">(</span><span class="n">m_ptOrigin</span><span class="p">,</span><span class="n">point</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">Ellipse</span><span class="p">(</span><span class="n">CRect</span><span class="p">(</span><span class="n">m_ptOrigin</span><span class="p">,</span> <span class="n">point</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170420231045554?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h2 id="设置对话框">设置对话框
</h2><p>　　再增加一个对话框资源，ID为IDD_DLG_SETTING，Caption为Setting，Font为宋体。</p>
<h3 id="设置线宽">设置线宽
</h3><p>　　添加一个静态文本框，并将Caption设为“线宽”。再添加一个编辑框，ID：IDC_LINE_WIDTH。为此对话框资源创建一个响应的对话框类，类名为CSettingDlg。对编辑框右键，ClassWizard，为它添加一个成员变量：m_nLineWidth，类型为UINT。为绘图菜单下再增加一个菜单项为“设置”，ID为IDM_SETTING。为此菜单项添加一个命令响应，选择视类做出响应。为CGraphicView类添加一个私有成员变量：m_nLineWidth，类型：UINT，并在CGraphicView类的构造函数初始化为0。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CGraphicView</span><span class="o">::</span><span class="n">OnSetting</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CSettingDlg</span> <span class="n">dlg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">dlg</span><span class="p">.</span><span class="n">m_nLineWidth</span> <span class="o">=</span> <span class="n">m_nLineWidth</span><span class="p">;</span> <span class="c1">//将保存的用户先前设置的线宽再传回给该设置对话框
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span><span class="p">(</span><span class="n">IDOK</span> <span class="o">==</span> <span class="n">dlg</span><span class="p">.</span><span class="n">DoModal</span><span class="p">())</span><span class="c1">//点击OK才保持线宽值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">m_nLineWidth</span> <span class="o">=</span> <span class="n">dlg</span><span class="p">.</span><span class="n">m_nLineWidth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　在源文件前部添加：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">Include</span> <span class="err">“</span><span class="n">SettingDlg</span><span class="p">.</span><span class="n">h</span><span class="err">”</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　修改OnLButtonUp函数：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CGraphicView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//为边框设定颜色(m_nLineWidth定义线宽)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CPen</span> <span class="nf">pen</span><span class="p">(</span><span class="n">PS_SOLID</span><span class="p">,</span> <span class="n">m_nLineWidth</span><span class="p">,</span> <span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="err">……</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="设置线型">设置线型
</h3><p>　　为对话框资源添加一个组框，Caption设为线型。ID为IDC_LINE_STYLE。在组框内放三个单选按钮，ID不变，名称分别为：实线、虚线、点线（不要改变顺序）。在第一个单选按钮上右键，属性勾上Group，使三个按钮成为一组。再为CGraphicView类添加一个Int类型的私有成员变量m_nLineStyle，在构造函数中初始化为0。
　　由于WINGDI.h定义了一些符号常量，（可以在PS_SOLID右键，Go To Definition Of PS_SOLID），刚好PS_SOLID（实线）值本身就是0；PS_DASH（虚线）是1；PS_DOT（点线）是2。所以此处的排列是故意为之。
<img src="http://img.blog.csdn.net/20170424215210507?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
>
<img src="http://img.blog.csdn.net/20170424215239306?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　<strong>注意：若要画出虚线和点线，线宽只能为0或1。</strong></p>
<h2 id="颜色对话框">颜色对话框
</h2><p>　　在绘图下增加一个子菜单，ID为IDM_COLOR，Caption为颜色。为其在视类增加一个命令响应，代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CGraphicView</span><span class="o">::</span><span class="n">OnColor</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CColorDialog</span> <span class="n">dlg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">dlg</span><span class="p">.</span><span class="n">m_cc</span><span class="p">.</span><span class="n">Flags</span> <span class="o">|=</span> <span class="n">CC_RGBINIT</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">dlg</span><span class="p">.</span><span class="n">m_cc</span><span class="p">.</span><span class="n">rgbResult</span> <span class="o">=</span> <span class="n">m_clr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">IDOK</span> <span class="o">==</span> <span class="n">dlg</span><span class="p">.</span><span class="n">DoModal</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">m_clr</span> <span class="o">=</span> <span class="n">dlg</span><span class="p">.</span><span class="n">m_cc</span><span class="p">.</span><span class="n">rgbResult</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//dlg.m_cc.Flags |= CC_RGBINIT | CC_FULLOPEN;//让颜色对话框完全展开
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　为CGraphicView类再增加一个COLORREF类型的私有成员变量：m_clr，并在构造函数中初始化为红色：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">m_clr</span> <span class="o">=</span> <span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　修改该函数两处位置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CGraphicView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nFlags</span><span class="p">,</span> <span class="n">CPoint</span> <span class="n">point</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CClientDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//为边框设定颜色(m_nLineStyle定义线型，m_nLineWidth定义线宽，m_clr定义颜色)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CPen</span> <span class="nf">pen</span><span class="p">(</span><span class="n">m_nLineStyle</span><span class="p">,</span> <span class="n">m_nLineWidth</span><span class="p">,</span> <span class="n">m_clr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pen</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//能看到图形内部内容(透明)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CBrush</span> <span class="o">*</span><span class="n">pBrush</span> <span class="o">=</span> <span class="n">CBrush</span><span class="o">::</span><span class="n">FromHandle</span><span class="p">((</span><span class="n">HBRUSH</span><span class="p">)</span><span class="n">GetStockObject</span><span class="p">(</span><span class="n">NULL_BRUSH</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">pBrush</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">switch</span><span class="p">(</span><span class="n">m_nDrawType</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">SetPixel</span><span class="p">(</span><span class="n">point</span><span class="p">,</span><span class="n">m_clr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">MoveTo</span><span class="p">(</span><span class="n">m_ptOrigin</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">LineTo</span><span class="p">(</span><span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">CRect</span><span class="p">(</span><span class="n">m_ptOrigin</span><span class="p">,</span><span class="n">point</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">dc</span><span class="p">.</span><span class="n">Ellipse</span><span class="p">(</span><span class="n">CRect</span><span class="p">(</span><span class="n">m_ptOrigin</span><span class="p">,</span> <span class="n">point</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">CView</span><span class="o">::</span><span class="n">OnLButtonUp</span><span class="p">(</span><span class="n">nFlags</span><span class="p">,</span> <span class="n">point</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170424215308947?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　注意：//dlg.m_cc.Flags |= CC_RGBINIT | CC_FULLOPEN;//让颜色对话框完全展开
这句我没能实现展开效果。</p>
<h2 id="字体对话框">字体对话框
</h2><p>　　增加一个菜单，ID为IDM_FONT，Caption为字体。在视类增加命令响应，代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CGraphicView</span><span class="o">::</span><span class="n">OnFont</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CFontDialog</span> <span class="n">dlg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">IDOK</span> <span class="o">==</span> <span class="n">dlg</span><span class="p">.</span><span class="n">DoModal</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">m_font</span><span class="p">.</span><span class="n">m_hObject</span><span class="p">)</span> <span class="c1">//m_font对象是否已经与某字体资源相关联
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">m_font</span><span class="p">.</span><span class="n">DeleteObject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">m_font</span><span class="p">.</span><span class="n">CreateFontIndirect</span><span class="p">(</span><span class="n">dlg</span><span class="p">.</span><span class="n">m_cf</span><span class="p">.</span><span class="n">lpLogFont</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">m_strFontName</span> <span class="o">=</span> <span class="n">dlg</span><span class="p">.</span><span class="n">m_cf</span><span class="p">.</span><span class="n">lpLogFont</span><span class="o">-&gt;</span><span class="n">lfFaceName</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CGraphicView</span><span class="o">::</span><span class="n">OnDraw</span><span class="p">(</span><span class="n">CDC</span><span class="o">*</span> <span class="n">pDC</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CGraphicDoc</span><span class="o">*</span> <span class="n">pDoc</span> <span class="o">=</span> <span class="n">GetDocument</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">ASSERT_VALID</span><span class="p">(</span><span class="n">pDoc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: add draw code for native data here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CFont</span> <span class="o">*</span><span class="n">pOldFont</span> <span class="o">=</span> <span class="n">pDC</span><span class="o">-&gt;</span><span class="n">SelectObject</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m_font</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">TextOut</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m_strFontName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">pOldFont</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="示例对话框">示例对话框
</h2><p>　　在对话框中增加一个组框，Caption:示例，ID：IDC_SAMPLE。为CSettingDlg类添加编辑框控件的EN_CHANCE响应函数，对三个单选按钮都选择BN_CLICKED消息。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CSettingDlg</span><span class="o">::</span><span class="n">OnRadio1</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Add your control notification handler code here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Invalidate</span><span class="p">();</span>	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CSettingDlg</span><span class="o">::</span><span class="n">OnRadio2</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Add your control notification handler code here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Invalidate</span><span class="p">();</span>	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CSettingDlg</span><span class="o">::</span><span class="n">OnRadio3</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Add your control notification handler code here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Invalidate</span><span class="p">();</span>	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CSettingDlg</span><span class="o">::</span><span class="n">OnPaint</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CPaintDC</span> <span class="nf">dc</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// device context for painting
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Add your message handler code here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">UpdateData</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">CPen</span> <span class="nf">pen</span><span class="p">(</span><span class="n">m_nLineStyle</span><span class="p">,</span> <span class="n">m_nLineWidth</span><span class="p">,</span> <span class="n">m_clr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pen</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CRect</span> <span class="n">rect</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">GetDlgItem</span><span class="p">(</span><span class="n">IDC_SAMPLE</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetWindowRect</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rect</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">ScreenToClient</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rect</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">MoveTo</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">left</span><span class="o">+</span><span class="mi">20</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">top</span><span class="o">+</span><span class="n">rect</span><span class="p">.</span><span class="n">Height</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">dc</span><span class="p">.</span><span class="n">LineTo</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">right</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">top</span><span class="o">+</span><span class="n">rect</span><span class="p">.</span><span class="n">Height</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Do not call CDialog::OnPaint() for painting messages
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170424215335853?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　现在可以实时修改了。</p>
<h2 id="106-改变对话框和控件的背景及文本颜色">10.6 改变对话框和控件的背景及文本颜色
</h2><h3 id="改变整个对话框及其子控件的背景色">改变整个对话框及其子控件的背景色
</h3><p>　　为CSettingDlg类添加WM_CTLCOLOR消息，并定义一个CBrush类型的私有成员变量：m_brush，并在构造函数中初始化一个蓝色画刷：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">m_brush</span><span class="p">.</span><span class="n">CreateSolidBrush</span> <span class="p">(</span><span class="n">RGB</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">HBRUSH</span> <span class="n">CSettingDlg</span><span class="o">::</span><span class="n">OnCtlColor</span><span class="p">(</span><span class="n">CDC</span><span class="o">*</span> <span class="n">pDC</span><span class="p">,</span> <span class="n">CWnd</span><span class="o">*</span> <span class="n">pWnd</span><span class="p">,</span> <span class="n">UINT</span> <span class="n">nCtlColor</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">HBRUSH</span> <span class="n">hbr</span> <span class="o">=</span> <span class="n">CDialog</span><span class="o">::</span><span class="n">OnCtlColor</span><span class="p">(</span><span class="n">pDC</span><span class="p">,</span> <span class="n">pWnd</span><span class="p">,</span> <span class="n">nCtlColor</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Change any attributes of the DC here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Return a different brush if the default is not desired
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//return hbr;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">return</span> <span class="n">m_brush</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170424215356165?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h3 id="仅改变某个子控件的背景及文本颜色">仅改变某个子控件的背景及文本颜色
</h3><h1 id="图形的保存和重绘">图形的保存和重绘
</h1><h2 id="坐标空间和转换">坐标空间和转换
</h2><h3 id="坐标空间">坐标空间
</h3><p>　　Win32应用程序编程接口（API）使用四种坐标空间：世界坐标系空间、页面空间、设备空间和物理设备空间。Win32 API把世界坐标系空间和页面空间称为逻辑空间。</p>
<h3 id="转换">转换
</h3><p>　　转换是把对象从一个坐标空间复制到另一个坐标空间时改变（或转变）这一对象的大小、方位和形态。</p>
<h2 id="图形的保存和重绘-1">图形的保存和重绘
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">HBRUSH</span> <span class="n">CSettingDlg</span><span class="o">::</span><span class="n">OnCtlColor</span><span class="p">(</span><span class="n">CDC</span><span class="o">*</span> <span class="n">pDC</span><span class="p">,</span> <span class="n">CWnd</span><span class="o">*</span> <span class="n">pWnd</span><span class="p">,</span> <span class="n">UINT</span> <span class="n">nCtlColor</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">HBRUSH</span> <span class="n">hbr</span> <span class="o">=</span> <span class="n">CDialog</span><span class="o">::</span><span class="n">OnCtlColor</span><span class="p">(</span><span class="n">pDC</span><span class="p">,</span> <span class="n">pWnd</span><span class="p">,</span> <span class="n">nCtlColor</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Change any attributes of the DC here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Return a different brush if the default is not desired
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//return hbr;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="n">pWnd</span> <span class="o">-&gt;</span> <span class="n">GetDlgCtrlID</span><span class="p">()</span> <span class="o">==</span> <span class="n">IDC_LINE_STYLE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">SetTextColor</span><span class="p">(</span><span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">m_brush</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">hbr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170424215530885?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　上述程序再加一行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">pDC</span><span class="o">-&gt;</span><span class="n">SetBkMode</span><span class="p">(</span><span class="n">TRANSPARENT</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170424215545651?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">HBRUSH</span> <span class="n">CSettingDlg</span><span class="o">::</span><span class="n">OnCtlColor</span><span class="p">(</span><span class="n">CDC</span><span class="o">*</span> <span class="n">pDC</span><span class="p">,</span> <span class="n">CWnd</span><span class="o">*</span> <span class="n">pWnd</span><span class="p">,</span> <span class="n">UINT</span> <span class="n">nCtlColor</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">HBRUSH</span> <span class="n">hbr</span> <span class="o">=</span> <span class="n">CDialog</span><span class="o">::</span><span class="n">OnCtlColor</span><span class="p">(</span><span class="n">pDC</span><span class="p">,</span> <span class="n">pWnd</span><span class="p">,</span> <span class="n">nCtlColor</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Change any attributes of the DC here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Return a different brush if the default is not desired
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//return hbr;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="n">pWnd</span> <span class="o">-&gt;</span> <span class="n">GetDlgCtrlID</span><span class="p">()</span> <span class="o">==</span> <span class="n">IDC_LINE_STYLE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">SetTextColor</span><span class="p">(</span><span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">SetBkMode</span><span class="p">(</span><span class="n">TRANSPARENT</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">m_brush</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">pWnd</span><span class="o">-&gt;</span><span class="n">GetDlgCtrlID</span><span class="p">()</span> <span class="o">==</span> <span class="n">IDC_LINE_WIDTH</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">SetTextColor</span><span class="p">(</span><span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//pDC-&gt;SetBkMode(TRANSPARENT);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">SetBkColor</span><span class="p">(</span><span class="n">RGB</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">m_brush</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">hbr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170424215606416?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h3 id="改变控件上的文本字体">改变控件上的文本字体
</h3><p>　　为对话框增加一个静态文本控件，ID:IDC_TEXT，Caption:程序员，为CSettingDlg类增加一个CFont类型的私有成员变量：m_font，在构造函数中添加</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl">	<span class="n">m_font</span><span class="p">.</span><span class="n">CreatePointFont</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">&#34;华文行楷&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　在OnCtlColor函数中添加：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">pWnd</span><span class="o">-&gt;</span><span class="n">GetDlgCtrlID</span><span class="p">()</span> <span class="o">==</span> <span class="n">IDC_TEXT</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">SelectObject</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m_font</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170424215622479?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h3 id="改变按钮控件的背景色及文本颜色">改变按钮控件的背景色及文本颜色
</h3><p>　　在CSettingDlg类OnCtlColor函数中添加：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">pWnd</span><span class="o">-&gt;</span><span class="n">GetDlgCtrlID</span><span class="p">()</span> <span class="o">==</span> <span class="n">IDOK</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">pDC</span><span class="o">-&gt;</span><span class="n">SetTextColor</span><span class="p">(</span><span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">m_brush</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">hbr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　点Insert-New Class，选择MFC Class，新增类名：CTestBtn，基类CButton。
　　为此类添加DrawItem虚函数重写。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CTestBtn</span><span class="o">::</span><span class="n">DrawItem</span><span class="p">(</span><span class="n">LPDRAWITEMSTRUCT</span> <span class="n">lpDrawItemStruct</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Add your code to draw the specified item
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">UINT</span> <span class="n">uStyle</span> <span class="o">=</span> <span class="n">DFCS_BUTTONPUSH</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">ASSERT</span><span class="p">(</span><span class="n">lpDrawItemStruct</span><span class="o">-&gt;</span><span class="n">CtlType</span> <span class="o">==</span> <span class="n">ODT_BUTTON</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">lpDrawItemStruct</span><span class="o">-&gt;</span><span class="n">itemState</span> <span class="o">&amp;</span> <span class="n">ODS_SELECTED</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">uStyle</span> <span class="o">|=</span> <span class="n">DFCS_PUSHED</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="o">::</span><span class="n">DrawFrameControl</span><span class="p">(</span><span class="n">lpDrawItemStruct</span><span class="o">-&gt;</span><span class="n">hDC</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lpDrawItemStruct</span><span class="o">-&gt;</span><span class="n">rcItem</span><span class="p">,</span> <span class="n">DFC_BUTTON</span><span class="p">,</span> <span class="n">uStyle</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CString</span> <span class="n">strText</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">GetWindowText</span><span class="p">(</span><span class="n">strText</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">COLORREF</span> <span class="n">crOldColor</span> <span class="o">=</span> <span class="o">::</span><span class="n">SetTextColor</span><span class="p">(</span><span class="n">lpDrawItemStruct</span><span class="o">-&gt;</span><span class="n">hDC</span><span class="p">,</span> <span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="o">::</span><span class="n">DrawText</span><span class="p">(</span><span class="n">lpDrawItemStruct</span><span class="o">-&gt;</span><span class="n">hDC</span><span class="p">,</span> <span class="n">strText</span><span class="p">,</span> <span class="n">strText</span><span class="p">.</span><span class="n">GetLength</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">		<span class="o">&amp;</span><span class="n">lpDrawItemStruct</span><span class="o">-&gt;</span><span class="n">rcItem</span><span class="p">,</span> <span class="n">DT_SINGLELINE</span> <span class="o">|</span> <span class="n">DT_VCENTER</span> <span class="o">|</span> <span class="n">DT_CENTER</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">::</span><span class="n">SetTextColor</span><span class="p">(</span><span class="n">lpDrawItemStruct</span><span class="o">-&gt;</span><span class="n">hDC</span><span class="p">,</span> <span class="n">crOldColor</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　然而，此时我返回双击OK键显示“Cannot add new member”……</p>
<p>　　按理，接下来应该是：
　　利用ClassWizard打开Add Member Variable对话框，为OK按钮关联一个成员变量，名称为m_btnTest，类型CTestBtn。在SettingDlg.h文件前部添加<code>#include “TestBtn.h”</code>。对OK右键属性，打开Styles，选中Owner draw选项。此时OK文字变红色。</p>
<h2 id="位图的显示">位图的显示
</h2><h1 id="定制应用程序外观">定制应用程序外观
</h1><h2 id="修改应用程序窗口的外观">修改应用程序窗口的外观
</h2><h3 id="在窗口创建之前修改">在窗口创建之前修改
</h3><p>　　创建前，打开CMainFrame类的PreCreateWindow成员函数，修改CREATETRUCT结构体中的cx和cy成员。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">BOOL</span> <span class="n">CMainFrame</span><span class="o">::</span><span class="n">PreCreateWindow</span><span class="p">(</span><span class="n">CREATESTRUCT</span><span class="o">&amp;</span> <span class="n">cs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">CFrameWnd</span><span class="o">::</span><span class="n">PreCreateWindow</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Modify the Window class or styles here by modifying
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//  the CREATESTRUCT cs
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cs</span><span class="p">.</span><span class="n">cx</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">cs</span><span class="p">.</span><span class="n">cy</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　创建运行，可看到初始大小为300x200的应用程序窗口。</p>
<p>　　修改窗口标题：在上述 return TRUE; 前添加：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">cs</span><span class="p">.</span><span class="n">style</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FWS_ADDTOTITLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">cs</span><span class="p">.</span><span class="n">lpszName</span> <span class="o">=</span> <span class="s">&#34;http://www.sunxin.org&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="在窗口创建之后修改">在窗口创建之后修改
</h2><p>　　注释掉之前添加的代码。在OnCreate函数中添加：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">CMainFrame</span><span class="o">::</span><span class="n">OnCreate</span><span class="p">(</span><span class="n">LPCREATESTRUCT</span> <span class="n">lpCreateStruct</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="err">…</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Delete these three lines if you don&#39;t want the toolbar to
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//  be dockable
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">m_wndToolBar</span><span class="p">.</span><span class="n">EnableDocking</span><span class="p">(</span><span class="n">CBRS_ALIGN_ANY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">EnableDocking</span><span class="p">(</span><span class="n">CBRS_ALIGN_ANY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">DockControlBar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m_wndToolBar</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">SetWindowLong</span><span class="p">(</span><span class="n">m_hWnd</span><span class="p">,</span> <span class="n">GWL_STYLE</span><span class="p">,</span> <span class="n">WS_OVERLAPPEDWINDOW</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　创建运行后可看到文档标题去掉了。</p>
<p>　　去掉窗口最大化框类型：
　　将上述SetWindowLong函数替换为</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl">	<span class="n">SetWindowLong</span><span class="p">(</span><span class="n">m_hWnd</span><span class="p">,</span> <span class="n">GWL_STYLE</span><span class="p">,</span> <span class="n">GetWindowLong</span><span class="p">(</span><span class="n">m_hWnd</span><span class="p">,</span> <span class="n">GWL_STYLE</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">WS_MAXIMIZEBOX</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　创建运行发现最大化框变灰，不能放大窗口了。</p>
<h2 id="修改窗口的光标图标和背景">修改窗口的光标、图标和背景
</h2><h3 id="在窗口创建之前修改-1">在窗口创建之前修改
</h3><h1 id="网络编程">网络编程
</h1><h2 id="计算机网络基本知识">计算机网络基本知识
</h2><p>ISO/OSI七层参考模型
应用层——处理网络应用
Telnet、FTP、HTTP、DNS、SMTP、POP3</p>
<p>表示层——数据表示
TCP、UDP</p>
<p>会话层——主机间通信
传输层——端到端的连接
网络层——寻址和最短路径
IP、ICMP、IGMP</p>
<p>数据链路层——介质访问（接入）
物理层——二进制传输</p>
<h2 id="基于tcp的网络应用程序的编写">基于TCP的网络应用程序的编写
</h2><h3 id="服务器端程序">服务器端程序
</h3><p>　　关闭先前的工作区，新建一个工程，选择Win32 Console Application类型，名为TCPSrv。选择An empty project选项，创建一个空工程。再新建一个C++源文件：TcpSrv.cpp。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Winsock2.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//加载套接字库
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">WORD</span> <span class="n">wVersionRequested</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">WSADATA</span> <span class="n">wsaData</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">wVersionRequested</span> <span class="o">=</span> <span class="n">MAKEWORD</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">err</span> <span class="o">=</span> <span class="n">WSAStartup</span><span class="p">(</span><span class="n">wVersionRequested</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wsaData</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">LOBYTE</span><span class="p">(</span><span class="n">wsaData</span><span class="p">.</span><span class="n">wVersion</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">		<span class="n">HIBYTE</span><span class="p">(</span><span class="n">wsaData</span><span class="p">.</span><span class="n">wVersion</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">		<span class="n">WSACleanup</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//创建用于监听的套接字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">SOCKET</span> <span class="n">sockSrv</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">SOCKADDR_IN</span> <span class="n">addrSrv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">addrSrv</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">S_un</span><span class="p">.</span><span class="n">S_addr</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">INADDR_ANY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">addrSrv</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">addrSrv</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">7000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//绑定套接字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">bind</span><span class="p">(</span><span class="n">sockSrv</span><span class="p">,</span> <span class="p">(</span><span class="n">SOCKADDR</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addrSrv</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SOCKADDR</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//将套接字设为监听模式，准备接收客户请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">listen</span><span class="p">(</span><span class="n">sockSrv</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">SOCKADDR_IN</span> <span class="n">addrClient</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SOCKADDR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//等待客户请求到来
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">SOCKET</span> <span class="n">sockConn</span> <span class="o">=</span> <span class="n">accept</span><span class="p">(</span><span class="n">sockSrv</span><span class="p">,</span> <span class="p">(</span><span class="n">SOCKADDR</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addrClient</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="kt">char</span> <span class="n">sendBuf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="n">sprintf</span><span class="p">(</span><span class="n">sendBuf</span><span class="p">,</span> <span class="s">&#34;Welcome %s to http://www.sunxin.org&#34;</span><span class="p">,</span> <span class="n">inet_ntoa</span><span class="p">(</span><span class="n">addrClient</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//发送数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">send</span><span class="p">(</span><span class="n">sockConn</span><span class="p">,</span> <span class="n">sendBuf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">sendBuf</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="kt">char</span> <span class="n">recvBuf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//接收数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">recv</span><span class="p">(</span><span class="n">sockConn</span><span class="p">,</span> <span class="n">recvBuf</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//打印接收的数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">recvBuf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//关闭套接字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">closesocket</span><span class="p">(</span><span class="n">sockConn</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　Project-Setting-Link，在Object/library modules编辑框中添加ws2_32.lib文件，注意输入的库文件与前面的库文件之间一定 要有一个空格。
<img src="http://img.blog.csdn.net/20170428102011032?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h3 id="客户端程序">客户端程序
</h3><p>　　在工作区名称上单击鼠标右键，选择Add New Project to Workspace，再创建一个Win32 Console Application类型的应用程序，创建一个空工程。为此增加一个C++源文件：TcpClient.cpp。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Winsock2.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//加载套接字库
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">WORD</span> <span class="n">wVersionRequested</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">WSADATA</span> <span class="n">wsaData</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">wVersionRequested</span> <span class="o">=</span> <span class="n">MAKEWORD</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">err</span> <span class="o">=</span> <span class="n">WSAStartup</span><span class="p">(</span><span class="n">wVersionRequested</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wsaData</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">LOBYTE</span><span class="p">(</span><span class="n">wsaData</span><span class="p">.</span><span class="n">wVersion</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">||</span> 
</span></span><span class="line"><span class="cl">		<span class="n">HIBYTE</span><span class="p">(</span><span class="n">wsaData</span><span class="p">.</span><span class="n">wVersion</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">		<span class="n">WSACleanup</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//创建套接字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">SOCKET</span> <span class="n">sockClient</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">SOCKADDR_IN</span> <span class="n">addrSrv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">addrSrv</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">S_un</span><span class="p">.</span><span class="n">S_addr</span> <span class="o">=</span> <span class="n">inet_addr</span><span class="p">(</span><span class="s">&#34;127.0.0.1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">addrSrv</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">addrSrv</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">7000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//向服务器发出连接请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">connect</span><span class="p">(</span><span class="n">sockClient</span><span class="p">,</span> <span class="p">(</span><span class="n">SOCKADDR</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addrSrv</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SOCKADDR</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//接收数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">char</span> <span class="n">recvBuf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="n">recv</span><span class="p">(</span><span class="n">sockClient</span><span class="p">,</span> <span class="n">recvBuf</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="n">recvBuf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//发送数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">send</span><span class="p">(</span><span class="n">sockClient</span><span class="p">,</span> <span class="s">&#34;This is lisi&#34;</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="s">&#34;This is lisi&#34;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//关闭套接字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">closesocket</span><span class="p">(</span><span class="n">sockClient</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">WSACleanup</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　链接库文件：ws2_32.lib。
　　创建运行，首先运行服务器程序，然后再运行客户端程序。</p>
<p><img src="http://img.blog.csdn.net/20170428102101643?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　<strong>注意</strong>：当没有报错，服务器端运行结果为“烫烫……烫”（N个烫）时，尝试换一个端口号，有可能你设置的端口号被其它的应用程序占用了。</p>
<h2 id="基于udp的网络应用程序的编写">基于UDP的网络应用程序的编写
</h2><h3 id="服务器端程序-1">服务器端程序
</h3><p>　　关闭先前的工作区，新建一个工程，选择Win32 Console Application类型，名为UdpSrv。选择An empty project选项，创建一个空工程。再新建一个C++源文件：UdpSrv.cpp。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Winsock2.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//加载套接字库
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">WORD</span> <span class="n">wVersionRequired</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">WSADATA</span> <span class="n">wsaData</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">wVersionRequired</span> <span class="o">=</span> <span class="n">MAKEWORD</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">err</span> <span class="o">=</span> <span class="n">WSAStartup</span><span class="p">(</span><span class="n">wVersionRequired</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wsaData</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">LOBYTE</span><span class="p">(</span><span class="n">wsaData</span><span class="p">.</span><span class="n">wVersion</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">		<span class="n">HIBYTE</span><span class="p">(</span><span class="n">wsaData</span><span class="p">.</span><span class="n">wVersion</span><span class="p">)</span> <span class="o">!=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">WSACleanup</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//创建套接字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">SOCKET</span> <span class="n">sockSrv</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_DGRAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">SOCKADDR_IN</span> <span class="n">addrSrv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">addrSrv</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">S_un</span><span class="p">.</span><span class="n">S_addr</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">INADDR_ANY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">addrSrv</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">addrSrv</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">7000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//绑定套接字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">bind</span><span class="p">(</span><span class="n">sockSrv</span><span class="p">,</span> <span class="p">(</span><span class="n">SOCKADDR</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addrSrv</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SOCKADDR</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//等待并接收数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">SOCKADDR_IN</span> <span class="n">addrClient</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SOCKADDR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">recvBuf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="n">recvfrom</span><span class="p">(</span><span class="n">sockSrv</span><span class="p">,</span> <span class="n">recvBuf</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">SOCKADDR</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addrClient</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="n">recvBuf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//关闭套接字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">closesocket</span><span class="p">(</span><span class="n">sockSrv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">WSACleanup</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　在工程设置对话框的链接选项卡下添加库文件：Ws2_32.lib的链接。</p>
<h3 id="客户端程序-1">客户端程序
</h3><p>　　在同一个UdpSrv工作区中创建客户端应用程序。创建一个空的Win32 Console Application类型的工程，名为：UdpClient。为该工程添加一个C++源文件：UdpClient.cpp。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Winsock2.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//加载套接字库
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">WORD</span> <span class="n">wVersionRequired</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">WSADATA</span> <span class="n">wsaData</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">wVersionRequired</span> <span class="o">=</span> <span class="n">MAKEWORD</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">err</span> <span class="o">=</span> <span class="n">WSAStartup</span><span class="p">(</span><span class="n">wVersionRequired</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wsaData</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">LOBYTE</span><span class="p">(</span><span class="n">wsaData</span><span class="p">.</span><span class="n">wVersion</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">		<span class="n">HIBYTE</span><span class="p">(</span><span class="n">wsaData</span><span class="p">.</span><span class="n">wVersion</span><span class="p">)</span> <span class="o">!=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">WSACleanup</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//创建套接字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">SOCKET</span> <span class="n">sockClient</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_DGRAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">SOCKADDR_IN</span> <span class="n">addrSrv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">addrSrv</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">S_un</span><span class="p">.</span><span class="n">S_addr</span> <span class="o">=</span> <span class="n">inet_addr</span><span class="p">(</span><span class="s">&#34;127.0.0.1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">addrSrv</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">addrSrv</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">7000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//发送数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">sendto</span><span class="p">(</span><span class="n">sockClient</span><span class="p">,</span> <span class="s">&#34;Hello&#34;</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="s">&#34;Hello&#34;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="n">SOCKADDR</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addrSrv</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SOCKADDR</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//关闭套接字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">closesocket</span><span class="p">(</span><span class="n">sockClient</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">WSACleanup</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　链接库文件：ws2_32.lib。</p>
<p>　　创建运行。服务器端程序应先启动，然后启动客户端程序。</p>
<p><img src="http://img.blog.csdn.net/20170428102150065?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　<strong>基于TCP和基于UDP的网络应用程序在发送和接收数据时使用的函数是不一样的：前者使用send和recv，后者使用sendto和recvfrom。</strong></p>
<h2 id="基于udp的简单聊天程序">基于UDP的简单聊天程序
</h2><p>　　在新工作区新建一个空的Win32 Console Application类型的应用程序，名为NetSrv。为该工程添加一个C++源文件：NetSrv.cpp。接着为该工程添加对WinSock库的链接，即在工程设置对话框的Link选项卡上添加ws2_32.lib文件的链接。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Winsock2.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span> <span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	 <span class="c1">//加载套接字库
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	 <span class="n">WORD</span> <span class="n">wVersionRequested</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	 <span class="n">WSADATA</span> <span class="n">wsaData</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	 <span class="kt">int</span> <span class="n">err</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	 <span class="n">wVersionRequested</span> <span class="o">=</span> <span class="n">MAKEWORD</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	 <span class="n">err</span> <span class="o">=</span> <span class="n">WSAStartup</span><span class="p">(</span><span class="n">wVersionRequested</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wsaData</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	 <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="p">{</span>
</span></span><span class="line"><span class="cl">		 <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	 <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">LOBYTE</span><span class="p">(</span><span class="n">wsaData</span><span class="p">.</span><span class="n">wVersion</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">		<span class="n">HIBYTE</span><span class="p">(</span><span class="n">wsaData</span><span class="p">.</span><span class="n">wVersion</span><span class="p">)</span> <span class="o">!=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">WSACleanup</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	 <span class="c1">//创建套接字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	 <span class="n">SOCKET</span> <span class="n">sockSrv</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_DGRAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	 <span class="n">SOCKADDR_IN</span> <span class="n">addrSrv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	 <span class="n">addrSrv</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">S_un</span><span class="p">.</span><span class="n">S_addr</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">INADDR_ANY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	 <span class="n">addrSrv</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	 <span class="n">addrSrv</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">7000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	 <span class="c1">//绑定套接字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	 <span class="n">bind</span><span class="p">(</span><span class="n">sockSrv</span><span class="p">,</span> <span class="p">(</span><span class="n">SOCKADDR</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addrSrv</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SOCKADDR</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	 <span class="kt">char</span> <span class="n">recvBuf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	 <span class="kt">char</span> <span class="n">sendBuf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	 <span class="kt">char</span> <span class="n">tempBuf</span><span class="p">[</span><span class="mi">200</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	 <span class="n">SOCKADDR_IN</span> <span class="n">addrClient</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	 <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SOCKADDR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	 <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="p">{</span>
</span></span><span class="line"><span class="cl">		 <span class="c1">//等待并接收数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		 <span class="n">recvfrom</span><span class="p">(</span><span class="n">sockSrv</span><span class="p">,</span> <span class="n">recvBuf</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">SOCKADDR</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addrClient</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		 <span class="k">if</span> <span class="p">(</span><span class="sc">&#39;q&#39;</span> <span class="o">==</span> <span class="n">recvBuf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">		 <span class="p">{</span>
</span></span><span class="line"><span class="cl">			 <span class="n">sendto</span><span class="p">(</span><span class="n">sockSrv</span><span class="p">,</span> <span class="s">&#34;q&#34;</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="s">&#34;q&#34;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">SOCKADDR</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addrClient</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			 <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Chat end!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			 <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		 <span class="p">}</span>
</span></span><span class="line"><span class="cl">		 <span class="n">sprintf</span><span class="p">(</span><span class="n">tempBuf</span><span class="p">,</span> <span class="s">&#34;%s say : %s&#34;</span><span class="p">,</span> <span class="n">inet_ntoa</span><span class="p">(</span><span class="n">addrClient</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">),</span> <span class="n">recvBuf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		 <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">tempBuf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		 <span class="c1">//发送数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		 <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Please input data:</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		 <span class="n">gets</span><span class="p">(</span><span class="n">sendBuf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		 <span class="n">sendto</span><span class="p">(</span><span class="n">sockSrv</span><span class="p">,</span> <span class="n">sendBuf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">sendBuf</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">SOCKADDR</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addrClient</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	 <span class="c1">//关闭套接字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	 <span class="n">closesocket</span><span class="p">(</span><span class="n">sockSrv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	 <span class="n">WSACleanup</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="客户端程序-2">客户端程序
</h3><p>　　向已有工作区增加一个空的Win32 Console Application类型的工程：NetClient。为此添加一个C++源文件：NetClient.cpp。为该工程添加ws2_32.lib文件的链接。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Winsock2.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span> <span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	 <span class="c1">//加载套接字库
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	 <span class="n">WORD</span> <span class="n">wVersionRequested</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	 <span class="n">WSADATA</span> <span class="n">wsaData</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	 <span class="kt">int</span> <span class="n">err</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	 <span class="n">wVersionRequested</span> <span class="o">=</span> <span class="n">MAKEWORD</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	 <span class="n">err</span> <span class="o">=</span> <span class="n">WSAStartup</span><span class="p">(</span><span class="n">wVersionRequested</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wsaData</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	 <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="p">{</span>
</span></span><span class="line"><span class="cl">		 <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	 <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">LOBYTE</span><span class="p">(</span><span class="n">wsaData</span><span class="p">.</span><span class="n">wVersion</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">		<span class="n">HIBYTE</span><span class="p">(</span><span class="n">wsaData</span><span class="p">.</span><span class="n">wVersion</span><span class="p">)</span> <span class="o">!=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">WSACleanup</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	 <span class="c1">//创建套接字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	 <span class="n">SOCKET</span> <span class="n">sockClient</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_DGRAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	 <span class="n">SOCKADDR_IN</span> <span class="n">addrSrv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	 <span class="n">addrSrv</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">S_un</span><span class="p">.</span><span class="n">S_addr</span> <span class="o">=</span> <span class="n">inet_addr</span><span class="p">(</span><span class="s">&#34;127.0.0.1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	 <span class="n">addrSrv</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	 <span class="n">addrSrv</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">7000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	 <span class="kt">char</span> <span class="n">recvBuf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	 <span class="kt">char</span> <span class="n">sendBuf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	 <span class="kt">char</span> <span class="n">tempBuf</span><span class="p">[</span><span class="mi">200</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	 <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SOCKADDR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	 <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="p">{</span>
</span></span><span class="line"><span class="cl">		 <span class="c1">//发送数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		 <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Please input data:</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		 <span class="n">gets</span><span class="p">(</span><span class="n">sendBuf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		 <span class="n">sendto</span><span class="p">(</span><span class="n">sockClient</span><span class="p">,</span> <span class="n">sendBuf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">sendBuf</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">SOCKADDR</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addrSrv</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		 <span class="c1">//等待并接收数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		 <span class="n">recvfrom</span><span class="p">(</span><span class="n">sockClient</span><span class="p">,</span> <span class="n">recvBuf</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">SOCKADDR</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addrSrv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		 <span class="k">if</span><span class="p">(</span><span class="sc">&#39;q&#39;</span> <span class="o">==</span> <span class="n">recvBuf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">		 <span class="p">{</span>
</span></span><span class="line"><span class="cl">			 <span class="n">sendto</span><span class="p">(</span><span class="n">sockClient</span><span class="p">,</span> <span class="s">&#34;q&#34;</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="s">&#34;q&#34;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">SOCKADDR</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addrSrv</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			 <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Chat end!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			 <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		 <span class="p">}</span>
</span></span><span class="line"><span class="cl">		 <span class="n">sprintf</span><span class="p">(</span><span class="n">tempBuf</span><span class="p">,</span> <span class="s">&#34;%s say : %s&#34;</span><span class="p">,</span> <span class="n">inet_ntoa</span><span class="p">(</span><span class="n">addrSrv</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">),</span> <span class="n">recvBuf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		 <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">tempBuf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	 <span class="p">}</span>
</span></span><span class="line"><span class="cl">	 <span class="c1">//关闭套接字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	 <span class="n">closesocket</span><span class="p">(</span><span class="n">sockClient</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	 <span class="n">WSACleanup</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170428102229597?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h1 id="多线程">多线程
</h1><h2 id="进程">进程
</h2><h3 id="程序和进程">程序和进程
</h3><h2 id="简单多线程示例">简单多线程示例
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;windows.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">    <span class="n">DWORD</span> <span class="n">WINAPI</span> <span class="nf">Fun1Proc</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="n">LPVOID</span> <span class="n">lpParameter</span>  <span class="c1">//thread data					 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">HANDLE</span> <span class="n">hThread1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">hThread1</span> <span class="o">=</span> <span class="n">CreateThread</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Fun1Proc</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">CloseHandle</span><span class="p">(</span><span class="n">hThread1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;main thread is running&#34;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">Sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="c1">//让主线程暂停运行，进入分线程
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//线程1的入口函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">DWORD</span> <span class="n">WINAPI</span> <span class="nf">Fun1Proc</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">		<span class="n">LPVOID</span> <span class="n">lpParameter</span>  <span class="c1">//thread data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;thread1 is running&#34;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170424215653701?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　交替运行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;windows.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">    <span class="n">DWORD</span> <span class="n">WINAPI</span> <span class="nf">Fun1Proc</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="n">LPVOID</span> <span class="n">lpParameter</span>  <span class="c1">//thread data					 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">);</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">HANDLE</span> <span class="n">hThread1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">hThread1</span> <span class="o">=</span> <span class="n">CreateThread</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Fun1Proc</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">CloseHandle</span><span class="p">(</span><span class="n">hThread1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		<span class="k">while</span> <span class="p">(</span><span class="n">index</span> <span class="o">++&lt;</span> <span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;main thread is running&#34;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//Sleep(10);//让主线程暂停运行，进入分线程
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//线程1的入口函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="n">DWORD</span> <span class="n">WINAPI</span> <span class="nf">Fun1Proc</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">		<span class="n">LPVOID</span> <span class="n">lpParameter</span>  <span class="c1">//thread data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">while</span> <span class="p">(</span><span class="n">index</span><span class="o">++&lt;</span> <span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;thread1 is running&#34;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170424215712448?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h2 id="线程同步">线程同步
</h2><h3 id="火车站售票系统模拟程序">火车站售票系统模拟程序
</h3><p>　　由主线程创建的两个线程（1和2）负责销售火车票。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;windows.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">    <span class="n">DWORD</span> <span class="n">WINAPI</span> <span class="nf">Fun1Proc</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="n">LPVOID</span> <span class="n">lpParameter</span>  <span class="c1">//thread data					 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">);</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	 <span class="n">DWORD</span> <span class="n">WINAPI</span> <span class="nf">Fun2Proc</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="n">LPVOID</span> <span class="n">lpParameter</span>  <span class="c1">//thread data					 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">tickets</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">HANDLE</span> <span class="n">hMutex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">HANDLE</span> <span class="n">hThread1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">HANDLE</span> <span class="n">hThread2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//创建互斥对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">hMutex</span> <span class="o">=</span> <span class="n">CreateMutex</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//创建线程
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">hThread1</span> <span class="o">=</span> <span class="n">CreateThread</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Fun1Proc</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">hThread2</span> <span class="o">=</span> <span class="n">CreateThread</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Fun2Proc</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">CloseHandle</span><span class="p">(</span><span class="n">hThread1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">CloseHandle</span><span class="p">(</span><span class="n">hThread2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">Sleep</span><span class="p">(</span><span class="mi">4000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//线程1的入口函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">DWORD</span> <span class="n">WINAPI</span> <span class="nf">Fun1Proc</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">		<span class="n">LPVOID</span> <span class="n">lpParameter</span>  <span class="c1">//thread data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">while</span> <span class="p">(</span><span class="n">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">WaitForSingleObject</span><span class="p">(</span><span class="n">hMutex</span><span class="p">,</span> <span class="n">INFINITE</span><span class="p">);</span><span class="c1">//实现线程同步
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="p">(</span><span class="n">tickets</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">Sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;thread1 sell ticket:&#34;</span><span class="o">&lt;&lt;</span><span class="n">tickets</span><span class="o">--&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="k">else</span> 
</span></span><span class="line"><span class="cl">				<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">ReleaseMutex</span><span class="p">(</span><span class="n">hMutex</span><span class="p">);</span><span class="c1">//释放当前线程对互斥对象的所有权
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//线程2的入口函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">DWORD</span> <span class="n">WINAPI</span> <span class="nf">Fun2Proc</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">		<span class="n">LPVOID</span> <span class="n">lpParameter</span>  <span class="c1">//thread data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">while</span> <span class="p">(</span><span class="n">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">WaitForSingleObject</span><span class="p">(</span><span class="n">hMutex</span><span class="p">,</span><span class="n">INFINITE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">tickets</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">Sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;thread2 sell ticket:&#34;</span><span class="o">&lt;&lt;</span><span class="n">tickets</span><span class="o">--&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="k">else</span> 
</span></span><span class="line"><span class="cl">				<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">ReleaseMutex</span><span class="p">(</span><span class="n">hMutex</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="http://img.blog.csdn.net/20170424215734652?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
>
　　这时所销售的票号正常，没有看到销售了号码为0的票。</p>
<p>　　对互斥对象来说，谁拥有谁释放。</p>
<h2 id="保证应用程序只有一个实例运行">保证应用程序只有一个实例运行
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;windows.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">    <span class="n">DWORD</span> <span class="n">WINAPI</span> <span class="nf">Fun1Proc</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="n">LPVOID</span> <span class="n">lpParameter</span>  <span class="c1">//thread data					 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">);</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	 <span class="n">DWORD</span> <span class="n">WINAPI</span> <span class="nf">Fun2Proc</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="n">LPVOID</span> <span class="n">lpParameter</span>  <span class="c1">//thread data					 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">tickets</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">HANDLE</span> <span class="n">hMutex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">HANDLE</span> <span class="n">hThread1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">HANDLE</span> <span class="n">hThread2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//创建互斥对象(注意命名)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">hMutex</span> <span class="o">=</span> <span class="n">CreateMutex</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="s">&#34;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">hMutex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">ERROR_ALREADY_EXISTS</span> <span class="o">==</span> <span class="n">GetLastError</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;only one instance can run!&#34;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//创建线程
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">hThread1</span> <span class="o">=</span> <span class="n">CreateThread</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Fun1Proc</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">hThread2</span> <span class="o">=</span> <span class="n">CreateThread</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Fun2Proc</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">CloseHandle</span><span class="p">(</span><span class="n">hThread1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">CloseHandle</span><span class="p">(</span><span class="n">hThread2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">WaitForSingleObject</span><span class="p">(</span><span class="n">hMutex</span><span class="p">,</span> <span class="n">INFINITE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">ReleaseMutex</span><span class="p">(</span><span class="n">hMutex</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">ReleaseMutex</span><span class="p">(</span><span class="n">hMutex</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">Sleep</span><span class="p">(</span><span class="mi">4000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1">//线程1的入口函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">DWORD</span> <span class="n">WINAPI</span> <span class="nf">Fun1Proc</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">		<span class="n">LPVOID</span> <span class="n">lpParameter</span>  <span class="c1">//thread data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">while</span> <span class="p">(</span><span class="n">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">WaitForSingleObject</span><span class="p">(</span><span class="n">hMutex</span><span class="p">,</span> <span class="n">INFINITE</span><span class="p">);</span><span class="c1">//实现线程同步
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="p">(</span><span class="n">tickets</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">Sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;thread1 sell ticket:&#34;</span><span class="o">&lt;&lt;</span><span class="n">tickets</span><span class="o">--&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="k">else</span> 
</span></span><span class="line"><span class="cl">				<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">ReleaseMutex</span><span class="p">(</span><span class="n">hMutex</span><span class="p">);</span><span class="c1">//释放当前线程对互斥对象的所有权
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//线程2的入口函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">DWORD</span> <span class="n">WINAPI</span> <span class="nf">Fun2Proc</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">		<span class="n">LPVOID</span> <span class="n">lpParameter</span>  <span class="c1">//thread data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">while</span> <span class="p">(</span><span class="n">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">WaitForSingleObject</span><span class="p">(</span><span class="n">hMutex</span><span class="p">,</span><span class="n">INFINITE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">tickets</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">Sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;thread2 sell ticket:&#34;</span><span class="o">&lt;&lt;</span><span class="n">tickets</span><span class="o">--&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="k">else</span> 
</span></span><span class="line"><span class="cl">				<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">ReleaseMutex</span><span class="p">(</span><span class="n">hMutex</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="网络聊天室程序的实现">网络聊天室程序的实现
</h2><p>　　新建一个基于对话框的工程，名为：Chat。
<img src="http://img.blog.csdn.net/20170428102440017?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
>
<img src="http://img.blog.csdn.net/20170428102449366?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<h3 id="加载套接字库">加载套接字库
</h3><p>　　在CChatApp类的InitInstance函数开始位置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">BOOL</span> <span class="n">CChatApp</span><span class="o">::</span><span class="n">InitInstance</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">AfxSocketInit</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">AfxMessageBox</span><span class="p">(</span><span class="s">&#34;加载套接字库失败！&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="err">……</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　在stdafx.h中，添加头文件<code>#include &lt;Afxsock.h&gt;</code>。</p>
<h3 id="创建并初始化套接字">创建并初始化套接字
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">BOOL</span> <span class="n">CChatDlg</span><span class="o">::</span><span class="n">InitSocket</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//创建套接字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">m_socket</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_DGRAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">INVALID_SOCKET</span> <span class="o">==</span> <span class="n">m_socket</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">MessageBox</span><span class="p">(</span><span class="s">&#34;套接字创建失败！&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">SOCKADDR_IN</span> <span class="n">addrSock</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">addrSock</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">addrSock</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">7000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">addrSock</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">S_un</span><span class="p">.</span><span class="n">S_addr</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">INADDR_ANY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">retval</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//绑定套接字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">retval</span> <span class="o">=</span> <span class="n">bind</span><span class="p">(</span><span class="n">m_socket</span><span class="p">,</span> <span class="p">(</span><span class="n">SOCKADDR</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addrSock</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SOCKADDR</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">SOCKET_ERROR</span> <span class="o">==</span> <span class="n">retval</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">closesocket</span><span class="p">(</span><span class="n">m_socket</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">MessageBox</span><span class="p">(</span><span class="s">&#34;绑定失败！&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">BOOL</span> <span class="n">CChatDlg</span><span class="o">::</span><span class="n">OnInitDialog</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="err">……</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Add extra initialization here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">InitSocket</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>  <span class="c1">// return TRUE  unless you set the focus to a control
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="实现接收端功能">实现接收端功能
</h3><p>　　在CChatDlg类中定义：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="c1">/////////////////////////////////////////////////////////////////////////////
</span></span></span><span class="line"><span class="cl"><span class="c1">// CChatDlg dialog
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">RECVPARAM</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">SOCKET</span> <span class="n">sock</span><span class="p">;</span> <span class="c1">//已创建的套接字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">HWND</span> <span class="n">hwnd</span><span class="p">;</span> <span class="c1">//对话框句柄
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　在Chatdlg.h中添加：<code>static DWORD WINAPI RecvProc(LPVOID lpParameter);</code>
在OnInitDialog()中添加：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">BOOL</span> <span class="n">CChatDlg</span><span class="o">::</span><span class="n">OnInitDialog</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">……</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// TODO: Add extra initialization here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">InitSocket</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">RECVPARAM</span> <span class="o">*</span><span class="n">pRecvParam</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RECVPARAM</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pRecvParam</span><span class="o">-&gt;</span><span class="n">sock</span> <span class="o">=</span> <span class="n">m_socket</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pRecvParam</span><span class="o">-&gt;</span><span class="n">hwnd</span> <span class="o">=</span> <span class="n">m_hWnd</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//创建接收线程
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">HANDLE</span> <span class="n">hThread</span> <span class="o">=</span> <span class="n">CreateThread</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">RecvProc</span><span class="p">,</span> <span class="p">(</span><span class="n">LPVOID</span><span class="p">)</span><span class="n">pRecvParam</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//关闭该接收程句柄，释放其引用计数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CloseHandle</span><span class="p">(</span><span class="n">hThread</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>  <span class="c1">// return TRUE  unless you set the focus to a control
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　在CChatDlg类中添加：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">DWORD</span> <span class="n">WINAPI</span> <span class="n">CChatDlg</span><span class="o">::</span><span class="n">RecvProc</span><span class="p">(</span><span class="n">LPVOID</span> <span class="n">lpParameter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　若要求采用完全面向对象的思想来编程，不能使用全局函数和全局变量了，可以采用静态成员函数和静态成员变量的方法来解决。
　　</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">DWORD</span> <span class="n">WINAPI</span> <span class="n">CChatDlg</span><span class="o">::</span><span class="n">RecvProc</span><span class="p">(</span><span class="n">LPVOID</span> <span class="n">lpParameter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//获取主线程传递的套接字和窗口句柄
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">SOCKET</span> <span class="n">sock</span> <span class="o">=</span> <span class="p">((</span><span class="n">RECVPARAM</span><span class="o">*</span><span class="p">)</span><span class="n">lpParameter</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">sock</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">HWND</span> <span class="n">hwnd</span> <span class="o">=</span> <span class="p">((</span><span class="n">RECVPARAM</span><span class="o">*</span><span class="p">)</span><span class="n">lpParameter</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">hwnd</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">delete</span> <span class="n">lpParameter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">SOCKADDR_IN</span> <span class="n">addrFrom</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SOCKADDR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">recvBuf</span><span class="p">[</span><span class="mi">200</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">tempBuf</span><span class="p">[</span><span class="mi">300</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">retval</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">while</span><span class="p">(</span><span class="n">TRUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//接收数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">retval</span> <span class="o">=</span> <span class="n">recvfrom</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">recvBuf</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">SOCKADDR</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addrFrom</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">SOCKET_ERROR</span> <span class="o">==</span> <span class="n">retval</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">sprintf</span><span class="p">(</span><span class="n">tempBuf</span><span class="p">,</span> <span class="s">&#34;%s 说： %s&#34;</span><span class="p">,</span> <span class="n">inet_ntoa</span><span class="p">(</span><span class="n">addrFrom</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">),</span> <span class="n">recvBuf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">::</span><span class="n">PostMessage</span><span class="p">(</span><span class="n">hwnd</span><span class="p">,</span> <span class="n">WM_RECVDATA</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">LPARAM</span><span class="p">)</span><span class="n">tempBuf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　在该类添加头文件 <code>#define WM_RECVDATA	WM_USER+1</code></p>
<p>在CChatDlg类头文件中编写该消息响应函数原型的声明：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl">	<span class="c1">// Generated message map functions
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//{{AFX_MSG(CChatDlg)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">virtual</span> <span class="n">BOOL</span> <span class="nf">OnInitDialog</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">afx_msg</span> <span class="kt">void</span> <span class="nf">OnSysCommand</span><span class="p">(</span><span class="n">UINT</span> <span class="n">nID</span><span class="p">,</span> <span class="n">LPARAM</span> <span class="n">lParam</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">afx_msg</span> <span class="kt">void</span> <span class="nf">OnPaint</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">afx_msg</span> <span class="n">HCURSOR</span> <span class="nf">OnQueryDragIcon</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//}}AFX_MSG
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">afx_msg</span> <span class="kt">void</span> <span class="nf">OnRecvData</span><span class="p">(</span><span class="n">WPARAM</span> <span class="n">wParam</span><span class="p">,</span> <span class="n">LPARAM</span> <span class="n">lParam</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">DECLARE_MESSAGE_MAP</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在CChatDlg类的源文件中添加WM_RECVDATA消息映射。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">BEGIN_MESSAGE_MAP</span><span class="p">(</span><span class="n">CChatDlg</span><span class="p">,</span> <span class="n">CDialog</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//{{AFX_MSG_MAP(CChatDlg)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">ON_WM_SYSCOMMAND</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="n">ON_WM_PAINT</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="n">ON_WM_QUERYDRAGICON</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//}}AFX_MSG_MAP
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">ON_MESSAGE</span><span class="p">(</span><span class="n">WM_RECVDATA</span><span class="p">,</span> <span class="n">OnRecvData</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">END_MESSAGE_MAP</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在构造函数中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CChatDlg</span><span class="o">::</span><span class="n">OnRecvData</span><span class="p">(</span><span class="n">WPARAM</span> <span class="n">wParam</span><span class="p">,</span> <span class="n">LPARAM</span> <span class="n">lParam</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//取出接收到的数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CString</span> <span class="n">str</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">lParam</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">CString</span> <span class="n">strTemp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//获得已有数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">GetDlgItemText</span><span class="p">(</span><span class="n">IDC_EDIT_RECV</span><span class="p">,</span> <span class="n">strTemp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">str</span> <span class="o">+=</span> <span class="s">&#34;</span><span class="se">\r\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">str</span> <span class="o">+=</span> <span class="n">strTemp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//显示所有接收到的数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">SetDlgItemText</span><span class="p">(</span><span class="n">IDC_EDIT_RECV</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="实现发送端功能">实现发送端功能
</h3><p>双击发送，添加响应函数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CChatDlg</span><span class="o">::</span><span class="n">OnBtnSend</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//获取对方IP
</span></span></span><span class="line"><span class="cl"><span class="c1">// TODO: Add your control notification handler code here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">DWORD</span> <span class="n">dwIP</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">((</span><span class="n">CIPAddressCtrl</span><span class="o">*</span><span class="p">)</span><span class="n">GetDlgItem</span><span class="p">(</span><span class="n">IDC_IPADDRESS1</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">GetAddress</span><span class="p">(</span><span class="n">dwIP</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">SOCKADDR_IN</span> <span class="n">addrTo</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">addrTo</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">addrTo</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">7000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">addrTo</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">S_un</span><span class="p">.</span><span class="n">S_addr</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">dwIP</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">CString</span> <span class="n">strSend</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//获得待发送数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">GetDlgItemText</span><span class="p">(</span><span class="n">IDC_EDIT_SEND</span><span class="p">,</span> <span class="n">strSend</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//发送数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">sendto</span><span class="p">(</span><span class="n">m_socket</span><span class="p">,</span> <span class="n">strSend</span><span class="p">,</span> <span class="n">strSend</span><span class="p">.</span><span class="n">GetLength</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="n">SOCKADDR</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">addrTo</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SOCKADDR</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//清空发送编辑框中的内容
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">SetDlgItemText</span><span class="p">(</span><span class="n">IDC_EDIT_SEND</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　为了让编辑框控件接受换行符，必须设置该控件支持多行数据这一属性。
<img src="http://img.blog.csdn.net/20170428102525898?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="这里写图片描述"
	
	
></p>
<p>　　将“发送”设置为Default button，还可以选择取消Visible选项。
　　本例在一个程序中同时实现了接收端和发送端的功能，所以只需在聊天双方各自的机器上安装本程序，在聊天时，通过输入对方主机的IP地址，就可以与对方进行通信了。</p>
<h1 id="activex控件">ActiveX控件
</h1><h2 id="activex控件-1">ActiveX控件
</h2><p>OCX是ActiveX控件的一种后缀名。但ActiveX控件对应的文件也可以是其他后缀名，例如DLL。作为一个典型的ActiveX控件，它具有方法、属性、事件这三种特性。在一个文件中可以包含多个ActiveX控件。</p>
<h3 id="mfc-activex-controlwizard">MFC ActiveX ControlWizard
</h3><h1 id="动态链接库">动态链接库
</h1><p>　　动态链接库有两种加载方式：隐式链接和显式加载</p>
<h2 id="win32-dll的创建和使用">Win32 DLL的创建和使用
</h2><p>　　新建一个Win32 Dynamic-Link Library类型的工程，取名为Dll1。并在AppWizard的第一步选择“An empty Dll project”，即创建一个空的动态链接库工程。然后添加一个C++源文件：Dll1.cpp。添加代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">subtract</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　Build生成Dll1程序。在该工程的Debug目录下，可看到一个Dll1.dll文件，这就是生成的动态链接库文件。</p>
<h3 id="dumpbin命令">Dumpbin命令
</h3><p>　　应用程序如果想要访问某个DLL中的函数，那么该函数必须是已经被导出的函数。为了查看有哪些导出函数，可以用VS提供的命令行工具：Dumpbin实现。</p>
<h3 id="从dll中导出函数">从DLL中导出函数
</h3><p>　　为导出函数，需在每一个将被导出的函数前添加标识符：_declspec(dllexport)。修改上述代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">_declspec</span><span class="p">(</span><span class="n">dllexport</span><span class="p">)</span> <span class="kt">int</span> <span class="n">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">_declspec</span><span class="p">(</span><span class="n">dllexport</span><span class="p">)</span> <span class="kt">int</span> <span class="n">subtract</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　编译后可看到又生成了两个新文件，Dll1.lib，它保存Dll1.dll中导出的函数和变量的符号名。以及DALL1.EXP文件。</p>
<h2 id="隐式链接方式加载dll">隐式链接方式加载DLL
</h2><p>　　编写一个测试程序测试这个动态链接库。新建一个基于对话框的MFC应用程序，取名DllTest，放置两个按钮，ID和Caption分别为：IDC_BTN_ADD，Add，IDC_BTN_SUBTRACT，Subtract。</p>
<h3 id="利用extern声明外部函数">利用extern声明外部函数
</h3><p>　　为让编译器知道这两个函数，需作出声明，注意放在OnBtnAdd函数和OnBtnSubtract函数前面。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="k">extern</span> <span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">extern</span> <span class="kt">int</span> <span class="nf">subtract</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CDllTestDlg</span><span class="o">::</span><span class="n">OnBtnAdd</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Add your control notification handler code here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CString</span> <span class="n">str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">str</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&#34;5 + 3 = %d&#34;</span><span class="p">,</span> <span class="n">add</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">MessageBox</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CDllTestDlg</span><span class="o">::</span><span class="n">OnBtnSubtract</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Add your control notification handler code here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CString</span> <span class="n">str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">str</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&#34;5 - 3 = %d&#34;</span><span class="p">,</span> <span class="n">subtract</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">MessageBox</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　Build后报错：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="o">--------------------</span><span class="nl">Configuration</span><span class="p">:</span> <span class="n">DllTest</span> <span class="o">-</span> <span class="n">Win32</span> <span class="n">Debug</span><span class="o">--------------------</span>
</span></span><span class="line"><span class="cl"><span class="n">Compiling</span> <span class="n">resources</span><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">Compiling</span><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">StdAfx</span><span class="p">.</span><span class="n">cpp</span>
</span></span><span class="line"><span class="cl"><span class="n">Compiling</span><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">DllTest</span><span class="p">.</span><span class="n">cpp</span>
</span></span><span class="line"><span class="cl"><span class="n">DllTestDlg</span><span class="p">.</span><span class="n">cpp</span>
</span></span><span class="line"><span class="cl"><span class="n">Generating</span> <span class="n">Code</span><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">Linking</span><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">DllTestDlg</span><span class="p">.</span><span class="nl">obj</span> <span class="p">:</span> <span class="n">error</span> <span class="nl">LNK2001</span><span class="p">:</span> <span class="n">unresolved</span> <span class="n">external</span> <span class="n">symbol</span> <span class="s">&#34;int __cdecl add(int,int)&#34;</span> <span class="p">(</span><span class="o">?</span><span class="n">add</span><span class="err">@@</span><span class="n">YAHHH</span><span class="err">@</span><span class="n">Z</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">DllTestDlg</span><span class="p">.</span><span class="nl">obj</span> <span class="p">:</span> <span class="n">error</span> <span class="nl">LNK2001</span><span class="p">:</span> <span class="n">unresolved</span> <span class="n">external</span> <span class="n">symbol</span> <span class="s">&#34;int __cdecl subtract(int,int)&#34;</span> <span class="p">(</span><span class="o">?</span><span class="n">subtract</span><span class="err">@@</span><span class="n">YAHHH</span><span class="err">@</span><span class="n">Z</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Debug</span><span class="o">/</span><span class="n">DllTest</span><span class="p">.</span><span class="nl">exe</span> <span class="p">:</span> <span class="n">fatal</span> <span class="n">error</span> <span class="nl">LNK1120</span><span class="p">:</span> <span class="mi">2</span> <span class="n">unresolved</span> <span class="n">externals</span>
</span></span><span class="line"><span class="cl"><span class="err">执行</span> <span class="n">link</span><span class="p">.</span><span class="n">exe</span> <span class="err">时出错</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">DllTest</span><span class="p">.</span><span class="n">exe</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">error</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">0</span> <span class="n">warning</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　可看到编译成功，错误发生在链接时。为解决该问题，需利用动态链接库的引入库文件。
　　在Dll1.dll文件所在目录下，复制Dll1.lib文件，并将其复制到DllTest程序所在目录下，这个文件中就包含了Dll1.dll中导出函数的符号名。
　　然后在DllTest中，选择Porject\Settings\link，在Object/library modules中输入dll1.lib。
　　再次编译，成功生成DllTest.exe文件。
　　（可利用dumpbin -imports dlltest.exe查看输入信息）</p>
<p>　　运行程序，弹出报错对话框：
<img src="http://img.blog.csdn.net/20170709130424898?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="报错"
	
	
></p>
<p>　　将Dll1.dll放置在DllTest工程所在目录下，就好了。</p>
<p>　　效果如图。
<img src="http://img.blog.csdn.net/20170709130702138?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="效果"
	
	
></p>
<h3 id="depends工具">Depends工具
</h3><p>　　在Microsoft Visual Studio\Common\Tools中有一个DEPENDS.EXE，该工具可以查看可执行程序，还可以查看动态链接库，主要是看它们依赖于哪些动态链接库。
　　打开该工具，单击File\Open，选择DllText.exe，将会看到：
<img src="http://img.blog.csdn.net/20170709132044018?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="DEPENDS"
	
	
></p>
<p>　　DllTest程序需访问Dll1.dll这一动态链接库，但该文件名前有一个问号，说明没有找到Dll1.dll这个动态链接库。这是因为前面将动态链接库文件放在了\DllTest\Debug目录的上一级目录下了。这里，可将Dll1.dll文件再复制到\DllTest\Debug目录下，然后重启Depends工具。这时问号就没有了。（因为Dll1.dll与DllTest.exe位于同一目录，在打开DllTest.exe时，就可找到该动态链接库。）</p>
<p><img src="http://img.blog.csdn.net/20170709132630578?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="成功"
	
	
></p>
<h3 id="利用_declspecdllimport声明外部函数">利用_declspec(dllimport)声明外部函数
</h3><p>　　除了使用extern关键字表明函数是外部定义的之外，还可以使用标识符：_declspec(dllimport)来表明函数是从动态链接库中引入的。将之前的extern声明注释起来。添加：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">_declspec</span><span class="p">(</span><span class="n">dllimport</span><span class="p">)</span> <span class="kt">int</span> <span class="n">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">_declspec</span><span class="p">(</span><span class="n">dllimport</span><span class="p">)</span> <span class="kt">int</span> <span class="n">subtract</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　若调用的函数来自于动态链接库，应采用这种方式声明外部函数，编译器可以生成运行效率更高的代码。</p>
<h2 id="完善win32-dll例子">完善Win32 DLL例子
</h2><p>　　为知道DLL有哪些导出函数，通常在编写动态链接库时，会提供一个头文件，在此提供DLL导出函数原型的声明，以及函数有关注释文档。</p>
<p>　　为DLL1工程添加一个头文件：Dll1.h，并添加代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">_declspec</span><span class="p">(</span><span class="n">dllimport</span><span class="p">)</span> <span class="kt">int</span> <span class="n">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">_declspec</span><span class="p">(</span><span class="n">dllimport</span><span class="p">)</span> <span class="kt">int</span> <span class="n">subtract</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　然后将DllTestDlg.cpp先前添加的声明语句注释起来，并在前部添加下面的语句：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;dll1.h&#34;</span><span class="cp">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>　　Build并运行，结果和之前一样。</p>
<p>　　所以在发布Dll1.dll动态链接库时，可将Dll1.h头文件一起提供给使用者。</p>
<p>　　下面对Dll.h进行改造，使其不仅能为调用动态链接库的客户端程序服务，也能由动态链接库程序自身来使用。修改头文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#ifdef DLL1_API
</span></span></span><span class="line"><span class="cl"><span class="cp">#else
</span></span></span><span class="line"><span class="cl"><span class="cp">#define DLL1_API _declspec(dllimport)
</span></span></span><span class="line"><span class="cl"><span class="cp">#endif
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">_declspec</span><span class="p">(</span><span class="n">dllimport</span><span class="p">)</span> <span class="kt">int</span> <span class="n">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">_declspec</span><span class="p">(</span><span class="n">dllimport</span><span class="p">)</span> <span class="kt">int</span> <span class="n">subtract</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　修改Dll1.cpp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#define DLL1_API _declspec(dllexport)
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;Dll1.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">subtract</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　将重新生成的文件复制，运行，结果也是正确的。</p>
<h2 id="从dll中导出c类">从DLL中导出C++类
</h2><p>　　在一个动态链接库中还可以导出一个C++类。
　　在Dll1.h中添加如下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DLL1_API</span> <span class="n">Point</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="n">output</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　在Dll1.cpp中改为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#define DLL1_API _declspec(dllexport)
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;Dll1.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Windows.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">subtract</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Point</span><span class="o">::</span><span class="n">output</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//返回调用者进程当前正在使用的那个窗口的句柄
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">HWND</span> <span class="n">hwnd</span> <span class="o">=</span> <span class="n">GetForegroundWindow</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//获取DC
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">HDC</span> <span class="n">hdc</span> <span class="o">=</span> <span class="n">GetDC</span><span class="p">(</span><span class="n">hwnd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;x = %d, y = %d&#34;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//输出坐标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">TextOut</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//释放DC
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">ReleaseDC</span><span class="p">(</span><span class="n">hwnd</span><span class="p">,</span> <span class="n">hdc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　将Dll1.dll和Dll1.lib复制到测试工程DllTest所在目录下（本例将对应Dll1.h也放在了DllTest项目工程下，所以Dll1.h也应相应复制过来）。为避免麻烦，也可以把动态链接库文件所在目录添加到系统的环境变量Path中。这样就无需复制。
　　为测试这个新生成的DLL，打开DllTest工程，在对话框中增加一个按钮，属性为IDC_BTN_OUTPUT，Capition为Output。双击按钮添加响应函数OnBtnOutput。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CDllTestDlg</span><span class="o">::</span><span class="n">OnBtnOutput</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Add your control notification handler code here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Point</span> <span class="n">pt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pt</span><span class="p">.</span><span class="n">output</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>　　记得删除Debug下的旧Dll1.dll，放入新的，否则会报错。
<img src="http://img.blog.csdn.net/20170813113649482?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHVib2ppbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"
	
	
	
	loading="lazy"
	
		alt="Output"
	
	
>
　　可利用Dumpbin命令的exports选项查看Dll1.dll这一动态链接库的导出情况，利用imports选项查看测试程序的导入情况。</p>
<p>另外，在实现动态链接库时，可以不导出整个类，而只导出该类中的某些函数。
打开Dll1工程，在Dll1.h中将声明Point类时使用的DLL1_API宏注释起来，然后在output函数的声明前放置DLL1_API宏。这样就表示只导出Point类中的成员函数output。为证实这一点，为Point类再添加一个成员函数test，</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="k">class</span> <span class="err">/*</span><span class="nc">DLL1_API</span><span class="err">*/</span> <span class="n">Point</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="n">DLL1_API</span> <span class="n">output</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">test</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>接着在Dll1.cpp中添加test函数的实现：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Point</span><span class="o">::</span><span class="n">test</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Build后，利用dumpbin命令的exports可查看Dll1.dll的导出信息。
可将所需文件再次复制到DllTest工程中，运行结果和之前相同。
在导出类的成员函数时，该函数必须具有public类型的访问权限，否则即使能被导出也不能被其他程序访问。</p>
<h2 id="解决名字改编问题">解决名字改编问题
</h2><p>C++编译器在生产厂DLL时，会对导出的函数进行名字改编，由于不同编译器改编规则不同，所以改编后名字不同。若利用不同编译器分别生成DLL和访问该DLL的客户端程序时，后者在访问该DLL的导出函数时就会出现问题。因此希望动态链接库在编译时，导出函数的名称不要发生改变。为此，在定义导出函数时，需加上限定符：extern &ldquo;C&rdquo;。C一定要大写。
打开Dll1工程，找到Dll1.cpp和Dll1.h中定义DLL1_API宏的代码，添加限定符。
此时，Dll1.h为</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#ifdef DLL1_API
</span></span></span><span class="line"><span class="cl"><span class="cp">#else
</span></span></span><span class="line"><span class="cl"><span class="cp">#define DLL1_API extern &#34;C&#34; _declspec(dllimport)
</span></span></span><span class="line"><span class="cl"><span class="cp">#endif
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">DLL1_API</span> <span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">DLL1_API</span> <span class="kt">int</span> <span class="nf">subtract</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*class  Point
</span></span></span><span class="line"><span class="cl"><span class="cm">{
</span></span></span><span class="line"><span class="cl"><span class="cm">public:
</span></span></span><span class="line"><span class="cl"><span class="cm">	void DLL1_API output(int x, int y);
</span></span></span><span class="line"><span class="cl"><span class="cm">	void test();
</span></span></span><span class="line"><span class="cl"><span class="cm">};*/</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Dll1.cpp为</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#define DLL1_API extern &#34;C&#34; _declspec(dllexport)
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;Dll1.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Windows.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">subtract</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">void Point::output(int x, int y)
</span></span></span><span class="line"><span class="cl"><span class="cm">{
</span></span></span><span class="line"><span class="cl"><span class="cm">	//返回调用者进程当前正在使用的那个窗口的句柄
</span></span></span><span class="line"><span class="cl"><span class="cm">	HWND hwnd = GetForegroundWindow();
</span></span></span><span class="line"><span class="cl"><span class="cm">	//获取DC
</span></span></span><span class="line"><span class="cl"><span class="cm">	HDC hdc = GetDC(hwnd);
</span></span></span><span class="line"><span class="cl"><span class="cm">	char buf[20];
</span></span></span><span class="line"><span class="cl"><span class="cm">	memset(buf, 0, 20);
</span></span></span><span class="line"><span class="cl"><span class="cm">	sprintf(buf, &#34;x = %d, y = %d&#34;, x, y);
</span></span></span><span class="line"><span class="cl"><span class="cm">	//输出坐标
</span></span></span><span class="line"><span class="cl"><span class="cm">	TextOut(hdc, 0, 0, buf, strlen(buf));
</span></span></span><span class="line"><span class="cl"><span class="cm">	//释放DC
</span></span></span><span class="line"><span class="cl"><span class="cm">	ReleaseDC(hwnd, hdc);
</span></span></span><span class="line"><span class="cl"><span class="cm">}
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">void Point::test()
</span></span></span><span class="line"><span class="cl"><span class="cm">{
</span></span></span><span class="line"><span class="cl"><span class="cm">}
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Build后生成Dll1.dll，用dumpbin命令的exports选项查看该动态链接库的导出信息，发现add和subtract函数名没有被改编。然后利用DllTest工程测试，将Point类的代码注释起来，将发现客户端可访问Dll1中的导出函数。</p>
<p>缺陷：extern &ldquo;C&quot;只能导出全局函数，不能导出一个类的成员函数。另外，如果导出函数的调用约定发生了改变，即使使用了extern &ldquo;C&rdquo;，函数名仍会发生改编。
例如，在Dll1.h中add和subtract函数添加_stdcall关键字标准调用约定。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#ifdef DLL1_API
</span></span></span><span class="line"><span class="cl"><span class="cp">#else
</span></span></span><span class="line"><span class="cl"><span class="cp">#define DLL1_API extern &#34;C&#34; _declspec(dllimport)
</span></span></span><span class="line"><span class="cl"><span class="cp">#endif
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">DLL1_API</span> <span class="n">_stdcall</span> <span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">DLL1_API</span> <span class="n">_stdcall</span> <span class="kt">int</span> <span class="nf">subtract</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在Dll1.cpp中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#define DLL1_API extern &#34;C&#34; _declspec(dllexport)
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;Dll1.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Windows.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">_stdcall</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">_stdcall</span> <span class="nf">subtract</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>没有_stdcall关键字，函数的调用约定就是C调用约定，标准调用约定是WINAPI调用约定，与C调用约定不同。
Build后生成最新Dll1.dll，利用Dumpbin的exports选项查看该动态链接库的导出情况，可看到名字变为_add@8。</p>
<p>这种情况下，可通过模型定义文件（DEF）的方式来解决名字改编问题。
新建一个Win32 Dynamic-Link Library类型的工程，取名为Dll2，在AppWizard第一步选择“An empty Dll project”选项。添加Dll2.cpp，</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">subtract</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在Dll2工程目录下新建一个空文本文件，改后缀为.def，添加到工程Source文件并打开：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">LIBRARY</span> <span class="n">Dll2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">EXPORTS</span>
</span></span><span class="line"><span class="cl"><span class="n">add</span>
</span></span><span class="line"><span class="cl"><span class="n">subtract</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Bulid后利用Dumpbin的exports查看证明没有发生名字改编。</p>
<h2 id="显示加载方式加载dll">显示加载方式加载DLL
</h2><p>将最新的Dll2.dll复制到DllTest工程目录下。将DllTestDlg.cpp包含Dll1.h的那行代码注释起来，在link选项卡上删除对Dll1.lib的链接。
需用到LoadLibrary函数。</p>
<p>　　To be continued…
　　听听那冷雨</p>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/mfc/">MFC</a>
        
            <a href="/tags/cpp/">CPP</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
	const mainArticleElement = document.querySelector(".main-article");
        renderMathInElement(mainArticleElement, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>

    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/r4jjfhrr/">
        
        

        <div class="article-details">
            <h2 class="article-title">知识杂记</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/fgrl9cjx/">
        
        

        <div class="article-details">
            <h2 class="article-title">树状控件与列表控件交互以及XML的解析</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/4nbzpd7n/">
        
        

        <div class="article-details">
            <h2 class="article-title">一个MFC利用MSXML解析XML的最简例子</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/q58azm6e/">
        
        

        <div class="article-details">
            <h2 class="article-title">图</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/y456dm9v/">
        
        

        <div class="article-details">
            <h2 class="article-title">线性表</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src='//unpkg.com/@waline/client@v2/dist/waline.js'></script>
<link href='//unpkg.com/@waline/client@v2/dist/waline.css' rel='stylesheet'/>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
        --waline-font-size: var(--article-font-size);
    }
    .waline-container .wl-count {
        color: var(--card-text-color-main);
    }
</style><script>
    
    Waline.init({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://unpkg.com/@waline/emojis@1.0.1/weibo"],"locale":{"admin":"Admin","placeholder":"评论一句，好运+1！"},"requiredMeta":["name"],"serverURL":"https://zippy-halva-8e20f0.netlify.app/.netlify/functions/comment"});
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2015 - 
        
        2025 靖待
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
